pe.Floater=function(t,e,i){pe.init_widget(this,t),this.bottom_margin=i||0,this.start_point_div=t.find(".FloatingAreaStart"),this.end_point_div=e||null,this.start_from=0,this.stop_at=0,this.is_floating=!1,this.sticked=!1,this.floater=this.container.find(".Floater"),this.offset=0,this.disabled=!1,this.top=parseInt(this.floater.css("margin-top"),10)||0,$(window).scroll(this.callback(this.scrolling)),this.set_floating_area(),pe.Floater.register_floater(this)},pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"},pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top,this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)},pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var t=$(window).scrollTop(),e=t+this.offset+this.bottom_margin<=this.start_from,i=t+this.offset+this.bottom_margin>this.start_from,o=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;this.is_floating||!i||o||this.sticked?this.is_floating&&e?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,this)):this.end_point_div&&(!this.sticked&&o?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&t+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick()):(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this))}},pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed"),this.floater.removeClass("bottom"),this.is_floating=!0,this.sticked=!1,this.set_offset()},pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px"),this.floater.removeClass("fixed"),this.floater.css("position","absolute"),this.is_floating=!1,this.sticked=!0},pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px"),this.floater.removeClass("fixed"),this.floater.css("position","absolute"),this.is_floating=!1,this.sticked=!0,this.disabled=!0},pe.Floater.prototype.enable=function(){this.disabled=!1},pe.Floater.prototype.unstick=function(){this.floater.css("margin-top",""),this.floater.css("top",""),this.floater.css("position",""),this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this)},pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top",""),this.floater.removeClass("fixed"),this.floater.removeClass("bottom"),this.is_floating=!1,this.sticked=!1,this.set_offset()},pe.Floater.prototype.set_offset=function(t){t&&(this.offset=t),0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")},pe.Floater.registered_floaters=[],pe.Floater.register_floater=function(t){pe.Floater.registered_floaters.push(t),pe.Floater.update_positions()},pe.Floater.update_positions=function(){if(pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(t){return t.container.offset().top},null),pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var t=1;t<pe.Floater.registered_floaters.length;t++){var e=pe.Floater.registered_floaters[t-1].floater,i=(pe.Floater.registered_floaters[t].floater,pe.Floater.registered_floaters[t-1].offset+e.outerHeight());pe.Floater.registered_floaters[t].offset=i,pe.Floater.registered_floaters[t].is_floating&&pe.Floater.registered_floaters[t].start_floating(),pe.Floater.registered_floaters[t].set_floating_area()}},function(n){var s;n.rails=s={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",fileInputSelector:"input:file",CSRFProtection:function(t){var e=n('meta[name="csrf-token"]').attr("content");e&&t.setRequestHeader("X-CSRF-Token",e)},fire:function(t,e,i){var o=n.Event(e);return t.trigger(o,i),!1!==o.result},confirm:function(t){return confirm(t)},ajax:function(t){return n.ajax(t)},handleRemote:function(o){var t,e,i,a=o.data("type")||n.ajaxSettings&&n.ajaxSettings.dataType;if(s.fire(o,"ajax:before")){if(o.is("form")){t=o.attr("method"),e=o.attr("action"),i=o.serializeArray();var r=o.data("ujs:submit-button");r&&(i.push(r),o.data("ujs:submit-button",null))}else t=o.data("method"),e=o.attr("href"),i=null;s.ajax({url:e,type:t||"GET",data:i,dataType:a,beforeSend:function(t,e){return e.dataType===undefined&&t.setRequestHeader("accept","*/*;q=0.5, "+e.accepts.script),s.fire(o,"ajax:beforeSend",[t,e])},success:function(t,e,i){o.trigger("ajax:success",[t,e,i])},complete:function(t,e){o.trigger("ajax:complete",[t,e])},error:function(t,e,i){o.trigger("ajax:error",[t,e,i])}})}},handleMethod:function(t){var e=t.attr("href"),i=t.data("method"),o=n("meta[name=csrf-token]").attr("content"),a=n("meta[name=csrf-param]").attr("content"),r=n('<form method="post" action="'+e+'"></form>'),s='<input name="_method" value="'+i+'" type="hidden" />';a!==undefined&&o!==undefined&&(s+='<input name="'+a+'" value="'+o+'" type="hidden" />'),r.hide().append(s).appendTo("body"),r.submit()},disableFormElements:function(t){t.find(s.disableSelector).each(function(){var t=n(this),e=t.is("button")?"html":"val";t.data("ujs:enable-with",t[e]()),t[e](t.data("disable-with")),t.attr("disabled","disabled")})},enableFormElements:function(t){t.find(s.enableSelector).each(function(){var t=n(this),e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.removeAttr("disabled")})},allowAction:function(t){var e,i=t.data("confirm"),o=!1;return!i||(s.fire(t,"confirm")&&(o=s.confirm(i),e=s.fire(t,"confirm:complete",[o])),o&&e)},blankInputs:function(t,e,i){var o,a=n(),r=e||"input,textarea";return t.find(r).each(function(){o=n(this),(i?o.val():!o.val())&&(a=a.add(o))}),!!a.length&&a},nonBlankInputs:function(t,e){return s.blankInputs(t,e,!0)},stopEverything:function(t){return t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(t){var e=t.data("events"),i=!0;return e!==undefined&&e.submit!==undefined&&n.each(e.submit,function(t,e){if("function"==typeof e.handler)return i=e.handler(e.data)}),i}},"ajaxPrefilter"in n?n.ajaxPrefilter(function(t,e,i){s.CSRFProtection(i)}):n(document).ajaxSend(function(t,e){s.CSRFProtection(e)}),n(s.linkClickSelector).live("click.rails",function(t){var e=n(this);return s.allowAction(e)?e.data("remote")!==undefined?(s.handleRemote(e),!1):e.data("method")?(s.handleMethod(e),!1):void 0:s.stopEverything(t)}),n(s.formSubmitSelector).live("submit.rails",function(t){var e=n(this),i=e.data("remote")!==undefined,o=s.blankInputs(e,s.requiredInputSelector),a=s.nonBlankInputs(e,s.fileInputSelector);return s.allowAction(e)?o&&s.fire(e,"ajax:aborted:required",[o])?!i:i?a?s.fire(e,"ajax:aborted:file",[a]):n.support.submitBubbles||!1!==s.callFormSubmitBindings(e)?(s.handleRemote(e),!1):s.stopEverything(t):void setTimeout(function(){s.disableFormElements(e)},13):s.stopEverything(t)}),n(s.formInputClickSelector).live("click.rails",function(t){var e=n(this);if(!s.allowAction(e))return s.stopEverything(t);var i=e.attr("name"),o=i?{name:i,value:e.val()}:null;e.closest("form").data("ujs:submit-button",o)}),n(s.formSubmitSelector).live("ajax:beforeSend.rails",function(t){this==t.target&&s.disableFormElements(n(this))}),n(s.formSubmitSelector).live("ajax:complete.rails",function(t){this==t.target&&s.enableFormElements(n(this))})}(jQuery);