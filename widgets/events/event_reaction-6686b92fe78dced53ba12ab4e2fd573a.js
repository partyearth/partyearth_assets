pe.EventReaction=function(a,b,c){pe.init_widget(this,a);this.button=this.container.find(".Button");this.people_list_container=this.container.find(".People");this.visitors_container=this.container.find(".VisitorsList");this.reaction=b;this.clicked=void 0;gigya&&(this.user_action=new gigya.socialize.UserAction,this.user_action.addMediaItem({type:"image",src:$('meta[property="og:image"]').attr("content"),href:window.location.href}),this.user_action.setLinkBack(window.location.href),this.user_action.setTitle($('meta[property="og:title"]').attr("content")),
this.user_action.setDescription($('meta[property="og:description"]').attr("content")),this.user_action.setSubtitle("www.partyearth.com"),this.user_action.setUserMessage("I'm going!"),this.user_action.addActionLink("Learn more",window.location.href),this.twitter_user_action=this.user_action.clone(),this.twitter_user_action.setTitle(""),this.twitter_user_action.setUserMessage(window.twitter_user_message));this.bar_id=window.location.pathname+"/going";this.reactions_bar_params={barID:this.bar_id,showCounts:"none",
containerID:this.button.attr("id"),reactions:[this.reaction],userAction:this.user_action,twitterUserAction:this.twitter_user_action,showSuccessMessage:!1,multipleReactions:!1,showAlwaysShare:"hide",noButtonBorders:!1,cid:"event",enabledProviders:"facebook, twitter, yahoo, messenger, myspace",onReactionClicked:this.callback(this.on_click),onReactionUnclicked:this.callback(this.on_unclick),onSendDone:c,context:"pe.event_reaction"};gigya&&(gigya.socialize.getFriendsInfo({callback:this.callback(this.on_friends_received),
enabledProviders:"facebook,twitter,yahoo,google,foursquare,aol,messenger"}),gigya.socialize.showReactionsBarUI(this.reactions_bar_params))};pe.EventReaction.prototype.on_friends_received=function(){$.get("/reactions",{url:window.location.pathname},this.callback(function(a){this.people_list_container.show().removeClass("hidden");this.people_list_container.html(a);_.isEmpty(a.replace(/\s+/,""))||this.visitors_container.show().removeClass("hidden")}))};
pe.EventReaction.prototype.reorder_friends=function(a,b){_.each(b,function(b,d){_.each(a,function(a){a=this.find_user_li(d,a[b]);0<a.length&&this.people_list_container.prepend(a)},this)},this)};pe.EventReaction.prototype.post_reaction=function(a){(this.user_data=a)&&a.UID&&$.post("/reactions",{url:window.location.href,going:this.going,user_data:a.user},this.callback(function(){if(this.clicked)this.on_friends_received();else this.leave_list()}),"json")};
pe.EventReaction.prototype.leave_list=function(){this.find_user_li("uid",this.user_data.user.UID).remove();1>this.people_list_container.find("li").length&&this.visitors_container.hide()};pe.EventReaction.prototype.find_user_li=function(a,b){return this.people_list_container.find("li[data-"+a+'="'+b+'"]')};pe.EventReaction.prototype.on_click=function(a){this.clicked=!0;this.on_reaction(a)};pe.EventReaction.prototype.on_unclick=function(a){this.clicked=!1;this.on_reaction(a)};
pe.EventReaction.prototype.on_reaction=function(){this.user_data?this.post_reaction(this.user_data):gigya&&gigya.socialize.getUserInfo({callback:this.callback(this.post_reaction)})};
