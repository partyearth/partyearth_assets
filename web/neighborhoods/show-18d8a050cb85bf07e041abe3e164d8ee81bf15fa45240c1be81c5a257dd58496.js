pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"},pe.routes.build_path=function(e,t){var i=pe.routes.map[e],a=i.match(/\{\{\*(.+)\}\}/);return _.each(a,function(e){t[e]&&(t[e]=t[e].join("/"))}),i=i.replace(/\*/,""),t=t||{},pe.routes.clean_url(pe.templatize(i,t))},pe.routes.clean_url=function(e){return("/"+e).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")},pe.routes.current_url_params=function(){var e=pe.routes.recognize_path(window.location.pathname);return e?e.params:{}},pe.routes.recognize_path=function(t){var i,a;t=pe.routes.clean_url(t);var e=_.find(_.keys(pe.routes.map),function(e){return i=pe.routes.map[e],(a=new RegExp(i.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"))).test(t)});if(e){for(var o=_.map(i.match(/\{\{[^\}]+\}\}/g),function(e){return e.replace(/\{|\}/g,"")}),n=t.match(a).slice(1,99),s={params:{}},r=function(e){return!_.isEmpty(e)},p=0;p<o.length;p++)"*"==o[p][0]&&(o[p]=o[p].replace(/\*/g,""),n[p]=_.select(n[p].replace(/\*/g,"").split("/"),r)),s.params[o[p]]=n[p];return s.path_info={name:e,template:i},s}return!1},pe.routes.Request=function(e,t,i){pe.routes.map[e]?(this.path=e,"object"!=typeof t&&(t={id:t}),this.params=t,this.callback=i):alert("This path is not registered in the routes map.")},pe.routes.Request.factory=function(e,t,i){return new pe.routes.Request(e,t,i)},pe.routes.Request.from_current_location=function(e,t,i){t=t||{};var a=pe.routes.current_url_params();return new pe.routes.Request(e,_.extend(a,t),i)},pe.routes.Request.prototype.ajax=function(e,t){var i="function"==typeof t?t:this.callback;$.ajax({url:this.build_path(),data:this.params,type:e,success:i})},pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)},pe.routes.Request.prototype.get=function(e){this.ajax("GET",e)},pe.routes.Request.prototype.post=function(e){this.ajax("POST",e)},pe.init_calendar_buttons=function(){new pe.AddToCalendarButton},pe.AddToCalendarButton=function(){pe.init_widget(this,null),$(".AddToCalendarButton").live("click",this.callback(this.show_dialog))},pe.AddToCalendarButton.prototype.close_dialog=function(){},pe.AddToCalendarButton.prototype.show_dialog=function(e){var t=$('<div title="Add to your calendar">'),i=function(){t.empty(),t.dialog("destroy")};t.dialog({modal:!0,show:!1,close:i}),t.html('<div style="margin:0 auto; width: 80px;"><img src="/assets/content_bg/spinner.gif"/></div>');var a=$(e.currentTarget);if(params={event_id:a.data("event_id")},date=a.data("date"),params.date=date||null,_.isEmpty(a.data("event_id"))){var o=a.data("source_path");if(_.isEmpty(o))alert("NOR event_id, source_path is set for calendar button");else{var n=pe.routes.recognize_path(o);n?pe.routes.Request.factory(n.path_info.name+"_calendar",n.params,function(e){t.html(e),t.find("a").click(i)}).get():alert("Calendar route is not recognized")}}else pe.ajax_loader.add_to_calendar_dialog.load(params,function(e){t.html(e),t.find("a").click(i)});return!1},pe.HelpModule2=function(){var e=$(".HelperModule");e.length&&(pe.init_widget(this,e),this.container.live("click",this.callback(this.helper_module_div_clicked)),this.container.live("hover",this.callback(this.helper_module_div_hovered)),this.active_popup=null)},pe.HelpModule2.prototype.close_button_clicked=function(){this.destroy_active_popup()},pe.HelpModule2.prototype.create_popup=function(e,t){this.active_popup=$(t),e.append(this.active_popup),$("body").bind("click",this.callback(this.close_button_clicked))},pe.HelpModule2.prototype.destroy_active_popup=function(){$("body").unbind("click"),this.active_popup.remove(),this.active_popup=null},pe.HelpModule2.prototype.helper_module_div_hovered=function(e){var t=$(e.target),i=(t.hasClass("HelperModule")?t:t.closest(".HelperModule")).data("page-id");i&&pe.ajax_loader.help_page.load({page_id:i},this.callback(function(){}))},pe.HelpModule2.prototype.helper_module_div_clicked=function(e){var t,i=$(e.target);t=i.hasClass("HelperModule")?i:i.closest(".HelperModule"),this.active_popup&&this.destroy_active_popup();var a=t.data("page-id");a&&pe.ajax_loader.help_page.load({page_id:a},this.callback(function(e){this.create_popup(t,this.popup_html(e))})),e.stopPropagation()},pe.HelpModule2.prototype.popup_html=function(e){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <span class="title">{{title}}:&nbsp;&nbsp;</span> {{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',e)},pe.ChangeImageOnHover=function(e,t){pe.init_widget(this,e),this.image_container=this.container.find(".ImageContainer"),this.link_parent_class=t||null,this.include_caption=this.container.data("include-caption")||!1,this.object_links=this.container.find(".HoverLinkToChange"),this.object_links.mouseover(this.callback(this.object_link_hovered));var i=t?this.container.find("."+t):[];this.link_wrappers=0<i.length?i:this.object_links.parent()},pe.ChangeImageOnHover.prototype.image_html=function(e){var t='<a href="{{object_url}}" title="{{link_title}}" class="thumbnail_link"><img src="{{image_url}}" alt="{{alt_tag}}"></a>';this.include_caption&&(t+='<p class="name"><span class="date">{{link_prefix}}</span><a href="{{object_url}}">{{image_caption}}</a></p>');var i={object_url:e.attr("href"),image_url:e.data("image-url"),link_title:e.data("title")||"",alt_tag:e.data("image-alt-tag")||"",link_prefix:e.data("link-prefix")||"",image_caption:e.html()};return pe.templatize(t,i)},pe.ChangeImageOnHover.instantiate_all=function(t){return $.map($(".ChangeImageOnHoverContainer"),function(e){return new pe.ChangeImageOnHover($(e),t)})},pe.ChangeImageOnHover.prototype.object_link_hovered=function(e){var t=$(e.target);this.object_links.removeClass("selected"),this.link_wrappers.removeClass("selected"),t.addClass("selected"),this.link_wrapper(t).addClass("selected"),this.image_container.html(this.image_html(t)),pe.convert_to_rounded_corners()},pe.ChangeImageOnHover.prototype.link_wrapper=function(e){return this.link_parent_class?e.closest("."+this.link_parent_class):e.parent()},pe.map_tools.array_contains_marker=function(e,i){var a=!1;return $.each(e,function(e,t){if(t.object_id===i)return!(a=!0)}),a},pe.map_tools.event_map_data=function(e){var n=[];return $.each(e,function(e,o){$.each(o.locations,function(e,t){if(!t.latitude)return!0;var i=t.name,a=pe.map_tools.find_venue_by_name_in_array(n,i);a||(a={name:i,url:t.url,id:t.id,latitude:t.latitude,longitude:t.longitude,thumbnail:t.photo,small_pin:t.small_pin,ordering:o.ordering,favorite_id:o.favorite_id,city_id:o.city_id,events:[]},n.push(a)),a.events.push(o)})}),n},pe.map_tools.find_marker=function(e,i){var a=null;return $.each(e,function(e,t){if(t.object_id===i)return a=t,!1}),a},pe.map_tools.find_markers_to_remove=function(e,i){return $.map(e,function(e){if(e.type===pe.Map.marker_types.USER_LOCATION)return!0;var t=pe.map_tools.get_marker_object(i,e);return t?!1===t.map_visibility?e:JSON.stringify(e.events)!==JSON.stringify(t.events)?e:void 0:e})},pe.map_tools.find_objects_to_add=function(i,e){var a=[];return $.each(e,function(e,t){pe.map_tools.markers_contain_venue(i,t)||a.push(t)}),a},pe.map_tools.find_venue_by_name_in_array=function(e,i){var a=null;return $.each(e,function(e,t){if(t.name===i)return a=t,!1}),a},pe.map_tools.get_city_name_from_google_address_lookup_result=function(e){var a=null;return $.each(e.address_components,function(e,t){var i=!1;if($.each(t.types,function(e,t){"locality"===t&&(i=!0)}),i)return a=t.long_name,!1}),a},pe.map_tools.get_marker_object=function(e,i){var a=null;return $.each(e,function(e,t){if(i.object_id===t.id)return a=t,!1}),a},pe.map_tools.markers_contain_venue=function(e,i){var a=!1;return $.each(e,function(e,t){if(t.object_id===i.id&&JSON.stringify(t.events)===JSON.stringify(i.events))return!(a=!0)}),a},pe.map_tools.marker_icon=function(e,t){var i="http://www.partyearth.com/assets/map/";switch(e){case pe.Map.marker_types.CITY:i+="city.png";break;case pe.Map.marker_types.CURRENT_OBJECT:i+="location.png";break;case pe.Map.marker_types.EVENT:i+=t.disabled?"event_transparent.png":"event.png";break;case pe.Map.marker_types.EVENT_HIGHLIGHTED:i+="event_highlighted.png";break;case pe.Map.marker_types.HOTSPOT:i+=t.disabled?"hotspot_transparent.png":"hotspot.png";break;case pe.Map.marker_types.LANDMARK:i+="landmark.png";break;case pe.Map.marker_types.OTHER_EVENT:i+="event_small.png";break;case pe.Map.marker_types.OTHER_VENUE:i+="venue_small.png";break;case pe.Map.marker_types.RUNNERS:i+="pamplona/runners.png";break;case pe.Map.marker_types.SPECTATORS:i+="pamplona/spectators.png";break;case pe.Map.marker_types.TIME:i+="pamplona/time.png";break;case pe.Map.marker_types.USER_LOCATION:i+="location.png";break;case pe.Map.marker_types.VENUE:i+=t.disabled?"venue_transparent.png":"venue.png"}return i},pe.map_tools.numbered_marker_icon=function(e,t){return"http://cdn.partyearth.com/assets/map/pins/"+e.toLowerCase()+"/map/"+pe.map_tools.format_marker_id(String(t))+".png"},pe.map_tools.format_marker_id=function(e){return 3<e.length?"0000":"0000".substr(0,4-e.length)+e},pe.map_tools.objects_have_marker=function(e,i){var a=!1;return $.each(e,function(e,t){if(i.object_id===t.id&&JSON.stringify(i.events)===JSON.stringify(t.events))return!(a=!0)}),a},pe.map_tools.remove_marker_from_array=function(e,t){return $.map(e,function(e){return e.object_id===t.object_id?null:e})},pe.map_tools.venues_contain_venue=function(e,i){var a=!1;return $.each(e,function(e,t){if(t.id===i)return!(a=!0)}),a},pe.Map=function(e,t,i,a,o,n){pe.init_widget(this,e),n=n||{},this.map=new google.maps.Map(e[0],{zoom:a,center:new google.maps.LatLng(t,i),mapTypeId:o,minZoom:2,scrollwheel:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}}),this.bounds=new google.maps.LatLngBounds,google.maps.event.addListener(this.map,"zoom_changed",this.callback(this.zoom_changed)),google.maps.event.addListener(this.map,"dragend",this.callback(this.dragend));var s=new google.maps.OverlayView;s.draw=function(){},s.setMap(this.map),this.overlay=s;var r=$(".MapTooltip");0===r.length&&(r=$('<div class="map_tooltip MapTooltip"></div>'),e.parent().append(r)),this.map_tooltip=r;var p=$(".MapPopup");0===p.length&&(p=$('<div class="map_popup MapPopup"></div>'),e.parent().append(p)),this.map_popup=p,this.markers={},this.markers.CITY=[],this.markers.CURRENT_OBJECT=[],this.markers.EVENT=[],this.markers.LANDMARK=[],this.markers.USER_LOCATION=[],this.markers.VENUE=[],this.current_venue_ids=[],this.global_zoom_level_limit=8,this.current_zoom_level=a,this.zoom_state=null,this.zoom_changed(),this.clicked_marker=null,this.default_city=n.city,this.show_tooltips=!0},pe.Map.events={CITY_CHANGED:"Map_CITY_CHANGED",CITY_MARKER_CLICKED:"Map_CITY_MARKER_CLICKED",DRAGEND:"Map_DRAGEND",MARKER_CLICKED:"Map_MARKER_CLICKED",MARKER_HOVERED:"Map_MARKER_HOVERED",MARKER_BLURRED:"Map_MARKER_BLURRED",LANDMARK_MARKER_CLICKED:"Map_LANDMARK_MARKER_CLICKED",ZOOM_LEVEL_CHANGED:"Map_ZOOM_LEVEL_CHANGED",ZOOM_STATE_CHANGED:"Map_ZOOM_STATE_CHANGED"},pe.Map.marker_types={CITY:"CITY",CURRENT_OBJECT:"CURRENT_OBJECT",EVENT:"EVENT",EVENT_HIGHLIGHTED:"EVENT_HIGHLIGHTED",HOTSPOT:"HOTSPOT",LANDMARK:"LANDMARK",OTHER_EVENT:"OTHER_EVENT",OTHER_VENUE:"OTHER_VENUE",RUNNERS:"Tip for Runners",SPECTATORS:"Tip for Spectators",TIME:"Pamplona Run Time",USER_LOCATION:"USER_LOCATION",VENUE:"VENUE"},pe.Map.zoom_states={GLOBAL:"GLOBAL",LOCAL:"LOCAL"},pe.Map.prototype.add_marker=function(e){var t=e.small_pin?500:1e3;e.ordering&&(t-=e.ordering);var i={position:new google.maps.LatLng(e.latitude,e.longitude),map:this.map,icon:e.icon,cursor:this.show_tooltips?"pointer":"https://maps.gstatic.com/mapfiles/openhand_8_8.cur",zIndex:e.zIndex||t},a=new google.maps.Marker(i);a.bubble_html=e.bubble_html,a.popup_html=e.popup_html,a.type=e.type,a.object_id=e.object_id,a.object_url=e.object_url,a.city_id=e.city_id,a.events=e.events,a.is_visible=e.is_visible,a.small_pin=e.small_pin,a.ordering=e.ordering,a.favorite_id=e.favorite_id;var o=this;return o.show_tooltips&&google.maps.event.addListener(a,"click",function(){o.marker_clicked(a),o.fire_event(pe.Map.events.MARKER_CLICKED,this)}),o.show_tooltips&&google.maps.event.addListener(a,"mouseover",function(){o.marker_hovered(a),o.fire_event(pe.Map.events.MARKER_HOVERED,this)}),google.maps.event.addListener(a,"mouseout",function(){o.marker_blurred(a),o.fire_event(pe.Map.events.MARKER_BLURRED,this)}),this.markers[e.type].push(a),a},pe.Map.prototype.centrize=function(){var e=this.map.getCenter();google.maps.event.trigger(this.map,"resize"),this.map.setCenter(e)},pe.Map.prototype.centrize_bounds=function(){var e=this.bounds.getCenter();google.maps.event.trigger(this.map,"resize"),this.map.setCenter(e)},pe.Map.prototype.centrize_to_marker=function(e){var t=e||_.sortBy(_.union(this.markers.VENUE,this.markers.EVENT),function(e){return e.ordering})[0];if(t){var i=t.position;google.maps.event.trigger(this.map,"resize"),this.map.setCenter(i)}},pe.Map.prototype.marker_coordinates_weights=function(e){return e.small_pin?{left:{x:15,y:40},right:{x:15,y:40}}:{left:{x:15,y:50},right:{x:25,y:50}}},pe.Map.prototype.marker_blurred=function(){this.map_tooltip.hide()},pe.Map.prototype.marker_hovered=function(e){this.clicked_marker!=e&&(this.map_tooltip.html(e.bubble_html),this.map_tooltip.show(),this.set_popup_tooltip_div_position(this.map_tooltip,e))},pe.Map.prototype.marker_clicked=function(e){switch((this.clicked_marker=e).type){case pe.Map.marker_types.VENUE:e.is_visible&&this.show_popup(e);break;case pe.Map.marker_types.EVENT:this.show_popup(e)}},pe.Map.prototype.set_popup_tooltip_div_position=function(e,t){var i=this.marker_position_on_map(t),a=this.container.width(),o=this.marker_coordinates_weights(t);i.x>a/2?(e.css("right",a-i.x+o.right.x),e.css("left",""),e.css("top",i.y-o.right.y),e.removeClass("map_popup_right")):(e.css("right",""),e.css("left",i.x+o.left.x),e.css("top",i.y-o.left.y),e.addClass("map_popup_right"))},pe.Map.prototype.marker_position_on_map=function(e){var t=this.overlay.getProjection(),i=e.getPosition();return t.fromLatLngToContainerPixel(i)},pe.Map.prototype.marker_position_on_page=function(e){var t=this.marker_position_on_map(e);return{x:this.container.offset().left+t.x,y:this.container.offset().top+t.y}},pe.Map.prototype.bubble_template_city=function(e){return pe.templatize('<div class="bubble_text"><span class="bubble_headline">{{name}}</span></div>',e)},pe.Map.prototype.bubble_template_event=function(e){if(e.events){var t=e.events[0],i=t.start_date||t.date;t.formatted_date=i?$.datepicker.formatDate("M d",new Date(i)):"",e.events_text=pe.templatize('<li><span class="event_date">{{formatted_date}}</span><a href="{{url}}" class="blue_text">{{name}}</a></li>',t)}return pe.templatize('<div class="map_tooltip_content"><div class="map_popup_tip"><div class="map_popup_tip_inner"></div></div><span class="title">{{name}}</span><ul class="event_list">{{events_text}}</ul></div>',e)},pe.Map.prototype.bubble_template_landmark=function(e){return pe.templatize('<div class="map_tooltip_content"><div class="map_popup_tip"><div class="map_popup_tip_inner"></div></div><span class="title">{{name}}</span></div>',e)},pe.Map.prototype.bubble_template_venue=function(e){return e.venue_types_text=e.venue_types.join(" / "),pe.templatize('<div class="map_tooltip_content"><div class="map_popup_tip"><div class="map_popup_tip_inner"></div></div><span class="title">{{name}}</span><span class="venue_type">{{venue_types_text}}</span></div>',e)},pe.Map.prototype.city_marker_clicked=function(e){this.fire_event(pe.Map.events.CITY_MARKER_CLICKED,e)},pe.Map.prototype.landmark_marker_clicked=function(e){this.fire_event(pe.Map.events.LANDMARK_MARKER_CLICKED,e)},pe.Map.prototype.popup_template_landmark=function(e){return e.image="",e.thumbnail&&(e.image=pe.templatize('<div class="map_venue_img float_left ConvertToRoundedCorners"><img src="'+pe.https(pe.assign_photo_size(e.thumbnail,"100","100x100"))+'" /></div>',e)),pe.templatize('<div class="map_popup_content"><div class="map_popup_close CloseButton"></div><div class="map_popup_tip"><div class="map_popup_tip_inner"></div></div><div class="header">{{name}}</div><div class="main clearfix">{{image}}<div class="details">{{description}}</div></div></div>',e)},pe.Map.prototype.popup_template_user_location=function(e){return pe.templatize('<div class="user_location_popup" style="width:200px !important; height:80px !important;">{{user_location}}</div>',{user_location:e})},pe.Map.prototype.remove_marker=function(e){e.setMap(null),this.markers[e.type]=pe.map_tools.remove_marker_from_array(this.markers[e.type],e)},pe.Map.prototype.set_cities=function(e){$.each(this.markers.CITY,this.callback(function(e,t){this.remove_marker(t)})),$.each(e,this.callback(function(e,t){var i=this.bubble_template_city(t);this.add_marker({type:pe.Map.marker_types.CITY,icon:pe.map_tools.marker_icon(pe.Map.marker_types.CITY,t),object_id:t.id,object_url:t.url,latitude:t.latitude,longitude:t.longitude,bubble_html:i,marker_clicked:this.callback(this.city_marker_clicked)})}))},pe.Map.prototype.set_current_event=function(e){var t=pe.map_tools.event_map_data([e]),i=pe.map_tools.find_objects_to_add(this.markers.EVENT,t);$.each(i,this.callback(function(e,t){this.add_marker({type:pe.Map.marker_types.CURRENT_OBJECT,icon:pe.map_tools.marker_icon(pe.Map.marker_types.CURRENT_OBJECT,t),zIndex:1500,object_id:t.id,object_url:t.url,latitude:t.latitude,longitude:t.longitude,bubble_html:this.bubble_template_event(t),city_id:t.city_id,events:t.events}),this.current_venue_ids.push(t.id)}))},pe.Map.prototype.set_current_venue=function(e){this.add_marker({type:pe.Map.marker_types.CURRENT_OBJECT,icon:pe.map_tools.marker_icon(pe.Map.marker_types.CURRENT_OBJECT,e),zIndex:2e3,object_id:e.id,object_url:e.url,latitude:e.latitude,longitude:e.longitude,bubble_html:this.bubble_template_venue(e),city_id:e.city_id}),this.current_venue_ids.push(e.id)},pe.Map.prototype.set_events=function(e,n){var t=pe.map_tools.event_map_data(e),i=pe.map_tools.find_markers_to_remove(this.markers.EVENT,t);$.each(i,this.callback(function(e,t){-1<this.current_venue_ids.indexOf(t.object_id)||this.remove_marker(t)}));var a=pe.map_tools.find_objects_to_add(this.markers.EVENT,t);$.each(a,this.callback(function(e,t){var i=t.small_pin?pe.Map.marker_types.OTHER_EVENT:pe.Map.marker_types.EVENT,a=n?pe.map_tools.numbered_marker_icon("event",t.ordering):pe.map_tools.marker_icon(i,t);if(!(-1<this.current_venue_ids.indexOf(t.id))){var o=this.add_marker({small_pin:t.small_pin,type:pe.Map.marker_types.EVENT,icon:a,object_id:t.id,object_url:t.url,latitude:t.latitude,longitude:t.longitude,bubble_html:this.bubble_template_event(t),city_id:t.city_id,events:t.events,favorite_id:t.favorite_id,ordering:t.ordering});this.bounds.extend(o.position)}}))},pe.Map.prototype.set_landmarks=function(e){$.each(this.markers.LANDMARK,this.callback(function(e,t){this.remove_marker(t)})),$.each(e,this.callback(function(e,t){0===t.type&&t.map_visibility&&this.add_marker({type:pe.Map.marker_types.LANDMARK,icon:pe.map_tools.marker_icon(pe.Map.marker_types.LANDMARK,t),object_id:t.id,object_url:t.url,latitude:t.latitude,longitude:t.longitude,bubble_html:this.bubble_template_landmark(t),popup_html:this.popup_template_landmark(t),marker_clicked:this.callback(this.landmark_marker_clicked)})}))},pe.Map.prototype.set_venues=function(e,s){var t=pe.map_tools.find_markers_to_remove(this.markers.VENUE,e);$.each(t,this.callback(function(e,t){-1<this.current_venue_ids.indexOf(t.object_id)||this.remove_marker(t)}));var i=pe.map_tools.find_objects_to_add(this.markers.VENUE,e);$.each(i,this.callback(function(e,t){if(!(-1<this.current_venue_ids.indexOf(t.id))){var i=this.bubble_template_venue(t),a=t.small_pin?pe.Map.marker_types.OTHER_VENUE:pe.Map.marker_types.VENUE,o=s?pe.map_tools.numbered_marker_icon("venue",t.ordering):pe.map_tools.marker_icon(a,t),n=this.add_marker({small_pin:t.small_pin,type:pe.Map.marker_types.VENUE,icon:o,object_id:t.id,object_url:t.url,latitude:t.latitude,longitude:t.longitude,is_visible:t.is_visible,bubble_html:i,city_id:t.city_id,favorite_id:t.favorite_id,ordering:t.ordering});this.bounds.extend(n.position)}}))},pe.Map.prototype.set_view=function(e,t,i){this.map.setCenter(new google.maps.LatLng(e,t));var a=parseInt(i,10);isNaN(a)||(this.map.setZoom(a),this.zoom_changed())},pe.Map.prototype.show_popup=function(t){this.map_tooltip.hide(),this.map_popup.hide(),(this.default_city===t.city_id?this.load_venue_popup:this.load_default_venue_popup)(t,this.callback(function(e){this.map_popup.html(e),new pe.CloseButton(this.map_popup,pe.CloseButton.close_methods.HIDE).bind_event(pe.CloseButton.events.CLOSED,this.callback(function(){this.clicked_marker=null})),this.set_popup_tooltip_div_position(this.map_popup,t),this.map_popup.show()}))},pe.Map.prototype.switch_to_global_view=function(){this.zoom_state=pe.Map.zoom_states.GLOBAL,this.map.setMapTypeId(google.maps.MapTypeId.TERRAIN),pe.ajax_loader.cities.load(this.callback(function(e){this.set_cities(e),this.set_venues([]),this.set_events([])})),this.fire_event(pe.Map.events.ZOOM_STATE_CHANGED,this.zoom_state)},pe.Map.prototype.switch_to_local_view=function(t){this.zoom_state=pe.Map.zoom_states.LOCAL,this.map.setMapTypeId(google.maps.MapTypeId.ROADMAP),setTimeout(this.callback(function(){var e=this.map.getBounds();t===this.global_zoom_level_limit&&pe.ajax_loader.locate_city.load({north:e.getNorthEast().lat(),south:e.getSouthWest().lat(),east:e.getNorthEast().lng(),west:e.getSouthWest().lng()},this.callback(function(e){1===e.length&&this.load_default_map_objects(e[0].id),this.fire_event(pe.Map.events.ZOOM_STATE_CHANGED,this.zoom_state)}))}),0)},pe.Map.prototype.load_default_map_objects=function(t){var e=this.default_city===t?this.load_venues:this.load_default_venues,i=this.default_city===t?this.load_events:this.load_default_events;e(t,this.callback(function(e){this.set_venues(e),this.fire_event(pe.Map.events.CITY_CHANGED,t),this.set_cities([])})),i(t,this.callback(function(e){this.set_events(e)}))},pe.Map.prototype.load_default_venues=function(e,t){pe.routes.Request.factory("map_venues",{city_id:e}).get(function(e){t(pe.json_expander.expand_venues(e))})},pe.Map.prototype.load_default_events=function(e,t){pe.routes.Request.factory("map_events",{city_id:e}).get(function(e){t(pe.json_expander.expand_events(e))})},pe.Map.prototype.load_default_venue_popup=function(e,t){pe.routes.Request.factory("venue_map_popup",{venue_id:e.object_id}).get(t)},pe.Map.prototype.load_venues=function(e,t){pe.routes.Request.factory("map_venues",{city_id:e}).get(function(e){t(pe.json_expander.expand_venues(e))})},pe.Map.prototype.load_events=function(e,t){pe.routes.Request.factory("map_events",{city_id:e}).get(function(e){t(pe.json_expander.expand_events(e))})},pe.Map.prototype.load_venue_popup=function(e,t){pe.routes.Request.factory("venue_map_popup",{venue_id:e.object_id}).get(t)},pe.Map.prototype.dragend=function(){this.clicked_marker&&(this.map.getBounds().contains(this.clicked_marker.getPosition())?this.set_popup_tooltip_div_position(this.map_popup,this.clicked_marker):(this.map_popup.hide(),this.clicked_marker=null))},pe.Map.prototype.zoom_changed=function(){this.map_popup.hide();var e=this.map.getZoom();e<this.global_zoom_level_limit&&this.zoom_state!==pe.Map.zoom_states.GLOBAL&&this.switch_to_global_view(),e>=this.global_zoom_level_limit&&this.zoom_state!==pe.Map.zoom_states.LOCAL&&this.switch_to_local_view(e),this.fire_event(pe.Map.events.ZOOM_LEVEL_CHANGED,e)},function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};pe.GalleryMappable=function(){function e(e){this.container=e,this.map_loaded=t(this.map_loaded,this),this.expand_map_clicked=t(this.expand_map_clicked,this),this.expand_gallery_clicked=t(this.expand_gallery_clicked,this),this.map_container=$(".VenueMap"),this.marker_tips=$(".MarkerTip"),this.gallery_container=$(".PhotoSlideShow"),this.gallery_quick_nav=$(".GalleryQuickNav"),this.expand_map_link=$(".ExpandMap.Link"),this.expand_gallery_link=$(".ExpandGallery.Link"),this.map_popup=this.container.find(".map_popup"),this.map_tooltip=this.container.find(".map_tooltip"),$(".ExpandMap").click(this.expand_map_clicked),$(".ExpandGallery").click(this.expand_gallery_clicked)}return e.prototype.centrize_map=function(){var e,t;return t=(e=this.map.map).getCenter(),google.maps.event.trigger(e,"resize"),e.setCenter(t)},e.prototype.expand_gallery_clicked=function(){return this.expand_map(!1)},e.prototype.expand_map_clicked=function(){return this.expand_map()},e.prototype.expand_map=function(e){return null==e&&(e=!0),this.map_popup.hide(),this.map_container.unbind("click"),e?(this.map_container.removeClass("collapsed"),$(".SlideshowCont").addClass("collapsed"),$(".MapCont").removeClass("collapsed"),this.map.map.setOptions({mapTypeControl:!0,navigationControl:!0,streetViewControl:!0})):(this.map_container.addClass("collapsed"),$(".SlideshowCont").removeClass("collapsed"),$(".MapCont").addClass("collapsed"),this.map.map.setOptions({disableDefaultUI:!0,mapTypeControl:!1,navigationControl:!1,streetViewControl:!1}),this.map_container.click(this.expand_map_clicked)),this.centrize_map(),this.toggle_expanders()},e.prototype.toggle_expanders=function(){return this.expand_map_link.toggle(),this.expand_gallery_link.toggle(),this.gallery_quick_nav.toggle(),this.marker_tips.toggle()},e.prototype.map_loaded=function(){if("#map"===window.location.hash)return this.expand_map()},e}()}.call(this),pe.PhotoModule=function(e,t,i,a,o,n){pe.init_widget(this,e),this.container.html(this.dom(i)),this.slide_show_div=this.container.find(".SlideShow"),this.slide_show_div.html(this.render_photos(t,a,o,n)),0<t.length&&(this.slide_show_div.addClass("slider"),this.slide_show_div.nivoSlider({effect:"slideInRight",startSlide:0,animSpeed:70,pauseTime:0,directionNav:1<t.length,directionNavHide:!0,controlNav:!1,keyboardNav:!0,manualAdvance:!0}))},pe.PhotoModule.prototype.dom=function(e){return'<div class="SlideShow '+e+'"></div>'},pe.PhotoModule.prototype.render_photos=function(e,a,o,n){var s="";if(0===e.length)s+='<img src="'+pe.https(pe.assign_photo_size("",a,o))+'" alt="" title="">';else{var r=this,p=e.length;$.each(e,function(e,t){t.photo=pe.https(pe.assign_photo_size(t.src,a,o)),t.position=e+1+" of "+p,t.title_div="title_div_"+n+"_"+e,t.photo_caption_container=""===t.title?"":'<div class="photo_caption float_left"><span class="text float_left">'+t.title+'</span><div class="line_divider"></div></div>',r.container.append(pe.templatize('<div id="{{title_div}}" class="nivo-html-caption"><table width="100%" cellpadding="0" cellspacing="0"><tbody><tr><td width="90%">{{photo_caption_container}}</td><td valign="bottom"><div class="photo_number float_right"><span class="text"><nobr>{{position}}</nobr></span><div></td></tr></tbody></table></div>',t));var i='<img src="{{photo}}" alt="" title="#{{title_div}}"/>';t.url?s+=pe.templatize('<a href="{{url}}">'+i+"</a>",t):s+=pe.templatize(i,t)})}return s},function(){var o=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var a in t)n.call(t,a)&&(e[a]=t[a]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;pe.NeighborhoodGalleryMap=function(e){function a(e,t,i){this.nearby_events_loaded=o(this.nearby_events_loaded,this),this.nearby_venues_loaded=o(this.nearby_venues_loaded,this),a.__super__.constructor.call(this,e),this.map_data=t,this.create_map(),0<i?this.load_neighborhood_photos(this.map_data.url_param):this.expand_map()}return t(a,e),a.prototype.create_map=function(){var i,a;return this.map=new pe.Map(this.map_container,this.map_data.latitude,this.map_data.longitude,this.map_data.default_zoom_level,google.maps.MapTypeId.ROADMAP,{city:this.map_data.city_id}),google.maps.event.addListenerOnce(this.map.map,"idle",this.map_loaded),this.map.map.setOptions({disableDefaultUI:!0}),this.map.load_venues=(i=this,function(e,t){return pe.routes.Request.factory("map_neighborhood_venues",{neighborhood_id:i.map_data.url_param}).get(function(e){return t(pe.json_expander.expand_venues(e))})}),this.map.load_events=(a=this,function(e,t){return pe.routes.Request.factory("map_neighborhood_events",{neighborhood_id:a.map_data.url_param}).get(function(e){return t(pe.json_expander.expand_events(e))})}),this.map.marker_coordinates_weights=function(e){return e.small_pin?{left:{x:25,y:40},right:{x:15,y:40}}:{left:{x:25,y:50},right:{x:25,y:50}}},pe.routes.Request.factory("map_neighborhood_venues",{neighborhood_id:this.map_data.url_param}).get(
this.nearby_venues_loaded),pe.routes.Request.factory("map_neighborhood_events",{neighborhood_id:this.map_data.url_param}).get(this.nearby_events_loaded)},a.prototype.load_neighborhood_photos=function(e){return pe.ajax_loader.neighborhood_photos.load({neighborhood_id:e},function(e){if(0<e.length)return new pe.PhotoModule($(".PhotoSlideShow"),e,"width460","460","460","neighborhood")})},a.prototype.nearby_venues_loaded=function(e){return this.map.set_venues(pe.json_expander.expand_venues(e))},a.prototype.nearby_events_loaded=function(e){return this.map.set_events(pe.json_expander.expand_events(e))},a.prototype.toggle_expanders=function(){return this.expand_map_link.toggle(),this.expand_gallery_link.toggle()},a}(pe.GalleryMappable)}.call(this),pe.ScrollPaginator=function(e,t){pe.init_widget(this,e),this.cells=this.container.find(".Cell"),this.cells.click(this.callback(this.pagination_cell_clicked)),this.cells_container=this.container.find(".CellsContainer"),this.current_page_number=0,this.pages=this.container.find(".Page"),this.prev_button=this.container.find(".PrevButton"),this.prev_button.click(this.callback(this.prev_button_clicked)),this.next_button=this.container.find(".NextButton"),this.next_button.click(this.callback(this.next_button_clicked)),this.scroll_duration=t||500,this.show_current_page()},pe.ScrollPaginator.prototype.pagination_cell_clicked=function(e){return this.container.find(".Cell").removeClass("current"),$(e.currentTarget).addClass("current"),this.show_page(this.cells.index(e.currentTarget)),!1},pe.ScrollPaginator.prototype.prev_button_clicked=function(e){0!==this.current_page_number?this.show_page(this.current_page_number-1):e&&e.stopPropagation()},pe.ScrollPaginator.prototype.show_current_page=function(){this.cells.removeClass("current"),$(this.cells[this.current_page_number]).addClass("current"),$(this.container.find(".page_slide.current")).index()<this.current_page_number?this.container.find(".page_slide.current").addClass("move_left").delay(this.scroll_duration).queue(function(e){$(this).removeClass("move_left"),e()}):this.container.find(".page_slide.current").addClass("move_right").delay(this.scroll_duration).queue(function(e){$(this).removeClass("move_right"),e()}),this.pages.removeClass("current located_left located_right"),$(this.pages[this.current_page_number]).addClass("current").removeClass("located_left located_right"),$(this.pages[this.current_page_number]).prevUntil().addClass("located_left"),$(this.pages[this.current_page_number]).nextUntil().addClass("located_right"),this.next_button.toggleClass("disabled",this.current_page_number===this.pages.length-1),this.prev_button.toggleClass("disabled",0===this.current_page_number)},pe.ScrollPaginator.prototype.show_page=function(e){this.current_page_number!=e&&(this.current_page_number=e,this.show_current_page())},pe.ScrollPaginator.prototype.next_button_clicked=function(e){this.current_page_number>=this.pages.length-1?e&&e.stopPropagation():this.show_page(this.current_page_number+1)},pe.PrefetcherModule=function(e){pe.init_widget(this,e),this.elements_with_prefetch_urls=this.container.find("[data-prefetch-url]"),this.prefetch_data()},pe.PrefetcherModule.instantiate=function(){return new pe.PrefetcherModule($("body"))},pe.PrefetcherModule.prototype.is_image_url=function(e){return/\.(jpe?g|gif|png)(\?.*)?$/i.test(e)},pe.PrefetcherModule.prototype.prefetch_ajax_request=function(e){$.getScript(e)},pe.PrefetcherModule.prototype.prefetch_data=function(){$.each(this.elements_with_prefetch_urls,this.callback(function(e,t){var i=(t=$(t)).data("prefetch-url");this.is_image_url(i)?this.prefetch_image(i):this.prefetch_ajax_request(i),t.removeAttr("data-prefetch-url")}))},pe.PrefetcherModule.prototype.prefetch_image=function(e){this.container.append(pe.templatize('<div style="display:none;"><img src="{{url}}"></div>',{url:e}))},pe.Expander=function(e,t){pe.init_widget(this,e),this.collapsed_height=t||72,this.content_container=this.container.find(".Content"),this.content_height_container=this.container.find(".ContentHeight"),this.trigger=this.container.find(".Button"),this.content_height_container.height()>this.collapsed_height?this.trigger.click(this.callback(this.on_trigger_clicked)):this.trigger.parent().hide()},pe.Expander.prototype.on_trigger_clicked=function(e){var t=$(e.currentTarget),i=this.content_container.attr("scrollHeight");this.content_container.height()<=this.collapsed_height?this.content_container.animate({height:i},1e3):this.content_container.animate({height:this.collapsed_height+"px"},1e3),this.trigger.hide(),this.trigger.not(t).show()},function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};pe.FlexibleRightRail=function(){function e(e){this.required_pod_count=e,this.display_flexible_rail=t(this.display_flexible_rail,this),this.left_rail_height=$("#left_container").outerHeight(!0),this.right_rail_elements=$("#right_sidebar").children(),this.right_rail_height=0,this.required_pod_count||(this.required_pod_count=0),0<this.left_rail_height&&1<this.right_rail_elements.length&&this.display_flexible_rail()}return e.prototype.display_flexible_rail=function(){return _.each(this.right_rail_elements,(a=this,function(e,t){var i;if(i=$(e),a.right_rail_height+=i.outerHeight(!0),a.right_rail_height>a.left_rail_height&&t+1>a.required_pod_count)return i.addClass("hidden")}));var a},e}()}.call(this),pe.PageSlideScroller=function(e,t){pe.init_widget(this,e);var i={scroll_duration:1100,inactive_button_class:"loop_back",loop_scrolling:!1},a=$.extend(i,t);if(this.scroller_container=this.container.find(".ScreensContainer"),this.current_item=0,this.scroll_duration=a.scroll_duration,this.inactive_button_class=a.inactive_button_class,this.individual_items=this.scroller_container.find(".IndividualItem"),this.single_item_width=a.single_item_width||this.individual_items.width()+37,this.items_count=this.individual_items.length,this.next_button=this.container.find(".NextButton"),this.previous_button=this.container.find(".PreviousButton"),this.page_display_container=this.container.find(".PageDisplay"),this.dots_container=$(this.page_display_container.selector+" .Dot"),this.dots_container.live("click",this.callback(this.dot_clicked)),this.page_display_format=a.page_display_format||pe.PageSlideScroller.dots_template(this.items_count),this.loop_scrolling=a.loop_scrolling,this.enable_buttons=1<this.items_count,this.enable_buttons){this.next_button.click(this.callback(this.next_button_clicked)),this.previous_button.click(this.callback(this.previous_button_clicked));var o=this.individual_items.first(),n=this.individual_items.last();this.loop_scrolling&&(n.clone().insertBefore(o),o.clone().insertAfter(n)),this.update_display(),this.update_page_display()}else this.next_button.addClass("disabled"),this.previous_button.addClass("disabled")},pe.PageSlideScroller.dots_template=function(e){e=Math.min(e,4);for(var t=["one","two","three","four"],i="<ul class='page_count slide{{current_item_number}}'>",a=0;a<=e-1;a++)i+="<li class='Dot dot "+t[a]+"' data-page_number='"+a+"'></li>";return i+"</ul>"},pe.PageSlideScroller.prototype.animate_scrolling=function(e){this.enable_buttons=!1,this.current_item=e,this.update_page_display(),this.scroller_container.animate({left:"-"+this.compute_scroll_offset(this.current_item)+"px"},this.scroll_duration,"cubicEaseInOut",this.callback(this.update_display))},pe.PageSlideScroller.prototype.update_display=function(){this.current_item=this.constraint_page(this.current_item),this.previous_button.toggleClass(this.inactive_button_class,this.current_item<=0),this.next_button.toggleClass(this.inactive_button_class,this.current_item>=this.items_count-1),this.scroller_container.css("left","-"+this.compute_scroll_offset(this.current_item)+"px"),this.enable_buttons=!0},pe.PageSlideScroller.prototype.update_page_display=function(){var e=pe.templatize(this.page_display_format,{current_item_number:this.constraint_page(this.current_item)+1,items_count:this.items_count});this.page_display_container.html(e)},pe.PageSlideScroller.prototype.compute_scroll_offset=function(e){return(e+(this.loop_scrolling?1:0))*this.single_item_width},pe.PageSlideScroller.prototype.constraint_page=function(e){return this.loop_scrolling?e>=this.items_count?0:e<0?this.items_count-1:e:Math.max(Math.min(e,this.items_count-1),0)},pe.PageSlideScroller.prototype.next_button_clicked=function(){if(this.enable_buttons){var e=this.current_item+1;e>=this.items_count&&(e=0),this.loop_scrolling||(e=Math.min(e,this.items_count-1)),e!=this.current_item&&this.animate_scrolling(e)}},pe.PageSlideScroller.prototype.previous_button_clicked=function(){if(this.enable_buttons){var e=this.current_item-1;e<0&&(e=this.items_count-1),this.loop_scrolling||(e=Math.max(e,0)),e!=this.current_item&&this.animate_scrolling(e)}},pe.PageSlideScroller.prototype.dot_clicked=function(e){this.animate_scrolling($(e.currentTarget).data("page_number")-0)},pe.init_multiline_titles=function(e){var i,a,o=e||"two_line_title";_.each($(".FlexibleHeight"),function(e){for(a=$(e).find(".FlexibleHeightItem"),i=0;i<a.length;i++){var t=$(a[i]);if(parseInt(t.css("line-height"),10)<t.height()){t.parents(".FlexibleHeight").addClass(o);break}}})},$(document).ready(function(){pe.init_page_framework(),new pe.NeighborhoodGalleryMap($("#gal_map"),window.neighborhood.map_data,window.neighborhood.live_photos_count),0<$(".ThingsToDoScroller").length&&(pe.install_easing(),pe.things_to_do_scroller=new pe.PageSlideScroller($(".ThingsToDoScroller")),pe.help_module=new pe.HelpModule2),0<$(".PaginationScroller").length&&(pe.venues_scroller=new pe.ScrollPaginator($(".PaginationScroller"))),pe.ChangeImageOnHover.instantiate_all("LinkWrapper"),pe.PrefetcherModule.instantiate(),0<$(".AddToCalendarButton").length&&pe.init_calendar_buttons(),0<$(".ReadMoreScroll").length&&(pe.expander=new pe.Expander($(".ReadMoreScroll"),60),0===$(".ThingsToDoScroller").length&&pe.expander.trigger.filter(":visible").click()),$(".NeighborhoodDropdown").click(pe.neighborhood_dropdown_clicked),setTimeout(function(){pe.init_multiline_titles(),new pe.FlexibleRightRail},5)}),pe.neighborhood_dropdown_clicked=function(){$(this).toggleClass("expanded")};