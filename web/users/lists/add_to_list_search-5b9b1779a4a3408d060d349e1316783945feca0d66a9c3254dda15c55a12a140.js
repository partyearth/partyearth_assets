(function(){var i=function(t,i){return function(){return t.apply(i,arguments)}};pe.AddToListSearch=function(){function t(t){this.container=t,this.on_add_button_clicked=i(this.on_add_button_clicked,this),this.on_dialog_closed=i(this.on_dialog_closed,this),this.on_tab_button_clicked=i(this.on_tab_button_clicked,this),this.on_search_button_clicked=i(this.on_search_button_clicked,this),this.on_city_changed=i(this.on_city_changed,this),this.on_keypress=i(this.on_keypress,this),this.input=this.container.find(".Input"),this.input.keyup(this.on_keypress),this.placeholder=this.input.attr("placeholder"),this.autocomplete_container=this.container.find(".Autocomplete"),this.tab_button=this.container.find(".TabButton"),this.tab_button.click(this.on_tab_button_clicked),this.city_dropdown=this.container.find(".CityDropdown"),this.city_dropdown.change(this.on_city_changed),this.search_button=this.container.find(".SearchButton"),this.search_button.click(this.on_search_button_clicked),this.search_results_container=this.container.find(".SearchResults"),pe.bind_toggle_trigger(this.container.find(".ToggleAddToListOptionsTrigger"),this.container.find(".TabButtonsContainer")),this.dialog_container=this.container.find(".Dialog"),this.dialog=this.dialog_container.dialog({title:"Search and add to list",modal:!0,width:"auto",height:"auto",position:["middle","middle"],autoOpen:!1,dialogClass:"add_list_item_dialog",close:this.on_dialog_closed})}return t.prototype.on_keypress=function(t){return 13===t.keyCode?(this.on_search_button_clicked(),t.preventDefault()):(this.input.removeClass("invalid"),this.input.val()===this.placeholder&&this.input.val(""),2<this.input.val().length?this.show_autocomplete():this.hide_autocomplete())},t.prototype.show_autocomplete=function(){var t,i;return t=this.get_query(),this.request=new pe.routes.Request("search_autocomplete",{city_id:this.city_dropdown.val(),query:t,result_types:this.tab_id}),this.request.post((i=this,function(t){return i.autocomplete_container.show(),i.autocomplete_container.html(t),_.isEmpty(t)&&i.hide_autocomplete(),i.autocomplete_container.find("li").click(function(t){return i.input.val($(t.currentTarget).data("label")),i.on_search_button_clicked()})}))},t.prototype.hide_autocomplete=function(){return this.autocomplete_container.html(""),this.autocomplete_container.hide()},t.prototype.on_city_changed=function(){return this.query=null},t.prototype.on_search_button_clicked=function(){var t,i,e;return i=this.get_query(),_.isEmpty(i)?(this.input.addClass("invalid"),this.input.val(this.placeholder),this.search_results_container.html("")):this.query!==i?(this.query=i,this.search_results_container.html('<div class="lspinner" style="text-align: center;"><h2>Please Wait</h2><img src="/assets/content_bg/spinner.gif"/></div>'),t={result_types:this.tab_id,query:this.query,city_id:this.city_dropdown.val()},pe.routes.Request.from_current_location("list_items",t).get((e=this,function(t){return e.hide_autocomplete(),e.search_results_container.html(t),e.search_results_container.find(".AddButton").click(e.on_add_button_clicked),e.dialog.dialog("option","position",["middle","middle"])}))):void 0},t.prototype.get_query=function(){var t;return this.input.val(this.input.val().replace(/\s+/g," ").replace(/^\s+$/g,"")),(t=this.input.val())===this.placeholder&&(t=""),t},t.prototype.on_tab_button_clicked=function(t){return $("body").css("overflow","hidden"),this.change_tab($(t.currentTarget).data("tab")),this.dialog.dialog("open"),this.reset_input()},t.prototype.reset_input=function(){if(this.input.removeClass("invalid"),this.input.val()===this.placeholder)return this.input.val("")},t.prototype.select_tab=function(t){return this.hide_autocomplete(),this.tab_button.removeClass("active"),this.tab_button.filter("."+t).addClass("active"),this.tab_id=t,this.query=null},t.prototype.change_tab=function(t){if(this.tab_id!==t)return this.select_tab(t),this.on_search_button_clicked()},t.prototype.on_dialog_closed=function(){if(this.changed)return this.dialog.dialog("open"),this.dialog.html('<div class="lspinner" style="text-align: center;"><h2>Please Wait</h2><img src="/assets/content_bg/spinner.gif"/></div>'),this.dialog.dialog("option","position",["middle","middle"]),window.location.reload()},t.prototype.on_add_button_clicked=function(t){var i,e;if(this.changed=!0,!(i=$(t.currentTarget)).hasClass("Disabled"))return i.addClass("disabled Disabled"),i.html("Add"),e={favorite:{listable_id:i.data("id"),listable_type:i.data("type")}},pe.routes.Request.from_current_location("api_user_list_favorites",e).post(function(){return i.html("Added")})},t}()}).call(this);