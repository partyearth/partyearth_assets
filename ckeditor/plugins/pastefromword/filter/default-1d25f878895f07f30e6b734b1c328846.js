(function(){function D(a){a=a.toUpperCase();for(var b=E.length,d=0,c=0;c<b;++c)for(var e=E[c],f=e[1].length;a.substr(0,f)==e[1];a=a.substr(f))d+=e[0];return d}function F(a){a=a.toUpperCase();for(var b=G.length,d=1,c=1;0<a.length;c*=b)d+=G.indexOf(a.charAt(a.length-1))*c,a=a.substr(0,a.length-1);return d}var z=CKEDITOR.htmlParser.fragment.prototype,y=CKEDITOR.htmlParser.element.prototype;z.onlyChild=y.onlyChild=function(){var a=this.children;return 1==a.length&&a[0]||null};y.removeAnyChildWithName=
function(a){for(var b=this.children,d=[],c,e=0;e<b.length;e++)c=b[e],c.name&&(c.name==a&&(d.push(c),b.splice(e--,1)),d=d.concat(c.removeAnyChildWithName(a)));return d};y.getAncestor=function(a){for(var b=this.parent;b&&(!b.name||!b.name.match(a));)b=b.parent;return b};z.firstChild=y.firstChild=function(a){for(var b,d=0;d<this.children.length;d++)if(b=this.children[d],a(b)||b.name&&(b=b.firstChild(a)))return b;return null};y.addStyle=function(a,b,d){var c="";if("string"==typeof b)c+=a+":"+b+";";else{if("object"==
typeof a)for(var e in a)a.hasOwnProperty(e)&&(c+=e+":"+a[e]+";");else c+=a;d=b}this.attributes||(this.attributes={});a=this.attributes.style||"";a=(d?[c,a]:[a,c]).join(";");this.attributes.style=a.replace(/^;|;(?=;)/,"")};CKEDITOR.dtd.parentOf=function(a){var b={},d;for(d in this)-1==d.indexOf("$")&&this[d][a]&&(b[d]=1);return b};var K=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,H=/^(?:\b0[^\s]*\s*){1,4}$/,A={ol:{decimal:/\d+/,"lower-roman":/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,
"upper-roman":/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},ul:{disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/}},E=[[1E3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],G="ABCDEFGHIJKLMNOPQRSTUVWXYZ",w=0,r=null,x,z=CKEDITOR.plugins,B=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);
CKEDITOR.document.getBody().append(B);var I=z.pastefromword={utils:{createListBulletMarker:function(a,b){var d=new CKEDITOR.htmlParser.element("cke:listbullet");d.attributes={"cke:listsymbol":a[0]};d.add(new CKEDITOR.htmlParser.text(b));return d},isListBulletIndicator:function(a){if(/mso-list\s*:\s*Ignore/i.test(a.attributes&&a.attributes.style))return!0},isContainingOnlySpaces:function(a){var b;return(b=a.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(b.value)},resolveList:function(a){var b=a.attributes,
d;if((d=a.removeAnyChildWithName("cke:listbullet"))&&d.length&&(d=d[0]))return a.name="cke:li",b.style&&(b.style=I.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(a){a=a.split(" ");a=CKEDITOR.tools.convertToPx(a[3]||a[1]||a[0]);!w&&(null!==r&&a>r)&&(w=a-r);r=a;b["cke:indent"]=w&&Math.ceil(a/w)+1||1}],[/^mso-list$/,null,function(a){a=a.split(" ");var d=Number(a[0].match(/\d+/));a=Number(a[1].match(/\d+/));1==a&&(d!==x&&(b["cke:reset"]=1),x=d);b["cke:indent"]=
a}]])(b.style,a)||""),b["cke:indent"]||(r=0,b["cke:indent"]=1),CKEDITOR.tools.extend(b,d.attributes),!0;x=r=w=null;return!1},getStyleComponents:function(a,b,d){B.setStyle(a,b);a={};b=d.length;for(var c=0;c<b;c++)a[d[c]]=B.getStyle(d[c]);return a},listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(a,b){b="number"==typeof b?b:1;var d=a.attributes,c;switch(d.type){case "a":c="lower-alpha";break;case "1":c="decimal"}for(var e=a.children,f,h=0;h<e.length;h++)if(f=e[h],f.name in CKEDITOR.dtd.$listItem){var g=
f.attributes,j=f.children,p=j[j.length-1];p.name in CKEDITOR.dtd.$list&&(a.add(p,h+1),--j.length||e.splice(h--,1));f.name="cke:li";d.start&&!h&&(g.value=d.start);I.filters.stylesFilter([["tab-stops",null,function(a){(a=a.split(" ")[1].match(K))&&(r=CKEDITOR.tools.convertToPx(a[0]))}],1==b?["mso-list",null,function(a){a=a.split(" ");a=Number(a[0].match(/\d+/));a!==x&&(g["cke:reset"]=1);x=a}]:null])(g.style);g["cke:indent"]=b;g["cke:listtype"]=a.name;g["cke:list-style-type"]=c}else if(f.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,
[f,b+1]);e=e.slice(0,h).concat(f.children).concat(e.slice(h+1));a.children=[];f=0;for(j=e.length;f<j;f++)a.add(e[f])}delete a.name;d["cke:list"]=1},assembleList:function(a){var b=a.children,d,c,e,f,h,g;a=[];for(var j,p,k,n,l,t,s=0;s<b.length;s++)if(d=b[s],"cke:li"==d.name)if(d.name="li",c=d.attributes,k=(k=c["cke:listsymbol"])&&k.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),n=l=t=null,c["cke:ignored"])b.splice(s--,1);else{c["cke:reset"]&&(g=f=h=null);e=Number(c["cke:indent"]);e!=f&&(p=j=null);if(k){if(p&&
A[p][j].test(k[1]))n=p,l=j;else for(var u in A)for(var v in A[u])if(A[u][v].test(k[1]))if("ol"==u&&/alpha|roman/.test(v)){if(j=/roman/.test(v)?D(k[1]):F(k[1]),!t||j<t)t=j,n=u,l=v}else{n=u;l=v;break}!n&&(n=k[2]?"ol":"ul")}else n=c["cke:listtype"]||"ol",l=c["cke:list-style-type"];p=n;j=l||("ol"==n?"decimal":"disc");l&&l!=("ol"==n?"decimal":"disc")&&d.addStyle("list-style-type",l);if("ol"==n&&k){switch(l){case "decimal":t=Number(k[1]);break;case "lower-roman":case "upper-roman":t=D(k[1]);break;case "lower-alpha":case "upper-alpha":t=
F(k[1])}d.attributes.value=t}if(g){if(e>f)a.push(g=new CKEDITOR.htmlParser.element(n)),g.add(d),h.add(g);else{if(e<f){f-=e;for(var q;f--&&(q=g.parent);)g=q.parent}g.add(d)}b.splice(s--,1)}else a.push(g=new CKEDITOR.htmlParser.element(n)),g.add(d),b[s]=g;h=d;f=e}else g&&(g=f=h=null);for(s=0;s<a.length;s++)if(g=a[s],u=g.children,j=j=void 0,v=g.children.length,q=j=void 0,b=/list-style-type:(.*?)(?:;|$)/,f=CKEDITOR.plugins.pastefromword.filters.stylesFilter,j=g.attributes,!b.exec(j.style)){for(h=0;h<
v;h++)if(j=u[h],j.attributes.value&&Number(j.attributes.value)==h+1&&delete j.attributes.value,j=b.exec(j.attributes.style))if(j[1]==q||!q)q=j[1];else{q=null;break}if(q){for(h=0;h<v;h++)j=u[h].attributes,j.style&&(j.style=f([["list-style-type"]])(j.style)||"");g.addStyle("list-style-type",q)}}x=r=w=null},falsyFilter:function(){return!1},stylesFilter:function(a,b){return function(d,c){var e=[];(d||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(d,g,f){g=g.toLowerCase();
"font-family"==g&&(f=f.replace(/["']/g,""));for(var p,k,n,l=0;l<a.length;l++)if(a[l]&&(d=a[l][0],p=a[l][1],k=a[l][2],n=a[l][3],g.match(d)&&(!p||f.match(p)))){g=n||g;b&&(k=k||f);"function"==typeof k&&(k=k(f,c,g));k&&k.push&&(g=k[0],k=k[1]);"string"==typeof k&&e.push([g,k]);return}!b&&e.push([g,f])});for(var f=0;f<e.length;f++)e[f]=e[f].join(":");return e.length?e.join(";")+";":!1}},elementMigrateFilter:function(a,b){return function(d){var c=b?(new CKEDITOR.style(a,b))._.definition:a;d.name=c.element;
CKEDITOR.tools.extend(d.attributes,CKEDITOR.tools.clone(c.attributes));d.addStyle(CKEDITOR.style.getStyleText(c))}},styleMigrateFilter:function(a,b){var d=this.elementMigrateFilter;return function(c,e){var f=new CKEDITOR.htmlParser.element(null),h={};h[b]=c;d(a,h)(f);f.children=e.children;e.children=[f]}},bogusAttrFilter:function(a,b){if(-1==b.name.indexOf("cke:"))return!1},applyStyleFilter:null},getRules:function(a){var b=CKEDITOR.dtd,d=CKEDITOR.tools.extend({},b.$block,b.$listItem,b.$tableContent),
c=a.config,e=this.filters;a=e.falsyFilter;var f=e.stylesFilter,h=e.elementMigrateFilter,g=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),j=this.utils.createListBulletMarker,p=e.flattenList,k=e.assembleList,n=this.utils.isListBulletIndicator,l=this.utils.isContainingOnlySpaces,t=this.utils.resolveList,s=function(a){a=CKEDITOR.tools.convertToPx(a);return isNaN(a)?a:a+"px"},u=this.utils.getStyleComponents,v=this.utils.listDtdParents,q=!1!==c.pasteFromWordRemoveFontStyles,r=!1!==c.pasteFromWordRemoveStyles;
return{elementNames:[[/meta|link|script/,""]],root:function(a){a.filterChildren();k(a)},elements:{"^":function(a){var m;CKEDITOR.env.gecko&&(m=e.applyStyleFilter)&&m(a)},$:function(a){var m=a.name||"",C=a.attributes;m in d&&C.style&&(C.style=f([[/^(:?width|height)$/,null,s]])(C.style)||"");if(m.match(/h\d/)){a.filterChildren();if(t(a))return;h(c["format_"+m])(a)}else if(m in b.$inline)a.filterChildren(),l(a)&&delete a.name;else if(-1!=m.indexOf(":")&&-1==m.indexOf("cke")){a.filterChildren();if("v:imagedata"==
m){if(m=a.attributes["o:href"])a.attributes.src=m;a.name="img";return}delete a.name}m in v&&(a.filterChildren(),k(a))},style:function(a){if(CKEDITOR.env.gecko){a=(a=a.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/))&&a[1];var m={};a&&(a.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(a,b,d){b=b.split(",");a=b.length;for(var c=0;c<a;c++)CKEDITOR.tools.trim(b[c]).replace(/^(\w+)(\.[\w-]+)?$/g,function(a,b,c){b=b||"*";c=c.substring(1,c.length);c.match(/MsoNormal/)||(m[b]||
(m[b]={}),c?m[b][c]=d:m[b]=d)})}),e.applyStyleFilter=function(a){var b=m["*"]?"*":a.name,c=a.attributes&&a.attributes["class"];b in m&&(b=m[b],"object"==typeof b&&(b=b[c]),b&&a.addStyle(b,!0))})}return!1},p:function(a){if(/MsoListParagraph/.exec(a.attributes["class"])){var b=a.firstChild(function(a){return a.type==CKEDITOR.NODE_TEXT&&!l(a.parent)});(b=(b=b&&b.parent)&&b.attributes)&&!b.style&&(b.style="mso-list: Ignore;")}a.filterChildren();t(a)||(c.enterMode==CKEDITOR.ENTER_BR?(delete a.name,a.add(new CKEDITOR.htmlParser.element("br"))):
h(c["format_"+(c.enterMode==CKEDITOR.ENTER_P?"p":"div")])(a))},div:function(a){var b=a.onlyChild();if(b&&"table"==b.name){var c=a.attributes;b.attributes=CKEDITOR.tools.extend(b.attributes,c);c.style&&b.addStyle(c.style);b=new CKEDITOR.htmlParser.element("div");b.addStyle("clear","both");a.add(b);delete a.name}},td:function(a){a.getAncestor("thead")&&(a.name="th")},ol:p,ul:p,dl:p,font:function(a){if(n(a.parent))delete a.name;else{a.filterChildren();var b=a.attributes,c=b.style,d=a.parent;"font"==
d.name?(CKEDITOR.tools.extend(d.attributes,a.attributes),c&&d.addStyle(c),delete a.name):(c=c||"",b.color&&("#000000"!=b.color&&(c+="color:"+b.color+";"),delete b.color),b.face&&(c+="font-family:"+b.face+";",delete b.face),b.size&&(c+="font-size:"+(3<b.size?"large":3>b.size?"small":"medium")+";",delete b.size),a.name="span",a.addStyle(c))}},span:function(a){if(n(a.parent))return!1;a.filterChildren();if(l(a))return delete a.name,null;if(n(a)){var b=a.firstChild(function(a){return a.value||"img"==a.name}),
d=(b=b&&(b.value||"l."))&&b.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(d)return b=j(d,b),(a=a.getAncestor("span"))&&/ mso-hide:\s*all|display:\s*none /.test(a.attributes.style)&&(b.attributes["cke:ignored"]=1),b}if(d=(b=a.attributes)&&b.style)b.style=f([["line-height"],[/^font-family$/,null,!q?g(c.font_style,"family"):null],[/^font-size$/,null,!q?g(c.fontSize_style,"size"):null],[/^color$/,null,!q?g(c.colorButton_foreStyle,"color"):null],[/^background-color$/,null,!q?g(c.colorButton_backStyle,"color"):
null]])(d,a)||"";return null},b:h(c.coreStyles_bold),i:h(c.coreStyles_italic),u:h(c.coreStyles_underline),s:h(c.coreStyles_strike),sup:h(c.coreStyles_superscript),sub:h(c.coreStyles_subscript),a:function(a){var b=a.attributes;b&&!b.href&&b.name?delete a.name:CKEDITOR.env.webkit&&(b.href&&b.href.match(/file:\/\/\/[\S]+#/i))&&(b.href=b.href.replace(/file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(a){a.getAncestor(/h\d/)&&!c.pasteFromWordNumberedHeadingToList&&delete a.name}},attributeNames:[[/^onmouse(:?out|over)/,
""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:f(r?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(a,b,d){if(b.name in{p:1,div:1}){b="ltr"==c.contentsLangDirection?"margin-left":"margin-right";if("margin"==d)a=u(d,a,[b])[b];else if(d!=b)return null;if(a&&!H.test(a))return[b,a]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(a,b){if("img"==b.name)return a}],[/^width|height$/,null,function(a,b){if(b.name in{table:1,
td:1,th:1,img:1})return a}]]:[[/^mso-/],[/-color$/,null,function(a){if("transparent"==a)return!1;if(CKEDITOR.env.gecko)return a.replace(/-moz-use-text-color/g,"transparent")}],[/^margin$/,H],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],q?[/font-?/]:null],r),width:function(a,c){if(c.name in b.$tableContent)return!1},border:function(a,c){if(c.name in b.$tableContent)return!1},"class":a,bgcolor:a,valign:r?a:function(a,b){b.addStyle("vertical-align",a);return!1}},comment:!CKEDITOR.env.ie?
function(a,b){var c=a.match(/<img.*?>/),d=a.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);return d?(d=(c=d[1]||c&&"l.")&&c.match(/>(?:[(]?)([^\s]+?)([.)]?)</),j(d,c)):CKEDITOR.env.gecko&&c?(c=CKEDITOR.htmlParser.fragment.fromHtml(c[0]).children[0],(d=(d=(d=b.previous)&&d.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&d[1])&&(c.attributes.src=d),c):!1}:a}}},J=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};J.prototype={toHtml:function(a){a=CKEDITOR.htmlParser.fragment.fromHtml(a,
!1);var b=new CKEDITOR.htmlParser.basicWriter;a.writeHtml(b,this.dataFilter);return b.getHtml(!0)}};CKEDITOR.cleanWord=function(a,b){CKEDITOR.env.gecko&&(a=a.replace(/(\x3c!--\[if[^<]*?\])--\x3e([\S\s]*?)\x3c!--(\[endif\]--\x3e)/gi,"$1$2$3"));var d=new J,c=d.dataFilter;c.addRules(CKEDITOR.plugins.pastefromword.getRules(b));b.fire("beforeCleanWord",{filter:c});try{a=d.toHtml(a,!1)}catch(e){alert(b.lang.pastefromword.error)}a=a.replace(/cke:.*?".*?"/g,"");a=a.replace(/style=""/g,"");return a=a.replace(/<span>/g,
"")}})();
