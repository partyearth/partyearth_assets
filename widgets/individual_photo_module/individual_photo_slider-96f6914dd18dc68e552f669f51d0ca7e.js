pe.DisplayUpdater=function(a,b,c){pe.init_widget(this,a);this.photos=b;this.current_url="";this.pinterest_div=this.container.find(".PinterestDiv");this.slide_number_div=this.container.find(".SlideNumber");this.photo_caption_div=this.container.find(".Caption");this.credit_container=this.container.find(".Credit");this.tags_container=this.container.find(".Tags");this.tags_title=this.container.find(".TagsTitle");c.bind_event(pe.IndividualPhotoSlider.events.CHANGED,this.callback(this.slider_changed))};
pe.DisplayUpdater.prototype.slider_changed=function(a,b){var c=this.photos[b];this.slide_number_div.html(b+1+"");this.photo_caption_div.html(c.title);this.credit_container.html(""===c.credit?"":"&copy; "+c.credit);this.tags_title.html(0<c.tags.length?"Tags:":"");this.tags_container.html(this.tags_html(c.tags));this.populate_pinterest_with_current_photo(c);this.update_browser_details(c,b);this.update_og_tags(c)};
pe.DisplayUpdater.prototype.populate_pinterest_with_current_photo=function(a){this.pinterest_div.html('<img src="'+pe.assign_photo_size(void 0===a?null:a.src,"660","660x440")+'">')};pe.DisplayUpdater.prototype.tags_html=function(a){var b="";a&&$.each(a,function(a,d){b+="<li>"+d.name+"</li>"});return b};
pe.DisplayUpdater.prototype.update_browser_details=function(a,b){var c=pe.fetch_photo_id_from_url(a.url);this.current_url=window.location.href.replace(/photos\/.+/,"photos/"+c);window.history&&window.history.pushState&&window.history.replaceState({index:b},"",this.current_url)};
pe.DisplayUpdater.prototype.update_og_tags=function(a){$("meta[property=og\\:image]").attr("content",pe.remove_timestamp_from_asset_url(pe.assign_photo_size(a.src,"155","155x105")));$("meta[property=og\\:url]").attr("content",this.current_url)};pe.HubPaginator=function(a,b){pe.init_widget(this,a);this.links=this.container.find(".HubLink");this.links.click(this.callback(this.paginator_clicked));b.bind_event(pe.IndividualPhotoSlider.events.CHANGED,this.callback(this.slider_changed))};
pe.HubPaginator.events={CLICKED:"HubPaginator_CLICKED"};pe.HubPaginator.prototype.slider_changed=function(a,b){this.links.removeClass("selected");this.container.find(".HubLink[data-screen="+Math.floor(b/8)+"]").addClass("selected")};pe.HubPaginator.prototype.paginator_clicked=function(a){a.stopImmediatePropagation();a=$(a.target).closest(".HubLink").data("screen");void 0!==a&&this.fire_event(pe.HubPaginator.events.CLICKED,a);return!1};
pe.Scroller=function(a,b,c,d,e,f,g,h){pe.init_widget(this,a);this.scroller_container=this.container.find(".ScreensContainer");this.current_item=0;this.scroll_duration=b;this.inactive_button_class=c;this.visible_items_count=d||1;this.scroll_by=e||1;this.single_item_width=f;this.individual_items=this.scroller_container.find(".IndividualItem");this.items_count=this.individual_items.length;this.next_button=this.container.find(".NextButton");this.next_button.click(this.callback(this.next_button_clicked));
this.previous_button=this.container.find(".PreviousButton");this.previous_button.click(this.callback(this.previous_button_clicked));this.page_display_container=this.container.find(".PageDisplay");this.page_display_format=g||"";this.loop_scrolling=h||!1;this.update_display()};
pe.Scroller.prototype.animate_scrolling=function(a){a!=this.current_item&&(this.current_item=a,this.scroller_container.animate({left:"-"+this.current_item*(this.single_item_width||this.individual_items.width())+"px"},this.scroll_duration,"cubicEaseInOut"),this.update_display())};
pe.Scroller.prototype.update_display=function(){0>=this.current_item?this.previous_button.addClass(this.inactive_button_class):this.previous_button.removeClass(this.inactive_button_class);this.current_item>=this.items_count-this.visible_items_count?this.next_button.addClass(this.inactive_button_class):this.next_button.removeClass(this.inactive_button_class);this.page_display_container.html(pe.templatize(this.page_display_format,{current_item_number:this.current_item+1,items_count:this.items_count}))};
pe.Scroller.prototype.next_button_clicked=function(){var a=this.current_item+this.scroll_by;a>this.items_count-this.visible_items_count&&(a=this.loop_scrolling?0:this.items_count-this.visible_items_count);this.animate_scrolling(a)};pe.Scroller.prototype.previous_button_clicked=function(){var a=this.current_item-this.scroll_by;0>a&&(a=this.loop_scrolling?this.items_count-this.visible_items_count:0);this.animate_scrolling(a)};
pe.ThumbnailNavigator=function(a,b,c){pe.init_widget(this,a);this.scroller=new pe.Scroller(this.container,1100,"hidden",1,1,663);this.thumbnails=this.container.find(".ThumbnailImage");this.thumbnails.click(this.callback(this.thumbnail_clicked));b.bind_event(c,this.callback(this.slider_changed))};pe.ThumbnailNavigator.events={CLICKED:"ThumbnailNavigator_CLICKED"};
pe.ThumbnailNavigator.prototype.slider_changed=function(a,b){this.thumbnails.removeClass("selected");this.container.find(".ThumbnailImage[data-offset="+b+"]").addClass("selected");this.scroller.animate_scrolling(Math.floor(b/8))};pe.ThumbnailNavigator.prototype.thumbnail_clicked=function(a){a.stopImmediatePropagation();a=$(a.target).data("offset");void 0!==a&&this.fire_event(pe.ThumbnailNavigator.events.CLICKED,a);return!1};
pe.IndividualPhotoSlider=function(a,b,c){pe.init_widget(this,a);this.photos=b;this.slide_show_div=this.container.find(".Slider");this.slide_show_div.empty();$.each(this.photos,this.callback(function(a,b){this.slide_show_div.append(this.individual_photo_html(b))}));setTimeout(this.callback(function(){this.initialize_slider(this.photos,c-1);this.slider_prev_link=this.slide_show_div.find(".nivo-prevNav");this.slider_next_link=this.slide_show_div.find(".nivo-nextNav")}),500);new pe.DisplayUpdater(this.container,
this.photos,this);this.thumbnail_module=new pe.ThumbnailNavigator(this.container.find(".ThumbnailNavigatorDiv"),this,pe.IndividualPhotoSlider.events.CHANGED);this.thumbnail_module.bind_event(pe.ThumbnailNavigator.events.CLICKED,this.callback(this.thumbnail_selected));0<this.container.find(".HubLink").length&&(this.hub_paginator=new pe.HubPaginator(this.container.find(".HubPaginator"),this),this.hub_paginator.bind_event(pe.HubPaginator.events.CLICKED,this.callback(this.paginator_clicked)));this.container.find(".PreviousPhoto").click(this.callback(this.prev_button_clicked));
this.container.find(".NextPhoto").click(this.callback(this.next_button_clicked));$(document).keyup(this.callback(this.global_key_handler));setTimeout(this.callback(function(){this.current_slide_changed()}),700)};pe.IndividualPhotoSlider.events={CHANGED:"IndividualPhotoSlider_CHANGED"};pe.IndividualPhotoSlider.prototype.current_slide_changed=function(){this.fire_event(pe.IndividualPhotoSlider.events.CHANGED,this.slide_show_div.data("nivo:vars").currentSlide)};
pe.IndividualPhotoSlider.prototype.global_key_handler=function(a){37===a.keyCode&&this.prev_button_clicked();39===a.keyCode&&this.next_button_clicked()};pe.IndividualPhotoSlider.prototype.individual_photo_html=function(a){return'<img class="nivo-kid" style="display: none;" src="'+pe.assign_photo_size(void 0===a?null:a.src,"660","660x440")+'">'};
pe.IndividualPhotoSlider.prototype.initialize_slider=function(a,b){var c={effect:"slideInRight"};c.startSlide=b;c.animSpeed="50";c.afterChange=this.callback(this.current_slide_changed);c.pauseTime="0";c.directionNav=1<a.length;c.directionNavHide=!0;c.controlNav=!1;c.keyboardNav=!1;c.manualAdvance=!0;this.slide_show_div.nivoSlider(c)};pe.IndividualPhotoSlider.prototype.next_button_clicked=function(){this.slider_next_link.click()};pe.IndividualPhotoSlider.prototype.prev_button_clicked=function(){this.slider_prev_link.click()};
pe.IndividualPhotoSlider.prototype.paginator_clicked=function(a,b){this.set_slider_to_previous_image(8*b);this.next_button_clicked()};pe.IndividualPhotoSlider.prototype.thumbnail_selected=function(a,b){this.set_slider_to_previous_image(b);this.next_button_clicked()};pe.IndividualPhotoSlider.prototype.set_slider_to_previous_image=function(a){this.slide_show_div.data("nivo:vars").currentSlide=(0===a?this.photos.length:a)-1};
