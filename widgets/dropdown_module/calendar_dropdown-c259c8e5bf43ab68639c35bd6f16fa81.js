pe.CalendarDropdown=function(a){pe.init_widget(this,a);this.dropdown_widget=new pe.DropdownModule(a,this.dropdown_html(),this.callback(this.title_html),!1);this.dropdown_widget.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.dropdown_selected));this.start_date_input=this.container.find(".StartDate");this.start_date_input.click(this.callback(this.datepicker_input_clicked));this.end_date_input=this.container.find(".EndDate");this.end_date_input.click(this.callback(this.datepicker_input_clicked));
this.selected_dates_title_div=$(".SelectedDates");this.set_selected_dates_title();this.date_pickers=$(".StartDate, .EndDate").datepicker({beforeShow:this.callback(this.calendar_showing),onClose:this.callback(this.datepicker_closing),onSelect:this.callback(this.calendar_selected)})};pe.CalendarDropdown.events={OPENED:"CalendarDropdown_OPENED",CHANGED:"CalendarDropdown_CHANGED"};
pe.CalendarDropdown.prototype.add_search_configuration=function(a){var b=this.result_value(this.dropdown_widget.val());b&&(b.start_date&&a.add_filter("start_date",b.start_date),b.end_date&&a.add_filter("end_date",b.end_date))};
pe.CalendarDropdown.prototype.calendar_selected=function(a,b){this.dropdown_widget.enable_auto_collapse();this.dropdown_widget.container.focus();var c=this.date_pickers.not(b.input),d=b.input.hasClass("StartDate")?"minDate":"maxDate",e=$.datepicker.parseDate(b.settings.dateFormat||$.datepicker._defaults.dateFormat,a,b.settings);c.datepicker("option",d,e);b.input.hasClass("StartDate")&&this.end_date_input.val(a);this.fire_event(pe.CalendarDropdown.events.CHANGED)};
pe.CalendarDropdown.prototype.calendar_showing=function(){this.dropdown_widget.disable_auto_collapse(0)};pe.CalendarDropdown.prototype.datepicker_closing=function(){this.dropdown_widget.enable_auto_collapse()};pe.CalendarDropdown.prototype.datepicker_input_clicked=function(a){this.dropdown_widget.disable_auto_collapse(500);a.stopPropagation()};
pe.CalendarDropdown.prototype.dropdown_html=function(){var a=new Date;$.datepicker.formatDate("mm/dd/yy",a);a=a.setTime(a.getTime()+864E5);$.datepicker.formatDate("mm/dd/yy",new Date(a));return'<div class="Choice choice" data_result="today"><div class="choice_text">Today</div></div><div class="Choice choice" data_result="tomorrow"><div class="choice_text">Tomorrow</div></div><div class="Choice CustomDates custom_dates" data_result="custom"><div class="title">Custom Date</div><input type="text" class="StartDate float_left" name="start"/><label class="float_left">to</label><input type="text" class="EndDate float_left" name="end"/><div class="clear"></div><input type="button" class="btn select_btn float_right" value="Go" /><div class="clear"></div></div>'};
pe.CalendarDropdown.prototype.dropdown_selected=function(a,b){this.set_selected_dates_title();this.fire_event(pe.CalendarDropdown.events.CHANGED,this.result_value(b))};
pe.CalendarDropdown.prototype.read_search_configuration=function(a){var b=$.datepicker.formatDate("mm/dd/yy",new Date),c=new Date;c.setTime(c.getTime()+864E5);var c=$.datepicker.formatDate("mm/dd/yy",c),d=a.get_filter("start_date"),a=a.get_filter("end_date");d&&(d===b&&!a?this.val("today"):d===c&&!a?this.val("tomorrow"):(this.start_date_input.val(d),this.val("custom")));a?(this.end_date_input.val(a),this.val("custom")):d&&d!==b&&d!==c&&(this.end_date_input.val(d),this.val("custom"))};
pe.CalendarDropdown.prototype.reset=function(){this.dropdown_widget.val(".Choice[data_result='today']");this.dropdown_widget.collapse_dropdown()};
pe.CalendarDropdown.prototype.result_value=function(a){if(!a)return null;var b=$.datepicker.formatDate("mm/dd/yy",new Date),c=new Date;c.setTime(c.getTime()+864E5);c=$.datepicker.formatDate("mm/dd/yy",c);switch($(a).attr("data_result")){case "today":return{start_date:b};case "tomorrow":return{start_date:c};case "custom":return{start_date:this.start_date_input.val(),end_date:this.end_date_input.val()};default:return alert("Unknown result data."),null}};
pe.CalendarDropdown.prototype.selected_dates_title_html=function(){var a=this.result_value(this.dropdown_widget.val());if(!a)return $.datepicker.formatDate("DD M d",new Date);var b=[];a.start_date&&(b[0]=$.datepicker.formatDate("DD M d",new Date(a.start_date)));a.end_date&&a.start_date!==a.end_date&&(b[1]=$.datepicker.formatDate("DD M d",new Date(a.end_date)));return b.join(" - ")};
pe.CalendarDropdown.prototype.set_dates=function(a,b){this.start_date_input.val(pe.date_string(a));this.end_date_input.val(pe.date_string(b));this.val("custom");this.set_selected_dates_title()};pe.CalendarDropdown.prototype.set_selected_dates_title=function(){if(!this.selected_dates_title_div)return null;this.selected_dates_title_div.html(this.selected_dates_title_html())};
pe.CalendarDropdown.prototype.title_html=function(a){if(a){if("selecting"===a)return this.fire_event(pe.CalendarDropdown.events.OPENED,$(a)),"Select a Date";this.set_selected_dates_title();switch(a.attr("data_result")){case "today":return"today";case "tomorrow":return"tomorrow";case "custom":return this.start_date_input.val()+" - "+this.end_date_input.val();default:alert("unknown selection")}}else return"Select a Date"};
pe.CalendarDropdown.prototype.val=function(a){if(a)this.dropdown_widget.val(".Choice[data_result='"+a+"']"),this.set_selected_dates_title();else return this.result_value(this.dropdown_widget.val())};
