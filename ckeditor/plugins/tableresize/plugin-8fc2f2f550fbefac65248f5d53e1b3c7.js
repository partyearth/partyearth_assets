(function(){function v(a){return CKEDITOR.env.ie?a.$.clientWidth:parseInt(a.getComputedStyle("width"),10)}function p(a,h){var b=a.getComputedStyle("border-"+h+"-width"),d={thin:"0px",medium:"1px",thick:"2px"};0>b.indexOf("px")&&(b=b in d&&"none"!=a.getComputedStyle("border-style")?d[b]:0);return parseInt(b,10)}function x(a){var h=[],b=-1,d="rtl"==a.getComputedStyle("direction"),e;e=a.$.rows;for(var g=0,f,c,m,k=0,l=e.length;k<l;k++)m=e[k],f=m.cells.length,f>g&&(g=f,c=m);e=c;g=new CKEDITOR.dom.element(a.$.tBodies[0]);
f=g.getDocumentPosition();c=0;for(m=e.cells.length;c<m;c++){var k=new CKEDITOR.dom.element(e.cells[c]),l=e.cells[c+1]&&new CKEDITOR.dom.element(e.cells[c+1]),b=b+(k.$.colSpan||1),r,j,n=k.getDocumentPosition().x;d?j=n+p(k,"left"):r=n+k.$.offsetWidth-p(k,"right");l?(n=l.getDocumentPosition().x,d?r=n+l.$.offsetWidth-p(l,"right"):j=n+p(l,"left")):(n=a.getDocumentPosition().x,d?r=n:j=n+a.$.offsetWidth);k=Math.max(j-r,3);h.push({table:a,index:b,x:r,y:f.y,width:k,height:g.$.offsetHeight,rtl:d})}return h}
function w(a){(a.data||a).preventDefault()}function B(a){function h(){for(var b=g.rtl,a=b?y.length:r.length,c=0;c<a;c++){var d=r[c],e=y[c],f=g.table;CKEDITOR.tools.setTimeout(function(c,a,d,e,g,h){c&&c.setStyle("width",j(Math.max(a+h,0)));d&&d.setStyle("width",j(Math.max(e-h,0)));g&&f.setStyle("width",j(g+h*(b?-1:1)))},0,this,[d,d&&v(d),e,e&&v(e),(!d||!e)&&v(f)+p(f,"left")+p(f,"right"),l])}}function b(b){w(b);b=g.index;for(var a=CKEDITOR.tools.buildTableMap(g.table),h=[],j=[],p=Number.MAX_VALUE,t=
p,u=g.rtl,z=0,x=a.length;z<x;z++){var q=a[z],s=q[b+(u?1:0)],q=q[b+(u?0:1)],s=s&&new CKEDITOR.dom.element(s),q=q&&new CKEDITOR.dom.element(q);if(!s||!q||!s.equals(q))s&&(p=Math.min(p,v(s))),q&&(t=Math.min(t,v(q))),h.push(s),j.push(q)}r=h;y=j;n=g.x-p;A=g.x+t;c.setOpacity(0.5);k=parseInt(c.getStyle("left"),10);l=0;m=1;c.on("mousemove",e);f.on("dragstart",w);f.on("mouseup",d,this)}function d(b){b.removeListener();m=0;c.setOpacity(0);l&&h();var a=g.table;setTimeout(function(){a.removeCustomData("_cke_table_pillars")},
0);f.removeListener("dragstart",w)}function e(b){u(b.data.$.clientX)}var g,f,c,m,k,l,r,y,n,A;f=a.document;c=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',f);t||f.getDocumentElement().append(c);this.attachTo=function(a){m||(t&&(f.getBody().append(c),l=0),g=a,c.setStyles({width:j(a.width),
height:j(a.height),left:j(a.x),top:j(a.y)}),t&&c.setOpacity(0.25),c.on("mousedown",b,this),f.getBody().setStyle("cursor","col-resize"),c.show())};var u=this.move=function(a){if(!g)return 0;if(!m&&(a<g.x||a>g.x+g.width))return g=null,m=l=0,f.removeListener("mouseup",d),c.removeListener("mousedown",b),c.removeListener("mousemove",e),f.getBody().setStyle("cursor","auto"),t?c.remove():c.hide(),0;a-=Math.round(c.$.offsetWidth/2);if(m){if(a==n||a==A)return 1;a=Math.max(a,n);a=Math.min(a,A);l=a-k}c.setStyle("left",
j(a));return 1}}function u(a){var h=a.data.getTarget();if("mouseout"==a.name){if(!h.is("table"))return;for(var b=new CKEDITOR.dom.element(a.data.$.relatedTarget||a.data.$.toElement);b&&b.$&&!b.equals(h)&&!b.is("body");)b=b.getParent();if(!b||b.equals(h))return}h.getAscendant("table",1).removeCustomData("_cke_table_pillars");a.removeListener()}var j=CKEDITOR.tools.cssLength,t=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||7>CKEDITOR.env.version);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],
init:function(a){a.on("contentDom",function(){var h;a.document.getBody().on("mousemove",function(b){b=b.data;if(h&&h.move(b.$.clientX))w(b);else{var d=b.getTarget(),e;if(d.is("table")||d.getAscendant("tbody",1)){e=d.getAscendant("table",1);if(!(d=e.getCustomData("_cke_table_pillars")))e.setCustomData("_cke_table_pillars",d=x(e)),e.on("mouseout",u),e.on("mousedown",u);a:{b=b.$.clientX;e=0;for(var g=d.length;e<g;e++){var f=d[e];if(b>=f.x&&b<=f.x+f.width){d=f;break a}}d=null}d&&(!h&&(h=new B(a)),h.attachTo(d))}}})})}})})();
