(function(){function s(a,l,m){if(!l.is||!l.getCustomData("block_processed"))l.is&&CKEDITOR.dom.element.setMarker(m,l,"block_processed",!0),a.push(l)}function q(a,l){var m=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);delete m.div;a.config.div_wrapTable&&(delete m.td,delete m.th);var q=CKEDITOR.dtd.div,n={},p=[];return{title:a.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:a.lang.common.generalTab,title:a.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],
children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:a.lang.div.styleSelectLabel,"default":"",items:[[a.lang.common.notSet,""]],onChange:function(){var g=["info:class","advanced:dir","advanced:style"],c=this.getDialog(),h=c._element&&c._element.clone()||new CKEDITOR.dom.element("div",a.document);this.commit(h,!0);for(var g=[].concat(g),b=g.length,j,d=0;d<b;d++)(j=c.getContentElement.apply(c,g[d].split(":")))&&j.setup&&j.setup(h,!0)},setup:function(a){for(var c in n)n[c].checkElementRemovable(a,
!0)&&this.setValue(c)},commit:function(a){var c;if(c=this.getValue()){c=n[c];var h=a.getCustomData("elementStyle")||"";c.applyToObject(a);a.setCustomData("elementStyle",h+c._.definition.attributes.style)}}},{id:"class",type:"text",label:a.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:a.lang.common.advancedTab,title:a.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:a.lang.common.id,"default":""},
{type:"text",id:"lang",label:a.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:a.lang.common.cssStyle,"default":"",commit:function(a){var c=this.getValue()+(a.getCustomData("elementStyle")||"");a.setAttribute("style",c)}}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:a.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:a.lang.common.langDir,"default":"",items:[[a.lang.common.notSet,
""],[a.lang.common.langDirLtr,"ltr"],[a.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){this.foreach(function(a){/^(?!vbox|hbox)/.test(a.type)&&(a.setup||(a.setup=function(b){a.setValue(b.getAttribute(a.id)||"")}),a.commit||(a.commit=function(b){var c=this.getValue();"dir"==a.id&&b.getComputedStyle("direction")==c||(c?b.setAttribute(a.id,c):b.removeAttribute(a.id))}))});var g=this,c=this.getContentElement("info","elementStyle");a.getStylesSet(function(a){var b;if(a)for(var j=0;j<a.length;j++){var d=
a[j];d.element&&"div"==d.element&&(b=d.name,n[b]=new CKEDITOR.style(d),c.items.push([b,b]),c.add(b,b))}c[1<c.items.length?"enable":"disable"]();setTimeout(function(){c.setup(g._element)},0)})},onShow:function(){if("editdiv"==l){var g;(g=(g=(new CKEDITOR.dom.elementPath(a.getSelection().getStartElement())).blockLimit)&&g.getAscendant("div",!0))&&this.setupContent(this._element=g)}},onOk:function(){if("editdiv"==l)p=[this._element];else{var g=[],c={},h=[],b,j=a.document.getSelection(),d=j.getRanges(),
n=j.createBookmarks(),f,k;for(f=0;f<d.length;f++)for(k=d[f].createIterator();b=k.getNextParagraph();)if(b.getName()in m){var e=b.getChildren();for(b=0;b<e.count();b++)s(h,e.getItem(b),c)}else{for(;!q[b.getName()]&&"body"!=b.getName();)b=b.getParent();s(h,b,c)}CKEDITOR.dom.element.clearAllMarkers(c);d=[];f=null;for(k=0;k<h.length;k++){b=h[k];for(var e=(new CKEDITOR.dom.elementPath(b)).elements,t=void 0,r=0;r<e.length;r++)if(e[r].getName()in m){t=e[r];break}e=t;e.equals(f)||(f=e,d.push([]));d[d.length-
1].push(b)}for(f=0;f<d.length;f++){e=d[f][0];h=e.getParent();for(b=1;b<d[f].length;b++)h=h.getCommonAncestor(d[f][b]);k=new CKEDITOR.dom.element("div",a.document);for(b=0;b<d[f].length;b++){for(e=d[f][b];!e.getParent().equals(h);)e=e.getParent();d[f][b]=e}for(b=0;b<d[f].length;b++)if(e=d[f][b],!e.getCustomData||!e.getCustomData("block_processed"))e.is&&CKEDITOR.dom.element.setMarker(c,e,"block_processed",!0),b||k.insertBefore(e),k.append(e);CKEDITOR.dom.element.clearAllMarkers(c);g.push(k)}j.selectBookmarks(n);
p=g}g=p.length;for(c=0;c<g;c++)this.commitContent(p[c]),!p[c].getAttribute("style")&&p[c].removeAttribute("style");this.hide()},onHide:function(){"editdiv"==l&&this._element.removeCustomData("elementStyle");delete this._element}}}CKEDITOR.dialog.add("creatediv",function(a){return q(a,"creatediv")});CKEDITOR.dialog.add("editdiv",function(a){return q(a,"editdiv")})})();
