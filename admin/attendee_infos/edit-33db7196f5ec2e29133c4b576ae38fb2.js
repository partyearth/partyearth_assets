pe.Validator=function(a){this.message=a.message||"Invalid value.";this.callback=a.callback;this.unless_callback=a.unless||function(){return!1};this.options=a;this.value=a.value?a.value:function(b){return a.callback(b)}};pe.Validator.prototype.passed=function(a){return!!this.callback($(a))};pe.Validator.prototype.failed=function(a){return!this.passed(a)};pe.Validator.prototype.unless=function(){return this.unless_callback()};
pe.validation.not_blank_validator=new pe.Validator({callback:function(a){return"checkbox"==a.attr("type")?$(a).is(":checked"):!_.isEmpty($.trim(a.val()))},message:"Required."});
(function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(a){var b,c,d,e,f;b=_.map($(a).find("select"),function(a){return $(a).val()});f=b[2];a=b[0];d=b[1];if(!f||!a||!d)return!1;c=new Date(""+a+"/"+d+"/"+f);e=c.getMonth()+1+"";b=c.getDate()+"";c=c.getFullYear()+"";return e===a&&b===d&&c===f}})}).call(this);(function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(a){return 0<a.find("input:checked").length}})}).call(this);
pe.ValidatableForm=function(a,b,c,d){pe.init_widget(this,a);this.bindings=c||{};this.chained_fields=[];this.errors={};this.rules=b||{};_.each(a.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(a){a=$(a);var b="#"+a.attr("id"),c=a.data("validator");this.rules[b]=c?eval(c):pe.validation.not_blank_validator;(c=a.data("binding"))?this.bindings[b]=c:"text"==a.attr("type")||"textarea"==a.attr("tagName")?this.bindings[b]=
"blur":this.rules[b]==pe.validation.dob_validator?a.find("select").each(this.callback(function(a,c){$(c).change(this.callback(function(){this.validate_field(b)}))})):this.bindings[b]="change"}));this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.after_submit=d;this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(a,b){"string"===typeof a?$(b).bind(a,this.callback(function(){this.validate_field(b)})):"function"===typeof a&&this.callback(a)();this.rules[b].value($(b))&&this.validate_field(b)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var a=this.validate();this.highlight_first_failed();a&&this.after_submit&&this.after_submit();return a};pe.ValidatableForm.prototype.delete_error=function(a){delete this.errors[a];_.each(this.chained_fields,function(b){_.include(b,a)&&_.each(b,function(a){this.errors[a]&&this.delete_error(a)},this)},this)};
pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var a=_.keys(this.errors)[0];this.render_field_error(a)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(a,b){this.render_field_error(b)},this)};
pe.ValidatableForm.prototype.render_field_error=function(a){var b=$(a).parents("li.input:first");0===b.length&&(b=$(a));b.find(".inline-errors").remove();b.append('<span class="inline-errors">'+this.errors[a]+"</span>");b.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(a){var b=$(a).parents("li.input:first");0===b.length&&(b=$(a));b.find(".inline-success").remove();b.append('<img class="inline-success" src="/assets/users/check.png" />');b.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(a){this.render_field_success(a)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(a){var b=this.rules[a],c=b.passed(a);b.unless()?this.delete_error(a):c?(this.delete_error(a),this.render_field_success(a)):(this.errors[a]=$(a).data("message")||b.message,this.render_field_error(a));this.toggle_submit();return c};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};
pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(a,b){a.failed(b)?this.errors[b]=$(b).data("message")||a.message:delete this.errors[b]},this);return this.valid()};pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",
new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",
map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",
generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",
list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",
tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",
admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",
subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"};
pe.routes.build_path=function(a,b){var c=pe.routes.map[a],d=c.match(/\{\{\*(.+)\}\}/);_.each(d,function(a){b[a]&&(b[a]=b[a].join("/"))});c=c.replace(/\*/,"");b=b||{};return pe.routes.clean_url(pe.templatize(c,b))};pe.routes.clean_url=function(a){return("/"+a).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var a=pe.routes.recognize_path(window.location.pathname);return a?a.params:{}};
pe.routes.recognize_path=function(a){a=pe.routes.clean_url(a);var b,c,d=_.find(_.keys(pe.routes.map),function(d){b=pe.routes.map[d];c=RegExp(b.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return c.test(a)});if(d){for(var e=_.map(b.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),f=a.match(c).slice(1,99),g={params:{}},j=function(a){return!_.isEmpty(a)},h=0;h<e.length;h++)"*"==e[h][0]&&(e[h]=e[h].replace(/\*/g,""),f[h]=_.select(f[h].replace(/\*/g,"").split("/"),j)),
g.params[e[h]]=f[h];g.path_info={name:d,template:b};return g}return!1};pe.routes.Request=function(a,b,c){pe.routes.map[a]?(this.path=a,"object"!==typeof b&&(b={id:b}),this.params=b,this.callback=c):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(a,b,c){return new pe.routes.Request(a,b,c)};pe.routes.Request.from_current_location=function(a,b,c){b=b||{};var d=pe.routes.current_url_params();return new pe.routes.Request(a,_.extend(d,b),c)};
pe.routes.Request.prototype.ajax=function(a,b){var c="function"===typeof b?b:this.callback;$.ajax({url:this.build_path(),data:this.params,type:a,success:c})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(a){this.ajax("GET",a)};pe.routes.Request.prototype.post=function(a){this.ajax("POST",a)};
(function(a){var b;a.rails=b={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",
fileInputSelector:"input:file",CSRFProtection:function(b){var d=a('meta[name="csrf-token"]').attr("content");d&&b.setRequestHeader("X-CSRF-Token",d)},fire:function(b,d,e){d=a.Event(d);b.trigger(d,e);return!1!==d.result},confirm:function(a){return confirm(a)},ajax:function(b){return a.ajax(b)},handleRemote:function(c){var d,e,f,g=c.data("type")||a.ajaxSettings&&a.ajaxSettings.dataType;if(b.fire(c,"ajax:before")){if(c.is("form")){d=c.attr("method");e=c.attr("action");f=c.serializeArray();var j=c.data("ujs:submit-button");
j&&(f.push(j),c.data("ujs:submit-button",null))}else d=c.data("method"),e=c.attr("href"),f=null;b.ajax({url:e,type:d||"GET",data:f,dataType:g,beforeSend:function(a,d){void 0===d.dataType&&a.setRequestHeader("accept","*/*;q=0.5, "+d.accepts.script);return b.fire(c,"ajax:beforeSend",[a,d])},success:function(a,b,d){c.trigger("ajax:success",[a,b,d])},complete:function(a,b){c.trigger("ajax:complete",[a,b])},error:function(a,b,d){c.trigger("ajax:error",[a,b,d])}})}},handleMethod:function(b){var d=b.attr("href"),
e=b.data("method");b=a("meta[name=csrf-token]").attr("content");var f=a("meta[name=csrf-param]").attr("content"),d=a('<form method="post" action="'+d+'"></form>'),e='<input name="_method" value="'+e+'" type="hidden" />';void 0!==f&&void 0!==b&&(e+='<input name="'+f+'" value="'+b+'" type="hidden" />');d.hide().append(e).appendTo("body");d.submit()},disableFormElements:function(c){c.find(b.disableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";b.data("ujs:enable-with",b[c]());
b[c](b.data("disable-with"));b.attr("disabled","disabled")})},enableFormElements:function(c){c.find(b.enableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";if(b.data("ujs:enable-with"))b[c](b.data("ujs:enable-with"));b.removeAttr("disabled")})},allowAction:function(a){var d=a.data("confirm"),e=!1,f;if(!d)return!0;b.fire(a,"confirm")&&(e=b.confirm(d),f=b.fire(a,"confirm:complete",[e]));return e&&f},blankInputs:function(b,d,e){var f=a(),g;b.find(d||"input,textarea").each(function(){g=
a(this);if(e?g.val():!g.val())f=f.add(g)});return f.length?f:!1},nonBlankInputs:function(a,d){return b.blankInputs(a,d,!0)},stopEverything:function(a){a.stopImmediatePropagation();return!1},callFormSubmitBindings:function(b){b=b.data("events");var d=!0;void 0!==b&&void 0!==b.submit&&a.each(b.submit,function(a,b){if("function"===typeof b.handler)return d=b.handler(b.data)});return d}};"ajaxPrefilter"in a?a.ajaxPrefilter(function(a,d,e){b.CSRFProtection(e)}):a(document).ajaxSend(function(a,d){b.CSRFProtection(d)});
a(b.linkClickSelector).live("click.rails",function(c){var d=a(this);if(!b.allowAction(d))return b.stopEverything(c);if(void 0!==d.data("remote"))return b.handleRemote(d),!1;if(d.data("method"))return b.handleMethod(d),!1});a(b.formSubmitSelector).live("submit.rails",function(c){var d=a(this),e=void 0!==d.data("remote"),f=b.blankInputs(d,b.requiredInputSelector),g=b.nonBlankInputs(d,b.fileInputSelector);if(!b.allowAction(d))return b.stopEverything(c);if(f&&b.fire(d,"ajax:aborted:required",[f]))return!e;
if(e){if(g)return b.fire(d,"ajax:aborted:file",[g]);if(!a.support.submitBubbles&&!1===b.callFormSubmitBindings(d))return b.stopEverything(c);b.handleRemote(d);return!1}setTimeout(function(){b.disableFormElements(d)},13)});a(b.formInputClickSelector).live("click.rails",function(c){var d=a(this);if(!b.allowAction(d))return b.stopEverything(c);c=(c=d.attr("name"))?{name:c,value:d.val()}:null;d.closest("form").data("ujs:submit-button",c)});a(b.formSubmitSelector).live("ajax:beforeSend.rails",function(c){this==
c.target&&b.disableFormElements(a(this))});a(b.formSubmitSelector).live("ajax:complete.rails",function(c){this==c.target&&b.enableFormElements(a(this))})})(jQuery);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.onbeforeunload=function(){return"Are you sure? All unsaved data will be lost."};$(function(){pe.init_page_framework();$(".SelectAllTicketTypes").click(function(){return $(".TicketTypeCheckBox").attr("checked","checked")});$(".DeselectAllTicketTypes").click(function(){return $(".TicketTypeCheckBox").removeAttr("checked")});$(".Required").click(function(a){a=$(a.currentTarget);if(a.is(":checked"))return a.closest(".inputs").find(".Include").attr("checked",
"checked").change()});$(".QuestionCheckbox").change(function(a){var b;b=$(a.currentTarget);a={};a[b.data("key")]=b.attr("checked");return $.ajax({type:"POST",url:b.data("url"),data:{attendee_info_form_field:a,_method:"PUT"},dataType:"json"})});return pe.sorter=new pe.CustomQuestionSorter($(".SortableList"))});var b=pe,c=function(b){this.container=b;this.on_drop=a(this.on_drop,this);this.drop=a(this.drop,this);this.sorter=this.container.sortable({update:this.on_drop,containment:"#sortable_wrapper",
tolerance:"pointer",scrollSensitivity:150,scrollSpeed:30,handle:".handle",cursor:"auto"})};c.prototype.drop=function(a){return this.on_drop_callback=a};c.prototype.on_drop=function(){var a;console.log(this.sorter.data("url"));a={question_ids:this.sorter.sortable("toArray",{attribute:"data-question"})};return $.post(this.sorter.data("url"),a,this.on_drop_callback)};b.CustomQuestionSorter=c}).call(this);
