pe.CloseButton=function(c,b){pe.init_widget(this,c);this.close_button=c.find(".CloseButton");if("function"===typeof b)this.close_button.click(b);else switch(b){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}};pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"};
pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"};pe.CloseButton.prototype.remove_container=function(){this.container.detach();this.fire_event(pe.CloseButton.events.CLOSED);this.container.remove();return!1};pe.CloseButton.prototype.hide_container=function(){this.fire_event(pe.CloseButton.events.CLOSED);this.container.hide();return!1};
pe.GeneralAutocompleteInputModule=function(c,b,a,d){pe.init_widget(this,c);this.autocomplete_data_or_url=b;this.input_field_name=a;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.autocomplete_input_field=this.container.find(".AutocompleteField");this.autocomplete_handler();this.selected_data_list_div=this.container.find(".SelectedDataList");this.selected_data_list_div.sortable();d&&this.add_data_to_list(d)};
pe.GeneralAutocompleteInputModule.events={SELECTED:"GeneralAutocompleteInputModule_SELECTED",REMOVED:"GeneralAutocompleteInputModule_REMOVED",EMPTIED:"GeneralAutocompleteInputMOdule_EMPTIED"};pe.GeneralAutocompleteInputModule.prototype.add_data_to_list=function(c){this.remove_dummy_row();$.each(c,this.callback(function(b,a){-1===$.inArray(a.id.toString(),this.all_values())&&this.autocomplete_data_selected(a.label,a.id,a.category)}))};
pe.GeneralAutocompleteInputModule.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))};pe.GeneralAutocompleteInputModule.prototype.all_values=function(){return this.selected_data_list_div.find('[name="'+this.input_field_name+'"]').map(function(){return this.value}).toArray()};
pe.GeneralAutocompleteInputModule.prototype.autocomplete_data_selected=function(c,b,a){this.remove_dummy_row();this.selected_data_list_div.append(this.selected_data_html(c,b,a));(new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked))};
pe.GeneralAutocompleteInputModule.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:this.set_autocomplete_data(),minLength:1,close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(c,b){var a=b.item;this.autocomplete_data_selected(a.label,a.id,a.category);this.fire_event(pe.GeneralAutocompleteInputModule.events.SELECTED,a.id)})}).data("autocomplete")._renderItem=function(c,b){b.display_label=b.category?pe.templatize("{{label}} ({{category}})",
b):b.label;return $("<li></li>").data("item.autocomplete",b).append(pe.templatize("<a>{{display_label}}</a>",b)).appendTo(c)}};
pe.GeneralAutocompleteInputModule.prototype.set_autocomplete_data=function(){return"string"==typeof this.autocomplete_data_or_url?this.callback(function(c,b){$.getJSON(this.autocomplete_data_or_url,{term:this.autocomplete_input_field.val(),val:this.all_values().join(",")},function(a){pe.GeneralAutocompleteInputModule.sort_autocomplete_results(a,c,b)})}):this.callback(pe.GeneralAutocompleteInputModule.sort_autocomplete_results,this.autocomplete_data_or_url)};
pe.GeneralAutocompleteInputModule.sort_autocomplete_results=function(c,b,a){var d=pe.normalize(b.term).toLowerCase(),f=RegExp($.ui.autocomplete.escapeRegex(d),"i"),c=$.grep(c,function(a){a=a.label||a.value||a;return f.test(a)||f.test(pe.normalize(a))}),e=RegExp("^"+$.ui.autocomplete.escapeRegex(d),"i"),c=_.sortBy(c,function(a){a=pe.normalize(a.label).toLowerCase();return[a!=d,!e.test(a)]});a(c)};
pe.GeneralAutocompleteInputModule.prototype.clear_selected_data=function(){this.selected_data_list_div.html("");this.add_dummy_row()};pe.GeneralAutocompleteInputModule.prototype.close_button_clicked=function(){this.is_empty()&&this.add_dummy_row();this.fire_event(pe.GeneralAutocompleteInputModule.events.REMOVED);this.is_empty()&&this.fire_event(pe.GeneralAutocompleteInputModule.events.EMPTIED)};pe.GeneralAutocompleteInputModule.prototype.display_close_button=function(){this.selected_data_list_div.find(".CloseButton").show()};
pe.GeneralAutocompleteInputModule.prototype.hide_close_button=function(){this.selected_data_list_div.find(".CloseButton").hide()};pe.GeneralAutocompleteInputModule.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><ul class="SelectedDataList" id="sortable"></ul>'};pe.GeneralAutocompleteInputModule.prototype.is_empty=function(){return 0===this.selected_data_list_div.find(".SelectedInputData").length};
pe.GeneralAutocompleteInputModule.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};pe.GeneralAutocompleteInputModule.prototype.replace_data_in_list=function(c){c&&(this.clear_selected_data(),this.add_data_to_list(c))};
pe.GeneralAutocompleteInputModule.prototype.selected_data_html=function(c,b,a){return'<li class="SelectedInputData">  <img style="padding-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"\t\tclass="CloseButton float_left">  <p class="float_left">'+(a?c+"("+a+")":c)+'</p>  <input type="hidden" value="'+b+'" name="'+this.input_field_name+'">  <div class="clear"></div></li>'};
(function(c){var b;c.rails=b={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",
fileInputSelector:"input:file",CSRFProtection:function(a){var d=c('meta[name="csrf-token"]').attr("content");d&&a.setRequestHeader("X-CSRF-Token",d)},fire:function(a,d,b){d=c.Event(d);a.trigger(d,b);return!1!==d.result},confirm:function(a){return confirm(a)},ajax:function(a){return c.ajax(a)},handleRemote:function(a){var d,f,e,g=a.data("type")||c.ajaxSettings&&c.ajaxSettings.dataType;if(b.fire(a,"ajax:before")){if(a.is("form")){d=a.attr("method");f=a.attr("action");e=a.serializeArray();var h=a.data("ujs:submit-button");
h&&(e.push(h),a.data("ujs:submit-button",null))}else d=a.data("method"),f=a.attr("href"),e=null;b.ajax({url:f,type:d||"GET",data:e,dataType:g,beforeSend:function(d,c){void 0===c.dataType&&d.setRequestHeader("accept","*/*;q=0.5, "+c.accepts.script);return b.fire(a,"ajax:beforeSend",[d,c])},success:function(d,b,c){a.trigger("ajax:success",[d,b,c])},complete:function(d,b){a.trigger("ajax:complete",[d,b])},error:function(d,b,c){a.trigger("ajax:error",[d,b,c])}})}},handleMethod:function(a){var d=a.attr("href"),
b=a.data("method"),a=c("meta[name=csrf-token]").attr("content"),e=c("meta[name=csrf-param]").attr("content"),d=c('<form method="post" action="'+d+'"></form>'),b='<input name="_method" value="'+b+'" type="hidden" />';void 0!==e&&void 0!==a&&(b+='<input name="'+e+'" value="'+a+'" type="hidden" />');d.hide().append(b).appendTo("body");d.submit()},disableFormElements:function(a){a.find(b.disableSelector).each(function(){var a=c(this),b=a.is("button")?"html":"val";a.data("ujs:enable-with",a[b]());a[b](a.data("disable-with"));
a.attr("disabled","disabled")})},enableFormElements:function(a){a.find(b.enableSelector).each(function(){var a=c(this),b=a.is("button")?"html":"val";if(a.data("ujs:enable-with"))a[b](a.data("ujs:enable-with"));a.removeAttr("disabled")})},allowAction:function(a){var d=a.data("confirm"),c=!1,e;if(!d)return!0;b.fire(a,"confirm")&&(c=b.confirm(d),e=b.fire(a,"confirm:complete",[c]));return c&&e},blankInputs:function(a,b,f){var e=c(),g;a.find(b||"input,textarea").each(function(){g=c(this);if(f?g.val():
!g.val())e=e.add(g)});return e.length?e:!1},nonBlankInputs:function(a,c){return b.blankInputs(a,c,!0)},stopEverything:function(a){a.stopImmediatePropagation();return!1},callFormSubmitBindings:function(a){var a=a.data("events"),b=!0;void 0!==a&&void 0!==a.submit&&c.each(a.submit,function(a,c){if("function"===typeof c.handler)return b=c.handler(c.data)});return b}};"ajaxPrefilter"in c?c.ajaxPrefilter(function(a,c,f){b.CSRFProtection(f)}):c(document).ajaxSend(function(a,c){b.CSRFProtection(c)});c(b.linkClickSelector).live("click.rails",
function(a){var d=c(this);if(!b.allowAction(d))return b.stopEverything(a);if(void 0!==d.data("remote"))return b.handleRemote(d),!1;if(d.data("method"))return b.handleMethod(d),!1});c(b.formSubmitSelector).live("submit.rails",function(a){var d=c(this),f=void 0!==d.data("remote"),e=b.blankInputs(d,b.requiredInputSelector),g=b.nonBlankInputs(d,b.fileInputSelector);if(!b.allowAction(d))return b.stopEverything(a);if(e&&b.fire(d,"ajax:aborted:required",[e]))return!f;if(f){if(g)return b.fire(d,"ajax:aborted:file",
[g]);if(!c.support.submitBubbles&&!1===b.callFormSubmitBindings(d))return b.stopEverything(a);b.handleRemote(d);return!1}setTimeout(function(){b.disableFormElements(d)},13)});c(b.formInputClickSelector).live("click.rails",function(a){var d=c(this);if(!b.allowAction(d))return b.stopEverything(a);a=(a=d.attr("name"))?{name:a,value:d.val()}:null;d.closest("form").data("ujs:submit-button",a)});c(b.formSubmitSelector).live("ajax:beforeSend.rails",function(a){this==a.target&&b.disableFormElements(c(this))});
c(b.formSubmitSelector).live("ajax:complete.rails",function(a){this==a.target&&b.enableFormElements(c(this))})})(jQuery);$(document).ready(function(){var c="/api/venues/autocomplete.json?city_id="+window.holiday.city_id;pe.venue_autocomplete=new pe.GeneralAutocompleteInputModule($(".Venues"),c,"holiday[venue_ids][]",window.holiday.venues)});
