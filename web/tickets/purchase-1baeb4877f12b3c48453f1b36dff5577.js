(function(){var b,g,d,e,a,c={}.hasOwnProperty;g=function(a,b){function e(){this.constructor=a}for(var f in b)c.call(b,f)&&(a[f]=b[f]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};var k=this,f=function(){};d=b=this.Stripe=(f.version=2,f.endpoint="https://api.stripe.com/v1",f.setPublishableKey=function(a){f.key=a},f.complete=function(a){return function(c){var b;if("success"!==c)return b=Math.round((new Date).getTime()/1E3),(new Image).src="http://q.stripe.com?event=stripejs-error&type="+
c+"&key="+f.key+"&timestamp="+b,"function"==typeof a?a(500,{error:{code:c,type:c,message:"An unexpected error has occurred with Stripe.js. This may\nbe due to network connectivity issues, so you should try\nagain (you won't be charged twice). If you're still having\nproblems, please let us know!"}}):void 0}},f);e=function(){};e=(e.validate=function(a,c){if(!a)throw c+" required";if("object"!=typeof a)throw c+" invalid";},e.formatData=function(a,c){return b.utils.isElement(a)&&(a=b.utils.paramsFromForm(a,
c)),b.utils.underscoreKeys(a),a},e.create=function(a,c){return a.key||(a.key=b.key||b.publishableKey),b.utils.validateKey(a.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens",data:a,method:"POST",success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:b.complete(c),timeout:4E4})},e.get=function(a,c){if(!a)throw"token required";return b.utils.validateKey(b.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens/"+a,data:{key:b.key},success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:b.complete(c),
timeout:4E4})},e);d.token=e;d=this.Stripe;var m=function(){return m.__super__.constructor.apply(this,arguments)};g(m,this.Stripe.token);m.tokenName="card";m.whitelistedAttrs="number cvc exp_month exp_year name address_line1 address_line2 address_city address_state address_zip address_country".split(" ");m.createToken=function(a,c,e){var f;return null==c&&(c={}),b.token.validate(a,"card"),"function"==typeof c?(e=c,c={}):"object"!=typeof c&&(f=parseInt(c,10),c={},0<f&&(c.amount=f)),c[m.tokenName]=b.token.formatData(a,
m.whitelistedAttrs),b.token.create(c,e)};m.getToken=function(a,c){return b.token.get(a,c)};m.validateCardNumber=function(a){return a=(a+"").replace(/\s+|-/g,""),10<=a.length&&16>=a.length&&m.luhnCheck(a)};m.validateCVC=function(a){return a=b.utils.trim(a),/^\d+$/.test(a)&&3<=a.length&&4>=a.length};m.validateExpiry=function(a,c){var e,f;return a=b.utils.trim(a),c=b.utils.trim(c),/^\d+$/.test(a)?/^\d+$/.test(c)?12>=parseInt(a,10)?(f=new Date(c,a),e=new Date,f.setMonth(f.getMonth()-1),f.setMonth(f.getMonth()+
1,1),f>e):!1:!1:!1};m.luhnCheck=function(a){var c,b,e,f,k;b=!0;e=0;c=(a+"").split("").reverse();f=0;for(k=c.length;f<k;f++){a=c[f];a=parseInt(a,10);if(b=!b)a*=2;9<a&&(a-=9);e+=a}return 0===e%10};m.cardType=function(a){return m.cardTypes[a.slice(0,2)]||"Unknown"};var j;a={};for(e=j=40;49>=j;e=++j)a[e]="Visa";for(e=j=50;59>=j;e=++j)a[e]="MasterCard";e=(a[34]=a[37]="American Express",a[60]=a[62]=a[64]=a[65]="Discover",a[35]="JCB",a[30]=a[36]=a[38]=a[39]="Diners Club",a);e=(m.cardTypes=e,m);d.card=e;
d=this.Stripe;var h=function(){return h.__super__.constructor.apply(this,arguments)};g=(g(h,this.Stripe.token),h.tokenName="bank_account",h.whitelistedAttrs=["country","routing_number","account_number"],h.createToken=function(a,c,e){return null==c&&(c={}),b.token.validate(a,"bank account"),"function"==typeof c&&(e=c,c={}),c[h.tokenName]=b.token.formatData(a,h.whitelistedAttrs),b.token.create(c,e)},h.getToken=function(a,c){return b.token.get(a,c)},h.validateRoutingNumber=function(a,c){a=b.utils.trim(a);
switch(c){case "US":return/^\d+$/.test(a)&&9===a.length&&h.routingChecksum(a);case "CA":return/\d{5}\-\d{3}/.test(a)&&9===a.length;default:return!0}},h.validateAccountNumber=function(a,c){a=b.utils.trim(a);switch(c){case "US":return/^\d+$/.test(a)&&1<=a.length&&17>=a.length;default:return!0}},h.routingChecksum=function(a){var c,b,e,f,k;b=0;a=(a+"").split("");k=[0,3,6];e=0;for(f=k.length;e<f;e++)c=k[e],b+=3*parseInt(a[c]),b+=7*parseInt(a[c+1]),b+=parseInt(a[c+2]);return 0!==b&&0===b%10},h);d.bankAccount=
g;g="createToken getToken cardType validateExpiry validateCVC validateCardNumber".split(" ");e=0;for(a=g.length;e<a;e++)d=g[e],this.Stripe[d]=this.Stripe.card[d];"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe);"function"==typeof define&&define("stripe",[],function(){return k.Stripe})}).call(this);
(function(){var b,g,d,e=[].slice;b=encodeURIComponent;g=(new Date).getTime();d=function(a,c,e){var f,g;null==c&&(c=[]);for(f in a)g=a[f],e&&(f=""+e+"["+f+"]"),"object"==typeof g?d(g,c,f):c.push(""+f+"="+b(g));return c.join("&").replace(/%20/g,"+")};this.Stripe.ajaxJSONP=function(a){var c,b,f,m,j,h;return null==a&&(a={}),f="sjsonp"+ ++g,j=document.createElement("script"),b=null,c=function(c){var e;return null==c&&(c="abort"),clearTimeout(b),null!=(e=j.parentNode)&&e.removeChild(j),f in window&&(window[f]=
function(){}),"function"==typeof a.complete?a.complete(c,h,a):void 0},h={abort:c},j.onerror=function(){return h.abort(),"function"==typeof a.error?a.error(h,a):void 0},window[f]=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];clearTimeout(b);j.parentNode.removeChild(j);try{delete window[f]}catch(d){window[f]=void 0}return"function"==typeof a.success&&a.success.apply(a,c),"function"==typeof a.complete?a.complete("success",h,a):void 0},a.data||(a.data={}),a.data.callback=f,a.method&&(a.data._method=
a.method),j.src=a.url+"?"+d(a.data),m=document.getElementsByTagName("head")[0],m.appendChild(j),0<a.timeout&&(b=setTimeout(function(){return h.abort("timeout")},a.timeout)),h}}).call(this);
(function(){var b=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1},g=this.Stripe,d;d=function(){};d=(d.trim=function(b){return(b+"").replace(/^\s+|\s+$/g,"")},d.underscore=function(b){return(b+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},d.underscoreKeys=function(b){var a,c,k;k=[];for(a in b)c=b[a],delete b[a],k.push(b[this.underscore(a)]=c);return k},d.isElement=function(b){return"object"!=typeof b?!1:"undefined"!=
typeof jQuery&&null!==jQuery&&b instanceof jQuery?!0:1===b.nodeType},d.paramsFromForm=function(e,a){var c,k,f,d,g,h,p;null==a&&(a=[]);"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(e=e[0]);f=e.getElementsByTagName("input");d=e.getElementsByTagName("select");g={};h=0;for(p=f.length;h<p;h++)k=f[h],c=this.underscore(k.getAttribute("data-stripe")),0>b.call(a,c)||(g[c]=k.value);f=0;for(h=d.length;f<h;f++)k=d[f],c=this.underscore(k.getAttribute("data-stripe")),0>b.call(a,c)||null!=k.selectedIndex&&
(g[c]=k.options[k.selectedIndex].value);return g},d.validateKey=function(b){if(!b||"string"!=typeof b)throw Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(b))throw Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(b))throw Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js");
},d);g.utils=d}).call(this);
(function(){var b=[].indexOf||function(b){for(var d=0,e=this.length;d<e;d++)if(d in this&&this[d]===b)return d;return-1};this.Stripe.validator={"boolean":function(b,d){if("true"!==d&&"false"!==d)return"Enter a boolean string (true or false)"},integer:function(b,d){if(!/^\d+$/.test(d))return"Enter an integer"},positive:function(b,d){if(this.integer(b,d)||!(0<parseInt(d,10)))return"Enter a positive value"},range:function(g,d){var e;if(e=parseInt(d,10),0>b.call(g,e))return"Needs to be between "+g[0]+
" and "+g[g.length-1]},required:function(b,d){if(b&&(null==d||""===d))return"Required"},year:function(b,d){if(!/^\d{4}$/.test(d))return"Enter a 4-digit year"},birthYear:function(b,d){var e;if(e=this.year(b,d))return e;if(2E3<parseInt(d,10))return"You must be over 18";if(1900>parseInt(d,10))return"Enter your birth year"},month:function(b,d){if(this.integer(b,d))return"Please enter a month";if(this.range([1,2,3,4,5,6,7,8,9,10,11,12],d))return"Needs to be between 1 and 12"},choices:function(g,d){if(0>
b.call(g,d))return"Not an acceptable value for this field"},email:function(b,d){if(!/^[^@<\s>]+@[^@<\s>]+$/.test(d))return"That doesn't look like an email address"},url:function(b,d){if(!/^https?:\/\/.+\..+/.test(d))return"Not a valid url"},usTaxID:function(b,d){if(!/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(d))return"Not a valid tax ID"},ein:function(b,d){if(!/^\d{2}-?\d{7}$/.test(d))return"Not a valid EIN"},ssnLast4:function(b,d){if(!/^\d{4}$/.test(d))return"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(b,
d){var e;a:{switch(b){case "CA":e=/^\d{3}-?\d{3}-?\d{3}$/.test(d);break a;case "US":e=!0;break a}e=void 0}if(!e)return"Not a valid ID"},bizTaxID:function(b,d){var e,a,c,k,f,m;a={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]}[b];if(null!=a){e=a[0];k=a[1];a=!1;f=0;for(m=k.length;f<m;f++)if(c=k[f],c.test(d)){a=!0;break}if(!a)return"Not a valid "+e}},zip:function(b,d){var e;a:{switch(b.toUpperCase()){case "CA":e=/^[\d\w]{6}$/.test(null!=d?d.replace(/\s+/g,""):void 0);break a;case "US":e=/^\d{5}$/.test(d)||
/^\d{9}$/.test(d);break a}e=void 0}if(!e)return"Not a valid zip"},bankAccountNumber:function(b,d){if(!/^\d{1,17}$/.test(d))return"Invalid bank account number"},usRoutingNumber:function(b){var d,e,a,c,k,f;if(!/^\d{9}$/.test(b))return"Routing number must have 9 digits";d=k=c=0;for(f=b.length-1;k<=f;d=k+=3)e=3*parseInt(b.charAt(d),10),a=7*parseInt(b.charAt(d+1),10),d=parseInt(b.charAt(d+2),10),c+=e+a+d;if(0===c||0!==c%10)return"Invalid routing number"},caRoutingNumber:function(b){if(!/^\d{5}\-\d{3}$/.test(b))return"Invalid transit number"},
routingNumber:function(b,d){switch(b.toUpperCase()){case "CA":return this.caRoutingNumber(d);case "US":return this.usRoutingNumber(d)}},phoneNumber:function(b,d){if(10!==d.replace(/[^0-9]/g,"").length)return"Invalid phone number"},bizDBA:function(b,d){if(!/^.{1,23}$/.test(d))return"Statement descriptors can only have up to 23 characters"},nameLength:function(b,d){if(1===d.length)return"Names need to be longer than one character"}}}).call(this);
pe.routes={map:{search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",
new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",
map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",
generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",
list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",
api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",
admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",
creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"}};pe.routes.build_path=function(b,g){var d=pe.routes.map[b],e=d.match(/\{\{\*(.+)\}\}/);_.each(e,function(a){g[a]&&(g[a]=g[a].join("/"))});d=d.replace(/\*/,"");g=g||{};return pe.routes.clean_url(pe.templatize(d,g))};
pe.routes.clean_url=function(b){return("/"+b).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var b=pe.routes.recognize_path(window.location.pathname);return b?b.params:{}};
pe.routes.recognize_path=function(b){b=pe.routes.clean_url(b);var g,d,e=_.find(_.keys(pe.routes.map),function(a){g=pe.routes.map[a];d=RegExp(g.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return d.test(b)});if(e){for(var a=_.map(g.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),c=b.match(d).slice(1,99),k={params:{}},f=function(a){return!_.isEmpty(a)},m=0;m<a.length;m++)"*"==a[m][0]&&(a[m]=a[m].replace(/\*/g,""),c[m]=_.select(c[m].replace(/\*/g,"").split("/"),f)),
k.params[a[m]]=c[m];k.path_info={name:e,template:g};return k}return!1};pe.routes.Request=function(b,g,d){pe.routes.map[b]?(this.path=b,"object"!==typeof g&&(g={id:g}),this.params=g,this.callback=d):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(b,g,d){return new pe.routes.Request(b,g,d)};pe.routes.Request.from_current_location=function(b,g,d){g=g||{};var e=pe.routes.current_url_params();return new pe.routes.Request(b,_.extend(e,g),d)};
pe.routes.Request.prototype.ajax=function(b,g){var d="function"===typeof g?g:this.callback;$.ajax({url:this.build_path(),data:this.params,type:b,success:d})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(b){this.ajax("GET",b)};pe.routes.Request.prototype.post=function(b){this.ajax("POST",b)};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},g=pe,d=function(e,a,c,d){this.form=e;this.path_name=a;this.needs_token=c;this.on_success=d;this.on_submit_button_clicked=b(this.on_submit_button_clicked,this);this.on_submit=b(this.on_submit,this);this.on_charge=b(this.on_charge,this);this.form.find("select, input[type=text]").each(function(){return $(this).val("")});if(!this.init_stripe())return this.form.submit(function(a){return a.preventDefault()}),!1;this.errors_container=
this.form.find(".Errors");this.messages_container=this.form.find(".Messages");this.card_inputs=this.form.find(".CardInput");this.billing_inputs=this.form.find(".BillingInput");this.submit_button=this.form.find(".SubmitButton");this.submit_button.click(this.on_submit_button_clicked);this.form.submit(this.on_submit)};d.prototype.apply_values=function(b){var a=this;return _.each(b,function(b,e){return a.form.find("[data-key='"+e+"']").val(b)})};d.prototype.collect_card_data=function(b){var a;b||(b=$(".BillingInput, .CardInput"));
a={};_.each(b,function(b){var e;b=$(b);"radio"===b.attr("type")&&(b=b.filter(":checked"));if(0<b.length&&(e=b.data("key")))return a[e]=b.val()});return a};d.prototype.init_stripe=function(){if(window.publishable_stripe_key)return Stripe.setPublishableKey(window.publishable_stripe_key),!0;alert("No window.publishable_stripe_key set to use stripe");return!1};d.prototype.on_charge=function(b,a){var c,d=this;if(a&&a.error)return $("body").css("cursor","inherit"),this.show_error(a.error.message);this.show_message("Please wait...");
c=this.collect_card_data(this.billing_inputs);c={id:c.id,ticket_order:c};c.card_token=a?a.id:"failed";return pe.routes.Request.factory(this.path_name,c).post(function(a){$("body").css("cursor","inherit");if(1===a.status)return d.show_error(a.message);if(d.on_success)return d.on_success()})};d.prototype.on_submit=function(b){b&&b.preventDefault();return!1};d.prototype.charge=function(){$("body").css("cursor","wait");return this.needs_token?Stripe.card.createToken(this.collect_card_data(this.card_inputs),
this.on_charge):this.on_charge()};d.prototype.on_submit_button_clicked=function(){return this.charge()};d.prototype.show_error=function(b){this.errors_container.show().html(b);this.messages_container.hide();pe.install_easing();pe.animated_scrolling(this.errors_container,10);return _.each(this.card_inputs,function(a){$(a).val("");return $(a).parent().find(".inline-success").remove()})};d.prototype.show_message=function(){return this.errors_container.hide()};g.StripeForm=d}).call(this);
pe.Floater=function(b,g,d){pe.init_widget(this,b);this.bottom_margin=d||0;this.start_point_div=b.find(".FloatingAreaStart");this.end_point_div=g||null;this.stop_at=this.start_from=0;this.sticked=this.is_floating=!1;this.floater=this.container.find(".Floater");this.offset=0;this.disabled=!1;this.top=parseInt(this.floater.css("margin-top"),10)||0;$(window).scroll(this.callback(this.scrolling));this.set_floating_area();pe.Floater.register_floater(this)};
pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"};pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top;this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)};
pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var b=$(window).scrollTop(),g=b+this.offset+this.bottom_margin<=this.start_from,d=b+this.offset+this.bottom_margin>this.start_from,e=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;!this.is_floating&&d&&!e&&!this.sticked?(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this)):this.is_floating&&g?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,
this)):this.end_point_div&&(!this.sticked&&e?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&b+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick())}};pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed");this.floater.removeClass("bottom");this.is_floating=!0;this.sticked=!1;this.set_offset()};
pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.sticked=!0};pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.disabled=this.sticked=!0};
pe.Floater.prototype.enable=function(){this.disabled=!1};pe.Floater.prototype.unstick=function(){this.floater.css("margin-top","");this.floater.css("top","");this.floater.css("position","");this.start_floating();this.fire_event(pe.Floater.events.FLOATING,this)};pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top","");this.floater.removeClass("fixed");this.floater.removeClass("bottom");this.sticked=this.is_floating=!1;this.set_offset()};
pe.Floater.prototype.set_offset=function(b){b&&(this.offset=b);0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")};pe.Floater.registered_floaters=[];pe.Floater.register_floater=function(b){pe.Floater.registered_floaters.push(b);pe.Floater.update_positions()};
pe.Floater.update_positions=function(){pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(b){return b.container.offset().top},null);if(pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var b=1;b<pe.Floater.registered_floaters.length;b++){var g=pe.Floater.registered_floaters[b-1].offset+pe.Floater.registered_floaters[b-1].floater.outerHeight();pe.Floater.registered_floaters[b].offset=g;pe.Floater.registered_floaters[b].is_floating&&
pe.Floater.registered_floaters[b].start_floating();pe.Floater.registered_floaters[b].set_floating_area()}};pe.Validator=function(b){this.message=b.message||"Invalid value.";this.callback=b.callback;this.unless_callback=b.unless||function(){return!1};this.options=b;this.value=b.value?b.value:function(g){return b.callback(g)}};pe.Validator.prototype.passed=function(b){return!!this.callback($(b))};pe.Validator.prototype.failed=function(b){return!this.passed(b)};pe.Validator.prototype.unless=function(){return this.unless_callback()};
pe.validation.name_validator=new pe.Validator({callback:function(b){return _.isEmpty($.trim(b.val()))?(this.message="Field cannot be blank.",!1):50<b.val().length?(this.message="Please shorten your name.",!1):!0},message:"Invalid name."});pe.validation.not_blank_validator=new pe.Validator({callback:function(b){return!_.isEmpty($.trim(b.val()))},message:"Field cannot be blank."});
pe.validation.cc_number_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCardNumber(b.val())},message:"Invalid card number."});pe.validation.cvc_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCVC(b.val())},message:"Invalid CVC."});pe.validation.zip_code_validator=new pe.Validator({callback:function(b){return!!b.val().match(/^\d{5}(\s*\-\s*\d{4})?$/)},message:"Please enter a valid zip code."});
pe.validation.email_format_validator=new pe.Validator({callback:function(b){return pe.validation.check_email_format(b.val())},message:"Please enter a valid email address."});pe.validation.check_email_format=function(b){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(b))};
pe.ValidatableForm=function(b,g,d,e){pe.init_widget(this,b);this.bindings=d||{};this.chained_fields=[];this.errors={};this.rules=g||{};this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.after_submit=e;this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(b,g){"string"===typeof b?$(g).bind(b,this.callback(function(){this.validate_field(g)})):"function"===typeof b&&this.callback(b)();this.rules[g].value($(g))&&this.validate_field(g)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var b=this.validate();this.highlight_first_failed();b&&this.after_submit&&this.after_submit();return b};pe.ValidatableForm.prototype.delete_error=function(b){delete this.errors[b];_.each(this.chained_fields,function(g){_.include(g,b)&&_.each(g,function(b){this.errors[b]&&this.delete_error(b)},this)},this)};
pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var b=_.keys(this.errors)[0];this.render_field_error(b)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(b,g){this.render_field_error(g)},this)};
pe.ValidatableForm.prototype.render_field_error=function(b){var g=$(b).parents("li.input");0===g.length&&(g=$(b));g.find(".inline-errors").remove();g.append('<span class="inline-errors">'+this.errors[b]+"</span>");g.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(b){var g=$(b).parents("li.input");0===g.length&&(g=$(b));g.find(".inline-success").remove();g.append('<img class="inline-success" src="/assets/users/check.png" />');g.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(b){this.render_field_success(b)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(b){var g=this.rules[b],d=g.passed(b);g.unless()?this.delete_error(b):d?(this.delete_error(b),this.render_field_success(b)):(this.errors[b]=g.message,this.render_field_error(b));this.toggle_submit();return d};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(b,g){b.failed(g)?this.errors[g]=b.message:delete this.errors[g]},this);return this.valid()};
pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},g=pe,d=function(e){this.container=e;this.show_message=b(this.show_message,this);this.on_submit=b(this.on_submit,this);this.show_form=b(this.show_form,this);this.click=b(this.click,this);this.link=this.container.find(".Link");this.link.click(this.show_form);this.form_container=this.container.find(".FormContainer");this.form=this.form_container.find("form");this.form.submit(this.on_submit);this.message=this.container.find(".Message")};
d.prototype.click=function(b){return this.on_click_callback=b};d.prototype.show_form=function(){var b;b=new pe.Validator({callback:function(a){a=$.trim(a.val());if(_.isEmpty(a))return this.message="Email cannot be blank.",!1;this.message="Invalid email.";return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test(a)}});new pe.ValidatableForm(this.form,{"#question_name":pe.validation.name_validator,"#question_email":b,"#question_text":pe.validation.not_blank_validator},{"#question_name":"keyup",
"#question_email":"keyup","#question_text":"keyup"});this.link.hide();this.form_container.show();return this.on_click_callback()};d.prototype.on_submit=function(b){b.preventDefault();$.post(pe.routes.build_path("ask_party_earth"),this.form.serialize(),"json");return this.show_message()};d.prototype.show_message=function(){this.form_container.hide();return this.message.show()};g.AskPartyEarth=d}).call(this);
(function(b){function g(){function a(b){b=1E12>b?d?performance.now()+performance.timing.navigationStart:c():b||c();1E3<=b-g&&(e._updateTargets(),g=b);f(a)}this.regional=[];this.regional[""]={labels:"Years Months Weeks Days Hours Minutes Seconds".split(" "),labels1:"Year Month Week Day Hour Minute Second".split(" "),compactLabels:["y","m","w","d"],whichLabels:null,digits:"0123456789".split(""),timeSeparator:":",isRTL:!1};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",
layout:"",compact:!1,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:!1,onExpiry:null,onTick:null,tickInterval:1};b.extend(this._defaults,this.regional[""]);this._serverSyncs=[];var c="function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},d=window.performance&&"function"==typeof window.performance.now,f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
null,g=0;!f||b.noRequestAnimationFrame?(b.noRequestAnimationFrame=null,setInterval(function(){e._updateTargets()},980)):(g=window.animationStartTime||window.webkitAnimationStartTime||window.mozAnimationStartTime||window.oAnimationStartTime||window.msAnimationStartTime||c(),f(a))}b.extend(g.prototype,{markerClassName:"hasCountdown",propertyName:"countdown",_rtlClass:"countdown_rtl",_sectionClass:"countdown_section",_amountClass:"countdown_amount",_rowClass:"countdown_row",_holdingClass:"countdown_holding",
_showClass:"countdown_show",_descrClass:"countdown_descr",_timerTargets:[],setDefaults:function(a){this._resetExtraLabels(this._defaults,a);b.extend(this._defaults,a||{})},UTCDate:function(a,b,e,f,d,g,h,p){"object"==typeof b&&b.constructor==Date&&(p=b.getMilliseconds(),h=b.getSeconds(),g=b.getMinutes(),d=b.getHours(),f=b.getDate(),e=b.getMonth(),b=b.getFullYear());var n=new Date;n.setUTCFullYear(b);n.setUTCDate(1);n.setUTCMonth(e||0);n.setUTCDate(f||1);n.setUTCHours(d||0);n.setUTCMinutes((g||0)-(30>
Math.abs(a)?60*a:a));n.setUTCSeconds(h||0);n.setUTCMilliseconds(p||0);return n},periodsToSeconds:function(a){return 31557600*a[0]+2629800*a[1]+604800*a[2]+86400*a[3]+3600*a[4]+60*a[5]+a[6]},_attachPlugin:function(a,c){a=b(a);if(!a.hasClass(this.markerClassName)){var e={options:b.extend({},this._defaults),_periods:[0,0,0,0,0,0,0]};a.addClass(this.markerClassName).data(this.propertyName,e);this._optionPlugin(a,c)}},_addTarget:function(a){this._hasTarget(a)||this._timerTargets.push(a)},_hasTarget:function(a){return-1<
b.inArray(a,this._timerTargets)},_removeTarget:function(a){this._timerTargets=b.map(this._timerTargets,function(b){return b==a?null:b})},_updateTargets:function(){for(var a=this._timerTargets.length-1;0<=a;a--)this._updateCountdown(this._timerTargets[a])},_optionPlugin:function(a,c,e){a=b(a);var f=a.data(this.propertyName);if(!c||"string"==typeof c&&null==e){var d=c;return(c=(f||{}).options)&&d?c[d]:c}a.hasClass(this.markerClassName)&&(c=c||{},"string"==typeof c&&(d=c,c={},c[d]=e),c.layout&&(c.layout=
c.layout.replace(/&lt;/g,"<").replace(/&gt;/g,">")),this._resetExtraLabels(f.options,c),e=f.options.timezone!=c.timezone,b.extend(f.options,c),this._adjustSettings(a,f,null!=c.until||null!=c.since||e),c=new Date,(f._since&&f._since<c||f._until&&f._until>c)&&this._addTarget(a[0]),this._updateCountdown(a,f))},_updateCountdown:function(a,c){var e=b(a);if(c=c||e.data(this.propertyName)){e.html(this._generateHTML(c)).toggleClass(this._rtlClass,c.options.isRTL);if(b.isFunction(c.options.onTick)){var f=
"lap"!=c._hold?c._periods:this._calculatePeriods(c,c._show,c.options.significant,new Date);(1==c.options.tickInterval||0==this.periodsToSeconds(f)%c.options.tickInterval)&&c.options.onTick.apply(a,[f])}if("pause"!=c._hold&&(c._since?c._now.getTime()<c._since.getTime():c._now.getTime()>=c._until.getTime())&&!c._expiring){c._expiring=!0;if(this._hasTarget(a)||c.options.alwaysExpire)this._removeTarget(a),b.isFunction(c.options.onExpiry)&&c.options.onExpiry.apply(a,[]),c.options.expiryText&&(f=c.options.layout,
c.options.layout=c.options.expiryText,this._updateCountdown(a,c),c.options.layout=f),c.options.expiryUrl&&(window.location=c.options.expiryUrl);c._expiring=!1}else"pause"==c._hold&&this._removeTarget(a);e.data(this.propertyName,c)}},_resetExtraLabels:function(a,b){var e=!1,f;for(f in b)if("whichLabels"!=f&&f.match(/[Ll]abels/)){e=!0;break}if(e)for(f in a)f.match(/[Ll]abels[02-9]|compactLabels1/)&&(a[f]=null)},_adjustSettings:function(a,c,e){for(var f=0,f=null,d=0;d<this._serverSyncs.length;d++)if(this._serverSyncs[d][0]==
c.options.serverSync){f=this._serverSyncs[d][1];break}null!=f?(f=c.options.serverSync?f:0,a=new Date):(f=b.isFunction(c.options.serverSync)?c.options.serverSync.apply(a,[]):null,a=new Date,f=f?a.getTime()-f.getTime():0,this._serverSyncs.push([c.options.serverSync,f]));d=c.options.timezone;d=null==d?-a.getTimezoneOffset():d;if(e||!e&&null==c._until&&null==c._since)c._since=c.options.since,null!=c._since&&(c._since=this.UTCDate(d,this._determineTime(c._since,null)),c._since&&f&&c._since.setMilliseconds(c._since.getMilliseconds()+
f)),c._until=this.UTCDate(d,this._determineTime(c.options.until,a)),f&&c._until.setMilliseconds(c._until.getMilliseconds()+f);c._show=this._determineShow(c)},_destroyPlugin:function(a){a=b(a);a.hasClass(this.markerClassName)&&(this._removeTarget(a[0]),a.removeClass(this.markerClassName).empty().removeData(this.propertyName))},_pausePlugin:function(a){this._hold(a,"pause")},_lapPlugin:function(a){this._hold(a,"lap")},_resumePlugin:function(a){this._hold(a,null)},_hold:function(a,c){var e=b.data(a,
this.propertyName);if(e){if("pause"==e._hold&&!c){e._periods=e._savePeriods;var f=e._since?"-":"+";e[e._since?"_since":"_until"]=this._determineTime(f+e._periods[0]+"y"+f+e._periods[1]+"o"+f+e._periods[2]+"w"+f+e._periods[3]+"d"+f+e._periods[4]+"h"+f+e._periods[5]+"m"+f+e._periods[6]+"s");this._addTarget(a)}e._hold=c;e._savePeriods="pause"==c?e._periods:null;b.data(a,this.propertyName,e);this._updateCountdown(a,e)}},_getTimesPlugin:function(a){a=b.data(a,this.propertyName);return!a?null:"pause"==
a._hold?a._savePeriods:!a._hold?a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date)},_determineTime:function(a,b){var d;if(null==a)d=b;else if("string"==typeof a){d=a.toLowerCase();for(var f=new Date,g=f.getFullYear(),j=f.getMonth(),h=f.getDate(),p=f.getHours(),n=f.getMinutes(),f=f.getSeconds(),l=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,r=l.exec(d);r;){switch(r[2]||"s"){case "s":f+=parseInt(r[1],10);break;case "m":n+=parseInt(r[1],10);break;case "h":p+=parseInt(r[1],10);break;case "d":h+=
parseInt(r[1],10);break;case "w":h+=7*parseInt(r[1],10);break;case "o":j+=parseInt(r[1],10);h=Math.min(h,e._getDaysInMonth(g,j));break;case "y":g+=parseInt(r[1],10),h=Math.min(h,e._getDaysInMonth(g,j))}r=l.exec(d)}d=new Date(g,j,h,p,n,f,0)}else"number"==typeof a?(d=new Date,d.setTime(d.getTime()+1E3*a)):d=a;d&&d.setMilliseconds(0);return d},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_normalLabels:function(a){return a},_generateHTML:function(a){var c=this;a._periods=a._hold?
a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date);for(var d=!1,f=0,g=a.options.significant,j=b.extend({},a._show),h=0;6>=h;h++)d|="?"==a._show[h]&&0<a._periods[h],j[h]="?"==a._show[h]&&!d?null:a._show[h],f+=j[h]?1:0,g-=0<a._periods[h]?1:0;for(var p=[!1,!1,!1,!1,!1,!1,!1],h=6;0<=h;h--)a._show[h]&&(a._periods[h]?p[h]=!0:(p[h]=0<g,g--));var n=a.options.compact?a.options.compactLabels:a.options.labels,l=a.options.whichLabels||this._normalLabels,d=function(b){var e=a.options["compactLabels"+
l(a._periods[b])];return j[b]?c._translateDigits(a,a._periods[b])+(e?e[b]:n[b])+" ":""},g=function(b){var d=a.options["labels"+l(a._periods[b])];return!a.options.significant&&j[b]||a.options.significant&&p[b]?'<span class="'+e._sectionClass+'"><span class="'+e._amountClass+'">'+c._translateDigits(a,a._periods[b])+"</span><br/>"+(d?d[b]:n[b])+"</span>":""};return a.options.layout?this._buildLayout(a,j,a.options.layout,a.options.compact,a.options.significant,p):(a.options.compact?'<span class="'+this._rowClass+
" "+this._amountClass+(a._hold?" "+this._holdingClass:"")+'">'+d(0)+d(1)+d(2)+d(3)+(j[4]?this._minDigits(a,a._periods[4],2):"")+(j[5]?(j[4]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[5],2):"")+(j[6]?(j[4]||j[5]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[6],2):""):'<span class="'+this._rowClass+" "+this._showClass+(a.options.significant||f)+(a._hold?" "+this._holdingClass:"")+'">'+g(0)+g(1)+g(2)+g(3)+g(4)+g(5)+g(6))+"</span>"+(a.options.description?'<span class="'+this._rowClass+
" "+this._descrClass+'">'+a.options.description+"</span>":"")},_buildLayout:function(a,c,e,d,g,j){var h=a.options[d?"compactLabels":"labels"],p=a.options.whichLabels||this._normalLabels,n=function(b){return(a.options[(d?"compactLabels":"labels")+p(a._periods[b])]||h)[b]},l=function(b,c){return a.options.digits[Math.floor(b/c)%10]},n={desc:a.options.description,sep:a.options.timeSeparator,yl:n(0),yn:this._minDigits(a,a._periods[0],1),ynn:this._minDigits(a,a._periods[0],2),ynnn:this._minDigits(a,a._periods[0],
3),y1:l(a._periods[0],1),y10:l(a._periods[0],10),y100:l(a._periods[0],100),y1000:l(a._periods[0],1E3),ol:n(1),on:this._minDigits(a,a._periods[1],1),onn:this._minDigits(a,a._periods[1],2),onnn:this._minDigits(a,a._periods[1],3),o1:l(a._periods[1],1),o10:l(a._periods[1],10),o100:l(a._periods[1],100),o1000:l(a._periods[1],1E3),wl:n(2),wn:this._minDigits(a,a._periods[2],1),wnn:this._minDigits(a,a._periods[2],2),wnnn:this._minDigits(a,a._periods[2],3),w1:l(a._periods[2],1),w10:l(a._periods[2],10),w100:l(a._periods[2],
100),w1000:l(a._periods[2],1E3),dl:n(3),dn:this._minDigits(a,a._periods[3],1),dnn:this._minDigits(a,a._periods[3],2),dnnn:this._minDigits(a,a._periods[3],3),d1:l(a._periods[3],1),d10:l(a._periods[3],10),d100:l(a._periods[3],100),d1000:l(a._periods[3],1E3),hl:n(4),hn:this._minDigits(a,a._periods[4],1),hnn:this._minDigits(a,a._periods[4],2),hnnn:this._minDigits(a,a._periods[4],3),h1:l(a._periods[4],1),h10:l(a._periods[4],10),h100:l(a._periods[4],100),h1000:l(a._periods[4],1E3),ml:n(5),mn:this._minDigits(a,
a._periods[5],1),mnn:this._minDigits(a,a._periods[5],2),mnnn:this._minDigits(a,a._periods[5],3),m1:l(a._periods[5],1),m10:l(a._periods[5],10),m100:l(a._periods[5],100),m1000:l(a._periods[5],1E3),sl:n(6),sn:this._minDigits(a,a._periods[6],1),snn:this._minDigits(a,a._periods[6],2),snnn:this._minDigits(a,a._periods[6],3),s1:l(a._periods[6],1),s10:l(a._periods[6],10),s100:l(a._periods[6],100),s1000:l(a._periods[6],1E3)},r=e;for(e=0;6>=e;e++)l="yowdhms".charAt(e),r=r.replace(RegExp("\\{"+l+"<\\}([\\s\\S]*)\\{"+
l+">\\}","g"),!g&&c[e]||g&&j[e]?"$1":"");b.each(n,function(a,b){r=r.replace(RegExp("\\{"+a+"\\}","g"),b)});return r},_minDigits:function(a,b,e){b=""+b;if(b.length>=e)return this._translateDigits(a,b);b="0000000000"+b;return this._translateDigits(a,b.substr(b.length-e))},_translateDigits:function(a,b){return(""+b).replace(/[0-9]/g,function(b){return a.options.digits[b]})},_determineShow:function(a){a=a.options.format;var b=[];b[0]=a.match("y")?"?":a.match("Y")?"!":null;b[1]=a.match("o")?"?":a.match("O")?
"!":null;b[2]=a.match("w")?"?":a.match("W")?"!":null;b[3]=a.match("d")?"?":a.match("D")?"!":null;b[4]=a.match("h")?"?":a.match("H")?"!":null;b[5]=a.match("m")?"?":a.match("M")?"!":null;b[6]=a.match("s")?"?":a.match("S")?"!":null;return b},_calculatePeriods:function(a,b,d,f){a._now=f;a._now.setMilliseconds(0);var g=new Date(a._now.getTime());a._since?f.getTime()<a._since.getTime()?a._now=f=g:f=a._since:(g.setTime(a._until.getTime()),f.getTime()>a._until.getTime()&&(a._now=f=g));var j=[0,0,0,0,0,0,
0];if(b[0]||b[1]){var h=e._getDaysInMonth(f.getFullYear(),f.getMonth()),p=e._getDaysInMonth(g.getFullYear(),g.getMonth()),p=g.getDate()==f.getDate()||g.getDate()>=Math.min(h,p)&&f.getDate()>=Math.min(h,p),p=Math.max(0,12*(g.getFullYear()-f.getFullYear())+g.getMonth()-f.getMonth()+(g.getDate()<f.getDate()&&!p||p&&60*(60*g.getHours()+g.getMinutes())+g.getSeconds()<60*(60*f.getHours()+f.getMinutes())+f.getSeconds()?-1:0));j[0]=b[0]?Math.floor(p/12):0;j[1]=b[1]?p-12*j[0]:0;f=new Date(f.getTime());h=f.getDate()==
h;p=e._getDaysInMonth(f.getFullYear()+j[0],f.getMonth()+j[1]);f.getDate()>p&&f.setDate(p);f.setFullYear(f.getFullYear()+j[0]);f.setMonth(f.getMonth()+j[1]);h&&f.setDate(p)}var n=Math.floor((g.getTime()-f.getTime())/1E3);f=function(a,e){j[a]=b[a]?Math.floor(n/e):0;n-=j[a]*e};f(2,604800);f(3,86400);f(4,3600);f(5,60);f(6,1);if(0<n&&!a._since){a=[1,12,4.3482,7,24,60,60];f=6;g=1;for(h=6;0<=h;h--)b[h]&&(j[f]>=g&&(j[f]=0,n=1),0<n&&(j[h]++,n=0,f=h,g=1)),g*=a[h]}if(d)for(h=0;6>=h;h++)d&&j[h]?d--:d||(j[h]=
0);return j}});var d=["getTimes"];b.fn.countdown=function(a){var c=Array.prototype.slice.call(arguments,1),g;g="option"==a&&(0==c.length||1==c.length&&"string"==typeof c[0])?!0:-1<b.inArray(a,d);return g?e["_"+a+"Plugin"].apply(e,[this[0]].concat(c)):this.each(function(){if("string"==typeof a){if(!e["_"+a+"Plugin"])throw"Unknown command: "+a;e["_"+a+"Plugin"].apply(e,[this].concat(c))}else e._attachPlugin(this,a||{})})};var e=b.countdown=new g})(jQuery);
(function(b){var g=(b.browser.msie?"paste":"input")+".mask",d=void 0!=window.orientation;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};b.fn.extend({caret:function(b,a){if(0!=this.length){if("number"==typeof b)return a="number"==typeof a?a:b,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(b,a);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0);c.moveEnd("character",a);c.moveStart("character",b);c.select()}});if(this[0].setSelectionRange)b=
this[0].selectionStart,a=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var c=document.selection.createRange();b=0-c.duplicate().moveStart("character",-1E5);a=b+c.text.length}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(e,a){if(!e&&0<this.length){var c=b(this[0]),k=c.data("tests");return b.map(c.data("buffer"),function(a,b){return k[b]?a:null}).join("")}a=b.extend({placeholder:"_",completed:null},a);var f=b.mask.definitions,
k=[],m=e.length,j=null,h=e.length;b.each(e.split(""),function(a,b){"?"==b?(h--,m=a):f[b]?(k.push(RegExp(f[b])),null==j&&(j=k.length-1)):k.push(null)});return this.each(function(){function c(a){for(;++a<=h&&!k[a];);return a}function n(e){var f=b(this).caret();e=e.keyCode;v=16>e||16<e&&32>e||32<e&&41>e;0!=f.begin-f.end&&(!v||8==e||46==e)&&r(f.begin,f.end);if(8==e||46==e||d&&127==e){for(f=f.begin+(46==e?0:-1);!k[f]&&0<=--f;);for(e=f;e<h;e++)if(k[e]){s[e]=a.placeholder;var g=c(e);if(g<h&&k[e].test(s[g]))s[e]=
s[g];else break}u();q.caret(Math.max(j,f));return!1}if(27==e)return q.val(w),q.caret(0,t()),!1}function l(e){if(v)return v=!1,8==e.keyCode?!1:null;e=e||window.event;var d=e.charCode||e.keyCode||e.which,f=b(this).caret();if(e.ctrlKey||e.altKey||e.metaKey)return!0;if(32<=d&&125>=d||186<d)if(e=c(f.begin-1),e<h&&(d=String.fromCharCode(d),k[e].test(d))){for(var f=e,g=a.placeholder;f<h;f++)if(k[f]){var j=c(f),l=s[f];s[f]=g;if(j<h&&k[j].test(l))g=l;else break}s[e]=d;u();e=c(e);b(this).caret(e);a.completed&&
e==h&&a.completed.call(q)}return!1}function r(b,e){for(var c=b;c<e&&c<h;c++)k[c]&&(s[c]=a.placeholder)}function u(){return q.val(s.join("")).val()}function t(b){for(var e=q.val(),c=-1,d=0,f=0;d<h;d++)if(k[d]){for(s[d]=a.placeholder;f++<e.length;){var g=e.charAt(f-1);if(k[d].test(g)){s[d]=g;c=d;break}}if(f>e.length)break}else s[d]==e[f]&&d!=m&&(f++,c=d);if(!b&&c+1<m)q.val(""),r(0,h);else if(b||c+1>=m)u(),b||q.val(q.val().substring(0,c+1));return m?d:j}var q=b(this),s=b.map(e.split(""),function(b){if("?"!=
b)return f[b]?a.placeholder:b}),v=!1,w=q.val();q.data("buffer",s).data("tests",k);q.attr("readonly")||q.one("unmask",function(){q.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){w=q.val();var a=t();u();setTimeout(function(){a==e.length?q.caret(0,a):q.caret(a)},0)}).bind("blur.mask",function(){t();q.val()!=w&&q.change()}).bind("keydown.mask",n).bind("keypress.mask",l).bind(g,function(){setTimeout(function(){q.caret(t(!0))},0)});t()})}})})(jQuery);
pe.HelpModule=function(b,g,d){pe.init_widget(this,b);this.help_module_open=!1;this.help_id=g;this.container.append(this.html(d));this.container.click(this.callback(this.help_button_clicked));this.help_button_div=this.container.find(".HelpButton");(this.admin_link=this.container.find(".AdminLink"))&&this.admin_link.click(this.callback(this.admin_link_clicked))};
pe.HelpModule.prototype.html=function(b){var g="";0===this.container.contents().length&&(g+='<div class="help_btn HelpButton"></div>');b&&(g+='<div><a class="AdminLink admin_edit" target="_blank" href="/admin/pages/'+this.help_id+'/edit">Edit Tip</a></div>');return g};pe.HelpModule.prototype.admin_link_clicked=function(b){b.stopPropagation()};
pe.HelpModule.prototype.help_button_clicked=function(b){this.help_module_open?b.stopPropagation():pe.ajax_loader.help_page.load({page_id:this.help_id},this.callback(function(b){b=$(this.dialog_box_html(b));this.help_button_div.append(b);this.help_module_open=!0;new pe.CloseButton(b,this.callback(this.close_dialog,b))}))};
pe.HelpModule.prototype.dialog_box_html=function(b){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <h1>{{title}}</h1>{{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',b)};pe.HelpModule.prototype.close_dialog=function(b,g){this.help_module_open=!1;b.remove();g.stopPropagation()};
(function(){pe.validation.promo_code_validator=new pe.Validator({message:"Invalid code",callback:function(b){b=$.trim(b.val());this.message="Invalid code";return _.isEmpty(b)?(this.message="Please enter a promo code",!1):25<b.length?(this.message="Length is limited by 25 characters",!1):/^[\w-_@.]+$/.test(b)}})}).call(this);
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},g=pe,d=function(e){var a=this;this.container=e;this.remove_promo=b(this.remove_promo,this);this.assign_promo=b(this.assign_promo,this);this.apply_promo=b(this.apply_promo,this);this.input=this.container.find(".Input");this.input.val(this.container.data("value"));this.input.keypress(function(b){if(13===b.keyCode)return a.apply_promo()});this.apply_button=this.container.find(".ApplyCodeButton");this.apply_button.data("label",
this.apply_button.html());this.remove_button=this.container.find(".RemoveCodeButton");this.remove_button.data("label",this.remove_button.html());this.apply_button.click(this.apply_promo);this.remove_button.click(this.remove_promo);this.container.find(".Toggler").click(function(){a.container.find(".Fields").show();a.container.find(".Toggler").hide();return a.input.focus()});this.error=this.container.find(".Error");this.message=this.container.find(".Message");this.container.data("valid")?this.assign_promo():
this.initialize()};d.prototype.promo_code_entered=function(){return!_.isEmpty(this.promo_code())};d.prototype.promo_code=function(){return this.input.val()};d.prototype.hide_error=function(){this.error.html("");return this.error.hide()};d.prototype.show_error=function(b){this.error.html("<span>"+b+"</span>");return this.error.show()};d.prototype.show_message=function(b){this.message.html(b);return this.message.show()};d.prototype.hide_message=function(){return this.message.hide()};d.prototype.initialize=
function(){this.promo_code_entered()?(this.container.find(".Toggler").hide(),this.container.find(".Fields").show()):(this.container.find(".Fields").hide(),this.container.find(".Toggler").show());this.input.show();return this.apply_button.show()};d.prototype.reload_table=function(){var b,a;b=$(this.container.data("target"));b.css("opacity",0.5);a=b.data("url");return $.get(a,function(a){b.replaceWith(a);$(".TotalAmount").html($(".Supermoney").html());return pe.load_order_form()})};d.prototype.apply_promo=
function(){var b,a=this;return pe.validation.promo_code_validator.passed(this.input)?(this.error.hide(),this.apply_button.html("Please wait...").addClass("disabled"),b={},b.ticket_order={promo:this.promo_code()},pe.routes.Request.from_current_location("api_apply_ticket_order_promo_code",b).post(function(b){a.apply_button.html(a.apply_button.data("label"));a.apply_button.removeClass("disabled");if(1===b.status)return a.show_error(b.message);a.hide_message();a.assign_promo();return a.reload_table()})):
this.show_error(pe.validation.promo_code_validator.message)};d.prototype.applied=function(){return this.container.data("applied")};d.prototype.assign_promo=function(){this.container.data("applied",!0);this.container.find(".Fields").show();this.container.find(".Toggler").hide();this.input.hide();this.apply_button.hide();this.hide_error();this.show_message("Promo Applied: "+this.promo_code());return this.remove_button.show()};d.prototype.remove_promo=function(){var b=this;this.container.data("applied",
!1);this.remove_button.addClass("disabled").html("Please wait...");return pe.routes.Request.from_current_location("api_remove_ticket_order_promo_code").post(function(a){b.remove_button.html(b.remove_button.data("label"));b.remove_button.removeClass("disabled");if(1===a.status)return b.show_error(a.message);b.hide_error();b.reload_table();b.container.find(".Fields").show();b.hide_error();b.hide_message();b.remove_button.hide();b.input.val("");b.input.show();return b.apply_button.show()})};g.TicketPromoApplier=
d;pe.on_expire=function(){window.onbeforeunload=null;$(".Timer").html("0:00");alert("The time limit has been exceeded and your tickets have been released. \n\nThe purpose of the time limit is to give all fans a fair shot at tickets and ensure tickets are available to as many people as possible. We are sorry for the inconvenience.");$("body").css("cursor","wait");return pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){return window.location=pe.routes.build_path("tickets",
pe.routes.current_url_params())})};pe.on_tick=function(){return $(".Timer").html($(".Timer").html().replace(/0(\d+):/,"$1:"))};window.onbeforeunload=function(){return"You have not completed the purchase process."};pe.check_order_status=function(){return pe.routes.Request.factory("api_ticket_order_status",{id:pe.order_id}).get(function(b){if("pending"!==b.status)return window.onbeforeunload=null,alert("You already ordered this tickets"),window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())})};
$(function(){return pe.init_page_framework(function(){var b,a,c;setTimeout(function(){return pe.check_order_status()},5);pe.routes.Request.factory("api_ticket_orders_countdown_seconds").get(function(a){var b;b=new Date;b=new Date(b.getTime()+1E3*a.data.seconds);return $(".Timer").countdown({until:b,compact:!0,format:"MS",description:"",onExpiry:pe.on_expire,onTick:pe.on_tick})});$(".EditOrderLink").click(function(a){window.onbeforeunload=null;if(confirm("Your tickets will be released for others to purchase if you leave this page.\n\nDo you wish to forfeit your tickets?"))return $(this).html("Please wait..."),
$("body").css("cursor","wait"),pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){var a;a=pe.routes.build_path("tickets",pe.routes.current_url_params());pe.promo&&pe.promo.applied()&&(a=""+a+"?promo="+pe.promo.promo_code());return window.location=a});a.preventDefault();return a.stopPropagation()});pe.load_order_form();setTimeout(function(){return pe.promo=new pe.TicketPromoApplier($(".PromoCode"))},5);a=$("#OrderTicketsPaypalForm");0<a.length&&(pe.init_has_email_delivery(),
c={"#PayPalEmail":pe.validation.email_format_validator},b={"#PayPalEmail":"blur"},pe.paypal_form=new pe.ValidatableForm(a,c,b,function(){window.onbeforeunload=null;return a.submit()}));pe.right_rail_floater=new pe.Floater($(".FloaterContainer"),$(".FloaterLimiter"));pe.ask_party_earth=new pe.AskPartyEarth($(".AskPartyEarth"));return pe.ask_party_earth.click(function(){pe.right_rail_floater.start_floating();return pe.right_rail_floater.scrolling()})})});pe.init_has_email_delivery=function(){return $(".HasEmailDelivery").change(function(){return"true"===
$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")})};pe.load_order_form=function(){var b;b=pe.free_form;pe.free_form=pe.page_container.find(".ReloadArea").data("free");pe.order_tickets_form&&(pe.form_data=pe.order_tickets_form.collect_card_data());if(b!==pe.free_form)return pe.free_form?pe.load_free_order_form():pe.load_purchase_form()};
pe.load_free_order_form=function(){return pe.routes.Request.from_current_location("tickets_purchase_form").get(function(b){pe.page_container.find(".FormContainer").html(b);pe.init_free_order_form();if(pe.form_data&&pe.form)return pe.order_tickets_form.apply_values(pe.form_data),pe.form.validate()})};pe.load_purchase_form=function(){return pe.routes.Request.from_current_location("tickets_purchase_form").get(function(b){pe.page_container.find(".FormContainer").html(b);pe.init_full_purchase_form();if(pe.form_data&&
pe.form)return pe.order_tickets_form.apply_values(pe.form_data),pe.form.validate()})};pe.init_free_order_form=function(){var b,a,c;$("#OrderTicketsPaypalForm").hide();a=$("#OrderTicketsForm");if(0<a.length)return pe.order_tickets_form=new pe.StripeForm(a,"api_close_ticket_order",!1,function(){window.onbeforeunload=null;return window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),c={"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,
"#Email":pe.validation.email_format_validator},b={"#FirstName":"blur","#LastName":"blur","#Email":"blur"},$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")}),$("#Phone").mask("(999) 999-9999"),pe.form=new pe.ValidatableForm(a,c,b),b=a.find(".SubmitButton"),b.unbind("click"),b.click(function(a){a.preventDefault();a.stopPropagation();pe.form.on_submit()&&pe.order_tickets_form.charge();return!1}),pe.init_has_email_delivery()};pe.init_full_purchase_form=function(){var b,
a,c,d;a=$("#OrderTicketsForm");0<a.length&&($(".CCType").change(function(){"PayPal"===$(this).val()?($("#OrderTicketsForm").hide(),$("#OrderTicketsPaypalForm").show()):($("#OrderTicketsForm").show(),$("#OrderTicketsPaypalForm").hide());return $(".CCType").val($(this).val())}),$(".CCType").change(),pe.order_tickets_form=new pe.StripeForm(a,"api_close_ticket_order",!0,function(){window.onbeforeunload=null;return window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),
c=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||_.isEmpty($("#ExpYear").val())}}),d=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||_.isEmpty($("#ExpYear").val())}}));c={"#payment_type":new pe.Validator({message:"Card number does not match this type",
callback:function(){return Stripe.card.cardType($("#CardNumber").val())===$("#payment_type").val()},unless:function(){return!pe.validation.cc_number_validator.passed($("#CardNumber"))}}),"#CardNumber":pe.validation.cc_number_validator,"#ExpMonth":c,"#ExpYear":d,"#Cvc":pe.validation.cvc_validator,"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Address1":pe.validation.not_blank_validator,"#City":pe.validation.not_blank_validator,"#state":pe.validation.not_blank_validator,
"#Zip":pe.validation.zip_code_validator,"#Phone":pe.validation.not_blank_validator,"#Email":pe.validation.email_format_validator};$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")});$("#Phone").mask("(999) 999-9999");pe.form=new pe.ValidatableForm(a,c,{"#payment_type":"change","#CardNumber":"blur","#ExpMonth":"change","#ExpYear":"change","#Cvc":"blur","#FirstName":"blur","#LastName":"blur","#Address1":"blur","#City":"blur","#state":"change","#Zip":"blur","#Phone":"blur",
"#Email":"blur"});a=a.find(".SubmitButton");a.unbind("click");a.click(function(a){a.preventDefault();a.stopPropagation();pe.form.on_submit()&&pe.order_tickets_form.charge();return!1});$(".CCTypeButton").click(function(){$(".CCTypeButton").removeClass("selected").addClass("disabled");$(this).addClass("selected");$(".CCType").val($(this).data("value"));$(".CCType").change();return pe.form.validate_field("#payment_type")});$(".BillingInput[name=has_email_delivery]").change(function(){return"true"===
$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")});b=$(".CodeTipContent");if(0<b.length)return $(".CodeTipLink").click(function(){return b.toggle()}),$(".CodeTipClose").click(function(){return b.hide()})}}).call(this);
