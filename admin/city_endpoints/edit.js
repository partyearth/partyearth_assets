pe.Floater=function(a,b,c){pe.init_widget(this,a);this.bottom_margin=c||0;this.start_point_div=a.find(".FloatingAreaStart");this.end_point_div=b||null;this.stop_at=this.start_from=0;this.sticked=this.is_floating=!1;this.floater=this.container.find(".Floater");this.offset=0;this.disabled=!1;this.top=parseInt(this.floater.css("margin-top"),10)||0;$(window).scroll(this.callback(this.scrolling));this.set_floating_area();pe.Floater.register_floater(this)};
pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"};pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top;this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)};
pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var a=$(window).scrollTop(),b=a+this.offset+this.bottom_margin<=this.start_from,c=a+this.offset+this.bottom_margin>this.start_from,d=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;!this.is_floating&&c&&!d&&!this.sticked?(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this)):this.is_floating&&b?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,
this)):this.end_point_div&&(!this.sticked&&d?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&a+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick())}};pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed");this.floater.removeClass("bottom");this.is_floating=!0;this.sticked=!1;this.set_offset()};
pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.sticked=!0};pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.disabled=this.sticked=!0};
pe.Floater.prototype.enable=function(){this.disabled=!1};pe.Floater.prototype.unstick=function(){this.floater.css("margin-top","");this.floater.css("top","");this.floater.css("position","");this.start_floating();this.fire_event(pe.Floater.events.FLOATING,this)};pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top","");this.floater.removeClass("fixed");this.floater.removeClass("bottom");this.sticked=this.is_floating=!1;this.set_offset()};
pe.Floater.prototype.set_offset=function(a){a&&(this.offset=a);0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")};pe.Floater.registered_floaters=[];pe.Floater.register_floater=function(a){pe.Floater.registered_floaters.push(a);pe.Floater.update_positions()};
pe.Floater.update_positions=function(){pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(a){return a.container.offset().top},null);if(pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var a=1;a<pe.Floater.registered_floaters.length;a++){var b=pe.Floater.registered_floaters[a-1].offset+pe.Floater.registered_floaters[a-1].floater.outerHeight();pe.Floater.registered_floaters[a].offset=b;pe.Floater.registered_floaters[a].is_floating&&
pe.Floater.registered_floaters[a].start_floating();pe.Floater.registered_floaters[a].set_floating_area()}};pe.CloseButton=function(a,b){pe.init_widget(this,a);this.close_button=a.find(".CloseButton");if("function"===typeof b)this.close_button.click(b);else switch(b){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}};
pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"};pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"};pe.CloseButton.prototype.remove_container=function(){this.container.detach();this.fire_event(pe.CloseButton.events.CLOSED);this.container.remove();return!1};pe.CloseButton.prototype.hide_container=function(){this.fire_event(pe.CloseButton.events.CLOSED);this.container.hide();return!1};
pe.SortableAutocomplete=function(a,b,c,d,f){pe.init_widget(this,a);this.autocomplete_data_or_url=b;this.limit=d;this.input_field_name=c;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.messaging_area=this.container.find(".Messaging");this.autocomplete_input_field=this.container.find(".AutocompleteField");a=this.autocomplete_input_field.autocomplete({source:this.autocomplete_data_or_url,minLength:1,close:this.callback(this.autocomplete_closed),select:this.callback(this.autocomplete_entry_selected)}).data("autocomplete");
a._renderItem=pe.SortableAutocomplete.render_autocomplete_entry;a._renderMenu=pe.SortableAutocomplete.render_autocomplete_list;this.selected_data_list_div=this.container.find(".SelectedDataList");this.selected_data_list_div.sortable();this.selected_data_list_div.disableSelection();f&&this.add_data_to_list(f)};pe.SortableAutocomplete.events={SELECTED:"SortableAutocomplete_SELECTED"};
pe.SortableAutocomplete.prototype.add_data_to_list=function(a){0!==a.length&&(this.remove_dummy_row(),$.each(a,this.callback(function(a,c){this.add_selected_data(c.label,c.id,c.category)})),this.enforce_limit())};pe.SortableAutocomplete.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="">'),this.autocomplete_input_field.after(this.dummy_input_field))};
pe.SortableAutocomplete.prototype.add_selected_data=function(a,b,c){this.remove_dummy_row();this.selected_data_list_div.append(this.selected_data_html(a,b,c));(new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));this.enforce_limit()};pe.SortableAutocomplete.prototype.autocomplete_closed=function(){this.autocomplete_input_field.val("")};
pe.SortableAutocomplete.prototype.autocomplete_entry_selected=function(a,b){var c=b.item;this.add_selected_data(c.label,c.id,c.category);this.fire_event(pe.SortableAutocomplete.events.SELECTED,c.id)};pe.SortableAutocomplete.prototype.close_button_clicked=function(){0===this.selected_data_list_div.find(".SelectedInputData").length&&this.add_dummy_row();this.enforce_limit()};
pe.SortableAutocomplete.prototype.enforce_limit=function(){this.selected_data_list_div.find(".SelectedInputData").length>=this.limit?(this.messaging_area.html("You have reached the selection limit. Please remove before adding."),this.autocomplete_input_field.autocomplete("disable")):(this.messaging_area.html(""),this.autocomplete_input_field.autocomplete("enable"))};
pe.SortableAutocomplete.prototype.html=function(){return'<input class="AutocompleteField" type="text"><div class="Messaging"></div><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value=""><ul class="SelectedDataList" id="sortable"></ul>'};pe.SortableAutocomplete.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};
pe.SortableAutocomplete.render_autocomplete_entry=function(a,b){b.display_label=b.category?pe.templatize("{{label}} ({{category}})",b):b.label;var c=$(pe.templatize("<li><a>{{display_label}}</a></li>",b));c.data("item.autocomplete",b);a.append(c);return c};pe.SortableAutocomplete.render_autocomplete_list=function(a,b){var c=this,d="";$.each(b,function(b,e){e.type!=d&&(a.append("<li class='ui-autocomplete-category  first_category'>"+e.type+"</li>"),d=e.type);c._renderItem(a,e)})};
pe.SortableAutocomplete.prototype.selected_data_html=function(a,b,c){return'<li class="SelectedInputData ui-state-default"><img style="margin-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"class="CloseButton float_left"><p class="float_left">'+(c?a+"("+c+")":a)+'</p><input type="hidden" value="'+b+'" name="'+this.input_field_name+'"><div class="clear"></div></li>'};
pe.GeneralAutocompleteInputModule=function(a,b,c,d){pe.init_widget(this,a);this.autocomplete_data_or_url=b;this.input_field_name=c;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.autocomplete_input_field=this.container.find(".AutocompleteField");this.autocomplete_handler();this.selected_data_list_div=this.container.find(".SelectedDataList");this.selected_data_list_div.sortable();d&&this.add_data_to_list(d)};
pe.GeneralAutocompleteInputModule.events={SELECTED:"GeneralAutocompleteInputModule_SELECTED",REMOVED:"GeneralAutocompleteInputModule_REMOVED",EMPTIED:"GeneralAutocompleteInputMOdule_EMPTIED"};pe.GeneralAutocompleteInputModule.prototype.add_data_to_list=function(a){this.remove_dummy_row();$.each(a,this.callback(function(a,c){-1===$.inArray(c.id.toString(),this.all_values())&&this.autocomplete_data_selected(c.label,c.id,c.category)}))};
pe.GeneralAutocompleteInputModule.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))};pe.GeneralAutocompleteInputModule.prototype.all_values=function(){return this.selected_data_list_div.find('[name="'+this.input_field_name+'"]').map(function(){return this.value}).toArray()};
pe.GeneralAutocompleteInputModule.prototype.autocomplete_data_selected=function(a,b,c){this.remove_dummy_row();this.selected_data_list_div.append(this.selected_data_html(a,b,c));(new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked))};
pe.GeneralAutocompleteInputModule.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:"string"==typeof this.autocomplete_data_or_url?this.callback(function(a,b){$.getJSON(this.autocomplete_data_or_url,{term:this.autocomplete_input_field.val(),val:this.all_values().join(",")},b)}):this.autocomplete_data_or_url,minLength:1,close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(a,b){var c=b.item;this.autocomplete_data_selected(c.label,
c.id,c.category);this.fire_event(pe.GeneralAutocompleteInputModule.events.SELECTED,c.id)})}).data("autocomplete")._renderItem=function(a,b){b.display_label=b.category?pe.templatize("{{label}} ({{category}})",b):b.label;return $("<li></li>").data("item.autocomplete",b).append(pe.templatize("<a>{{display_label}}</a>",b)).appendTo(a)}};pe.GeneralAutocompleteInputModule.prototype.clear_selected_data=function(){this.selected_data_list_div.html("");this.add_dummy_row()};
pe.GeneralAutocompleteInputModule.prototype.close_button_clicked=function(){this.is_empty()&&this.add_dummy_row();this.fire_event(pe.GeneralAutocompleteInputModule.events.REMOVED);this.is_empty()&&this.fire_event(pe.GeneralAutocompleteInputModule.events.EMPTIED)};pe.GeneralAutocompleteInputModule.prototype.display_close_button=function(){this.selected_data_list_div.find(".CloseButton").show()};pe.GeneralAutocompleteInputModule.prototype.hide_close_button=function(){this.selected_data_list_div.find(".CloseButton").hide()};
pe.GeneralAutocompleteInputModule.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><ul class="SelectedDataList" id="sortable"></ul>'};pe.GeneralAutocompleteInputModule.prototype.is_empty=function(){return 0===this.selected_data_list_div.find(".SelectedInputData").length};
pe.GeneralAutocompleteInputModule.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};pe.GeneralAutocompleteInputModule.prototype.replace_data_in_list=function(a){a&&(this.clear_selected_data(),this.add_data_to_list(a))};
pe.GeneralAutocompleteInputModule.prototype.selected_data_html=function(a,b,c){return'<li class="SelectedInputData">  <img style="padding-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"\t\tclass="CloseButton float_left">  <p class="float_left">'+(c?a+"("+c+")":a)+'</p>  <input type="hidden" value="'+b+'" name="'+this.input_field_name+'">  <div class="clear"></div></li>'};
pe.CharacterWithIdsDropdown=function(a,b,c){pe.init_widget(this,a);this.dropdown_widget=new pe.DropdownModule(a,this.dropdown_html(),this.callback(this.title_html),!1,b,c);this.dropdown_widget.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.selected))};pe.CharacterWithIdsDropdown.events={OPENED:"CharacterWithIdsDropdown_OPENED",CHANGED:"CharacterWithIdsDropdown_CHANGED"};pe.CharacterWithIdsDropdown.prototype.dropdown_html=function(){return'<div class="Choice choice" data_result="2" data_character_name="Lucas">Lucas</div><div class="Choice choice" data_result="3" data_character_name="Adriana">Adriana</div><div class="Choice choice" data_result="4" data_character_name="Jonah">Jonah</div><div class="Choice choice" data_result="5" data_character_name="Emma">Emma</div><div class="footer_bottom"></div>'};
pe.CharacterWithIdsDropdown.prototype.result_value=function(a){return a&&(a=a.attr("data_result"),"string"===typeof a)?a:""};pe.CharacterWithIdsDropdown.prototype.selected=function(a,b){var c=this.result_value($(b));this.dropdown_widget.set_input_field_value(c);this.fire_event(pe.CharacterDropdown.events.CHANGED,c)};
pe.CharacterWithIdsDropdown.prototype.title_html=function(a){return a?"selecting"===a?(this.fire_event(pe.CharacterWithIdsDropdown.events.OPENED,$(a)),'<span class="unselected">Select a Personality</span>'):a.attr("data_character_name"):'<span class="unselected">Select a Personality</span>'};pe.CharacterWithIdsDropdown.prototype.val=function(a){if(a)this.dropdown_widget.val(".Choice[data_result='"+a+"']"),this.dropdown_widget.set_input_field_value(a);else return this.result_value(this.dropdown_widget.val())};
$(document).ready(function(){pe.form_update_button=$(".FormSubmitButton");pe.total_ajax_requests=0;pe.ajax_requests_complete=0;var a=$(".PageInterests");0<a.length&&(pe.total_ajax_requests+=1,pe.ajax_loader.page_interests.load({endpoint_id:window.endpoint_id,timestamp:pe.interests_timestamp()},function(b){new pe.SortableAutocomplete(a,b,"page_interest_ids[]",100,window.page_interests);pe.ajax_requests_completed()}));window.is_venues&&(new pe.SortableAutocomplete($(".FamousVenues"),window.all_venues,
"ordered_famous_venues_ids[]",100,window.famous_venues),new pe.SortableAutocomplete($(".AnnualEvents"),window.all_events,"ordered_annual_events_ids[]",100,window.annual_events),new pe.SortableAutocomplete($(".TopVenuesTags"),window.all_venues_tags,"ordered_top_venues_tags_ids[]",100,window.top_venues_tags));if(window.is_sports){var b=$(".TeamsSortable");b.find("#sortable").sortable();b.find("#sortable").disableSelection();new pe.SortableAutocomplete($(".AnnualSportings"),window.all_events,"ordered_sportings_ids[]",
100,window.existing_sportings);new pe.CharacterWithIdsDropdown($(".CharacterSelect"),"city_endpoint[character_pick_attributes][character_id]",window.character_id);new pe.SortableAutocomplete($(".PickVenues"),window.all_venues,"city_endpoint[character_pick_attributes][ordered_venues_ids][]",100,window.picked_venues)}b=$(".RelatesEndpoints");0<b.length&&new pe.GeneralAutocompleteInputModule(b,window.all_endpoints,"city_endpoint[related_endpoint_ids][]",window.related_endpoints);b=$(".EventTypeInterests");
0<b.length&&(b.find("#sortable").sortable(),b.find("#sortable").disableSelection());b=$(".ClubCategories");0<b.length&&(b.find(".Sortable").sortable(),b.find(".Sortable").disableSelection());var c=$(".DayTimeInterests");0<c.length&&(pe.total_ajax_requests+=1,pe.ajax_loader.day_time_interests.load({timestamp:pe.interests_timestamp()},function(a){new pe.SortableAutocomplete(c,a,"daytime_interest_ids[]",100,window.day_time_interests);pe.ajax_requests_completed()}));var d=$(".NightTimeInterests");0<d.length&&
(pe.total_ajax_requests+=1,pe.ajax_loader.night_time_interests.load({timestamp:pe.interests_timestamp()},function(a){new pe.SortableAutocomplete(d,a,"night_time_interest_ids[]",100,window.night_time_interests);pe.ajax_requests_completed()}));new pe.Floater($(".FloaterContainer"));pe.init_page_framework();0===pe.total_ajax_requests&&pe.form_update_button.removeAttr("disabled")});pe.ajax_requests_completed=function(){pe.ajax_requests_complete+=1;pe.ajax_requests_complete===pe.total_ajax_requests&&pe.form_update_button.removeAttr("disabled")};
