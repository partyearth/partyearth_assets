(function(){var n=function(t,e){return function(){return t.apply(e,arguments)}};pe.TicketButtonGenerator=function(){function t(t){var e,i;this.container=t,this.update_image_style=n(this.update_image_style,this),this.update_text=n(this.update_text,this),this.update_color=n(this.update_color,this),this.update_size=n(this.update_size,this),this.reset=n(this.reset,this),this.generate=n(this.generate,this),this.disabled=!1,this.image_selector=this.container.find(".ImageSelector"),this.button_text_toggler=this.container.find(".ButtonTextToggler"),this.button_text_input=this.container.find(".ButtonTextInput"),this.size_input=this.container.find(".SizeInput"),this.generate_button=this.container.find(".GenerateButton"),this.debug_container=this.container.find(".DebugContainer"),this.code_container=this.container.find(".CodeContainer"),this.preview=this.container.find(".Preview"),this.reset_button=this.container.find(".ResetButton"),this.color_container=this.container.find(".ColorInput"),this.button_text_toggler.change(this.update_text),this.button_text_input.keydown(this.update_text),this.button_text_input.keyup(this.update_text),this.size_input.change(this.update_size),this.image_selector.change(this.update_image_style),this.color_container.change(this.update_color),this.generate_button.click(this.generate),this.reset_button.click(this.reset),this.button_text_toggler.change((e=this,function(){if(!e.default_text_selected())return e.button_text_input.focus()})),this.container.find("input").change((i=this,function(){return i.code_container.css("opacity",.5)})),this.update_size(),this.update_text(),this.update_image_style(),this.code_container.css("opacity",.5),this.default_state=this.serialize()}return t.prototype.generate=function(){var e;if(!this.disabled)return this.generate_button.html("Please wait..."),this.generate_button.css("opacity",.5),this.generate_button.css("cursor","wait"),pe.routes.Request.from_current_location("generate_button_user_dashboard_event",this.serialize()).get((e=this,function(t){return e.generate_button.html("Generate"),e.generate_button.css("cursor","pointer"),e.generate_button.css("opacity",1),e.disabled=!1,e.debug_container.html(t),e.code_container.val(t),e.code_container.css("opacity",1)})),this.disabled=!0},t.prototype.serialize=function(){return{height:this.height()||this.actual_height(),width:this.width()||this.actual_width(),outer_width:this.actual_width(),outer_height:this.actual_height(),text:this.text(),style:this.style(),image_style:this.image_style(),color:this.color()}},t.prototype.reset=function(){if(confirm("Are you sure you want to reset the button back to its default settings?"))return this.button_text_toggler.filter(":first").click(),this.size_input.filter(":last").click(),this.image_selector.filter(":first").click(),this.button_text_input.val(""),this.code_container.val("")},t.prototype.image_style=function(){return this.image_selector.filter(":checked").val()},t.prototype.size=function(){return this.size_input.filter(":checked").data()},t.prototype.width=function(){return this.size().width},t.prototype.height=function(){return this.size().height},t.prototype.style=function(){return this.size().style},t.prototype.color=function(){return this.color_container.filter(":checked").val()},t.prototype.actual_width=function(){return this.preview.outerWidth()},t.prototype.actual_height=function(){return this.preview.outerHeight()},t.prototype.update_size=function(){var e;return this.preview.css("width",this.width()+"px"),this.preview.css("height",this.height()+"px"),_.each(this.size_input,(e=this,function(t){return e.preview.removeClass($(t).data().style)})),this.preview.addClass(this.style())},t.prototype.update_color=function(){var e;return _.each(this.color_container,(e=this,function(t){return e.preview.removeClass($(t).val())})),this.preview.addClass(this.color())},t.prototype.update_text=function(t){return this.text().length<=25?this.preview.find(".Text").html(this.text()):(this.button_text_input.val(this.text().substring(0,25)),t.preventDefault(),t.stopPropagation())},t.prototype.update_image_style=function(){var e;return _.each(this.image_selector,(e=this,function(t){return e.preview.removeClass($(t).val())})),this.preview.addClass(this.image_style())},t.prototype.default_text_selected=function(){return"Buy Tickets"===this.button_text_toggler.filter(":checked").val()},t.prototype.text=function(){return this.default_text_selected()?"Buy Tickets":this.button_text_input.val().replace(/<\/?[^>]+(>|$)/g,"")||"Buy Tickets"},t}()}).call(this);