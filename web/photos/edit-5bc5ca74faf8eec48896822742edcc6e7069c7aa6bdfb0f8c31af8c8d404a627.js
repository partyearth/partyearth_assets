pe.CloseButton=function(t,e){if(pe.init_widget(this,t),this.close_button=t.find(".CloseButton"),"function"==typeof e)this.close_button.click(e);else switch(e){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}},pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"},pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"},pe.CloseButton.prototype.remove_container=function(){return this.container.detach(),this.fire_event(pe.CloseButton.events.CLOSED),this.container.remove(),!1},pe.CloseButton.prototype.hide_container=function(){return this.fire_event(pe.CloseButton.events.CLOSED),this.container.hide(),!1},pe.GeneralAutocompleteInputModule=function(t,e,n,o){pe.init_widget(this,t),this.autocomplete_data_or_url=e,this.input_field_name=n,this.container.html(this.html()),this.dummy_input_field=this.container.find(".DummyInputField"),this.autocomplete_input_field=this.container.find(".AutocompleteField"),this.autocomplete_handler(),this.selected_data_list_div=this.container.find(".SelectedDataList"),this.selected_data_list_div.sortable(),o&&this.add_data_to_list(o)},pe.GeneralAutocompleteInputModule.events={SELECTED:"GeneralAutocompleteInputModule_SELECTED",REMOVED:"GeneralAutocompleteInputModule_REMOVED",EMPTIED:"GeneralAutocompleteInputMOdule_EMPTIED"},pe.GeneralAutocompleteInputModule.prototype.add_data_to_list=function(t){this.remove_dummy_row(),$.each(t,this.callback(function(t,e){-1===$.inArray(e.id.toString(),this.all_values())&&this.autocomplete_data_selected(e.label,e.id,e.category)}))},pe.GeneralAutocompleteInputModule.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))},pe.GeneralAutocompleteInputModule.prototype.all_values=function(){return this.selected_data_list_div.find('[name="'+this.input_field_name+'"]').map(function(){return this.value}).toArray()},pe.GeneralAutocompleteInputModule.prototype.autocomplete_data_selected=function(t,e,n){this.remove_dummy_row(),this.selected_data_list_div.append(this.selected_data_html(t,e,n)),new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked))},pe.GeneralAutocompleteInputModule.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:this.set_autocomplete_data(),minLength:1,close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(t,e){var n=e.item;this.autocomplete_data_selected(n.label,n.id,n.category),this.fire_event(pe.GeneralAutocompleteInputModule.events.SELECTED,n.id)})}).data("autocomplete")._renderItem=function(t,e){return e.display_label=e.category?pe.templatize("{{label}} ({{category}})",e):e.label,$("<li></li>").data("item.autocomplete",e).append(pe.templatize("<a>{{display_label}}</a>",e)).appendTo(t)}},pe.GeneralAutocompleteInputModule.prototype.set_autocomplete_data=function(){return"string"==typeof this.autocomplete_data_or_url?this.callback(function(e,n){$.getJSON(this.autocomplete_data_or_url,{term:this.autocomplete_input_field.val(),val:this.all_values().join(",")},function(t){pe.GeneralAutocompleteInputModule.sort_autocomplete_results(t,e,n)})}):this.callback(pe.GeneralAutocompleteInputModule.sort_autocomplete_results,this.autocomplete_data_or_url)},pe.GeneralAutocompleteInputModule.sort_autocomplete_results=function(t,e,n){var o=pe.normalize(e.term).toLowerCase(),i=new RegExp($.ui.autocomplete.escapeRegex(o),"i"),a=$.grep(t,function(t){return t=t.label||t.value||t,i.test(t)||i.test(pe.normalize(t))}),r=new RegExp("^"+$.ui.autocomplete.escapeRegex(o),"i");n(a=_.sortBy(a,function(t){var e=pe.normalize(t.label).toLowerCase();return[e!=o,!r.test(e)]}))},pe.GeneralAutocompleteInputModule.prototype.clear_selected_data=function(){this.selected_data_list_div.html(""),this.add_dummy_row()},pe.GeneralAutocompleteInputModule.prototype.close_button_clicked=function(){this.is_empty()&&this.add_dummy_row(),this.fire_event(pe.GeneralAutocompleteInputModule.events.REMOVED),this.is_empty()&&this.fire_event(pe.GeneralAutocompleteInputModule.events.EMPTIED)},pe.GeneralAutocompleteInputModule.prototype.display_close_button=function(){this.selected_data_list_div.find(".CloseButton").show()},pe.GeneralAutocompleteInputModule.prototype.hide_close_button=function(){this.selected_data_list_div.find(".CloseButton").hide()},pe.GeneralAutocompleteInputModule.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><ul class="SelectedDataList" id="sortable"></ul>'},pe.GeneralAutocompleteInputModule.prototype.is_empty=function(){return 0===this.selected_data_list_div.find(".SelectedInputData").length},pe.GeneralAutocompleteInputModule.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)},pe.GeneralAutocompleteInputModule.prototype.replace_data_in_list=function(t){t&&(this.clear_selected_data(),this.add_data_to_list(t))},pe.GeneralAutocompleteInputModule.prototype.selected_data_html=function(t,e,n){return'<li class="SelectedInputData">  <img style="padding-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"\t\tclass="CloseButton float_left">  <p class="float_left">'+(n?t+"("+n+")":t)+'</p>  <input type="hidden" value="'+e+'" name="'+this.input_field_name+'">  <div class="clear"></div></li>'},pe.AjaxForm=function(t){pe.init_widget(this,t),this.update_url=this.container.attr("data_update_url"),this.update_key=this.container.attr("data_update_key"),this.input=pe.load(this.container.find(".Input")),this.update_button=this.container.find(".Update"),this.update_button.click(this.callback(this.update_clicked))},pe.AjaxForm.prototype.update_clicked=function(){var t=null;if("textarea"===this.input[0].type)t=this.input.val();else if(this.input.is(":checkbox"))t=this.input.is(":checked");else{if(!this.input.is(":text"))return void alert("unknown input field");t=this.input.val()}var e={};e[this.update_key]=t,$.ajax({url:this.update_url,data:e,type:"PUT"})},pe.AjaxForm.instantiate=function(){$(".AjaxForm").each(function(t,e){new pe.AjaxForm($(e))})},pe.AjaxInput=function(t){pe.init_widget(this,t),this.update_url=this.container.attr("data_update_url"),this.update_key=this.container.attr("data_update_key"),this.input=pe.load(this.container.find(".Input")),this.input.change(this.callback(this.input_changed))},pe.AjaxInput.prototype.input_changed=function(){var t=null;if("textarea"===this.input[0].type)t=this.input.val();else if(this.input.is(":checkbox"))t=this.input.is(":checked");else{if(!this.input.is(":text"))return void alert("unknown input field");t=this.input.val()}var e={};e[this.update_key]=t,$.ajax({url:this.update_url,data:e,type:"PUT"})},pe.AjaxInput.instantiate=function(){$(".AjaxFlag").each(function(t,e){new pe.AjaxInput($(e))})},pe.accentMap={"&":"and","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xe7":"c","\xc0":"a","\xc1":"a","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xc8":"e","\xc9":"e","\xec":"i","\xf1":"n","\xed":"i","\xee":"i","\xef":"i","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","!":"i",$:"s","-":""," ":"","'":"","\u2019":"",".":""},pe.ajax_error=function(){alert("The request failed. Please try again later.")},pe.ajax_send=function(t,e){var n=$("meta[name='csrf-token']").attr("content");e.setRequestHeader("X-CSRF-Token",n)},pe.alert=function(t){alert(t)},pe.animated_scrolling=function(t,e){if(0!==t.length){var n=t.offset().top-(e||25);$("html,body").stop().animate({scrollTop:n+"px"},800,"cubicEaseInOut",function(){return!1})}},pe.scrolling=function(t,e){if(0!==t.length){var n=t.offset().top-(e||25);$("html,body").scrollTop(n)}},pe.days_of_week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],pe.array_contains=function(t,e){return _.isArray(e)?0===_.difference(e,t).length:-1<_.indexOf(t,e)},pe.arrays_equal=function(t,e){if(!t&&!e)return!0;if(!t&&0===e.length||0===t.length&&!e)return!0;if(t.length!=e.length)return!1;for(var n=t.sort(),o=e.sort(),i=0,a=t.length;i<a;i++)if(n[i]!==o[i])return!1;return!0},pe.array_match=function(t,n){var o=!1;return $.each(t,function(t,e){if(-1<n.indexOf(e))return!(o=!0)}),o},pe.array_merge=function(t,e){var n=t.concat(e);return n.sort(),n},pe.array_remove=function(t,e){return t?pe.is_array(e)?$.grep(t,function(t){return-1===e.indexOf(t)}):$.grep(t,function(t){return t!==e}):t},pe.assign_photo_size=function(t,e,n){return t?"original"===e?t.replace("xxx.jpg",e+".jpg"):t.replace("xxx.jpg","s"+e+".jpg"):"/assets/no_image_"+n+".png"},pe.remove_timestamp_from_asset_url=function(t){return t.split("?")[0]},pe.browser_is_ie8=function(){return $.browser.msie&&"8.0"===$.browser.version},pe.build_dob_field_name=function(t,e,n){return e?e+="_":e="",[t=t||"user","[",e,"dob(",n,"i)]"].join("")},pe.capitalise_first_letter=function(t){return null===t?"":t.charAt(0).toUpperCase()+t.slice(1)},pe.classes_starting_with=function(t,e){return $.map(t.attr("class").split(/\s+/),function(t){if(pe.string_starts_with(t,e))return t})},pe.compare=function(t,e){return pe.is_array(t)&&pe.is_array(e)?pe.arrays_equal(t,e):t===e},pe.convert_to_rounded_corners=function(t){var e=t||$(".ConvertToRoundedCorners");return e.each(function(t,e){var n=$(e);n.removeClass("ConvertToRoundedCorners"),n.addClass("rounded_corner_wrapper"),$('<div class="rounded_corner top_left"></div>').appendTo(n),$('<div class="rounded_corner top_right"></div>').appendTo(n),$('<div class="rounded_corner bottom_left"></div>').appendTo(n),$('<div class="rounded_corner bottom_right"></div>').appendTo(n)}),e},pe.convert_to_tabbed_pod=function(t,u){return $.map(t,function(t){var e=$(t);if(!e.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+e[0].className);var n=e.children("ul");n.addClass("tab"),n.children("li").each(function(t,e){var n=(e=$(e)).html();e.html(pe.templatize('<div class="left_end pod_sprite float_left"></div>{{content}}<div class="right_end pod_sprite float_left"></div>',{content:n}))});var o=n.html();n.remove();var i=e.html(),a=pe.classes_starting_with(e,"width");if(0===a.length)return alert("no width class found");if(1<a.length)return alert("more than 1 width class found");var r=a[0].substr(5);e.addClass("tabs"),e.removeClass("ConvertToTabs"),e.removeClass(a[0]),e.html(pe.templatize('<div><table class="width{{width}}" cellpadding="0" cellspacing="0"><tbody><tr><td class="header" colspan="4"><div class="header_row"><ul class="tab">{{headers}}</ul><div class="mid_section"></div><div class="right_corner pod_sprite"></div></div></td></tr><tr class="content_container"><td class="left_side pod_sides"></td><td class="content">{{content}}</td><td class="right_side pod_sides"></td></tr><tr class="footer_row"><td class="left_corner pod_sprite"></td><td class="mid_section"></td><td class="right_corner pod_sprite"></td></tr></tbody></table></div>',{width:r,headers:o,content:i}));var s=e.children().tabs(u),l=["first","second","third","fourth"];return e.find("ul.tab li").each(function(t,e){$(e).addClass(l[t])}),s})},pe.new_convert_to_tabbed_pod=function(t,u){return $.map(t,function(t){var e=$(t);if(!e.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+e[0].className);var n=e.children("ul"),o=n.html();n.remove();var i=e.html(),a=pe.classes_starting_with(e,"width");if(0===a.length)return alert("no width class found");if(1<a.length)return alert("more than 1 width class found");var r=a[0].substr(5);e.addClass("tabs"),e.removeClass("ConvertToTabs"),e.removeClass(a[0]),e.html(pe.templatize('<div class="width{{width}}"><ul class="tab">{{headers}}</ul>{{content}}</div>',{width:r,headers:o,content:i}));var s=e.children().tabs(u),l=["first","second","third","fourth"];return e.find("ul.tab li").each(function(t,e){$(e).addClass(l[t])}),s})},pe.date_string=function(t){return"string"==typeof t?t:t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()},pe.days_between_dates=function(t,e){var n="string"==typeof t?Date.parse(t):t,o="string"==typeof e?Date.parse(e):e;return Math.abs(Math.floor((n-o)/864e5))},pe.empty=function(){},pe.event_search_text=function(t){var n=[t.name,t.description,t.location_name,t.category,t.neighborhood_name,t.neighborhood_id];return t.tags&&$.each(t.tags,function(t,e){n.push(e)}),t.performer_names&&$.each(t.performer_names,function(t,e){n.push(e)}),n.join(" ")},pe.fetch_photo_id_from_url=function(t){return t.split("/photos/")[1]},pe.fix_ie7_rendering_bug=function(){$(".ConvertToTabbedPod").addClass("IeSucks")},pe.format_date=function(t){return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()},pe.format_price=function(t){var e=Math.floor(t/100).toString(),n=(t%100).toString();return n.length<2&&(n="0"+n),"$"+e+"."+n},pe.format_duration=function(t,e){if(!t)return"0:00";var n=Math.floor(t/60),o=Math.floor(t%60);return pe.string_padding_left(n.toString(),e||1,"0")+":"+pe.string_padding_left(o.toString(),2,"0")},pe.get_city_id=function(){return window.city_id},pe.get_url_parameter=function(t,e){var n=new RegExp("[\\?&]"+e+"=([^&]+)","i").exec(t);return n?n[1]:null},pe.hash_length=function(t){var e=0;for(var n in t)t.hasOwnProperty(n)&&e++;return e},pe.hashes_equal=function(t,e){if(t===e)return!0;if(pe.hash_length(t)!=pe.hash_length(e))return!1;for(var n in t){var o=t[n],i=e[n];if(pe.is_array(o)){if(!pe.arrays_equal(o,i))return!1}else if(o!==i)return!1}return!0},pe.hashes_match=function(t,e){for(var n in t){var o=t[n],i=e[n];if(pe.is_array(o)){if(!pe.array_contains(i,o))return!1}else if(o!==i)return!1}return!0},pe.https=function(t){return-1===window.location.href.indexOf("https://")?t:t.replace("http://","https://")},pe.inject=function(t,e,n){var o=e;return $.each(t,function(t,e){o=n(o,e)}),o},pe.init_widget=function(t,e){"string"!=typeof e&&(null===e||e.length?(t.container=e,t.callback=function(t){for(var e=[t,this],n=1;n<arguments.length;n++)e.push(arguments[n]);return pe.bind_this.apply(this,e)},t.check_bind=function(t){if("undefined"==typeof this.container)throw" in: "+t},t.bind_event=function(t,e){pe.assert(t,"bind_event: parameter 'event_type' is empty"),this.container.bind(t,e)},t.fire_event=function(t,e){void 0===t&&alert("Must provide the event type to fire."),void 0===e&&(e={}),this.container.trigger(t,e)},t.show=function(){this.container.show()},t.hide=function(){this.container.hide()},t.toggle=function(t){this.container.toggle(t)},t.is_visible=function(){return this.container.is(":visible")}):alert("No container given."))},pe.install_easing=function(){jQuery.easing.cubicEaseInOut||(jQuery.easing.cubicEaseInOut=function(t,e,n,o){var i=n+o;return(t/=.5)<1?i/2*t*t*t+n:i/2*((t-=2)*t*t+2)+n})},pe.is_array=function(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.splice||t.propertyIsEnumerable("length"))},pe.is_valid_credit_card_number=function(t){return!!t.match(/^\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}$/)},pe.is_valid_date=function(t){var e=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/;return!!t.match(e)&&(t===$.datepicker.formatDate("m/d/yy",new Date(t))||t===$.datepicker.formatDate("mm/dd/yy",new Date(t)))},pe.is_valid_zip_code=function(t){return!!t.match(/^\d{5}(\s*\-\s*\d{4})?$/)},pe.load=function(t){return pe.assert(t,"error loading data"),t},pe.link_title_for_city=function(t){return"See the latest hotspots and events happening in "+t+"."},pe.link_title_for_city_party_climate=function(t){return"Check out the overview and photos of "+t+"."},pe.link_title_for_event=function(t,e){return e?"Check out event details, photos and videos of "+t+" at "+e+".":"Check out event details, photos and videos of "+t+"."},pe.link_title_for_neighborhood=function(t,e){return"Check out "+t+" description, photos, and venues in "+e+"."},pe.link_title_for_performer=function(t){return"See the latest "+t+" schedule, photos, videos and news."},pe.link_title_for_reviewer=function(t){switch(t){case"Lucas":return"Meet Lucas, the quintessential fun- loving, pub-crawling \u201cguy\u2019s guy\u201d. Learn about his personality and ratings.";case"Adriana":return"Meet Adriana, the epitome of a cosmopolitan girl. Learn about her personality and ratings.";case"Jonah":return"Meet Jonah, an affable, non-mainstream guy with natural curiosity about people and cultures. Learn about his personality and ratings.";case"Emma":return"Meet Emma, a lively, witty, and sociable \u201cgirl next door\u201d. Learn about her personality and ratings.";case"All":return"Meet Lucas, Adriana, Jonah and Emma. Learn how their personalities can help you maximize your social experiences in your city and your travels."}},pe.link_title_for_venue=function(t,e,n){return n?"Check out the review, photos, videos, map and events schedule of "+t+" - "+n+" in "+e+".":"Check out the review, photos, videos, map and events schedule of "+t+" in "+e+"."},pe.normalize=function(t){for(var e="",n=0,o=t.length;n<o;n++){var i=t.charAt(n),a=pe.accentMap[i];e+=void 0===a?i:a}return e},pe.object_hash_from_array=function(t){var n={};return $.each(t,function(t,e){n[e.id]=e}),n},pe.object_length=function(t){var e,n=0;for(e in t)t.hasOwnProperty(e)&&n++;return n},pe.parse_price=function(t){return Math.ceil(100*parseFloat(t.substring(1)))},pe.prepare_autocomplete_data=function(t){var o=[];return $.each(t,function(n,t){$.each(t,function(t,e){e.category=n,o.push(e)})}),o},pe.remove_anchor_from_url=function(t){return t?t.split("#")[0]:""},pe.remove_query_string_from_url=function(t){return t?t.split("?")[0]:""},pe.set_autocomplete_source=function(t,e,n){var o=pe.normalize(e.term).toLowerCase(),i=new RegExp($.ui.autocomplete.escapeRegex(o),"i"),a=$.grep(pe.prepare_autocomplete_data(t),function(t){return t=t.label||t.value||t,i.test(t)||i.test(pe.normalize(t))});n(a=_.sortBy(a,function(t){var e=t.label||t.value||t;return e=pe.normalize(e).toLowerCase(),[t.category,e!=o,t.label]}))},pe.shuffle_array=function(t){if(!t)return[];for(var e,n,o=t.length;o;)e=parseInt(Math.random()*o,10),n=t[--o],t[o]=t[e],t[e]=n;return t},pe.string_padding_left=function(t,e,n){for(var o=t;o.length<e;)o=n+o;return o},pe.string_starts_with=function(t,e){return t.substr(0,e.length)===e},pe.string_ends_with=function(t,e){return t.substr(t.length-e.length)===e},pe.structured_tags_as_flat_array=function(t){var n=[];return $.each(t,function(t,e){$.merge(n,e)}),n},pe.text_contains_query=function(n,t){var e=t.split(" "),o=!0;return $.each(e,function(t,e){if(-1===n.indexOf(e))return!(o=!1)}),o},pe.today_date_string=function(){var t=new Date;return pe.date_string(t)},pe.truncate_by_words=function(t,e,n){if(!t||!e)return alert("Sorry, but an error happened. We are already warned about that.");if(n=n||"...",t.length<e)return t;var o=t.slice(0,e-1);if(" "!==_.last(o)){var i=o.lastIndexOf(" ");o=o.slice(0,i)}return $.trim(o)+n},pe.value_from_cookie=function(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^ ;]+)"));return e?e[2]:null},pe.venue_search_text=function(t){var n=[t.name,t.description,t.address,t.hotspot_text,t.neighborhood_name];return t.types&&$.each(t.types,function(t,e){n.push(e)}),t.tags&&$.each(t.tags,function(t,e){n.push(e)}),n.join(" ")},pe.xor=function(t,e){return!!(t?!e:e)},$(document).ready(function(){$(document).ajaxSend(pe.ajax_send)}),pe.DropdownModule=function(t,e,n,o,i,a){if(pe.init_widget(this,t),this.container.html(this.html(o,i)),this.container.attr("tabindex",0),this.container.addClass("Dropdown"),this.container.focusout(this.callback(this.container_focusout)),this.container.click(this.callback(this.title_clicked)),this.title_string_function=n,this.title_container_div=this.container.find(".TitleContainer"),this.title_div=pe.load(this.container.find(".Title")),this.title_div.html(this.title_string_function(null)),this.dropdown_input_field=this.container.find(".DropdownInput"),this.dropdown_div=pe.load(this.container.find(".Dropdown")),this.dropdown_div.hide(),this.choices_div=pe.load(this.container.find(".Choices")),"function"==typeof e?this.dropdown_html_function=e:"string"==typeof e?this.set_choices_content(e):alert("Unknown dropdown_html type given."),a){var r='div[data_result="'+a+'"]';this.set_default_selection(r),this.set_input_field_value(a)}else this.current_selection=null;(this.prevent_next_collapse_flag=!1,o)&&new pe.CloseButton(this.container,pe.CloseButton.close_methods.REMOVE).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));this.auto_collapse=0,this.scroll_timeout=null},pe.DropdownModule.events={OPENED:"DropdownModule_OPENED",CHANGED:"DropdownModule_CHANGED",CLOSED:"DropdownModule_CLOSED",MINIMIZED:"DropdownModule_MINIMIZED"},pe.DropdownModule.prototype.choice_clicked=function(t){return this.current_selection=$(t.target).closest(".Choice"),this.collapse_dropdown(),this.dropdown_div.hide(),this.fire_event(pe.DropdownModule.events.CHANGED,this.current_selection),!1},pe.DropdownModule.prototype.close_button_clicked=function(){this.fire_event(pe.DropdownModule.events.CLOSED)},pe.DropdownModule.prototype.collapse_dropdown=function(){this.dropdown_div.hide(),this.title_div.html(this.title_string_function(this.current_selection)),this.title_div.addClass(this.current_selection&&0<this.current_selection.length?"ClosedWithSelection":"Closed"),this.title_container_div.addClass(this.current_selection&&0<this.current_selection.length?"ClosedWithSelection":"Closed"),this.title_div.removeClass("Opened"),this.title_container_div.removeClass("Opened"),this.fire_event(pe.DropdownModule.events.MINIMIZED)},pe.DropdownModule.prototype.container_focusout=function(){this.auto_collapse<0||setTimeout(this.callback(function(){0<=this.auto_collapse&&!this.prevent_next_collapse_flag&&this.collapse_dropdown(),this.prevent_next_collapse_flag=!1}),200)},pe.DropdownModule.prototype.content_scrolling=function(){this.disable_auto_collapse(0),this.scroll_timeout&&clearTimeout(this.scroll_timeout),this.scroll_timeout=setTimeout(this.callback(function(){this.enable_auto_collapse(),this.container.focus()}),300)},pe.DropdownModule.prototype.disable_auto_collapse=function(t){this.auto_collapse-=1,t&&setTimeout(this.callback(function(){this.enable_auto_collapse()}),t)},pe.DropdownModule.prototype.enable_auto_collapse=function(){this.auto_collapse+=1,0<this.auto_collapse&&(this.auto_collapse=0)},pe.DropdownModule.prototype.expand_dropdown=function(){this.dropdown_html_function&&this.set_choices_content(this.dropdown_html_function()),this.dropdown_div.show(),this.title_div.html(this.title_string_function("selecting")),this.title_div.removeClass("Closed ClosedWithSelection"),this.title_container_div.removeClass("Closed ClosedWithSelection"),this.title_div.addClass("Opened"),this.title_container_div.addClass("Opened"),this.fire_event(pe.DropdownModule.events.OPENED)},pe.DropdownModule.prototype.html=function(t,e){return'<div class="TitleContainer Closed"><div class="Title select Closed"></div>'+(t?'<div class="CloseButton close_btn fake_link"></div>':"")+'<input type="hidden" class="DropdownInput" name="'+e+'" ></div><div class="Dropdown dropdown"><div class="choices_wrapper"><div class="Choices choices"></div></div><div class="footer_bottom"><div class="footer_right"></div></div></div>'},pe.DropdownModule.prototype.is_expanded=function(){return this.dropdown_div.is(":visible")},pe.DropdownModule.prototype.prevent_next_collapse=function(){this.prevent_next_collapse_flag=!0},pe.DropdownModule.prototype.reset_dropdown=function(t){this.title_div.html(this.title_string_function(t)),this.dropdown_input_field.val("")},pe.DropdownModule.prototype.set_choices_content=function(t){this.choices_div.html(t),this.choices_div.find(".Choice").click(this.callback(this.choice_clicked)),this.choices_div.scroll(this.callback(this.content_scrolling))},pe.DropdownModule.prototype.set_default_selection=function(t){this.current_selection=pe.load(this.dropdown_div.find(t)),this.title_div.html(this.title_string_function(this.current_selection))},pe.DropdownModule.prototype.set_error_as_title=function(){this.title_div.html(this.title_string_function("error"))},pe.DropdownModule.prototype.set_input_field_value=function(t){this.dropdown_input_field.val(t)},pe.DropdownModule.prototype.title_clicked=function(){this.is_expanded()?this.collapse_dropdown():(this.disable_auto_collapse(500),this.expand_dropdown())},pe.DropdownModule.prototype.val=function(t){if(!t)return this.current_selection;this.current_selection="string"==typeof t?this.dropdown_div.find(t):t,this.title_div.html(this.title_string_function(this.current_selection))},pe.PhotoQualityStatusSelect=function(t){pe.init_widget(this,t),this.photo_id=this.container.attr("data_photo_id"),this.dropdown_module=new pe.DropdownModule(t,this.dropdown_html(),this.callback(this.title_html),!1),this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.value_changed));var e=this.container.attr("data_default");e&&this.dropdown_module.set_default_selection(".Choice[data='"+e+"']")},pe.PhotoQualityStatusSelect.events={CHANGED:"PhotoQualityStatusSelect_CHANGED"},pe.PhotoQualityStatusSelect.prototype.dropdown_html=function(){return'<div class="Choice" data="good">good</div><div class="Choice" data="bad">bad</div><div class="Choice" data="on_the_fence">on fence</div>'},pe.PhotoQualityStatusSelect.prototype.value_changed=function(t,e){$.ajax({url:"/admin/photos/"+this.photo_id+".json",type:"PUT",data:{"photo[quality_status]":this.result_value(e)}}),this.fire_event(pe.PhotoQualityStatusSelect.events.CHANGED,this.result_value(e))},pe.PhotoQualityStatusSelect.prototype.title_html=function(t){return t?"selecting"===t?"click on a choice":t.html():"quality status"},pe.PhotoQualityStatusSelect.prototype.result_value=function(t){if(!t)return"";var e=$(t).attr("data");return"string"==typeof e?e:""},pe.PhotoQualityStatusSelect.prototype.val=function(){return this.result_value(this.dropdown_module.val())},pe.PhotoQualityStatusSelect.create_all=function(){$(".PhotoQualityStatusSelect").each(function(t,e){new pe.PhotoQualityStatusSelect($(e))})},pe.PhotoStatusSelect=function(t){pe.init_widget(this,t),this.container.data("widget",this),this.photo_id=pe.load(this.container.attr("data_photo_id")),this.dropdown_module=new pe.DropdownModule(t,this.dropdown_html(),this.callback(this.title_html),!1),this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.value_changed));var e=this.container.attr("data_default");e&&this.dropdown_module.set_default_selection(".Choice[data='"+e+"']")},pe.PhotoStatusSelect.events={CHANGED:"PhotoStatusSelect_CHANGED"},pe.PhotoStatusSelect.prototype.dropdown_html=function(){return'<div class="Choice" data="not_reviewed">not reviewed</div><div class="Choice" data="disabled">disabled</div><div class="Choice" data="live">live</div>'},pe.PhotoStatusSelect.prototype.value_changed=function(t,e){$.ajax({url:"/admin/photos/"+this.photo_id+".json",type:"PUT",data:{"photo[status]":this.result_value(e)}}),this.fire_event(pe.PhotoStatusSelect.events.CHANGED,this.result_value($(e)))},pe.PhotoStatusSelect.prototype.title_html=function(t){return t?"selecting"===t?"click on a choice":t.html():"photo status"},pe.PhotoStatusSelect.prototype.result_value=function(t){if(!t)return"";var e=$(t).attr("data");return"string"==typeof e?e:""},pe.PhotoStatusSelect.prototype.val=function(t){if(!t)return this.result_value(this.dropdown_module.val());var e=pe.load(this.container.find('.Choice[data="'+t+'"]'));this.dropdown_module.val(e)},pe.PhotoStatusSelect.create_all=function(){$(".PhotoStatusSelect").each(function(t,e){new pe.PhotoStatusSelect($(e))})},function(s){var r;s.rails=r={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",fileInputSelector:"input:file",CSRFProtection:function(t){var e=s('meta[name="csrf-token"]').attr("content");e&&t.setRequestHeader("X-CSRF-Token",e)},fire:function(t,e,n){var o=s.Event(e);return t.trigger(o,n),!1!==o.result},confirm:function(t){return confirm(t)},ajax:function(t){return s.ajax(t)},handleRemote:function(o){var t,e,n,i=o.data("type")||s.ajaxSettings&&s.ajaxSettings.dataType;if(r.fire(o,"ajax:before")){if(o.is("form")){t=o.attr("method"),e=o.attr("action"),n=o.serializeArray();var a=o.data("ujs:submit-button");a&&(n.push(a),o.data("ujs:submit-button",null))}else t=o.data("method"),e=o.attr("href"),n=null;r.ajax({url:e,type:t||"GET",data:n,dataType:i,beforeSend:function(t,e){return e.dataType===undefined&&t.setRequestHeader("accept","*/*;q=0.5, "+e.accepts.script),r.fire(o,"ajax:beforeSend",[t,e])},success:function(t,e,n){o.trigger("ajax:success",[t,e,n])},complete:function(t,e){o.trigger("ajax:complete",[t,e])},error:function(t,e,n){o.trigger("ajax:error",[t,e,n])}})}},handleMethod:function(t){var e=t.attr("href"),n=t.data("method"),o=s("meta[name=csrf-token]").attr("content"),i=s("meta[name=csrf-param]").attr("content"),a=s('<form method="post" action="'+e+'"></form>'),r='<input name="_method" value="'+n+'" type="hidden" />';i!==undefined&&o!==undefined&&(r+='<input name="'+i+'" value="'+o+'" type="hidden" />'),a.hide().append(r).appendTo("body"),a.submit()},disableFormElements:function(t){t.find(r.disableSelector).each(function(){var t=s(this),e=t.is("button")?"html":"val";t.data("ujs:enable-with",t[e]()),t[e](t.data("disable-with")),t.attr("disabled","disabled")})},enableFormElements:function(t){t.find(r.enableSelector).each(function(){var t=s(this),e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.removeAttr("disabled")})},allowAction:function(t){var e,n=t.data("confirm"),o=!1;return!n||(r.fire(t,"confirm")&&(o=r.confirm(n),e=r.fire(t,"confirm:complete",[o])),o&&e)},blankInputs:function(t,e,n){var o,i=s(),a=e||"input,textarea";return t.find(a).each(function(){o=s(this),(n?o.val():!o.val())&&(i=i.add(o))}),!!i.length&&i},nonBlankInputs:function(t,e){return r.blankInputs(t,e,!0)},stopEverything:function(t){return t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(t){var e=t.data("events"),n=!0;return e!==undefined&&e.submit!==undefined&&s.each(e.submit,function(t,e){if("function"==typeof e.handler)return n=e.handler(e.data)}),n}},"ajaxPrefilter"in s?s.ajaxPrefilter(function(t,e,n){r.CSRFProtection(n)}):s(document).ajaxSend(function(t,e){r.CSRFProtection(e)}),s(r.linkClickSelector).live("click.rails",function(t){var e=s(this);return r.allowAction(e)?e.data("remote")!==undefined?(r.handleRemote(e),!1):e.data("method")?(r.handleMethod(e),!1):void 0:r.stopEverything(t)}),s(r.formSubmitSelector).live("submit.rails",function(t){var e=s(this),n=e.data("remote")!==undefined,o=r.blankInputs(e,r.requiredInputSelector),i=r.nonBlankInputs(e,r.fileInputSelector);return r.allowAction(e)?o&&r.fire(e,"ajax:aborted:required",[o])?!n:n?i?r.fire(e,"ajax:aborted:file",[i]):s.support.submitBubbles||!1!==r.callFormSubmitBindings(e)?(r.handleRemote(e),!1):r.stopEverything(t):void setTimeout(function(){r.disableFormElements(e)},13):r.stopEverything(t)}),s(r.formInputClickSelector).live("click.rails",function(t){var e=s(this);if(!r.allowAction(e))return r.stopEverything(t);var n=e.attr("name"),o=n?{name:n,value:e.val()}:null;e.closest("form").data("ujs:submit-button",o)}),s(r.formSubmitSelector).live("ajax:beforeSend.rails",function(t){this==t.target&&r.disableFormElements(s(this))}),s(r.formSubmitSelector).live("ajax:complete.rails",function(t){this==t.target&&r.enableFormElements(s(this))})}(jQuery);