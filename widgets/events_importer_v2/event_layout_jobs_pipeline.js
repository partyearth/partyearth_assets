pe.EventLayoutJobsPipeline=function(a){pe.init_widget(this,a);this.event_jobs=[];this.request_in_process=!1;this.interval_to_render_layout=1500;$(window).bind("beforeunload",this.callback(this.window_close_button_clicked))};pe.EventLayoutJobsPipeline.prototype.window_close_button_clicked=function(){if(this.request_in_process)return alert("Do not close the window as event layout updates are running in the background!"),!1};
pe.EventLayoutJobsPipeline.prototype.add_job=function(a){this.event_jobs.push(a);!this.request_in_process&&0<this.event_jobs.length&&this.process_next_job()};pe.EventLayoutJobsPipeline.prototype.process_next_job=function(){this.request_in_process=!0;var a=this.event_jobs.pop();$.ajax({url:a+"/get_layout.ehtml",error:pe.ajax_error,success:this.callback(function(b){this.container.html(b);setTimeout(this.callback(pe.bind(this.update_layout_type,a)),this.interval_to_render_layout)})})};
pe.EventLayoutJobsPipeline.prototype.update_layout_type=function(a){var b=0;$.each(this.container.find(".left_section .ShortLayout"),function(a,c){b+=parseInt($(c).outerHeight(!0),10)});$.ajax({url:a+"/update_layout.json",type:"PUT",data:{layout_type:292<b?2:1},error:pe.ajax_error,success:this.callback(function(){this.container.html("");0===this.event_jobs.length?this.request_in_process=!1:this.process_next_job()})})};
