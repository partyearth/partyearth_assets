pe.ListItem=function(a,b){pe.init_widget(this,a);this.list_id=this.container.data("list-id");this.list_name=this.container.find(".ListName").html();this.selected=_.include(b,this.list_id);this.list_display=this.container.find(".ListDisplay");this.list_display.click(this.callback(this.list_display_clicked))};pe.ListItem.events={CLICKED:"ListItem_CLICKED"};
pe.ListItem.prototype.build_message=function(){return"You have "+(this.selected?" subscribed <br> to ":"unsubscribed <br> from ")+"the "+this.list_name+" email list"};pe.ListItem.prototype.list_display_clicked=function(){this.selected?(this.list_display.html("Subscribe"),this.selected=!1):this.subscribe();console.log(this.build_message());this.fire_event(pe.ListItem.events.CLICKED,this.build_message())};
pe.ListItem.prototype.subscribe=function(){this.list_display.html("Unsubscribe");this.selected=!0};
pe.UnsubscribePage=function(a,b,c){pe.init_widget(this,a);this.subscriber_email=b;this.list_items=_.map(this.container.find(".ListItem"),this.callback(function(a){a=new pe.ListItem($(a),c);a.bind_event(pe.ListItem.events.CLICKED,this.callback(this.list_item_clicked));return a}));this.select_all_link=this.container.find(".SelectAllLists");this.select_all_link.click(this.callback(this.select_all_link_clicked));this.confirmation_display=this.container.find(".ConfirmationDisplay")};
pe.UnsubscribePage.prototype.update_subscriptions=function(a){var b={email:this.subscriber_email,list_ids:this.selected_list_ids()};$.ajax({url:"/services/subscriptions/web/unsubscribe",data:b,type:"POST",success:this.callback(function(){this.confirmation_display.addClass("confirmation");this.confirmation_display.html(a)})})};pe.UnsubscribePage.prototype.list_item_clicked=function(a,b){this.update_subscriptions(b)};
pe.UnsubscribePage.prototype.select_all_link_clicked=function(){_.each(this.list_items,function(a){a.subscribe()});this.update_subscriptions("You have subscribed <br>to all Party Earth email lists.")};pe.UnsubscribePage.prototype.selected_list_ids=function(){var a=[];_.each(this.list_items,function(b){b.selected&&a.push(b.list_id)});return a};$(document).ready(function(){new pe.UnsubscribePage($(".SubscriptionsContainer"),window.email,window.list_ids);pe.init_page_framework()});
