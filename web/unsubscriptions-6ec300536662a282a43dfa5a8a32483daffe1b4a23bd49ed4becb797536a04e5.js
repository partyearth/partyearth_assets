pe.ListItem=function(i,t){pe.init_widget(this,i),this.list_id=this.container.data("list-id"),this.list_name=this.container.find(".ListName").html(),this.selected=_.include(t,this.list_id),this.list_display=this.container.find(".ListDisplay"),this.list_display.click(this.callback(this.list_display_clicked))},pe.ListItem.events={CLICKED:"ListItem_CLICKED"},pe.ListItem.prototype.build_message=function(){return"You have "+(this.selected?" subscribed <br> to ":"unsubscribed <br> from ")+"the "+this.list_name+" email list"},pe.ListItem.prototype.list_display_clicked=function(){this.selected?(this.list_display.html("Subscribe"),this.selected=!1):this.subscribe(),this.fire_event(pe.ListItem.events.CLICKED,this.build_message())},pe.ListItem.prototype.subscribe=function(){this.list_display.html("Unsubscribe"),this.selected=!0},pe.UnsubscribePage=function(i,t,s){pe.init_widget(this,i),this.subscriber_email=t,this.list_items=_.map(this.container.find(".ListItem"),this.callback(function(i){var t=new pe.ListItem($(i),s);return t.bind_event(pe.ListItem.events.CLICKED,this.callback(this.list_item_clicked)),t})),this.select_all_link=this.container.find(".SelectAllLists"),this.select_all_link.click(this.callback(this.select_all_link_clicked)),this.confirmation_display=this.container.find(".ConfirmationDisplay")},pe.UnsubscribePage.prototype.update_subscriptions=function(i){var t={email:this.subscriber_email,list_ids:this.selected_list_ids()};$.ajax({url:"/services/subscriptions/web/unsubscribe",data:t,type:"POST",success:this.callback(function(){this.confirmation_display.addClass("confirmation"),this.confirmation_display.html(i)})})},pe.UnsubscribePage.prototype.list_item_clicked=function(i,t){this.update_subscriptions(t)},pe.UnsubscribePage.prototype.select_all_link_clicked=function(){_.each(this.list_items,function(i){i.subscribe()}),this.update_subscriptions("You have subscribed <br>to all Party Earth email lists.")},pe.UnsubscribePage.prototype.selected_list_ids=function(){var t=[];return _.each(this.list_items,function(i){i.selected&&t.push(i.list_id)}),t},$(document).ready(function(){new pe.UnsubscribePage($(".SubscriptionsContainer"),window.email,window.list_ids),pe.init_page_framework()});