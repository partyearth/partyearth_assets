pe.CallbackHandler=function(){this.callbacks={}};pe.CallbackHandler.prototype.add=function(a,b){this.callbacks[a]||(this.callbacks[a]=[]);this.callbacks[a].push(b)};pe.CallbackHandler.prototype.call=function(a,b){var c=Array.prototype.slice.call(arguments,1);if(this.callbacks[a])return _.each(this.callbacks[a],function(a){a.apply(null,c)}),!0};
pe.VerticalSlider=function(a,b){pe.init_widget(this,a);this.callbacks=new pe.CallbackHandler;this.current_slide=1;this.next_button=this.container.find(".NextButton");this.prev_button=this.container.find(".PrevButton");this.slide_amount=b;this.viewport=this.container.find(".Viewport");this.slides=this.viewport.find(".Slide");this.items=this.slides.find(".Item");this.slides_length=this.slides.length;this.viewport_top=0;this.items.mouseenter(this.callback(this.item_hovered));this.items.mouseleave(this.callback(this.item_leaved));
this.next_button.click(this.callback(this.next_button_clicked));this.prev_button.click(this.callback(this.prev_button_clicked))};pe.VerticalSlider.callbacks={ITEM_HOVERED:"item_hovered",ITEM_LEAVED:"item_leaved",SLIDE_CHANGED:"slide_changed"};pe.VerticalSlider.prototype.append_first=function(){var a=_.last(this.slides);$(a).prependTo(this.viewport);this.slides=$.merge([a],_.without(this.slides,a))};
pe.VerticalSlider.prototype.append_last=function(){var a=_.first(this.slides);$(a).appendTo(this.viewport);this.slides=_.rest(this.slides).concat(a)};pe.VerticalSlider.prototype.item_hovered=function(a){this.callbacks.call(pe.VerticalSlider.callbacks.ITEM_HOVERED,a.currentTarget)};pe.VerticalSlider.prototype.item_leaved=function(){this.callbacks.call(pe.VerticalSlider.callbacks.ITEM_LEAVED)};
pe.VerticalSlider.prototype.move_viewport=function(a){a?this.viewport.css("margin-top",this.viewport_top):this.viewport.animate({"margin-top":this.viewport_top},500)};pe.VerticalSlider.prototype.next_button_clicked=function(){this.current_slide===this.slides_length?(this.append_last(),this.slide_prev(!0)):this.current_slide+=1;this.slide_next();this.callbacks.call("slide_changed",this.slides[this.current_slide-1])};
pe.VerticalSlider.prototype.prev_button_clicked=function(){1===this.current_slide?(this.append_first(),this.slide_next(!0)):this.current_slide-=1;this.slide_prev();this.callbacks.call("slide_changed",this.slides[this.current_slide-1])};pe.VerticalSlider.prototype.slide_next=function(a){this.viewport_top-=this.slide_amount;this.move_viewport(a)};pe.VerticalSlider.prototype.slide_prev=function(a){this.viewport_top+=this.slide_amount;this.move_viewport(a)};
pe.MetrosVerticalSlider=function(a){pe.init_widget(this,a);this.featured_item=this.container.find(".FeaturedItem");this.featured_item.hover(this.callback(this.item_hovered,null),this.callback(this.restart_timer));this.slider=new pe.VerticalSlider(this.container.find(".VerticalSlider"),306);this.slider.items.each(function(a,c){$(c).height("86").css("overflow","hidden")});this.selected_item=this.slider.items.filter(".selected");this.timer=42;this.restart_timer();this.slider.callbacks.add(pe.VerticalSlider.callbacks.ITEM_HOVERED,
this.callback(this.item_hovered));this.slider.callbacks.add(pe.VerticalSlider.callbacks.ITEM_LEAVED,this.callback(this.restart_timer));this.slider.callbacks.add(pe.VerticalSlider.callbacks.SLIDE_CHANGED,this.callback(this.slide_changed))};pe.MetrosVerticalSlider.prototype.select_item=function(a){a=$(a);this.selected_item.removeClass("selected");this.selected_item=a.addClass("selected");this.featured_item.html(a.find(".FeaturedHtml").html())};
pe.MetrosVerticalSlider.prototype.item_hovered=function(a){clearTimeout(this.timer);a&&this.select_item(a)};pe.MetrosVerticalSlider.prototype.select_next_item=function(){var a=this.selected_item.next(".Item")[0];a?this.select_item(a):this.slider.next_button_clicked();this.restart_timer()};pe.MetrosVerticalSlider.prototype.restart_timer=function(){this.timer=setTimeout(this.callback(this.select_next_item),5E3)};pe.MetrosVerticalSlider.prototype.slide_changed=function(a){this.select_item($(a).find(".Item:first")[0])};
