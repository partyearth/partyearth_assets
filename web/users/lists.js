pe.routes={map:{search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",
holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",
map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",user_lists:"/users/{{user_id}}/lists",user_list:"/users/{{user_id}}/lists/{{id}}",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user:"/users/{{id}}",api_user:"/api/users/{{id}}",
event:"/{{city_id}}/{{*endpoints}}/{{id}}-1"}};pe.routes.build_path=function(b,c){var a=pe.routes.map[b],e=a.match(/\{\{\*(.+)\}\}/);_.each(e,function(a){c[a]&&(c[a]=c[a].join("/"))});a=a.replace(/\*/,"");return pe.routes.clean_url(pe.templatize(a,c))};pe.routes.clean_url=function(b){return("/"+b).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var b=pe.routes.recognize_path(window.location.pathname);return b?b.params:{}};
pe.routes.recognize_path=function(b){b=pe.routes.clean_url(b);var c,a,e=_.find(_.keys(pe.routes.map),function(e){c=pe.routes.map[e];a=RegExp(c.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return a.test(b)});if(e){for(var f=_.map(c.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),d=b.match(a).slice(1,99),m={params:{}},h=function(a){return!_.isEmpty(a)},j=0;j<f.length;j++)"*"==f[j][0]&&(f[j]=f[j].replace(/\*/g,""),d[j]=_.select(d[j].replace(/\*/g,"").split("/"),h)),
m.params[f[j]]=d[j];m.path_info={name:e,template:c};return m}return!1};pe.routes.Request=function(b,c,a){pe.routes.map[b]?(this.path=b,"object"!==typeof c&&(c={id:c}),this.params=c,this.callback=a):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(b,c,a){return new pe.routes.Request(b,c,a)};pe.routes.Request.from_current_location=function(b,c,a){c=c||{};var e=pe.routes.current_url_params();return new pe.routes.Request(b,_.extend(e,c),a)};
pe.routes.Request.prototype.ajax=function(b,c){var a="function"===typeof c?c:this.callback;$.ajax({url:this.build_path(),data:this.params,type:b,success:a})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(b){this.ajax("GET",b)};pe.routes.Request.prototype.post=function(b){this.ajax("POST",b)};
(function(b){function c(){if(b.fn.ajaxSubmit.debug){var a="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(a):window.opera&&window.opera.postError&&window.opera.postError(a)}}b.fn.ajaxSubmit=function(a){function e(){function e(){var a=l.attr("target"),c=l.attr("action");d.setAttribute("target",m);"POST"!=d.getAttribute("method")&&d.setAttribute("method","POST");d.getAttribute("action")!=g.url&&d.setAttribute("action",g.url);g.skipEncodingOverride||
l.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});g.timeout&&setTimeout(function(){t=!0;f()},g.timeout);var k=[];try{if(g.extraData)for(var n in g.extraData)k.push(b('<input type="hidden" name="'+n+'" value="'+g.extraData[n]+'" />').appendTo(d)[0]);j.appendTo("body");h.attachEvent?h.attachEvent("onload",f):h.addEventListener("load",f,!1);d.submit()}finally{d.setAttribute("action",c),a?d.setAttribute("target",a):l.removeAttr("target"),b(k).remove()}}function f(){if(!k.aborted){var a=
h.contentWindow?h.contentWindow.document:h.contentDocument?h.contentDocument:h.document;if(a&&a.location.href!=g.iframeSrc){h.detachEvent?h.detachEvent("onload",f):h.removeEventListener("load",f,!1);var e=!0;try{if(t)throw"timeout";var d="xml"==g.dataType||a.XMLDocument||b.isXMLDoc(a);c("isXml="+d);if(!d&&(window.opera&&(null==a.body||""==a.body.innerHTML))&&--y){c("requeing onLoad callback, DOM not available");setTimeout(f,250);return}k.responseText=a.body?a.body.innerHTML:a.documentElement?a.documentElement.innerHTML:
null;k.responseXML=a.XMLDocument?a.XMLDocument:a;k.getResponseHeader=function(a){return{"content-type":g.dataType}[a]};var m=/(json|script)/.test(g.dataType);if(m||g.textarea){var l=a.getElementsByTagName("textarea")[0];if(l)k.responseText=l.value;else if(m){var q=a.getElementsByTagName("pre")[0],s=a.getElementsByTagName("body")[0];q?k.responseText=q.textContent:s&&(k.responseText=s.innerHTML)}}else"xml"==g.dataType&&(!k.responseXML&&null!=k.responseText)&&(k.responseXML=z(k.responseText));var a=
k,r=g.dataType,d=g,v=a.getResponseHeader("content-type")||"",w="xml"===r||!r&&0<=v.indexOf("xml"),p=w?a.responseXML:a.responseText;w&&"parsererror"===p.documentElement.nodeName&&b.error&&b.error("parsererror");d&&d.dataFilter&&(p=d.dataFilter(p,r));"string"===typeof p&&("json"===r||!r&&0<=v.indexOf("json")?p=A(p):("script"===r||!r&&0<=v.indexOf("javascript"))&&b.globalEval(p));x=p}catch(u){c("error caught:",u),e=!1,k.error=u,g.error&&g.error.call(g.context,k,"error",u),n&&b.event.trigger("ajaxError",
[k,g,u])}k.aborted&&(c("upload aborted"),e=!1);e&&(g.success&&g.success.call(g.context,x,"success",k),n&&b.event.trigger("ajaxSuccess",[k,g]));n&&b.event.trigger("ajaxComplete",[k,g]);n&&!--b.active&&b.event.trigger("ajaxStop");g.complete&&g.complete.call(g.context,k,e?"success":"error");setTimeout(function(){j.removeData("form-plugin-onload");j.remove();k.responseXML=null},100)}}}var d=l[0];if(b(":input[name=submit],:input[id=submit]",d).length)alert('Error: Form elements must not have name or id of "submit".');
else{var g=b.extend(!0,{},b.ajaxSettings,a);g.context=g.context||g;var m="jqFormIO"+(new Date).getTime(),j=b('<iframe id="'+m+'" name="'+m+'" src="'+g.iframeSrc+'" />'),h=j[0];j.css({position:"absolute",top:"-1000px",left:"-1000px"});var k={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){c("aborting upload...");this.aborted=1;j.attr("src",g.iframeSrc);k.error="aborted";
g.error&&g.error.call(g.context,k,"error","aborted");n&&b.event.trigger("ajaxError",[k,g,"aborted"]);g.complete&&g.complete.call(g.context,k,"error")}},n=g.global;n&&!b.active++&&b.event.trigger("ajaxStart");n&&b.event.trigger("ajaxSend",[k,g]);if(g.beforeSend&&!1===g.beforeSend.call(g.context,k,g))g.global&&b.active--;else if(!k.aborted){var t=0,q=d.clk;if(q){var s=q.name;s&&!q.disabled&&(g.extraData=g.extraData||{},g.extraData[s]=q.value,"image"==q.type&&(g.extraData[s+".x"]=d.clk_x,g.extraData[s+
".y"]=d.clk_y))}g.forceSync?e():setTimeout(e,10);var x,y=50,z=b.parseXML||function(a,b){window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},A=b.parseJSON||function(a){return window.eval("("+a+")")}}}}if(!this.length)return c("ajaxSubmit: skipping submit process - no element selected"),this;"function"==typeof a&&(a={success:a});var f=
this.attr("action");(f="string"===typeof f?b.trim(f):"")&&(f=(f.match(/^([^#]+)/)||[])[1]);f=f||window.location.href||"";a=b.extend(!0,{url:f,type:this[0].getAttribute("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},a);f={};this.trigger("form-pre-serialize",[this,a,f]);if(f.veto)return c("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(a.beforeSerialize&&!1===a.beforeSerialize(this,a))return c("ajaxSubmit: submit aborted via beforeSerialize callback"),
this;var d,m,h=this.formToArray(a.semantic);if(a.data)for(d in a.extraData=a.data,a.data)if(a.data[d]instanceof Array)for(var j in a.data[d])h.push({name:d,value:a.data[d][j]});else m=a.data[d],m=b.isFunction(m)?m():m,h.push({name:d,value:m});if(a.beforeSubmit&&!1===a.beforeSubmit(h,this,a))return c("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[h,this,a,f]);if(f.veto)return c("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;d=b.param(h);
"GET"==a.type.toUpperCase()?(a.url+=(0<=a.url.indexOf("?")?"&":"?")+d,a.data=null):a.data=d;var l=this,n=[];a.resetForm&&n.push(function(){l.resetForm()});a.clearForm&&n.push(function(){l.clearForm()});if(!a.dataType&&a.target){var t=a.success||function(){};n.push(function(e){var d=a.replaceTarget?"replaceWith":"html";b(a.target)[d](e).each(t,arguments)})}else a.success&&n.push(a.success);a.success=function(b,e,d){for(var f=a.context||a,c=0,m=n.length;c<m;c++)n[c].apply(f,[b,e,d||l,l])};d=0<b("input:file",
this).length;j="multipart/form-data"==l.attr("enctype")||"multipart/form-data"==l.attr("encoding");!1!==a.iframe&&(d||a.iframe||j)?a.closeKeepAlive?b.get(a.closeKeepAlive,e):e():b.ajax(a);this.trigger("form-submit-notify",[this,a]);return this};b.fn.ajaxForm=function(a){if(0===this.length){var e=this.selector,f=this.context;if(!b.isReady&&e)return c("DOM not ready, queuing ajaxForm"),b(function(){b(e,f).ajaxForm(a)}),this;c("terminating; zero elements found by selector"+(b.isReady?"":" (DOM not ready)"));
return this}return this.ajaxFormUnbind().bind("submit.form-plugin",function(e){e.isDefaultPrevented()||(e.preventDefault(),b(this).ajaxSubmit(a))}).bind("click.form-plugin",function(a){var e=a.target,f=b(e);if(!f.is(":submit,input:image")){e=f.closest(":submit");if(0==e.length)return;e=e[0]}var c=this;c.clk=e;"image"==e.type&&(void 0!=a.offsetX?(c.clk_x=a.offsetX,c.clk_y=a.offsetY):"function"==typeof b.fn.offset?(f=f.offset(),c.clk_x=a.pageX-f.left,c.clk_y=a.pageY-f.top):(c.clk_x=a.pageX-e.offsetLeft,
c.clk_y=a.pageY-e.offsetTop));setTimeout(function(){c.clk=c.clk_x=c.clk_y=null},100)})};b.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};b.fn.formToArray=function(a){var e=[];if(0===this.length)return e;var f=this[0],d=a?f.getElementsByTagName("*"):f.elements;if(!d)return e;var c,h,j,l,n,t;c=0;for(n=d.length;c<n;c++)if(h=d[c],j=h.name)if(a&&f.clk&&"image"==h.type)!h.disabled&&f.clk==h&&(e.push({name:j,value:b(h).val()}),e.push({name:j+".x",value:f.clk_x},
{name:j+".y",value:f.clk_y}));else if((l=b.fieldValue(h,!0))&&l.constructor==Array){h=0;for(t=l.length;h<t;h++)e.push({name:j,value:l[h]})}else null!==l&&"undefined"!=typeof l&&e.push({name:j,value:l});if(!a&&f.clk&&(a=b(f.clk),d=a[0],(j=d.name)&&!d.disabled&&"image"==d.type))e.push({name:j,value:a.val()}),e.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y});return e};b.fn.formSerialize=function(a){return b.param(this.formToArray(a))};b.fn.fieldSerialize=function(a){var e=[];this.each(function(){var f=
this.name;if(f){var d=b.fieldValue(this,a);if(d&&d.constructor==Array)for(var c=0,h=d.length;c<h;c++)e.push({name:f,value:d[c]});else null!==d&&"undefined"!=typeof d&&e.push({name:this.name,value:d})}});return b.param(e)};b.fn.fieldValue=function(a){for(var e=[],f=0,d=this.length;f<d;f++){var c=b.fieldValue(this[f],a);null===c||("undefined"==typeof c||c.constructor==Array&&!c.length)||(c.constructor==Array?b.merge(e,c):e.push(c))}return e};b.fieldValue=function(a,e){var c=a.name,d=a.type,m=a.tagName.toLowerCase();
void 0===e&&(e=!0);if(e&&(!c||a.disabled||"reset"==d||"button"==d||("checkbox"==d||"radio"==d)&&!a.checked||("submit"==d||"image"==d)&&a.form&&a.form.clk!=a||"select"==m&&-1==a.selectedIndex))return null;if("select"==m){var h=a.selectedIndex;if(0>h)return null;for(var c=[],m=a.options,j=(d="select-one"==d)?h+1:m.length,h=d?h:0;h<j;h++){var l=m[h];if(l.selected){var n=l.value;n||(n=l.attributes&&l.attributes.value&&!l.attributes.value.specified?l.text:l.value);if(d)return n;c.push(n)}}return c}return b(a).val()};
b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var a=this.type,b=this.tagName.toLowerCase();"text"==a||"password"==a||"textarea"==b?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==b&&(this.selectedIndex=-1)})};b.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};
b.fn.enable=function(a){void 0===a&&(a=!0);return this.each(function(){this.disabled=!a})};b.fn.selected=function(a){void 0===a&&(a=!0);return this.each(function(){var e=this.type;"checkbox"==e||"radio"==e?this.checked=a:"option"==this.tagName.toLowerCase()&&(e=b(this).parent("select"),a&&(e[0]&&"select-one"==e[0].type)&&e.find("option").selected(!1),this.selected=a)})}})(jQuery);
(function(){var b=function(a,b){return function(){return a.apply(b,arguments)}};pe.users||(pe.users={});var c=pe.users,a=function(a){this.container=a;this.on_ajax=b(this.on_ajax,this);this.on_page_clicked=b(this.on_page_clicked,this);this.on_form_changed=b(this.on_form_changed,this);this.lists_container=this.container.find(".Lists");this.container.find("select").change(this.on_form_changed);this.on_form_changed();this.on_after_changed=function(){}};a.prototype.on_form_changed=function(){return this.container.ajaxSubmit(this.on_ajax)};
a.prototype.on_page_clicked=function(a){var b;(b=$(a.currentTarget).attr("href"))&&$.get(b,this.on_ajax);return!1};a.prototype.on_ajax=function(a){this.lists_container.html(a);this.container.find(".Paginator a").click(this.on_page_clicked);return this.on_after_changed()};a.prototype.change=function(a){return this.on_after_changed=a};c.CollectionSearchForm=a}).call(this);
(function(){var b=function(a,b){return function(){return a.apply(b,arguments)}};pe.gigya=pe.gigya||{};var c=pe.gigya,a=function(a){var c=this;this.container=a;this.input_field_focused=b(this.input_field_focused,this);this.input_field_focusouted=b(this.input_field_focusouted,this);this.error_message_container_clicked=b(this.error_message_container_clicked,this);this.on_list_created=b(this.on_list_created,this);this.submit_button_clicked=b(this.submit_button_clicked,this);this.error_message_container=
this.container.find(".Error");this.input_field=this.container.find(".Input");this.submit_button=this.container.find(".CreateButton");this.input_field.attr("placeholder",pe.gigya.ListCreator.default_label);this.input_field.focus(this.input_field_focused);this.input_field.focusout(this.input_field_focusouted);this.input_field.keypress(function(a){if(13===a.which)return a.preventDefault(),c.hide_error_message(),a=c.input_field.val(),_.isEmpty(a.replace(/\s/g,""))||c.create_list(a),!1});this.error_message_container.click(this.error_message_container_clicked);
this.submit_button.click(this.submit_button_clicked);this.hide_error_message();this.put_name(pe.gigya.ListCreator.default_label)};a.default_label="Enter new list title";a.prototype.create_list=function(a){this.on_before_create();return $.post("/api/user_lists",{user_list:{name:a}},this.on_list_created,"json")};a.prototype.put_name=function(a){return this.input_field.val(a)};a.prototype.validate=function(){return!this.is_empty()};a.prototype.show_error_message=function(){return this.error_message_container.show().removeClass("hidden")};
a.prototype.hide_error_message=function(){return this.error_message_container.hide().removeClass("visible")};a.prototype.is_empty=function(){var a;a=this.input_field.val();return _.isEmpty(a)||a===pe.gigya.ListCreator.default_label};a.prototype.submit_button_clicked=function(){return this.validate()?(this.hide_error_message(),this.create_list(this.input_field.val()),this.put_name("")):this.show_error_message()};a.prototype.on_list_created=function(a){return 0===a.status?(this.put_name(""),this.on_after_create(a.instance)):
alert("Something went wrong: ListCreator#on_list_created")};a.prototype.on_after_create=function(){return!0};a.prototype.on_before_create=function(){return!0};a.prototype.after_create=function(a){return this.on_after_create=a};a.prototype.before_create=function(a){return this.on_before_create=a};a.prototype.error_message_container_clicked=function(){this.error_message_container.hide();this.put_name("");return this.input_field.focus()};a.prototype.input_field_focusouted=function(){if(_.isEmpty(this.input_field.val()))return this.put_name(pe.gigya.ListCreator.default_label)};
a.prototype.input_field_focused=function(){if(this.is_empty())return this.put_name("")};c.ListCreator=a}).call(this);
(function(){var b=pe,c=function(a){this.container=a;var b=this.on_submit_button_clicked,c=this;this.on_submit_button_clicked=function(){return b.apply(c,arguments)};this.submit_button=this.container.find(".SubmitButton");this.input_field=this.container.find(".SearchInput");this.submit_button.click(this.on_submit_button_clicked);this.container.bind("submit",this.on_submit_button_clicked)};c.prototype.on_submit_button_clicked=function(){var a,b,c;c=this.input_field.val();b=null!=c?c:"Search results for <b>"+
c+{"</b> in {{city}}":"Search results in {{city}}"};a=$("meta[property='pe:city_id']").attr("content");pe.city_configuration_widget.set_cookie_and_redirect({city_id:a,query:c,message:b});return!1};b.SearchForm=c}).call(this);
(function(){$(document).ready(function(){0<$(".SearchForm").length&&(pe.search_form=new pe.users.CollectionSearchForm($(".SearchForm")),pe.search_form.change(function(){return $(".SearchForm .ActivateButton").click(function(){var b,c=this;b={user_list:{},_method:"put"};b.user_list.status="active";b.id=$(this).data("id");return(new pe.routes.Request("api_user_list",b)).post(function(){$(c).html("Your list is now public");return $(c).unbind("click")})})}));0<$(".SearchPageForm").length&&(pe.search_form=
new pe.SearchForm($(".SearchPageForm")));0<$(".ListCreator").length&&(pe.list_creator=new pe.gigya.ListCreator($(".ListCreator")),pe.list_creator.after_create(function(b){var c;c=pe.routes.current_url_params().user_id;return window.location=pe.routes.build_path("user_list",{user_id:c,id:b.url_param})}),pe.bind_toggle_trigger($(".ListCreatorToggleTrigger"),$(".ListCreator")));return pe.init_page_framework()})}).call(this);
