(function(){var d=function(a,b){return function(){return a.apply(b,arguments)}},e=pe,c=function(a){this.container=a;this.on_keydown=d(this.on_keydown,this);this.on_item_selected=d(this.on_item_selected,this);this.on_city_changed=d(this.on_city_changed,this);this.on_add_button_clicked=d(this.on_add_button_clicked,this);this.add_button=this.container.find(".AddButton");this.cities_selector=this.container.find(".CitiesSelector");this.input=this.container.find(".SearchInput");this.results_container=this.container.find(".Results");
this.add_button.click(this.on_add_button_clicked);this.cities_selector.change(this.on_city_changed);this.input.keydown(this.on_keydown);this.results_container.find("li").live("click",this.on_item_selected);this.on_city_changed()};c.prototype.get_query=function(){return this.input.val()};c.prototype.on_add_button_clicked=function(){var a;return this.selected_item&&0<this.results_container.find("li.selected").length?(a={favorite:this.selected_item},pe.routes.Request.from_current_location("api_user_list_favorites",
a).post(function(){return window.location.reload()})):alert("you must select item first")};c.prototype.on_city_changed=function(){var a;a=this.cities_selector.val();this.request=new pe.routes.Request("search_autocomplete",{city_id:a});return this.search()};c.prototype.on_item_selected=function(a){var b;this.results_container.find("li").removeClass("selected");b=$(a.currentTarget);b.addClass("selected");a=b.data("id");b=b.data("type");return this.selected_item={listable_id:a,listable_type:b}};c.prototype.on_keydown=
function(a){if(13!==a.keycode)return this.search()};c.prototype.search=function(){var a,b=this;a=this.get_query();return 2<a.length?(this.request.params.q=a,this.request.post(function(a){return b.results_container.html(a)})):this.results_container.empty()};e.Searchable=c}).call(this);
