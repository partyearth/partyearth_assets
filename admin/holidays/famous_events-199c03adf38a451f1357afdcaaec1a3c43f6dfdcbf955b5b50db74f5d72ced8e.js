pe.CloseButton=function(e,t){if(pe.init_widget(this,e),this.close_button=e.find(".CloseButton"),"function"==typeof t)this.close_button.click(t);else switch(t){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}},pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"},pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"},pe.CloseButton.prototype.remove_container=function(){return this.container.detach(),this.fire_event(pe.CloseButton.events.CLOSED),this.container.remove(),!1},pe.CloseButton.prototype.hide_container=function(){return this.fire_event(pe.CloseButton.events.CLOSED),this.container.hide(),!1},pe.GeneralAutocompleteInputModule=function(e,t,n,o){pe.init_widget(this,e),this.autocomplete_data_or_url=t,this.input_field_name=n,this.container.html(this.html()),this.dummy_input_field=this.container.find(".DummyInputField"),this.autocomplete_input_field=this.container.find(".AutocompleteField"),this.autocomplete_handler(),this.selected_data_list_div=this.container.find(".SelectedDataList"),this.selected_data_list_div.sortable(),o&&this.add_data_to_list(o)},pe.GeneralAutocompleteInputModule.events={SELECTED:"GeneralAutocompleteInputModule_SELECTED",REMOVED:"GeneralAutocompleteInputModule_REMOVED",EMPTIED:"GeneralAutocompleteInputMOdule_EMPTIED"},pe.GeneralAutocompleteInputModule.prototype.add_data_to_list=function(e){this.remove_dummy_row(),$.each(e,this.callback(function(e,t){-1===$.inArray(t.id.toString(),this.all_values())&&this.autocomplete_data_selected(t.label,t.id,t.category)}))},pe.GeneralAutocompleteInputModule.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))},pe.GeneralAutocompleteInputModule.prototype.all_values=function(){return this.selected_data_list_div.find('[name="'+this.input_field_name+'"]').map(function(){return this.value}).toArray()},pe.GeneralAutocompleteInputModule.prototype.autocomplete_data_selected=function(e,t,n){this.remove_dummy_row(),this.selected_data_list_div.append(this.selected_data_html(e,t,n)),new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked))},pe.GeneralAutocompleteInputModule.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:this.set_autocomplete_data(),minLength:1,close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(e,t){var n=t.item;this.autocomplete_data_selected(n.label,n.id,n.category),this.fire_event(pe.GeneralAutocompleteInputModule.events.SELECTED,n.id)})}).data("autocomplete")._renderItem=function(e,t){return t.display_label=t.category?pe.templatize("{{label}} ({{category}})",t):t.label,$("<li></li>").data("item.autocomplete",t).append(pe.templatize("<a>{{display_label}}</a>",t)).appendTo(e)}},pe.GeneralAutocompleteInputModule.prototype.set_autocomplete_data=function(){return"string"==typeof this.autocomplete_data_or_url?this.callback(function(t,n){$.getJSON(this.autocomplete_data_or_url,{term:this.autocomplete_input_field.val(),val:this.all_values().join(",")},function(e){pe.GeneralAutocompleteInputModule.sort_autocomplete_results(e,t,n)})}):this.callback(pe.GeneralAutocompleteInputModule.sort_autocomplete_results,this.autocomplete_data_or_url)},pe.GeneralAutocompleteInputModule.sort_autocomplete_results=function(e,t,n){var o=pe.normalize(t.term).toLowerCase(),a=new RegExp($.ui.autocomplete.escapeRegex(o),"i"),i=$.grep(e,function(e){return e=e.label||e.value||e,a.test(e)||a.test(pe.normalize(e))}),l=new RegExp("^"+$.ui.autocomplete.escapeRegex(o),"i");n(i=_.sortBy(i,function(e){var t=pe.normalize(e.label).toLowerCase();return[t!=o,!l.test(t)]}))},pe.GeneralAutocompleteInputModule.prototype.clear_selected_data=function(){this.selected_data_list_div.html(""),this.add_dummy_row()},pe.GeneralAutocompleteInputModule.prototype.close_button_clicked=function(){this.is_empty()&&this.add_dummy_row(),this.fire_event(pe.GeneralAutocompleteInputModule.events.REMOVED),this.is_empty()&&this.fire_event(pe.GeneralAutocompleteInputModule.events.EMPTIED)},pe.GeneralAutocompleteInputModule.prototype.display_close_button=function(){this.selected_data_list_div.find(".CloseButton").show()},pe.GeneralAutocompleteInputModule.prototype.hide_close_button=function(){this.selected_data_list_div.find(".CloseButton").hide()},pe.GeneralAutocompleteInputModule.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><ul class="SelectedDataList" id="sortable"></ul>'},pe.GeneralAutocompleteInputModule.prototype.is_empty=function(){return 0===this.selected_data_list_div.find(".SelectedInputData").length},pe.GeneralAutocompleteInputModule.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)},pe.GeneralAutocompleteInputModule.prototype.replace_data_in_list=function(e){e&&(this.clear_selected_data(),this.add_data_to_list(e))},pe.GeneralAutocompleteInputModule.prototype.selected_data_html=function(e,t,n){return'<li class="SelectedInputData">  <img style="padding-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"\t\tclass="CloseButton float_left">  <p class="float_left">'+(n?e+"("+n+")":e)+'</p>  <input type="hidden" value="'+t+'" name="'+this.input_field_name+'">  <div class="clear"></div></li>'},function(u){var l;u.rails=l={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",fileInputSelector:"input:file",CSRFProtection:function(e){var t=u('meta[name="csrf-token"]').attr("content");t&&e.setRequestHeader("X-CSRF-Token",t)},fire:function(e,t,n){var o=u.Event(t);return e.trigger(o,n),!1!==o.result},confirm:function(e){return confirm(e)},ajax:function(e){return u.ajax(e)},handleRemote:function(o){var e,t,n,a=o.data("type")||u.ajaxSettings&&u.ajaxSettings.dataType;if(l.fire(o,"ajax:before")){if(o.is("form")){e=o.attr("method"),t=o.attr("action"),n=o.serializeArray();var i=o.data("ujs:submit-button");i&&(n.push(i),o.data("ujs:submit-button",null))}else e=o.data("method"),t=o.attr("href"),n=null;l.ajax({url:t,type:e||"GET",data:n,dataType:a,beforeSend:function(e,t){return t.dataType===undefined&&e.setRequestHeader("accept","*/*;q=0.5, "+t.accepts.script),l.fire(o,"ajax:beforeSend",[e,t])},success:function(e,t,n){o.trigger("ajax:success",[e,t,n])},complete:function(e,t){o.trigger("ajax:complete",[e,t])},error:function(e,t,n){o.trigger("ajax:error",[e,t,n])}})}},handleMethod:function(e){var t=e.attr("href"),n=e.data("method"),o=u("meta[name=csrf-token]").attr("content"),a=u("meta[name=csrf-param]").attr("content"),i=u('<form method="post" action="'+t+'"></form>'),l='<input name="_method" value="'+n+'" type="hidden" />';a!==undefined&&o!==undefined&&(l+='<input name="'+a+'" value="'+o+'" type="hidden" />'),i.hide().append(l).appendTo("body"),i.submit()},disableFormElements:function(e){e.find(l.disableSelector).each(function(){var e=u(this),t=e.is("button")?"html":"val";e.data("ujs:enable-with",e[t]()),e[t](e.data("disable-with")),e.attr("disabled","disabled")})},enableFormElements:function(e){e.find(l.enableSelector).each(function(){var e=u(this),t=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.removeAttr("disabled")})},allowAction:function(e){var t,n=e.data("confirm"),o=!1;return!n||(l.fire(e,"confirm")&&(o=l.confirm(n),t=l.fire(e,"confirm:complete",[o])),o&&t)},blankInputs:function(e,t,n){var o,a=u(),i=t||"input,textarea";return e.find(i).each(function(){o=u(this),(n?o.val():!o.val())&&(a=a.add(o))}),!!a.length&&a},nonBlankInputs:function(e,t){return l.blankInputs(e,t,!0)},stopEverything:function(e){return e.stopImmediatePropagation(),!1},callFormSubmitBindings:function(e){var t=e.data("events"),n=!0;return t!==undefined&&t.submit!==undefined&&u.each(t.submit,function(e,t){if("function"==typeof t.handler)return n=t.handler(t.data)}),n}},"ajaxPrefilter"in u?u.ajaxPrefilter(function(e,t,n){l.CSRFProtection(n)}):u(document).ajaxSend(function(e,t){l.CSRFProtection(t)}),u(l.linkClickSelector).live("click.rails",function(e){var t=u(this);return l.allowAction(t)?t.data("remote")!==undefined?(l.handleRemote(t),!1):t.data("method")?(l.handleMethod(t),!1):void 0:l.stopEverything(e)}),u(l.formSubmitSelector).live("submit.rails",function(e){var t=u(this),n=t.data("remote")!==undefined,o=l.blankInputs(t,l.requiredInputSelector),a=l.nonBlankInputs(t,l.fileInputSelector);return l.allowAction(t)?o&&l.fire(t,"ajax:aborted:required",[o])?!n:n?a?l.fire(t,"ajax:aborted:file",[a]):u.support.submitBubbles||!1!==l.callFormSubmitBindings(t)?(l.handleRemote(t),!1):l.stopEverything(e):void setTimeout(function(){l.disableFormElements(t)},13):l.stopEverything(e)}),u(l.formInputClickSelector).live("click.rails",function(e){var t=u(this);if(!l.allowAction(t))return l.stopEverything(e);var n=t.attr("name"),o=n?{name:n,value:t.val()}:null;t.closest("form").data("ujs:submit-button",o)}),u(l.formSubmitSelector).live("ajax:beforeSend.rails",function(e){this==e.target&&l.disableFormElements(u(this))}),u(l.formSubmitSelector).live("ajax:complete.rails",function(e){this==e.target&&l.enableFormElements(u(this))})}(jQuery),$(document).ready(function(){var e="/api/events/autocomplete.json?only_recurring=true&city_id="+window.holiday.city_id;pe.events_autocomplete=new pe.GeneralAutocompleteInputModule($(".Events"),e,"holiday[famous_event_ids][]",window.holiday.famous_events)});