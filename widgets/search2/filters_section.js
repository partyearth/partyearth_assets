pe.CallbackHandler=function(){this.callbacks={}};pe.CallbackHandler.prototype.add=function(a,b){this.callbacks[a]||(this.callbacks[a]=[]);this.callbacks[a].push(b)};pe.CallbackHandler.prototype.call=function(a,b){var c=Array.prototype.slice.call(arguments,1);if(this.callbacks[a])return _.each(this.callbacks[a],function(a){a.apply(null,c)}),!0};
pe.CustomAddressDialog=function(a,b){pe.init_widget(this,a);this.filter=b;this.custom_address_field=this.container.find(".CustomAddress");this.container.dialog({modal:!0,autoOpen:!1,show:!1});a.find("label.Infield").inFieldLabels();this.container.find(".Cancel").click(this.callback(this.close_dialog));this.container.find(".Reset").click(this.callback(function(){this.container.find("form").get(0).reset()}));this.container.find(".Ok").click(this.callback(this.on_ok_button_clicked));pe.bind_global_event(pe.StandardFilter.events.CHANGED,
this.callback(this.change_neighborhood_state))};pe.CustomAddressDialog.events={OK_CLICKED:"CustomAddressDialog_OK_BUTTON_CLICKED"};pe.CustomAddressDialog.prototype.close_dialog=function(){this.container.dialog("close")};pe.CustomAddressDialog.prototype.show_dialog=function(){this.container.dialog("open")};pe.CustomAddressDialog.prototype.custom_address=function(){return this.custom_address_field.val().toString()};
pe.CustomAddressDialog.prototype.change_neighborhood_state=function(a,b,c){a=this.container.find("input[value='"+b+"']");c?a.attr("checked","checked"):a.removeAttr("checked")};pe.CustomAddressDialog.prototype.on_ok_button_clicked=function(){var a=this.selected_neighborhoods();this.filter.reset();_.each(a,this.callback(function(a){this.filter.check(a)}));this.fire_event(pe.CustomAddressDialog.events.OK_CLICKED,this);this.close_dialog()};
pe.CustomAddressDialog.prototype.selected_neighborhoods=function(){return _.map(this.container.find(":checked"),function(a){return $(a).val().toString()})};pe.TabsSection=function(a,b){pe.init_widget(this,a);this.selected_tab="";this.tabs=this.container.find("a[rel]");this.tabs.click(this.callback(this.tab_clicked));this.select_tab(b||"all_results")};pe.TabsSection.events={CHANGED:"TabsSection_CHANGED"};
pe.TabsSection.tabs={ALL_RESULTS:"all_results",THINGS_TO_DO:"things_to_do",BARS_AND_CLUBS:"bars_and_clubs",RESTAURANTS:"restaurants",EVENT_VENUES:"event_venues",EVENTS:"events",ENTERTAINERS:"entertainers",TEAMS:"teams"};pe.TabsSection.venue_tabs={ALL_RESULTS:"all_results",THINGS_TO_DO:"things_to_do",BARS_AND_CLUBS:"bars_and_clubs",RESTAURANTS:"restaurants",EVENT_VENUES:"event_venues"};pe.TabsSection.tab_names=_.uniq(_.values(pe.TabsSection.tabs));
pe.TabsSection.prototype.add_search_configuration=function(a){a.add_filter("category",this.get_selected_tab_name())};pe.TabsSection.prototype.get_selected_tab_name=function(){return this.selected_tab};pe.TabsSection.prototype.read_search_configuration=function(a){this.select_tab(a.filter_value("category")||"all_results")};
pe.TabsSection.prototype.select_tab=function(a){a=(a||"").replace(/-/g,"_");_.contains(pe.TabsSection.tab_names,a)||(a="all_results");this.selected_tab=a;this.tabs.removeClass("selected");this.tabs.filter("[rel="+a+"]").addClass("selected")};pe.TabsSection.prototype.tab_clicked=function(a){a=$(a.currentTarget);a.hasClass("disabled")||(a=a.attr("rel")+"",this.selected_tab!=a&&(this.select_tab(a),pe.fire_global_event(pe.TabsSection.events.CHANGED,a)))};
pe.TabsSection.prototype.update_tab_counters=function(a){this.tabs.addClass("disabled");_.each(pe.TabsSection.tab_names,this.callback(function(b){var c=this.tabs.filter("[rel="+b+"]"),b=a[b]||0;0!==b&&c.removeClass("disabled");c.find(".Counter").html("("+b+")")}))};
pe.StandardFilter=function(a,b,c,d){pe.init_widget(this,a);this.id=b;this.title=d||this.id;this.facets={};this.selection_facets={};this.selected_values=[];this.visible_tabs=c;this.callbacks=new pe.CallbackHandler;this.all_container=a.find(".All");this.all_container.addClass("hidden");setTimeout(this.callback(function(){this.all_container.treeview({collapsed:!0})}),0);this.summary_container=a.find(".Summary");this.more_link=this.container.find(".More");this.more_link.click(this.callback(this.on_more_link_clicked));
this.filter_title_container=this.container.find(".FilterTitle");this.filter_title_container.click(this.callback(this.on_more_link_clicked));this.view_status=pe.StandardFilter.view_statuses.SUMMARY;this.all_inputs().live("change",this.callback(this.on_checkbox_changed));this.summary_inputs().live("change",this.callback(this.on_checkbox_changed));pe.bind_global_event(pe.TabsSection.events.CHANGED,this.callback(this.on_tab_changed))};pe.StandardFilter.SUMMARY_LENGTH=4;
pe.StandardFilter.callbacks={AFTER_CHECKBOX_CHANGED:"standard_filter_after_checkbox_changed",AFTER_UPDATE_SUMMARY:"after_update_summary",BEFORE_UPDATE_SUMMARY:"before_update_summary"};pe.StandardFilter.events={CHANGED:"StandardFilter_CHANGED"};pe.StandardFilter.view_statuses={HIDDEN:1,SUMMARY:2,ALL:3};pe.StandardFilter.prototype.add_search_configuration=function(a){a.filter_value("result_types");!this.is_nothing_checked()&&!this.is_all_checked()&&a.add_filter(this.id,this.filter_values())};
pe.StandardFilter.prototype.filter_values=function(){return _.union(_.map(this.selected_values,function(a){return this.input_value(a)},this))};pe.StandardFilter.prototype.input_value=function(a){var b=[a],a=$("#tag_"+a).parents("ul").parents("li").children(".Input");0<a.length&&(b=b.concat(this.input_value("__parent_tag__"+a.val())));return b};pe.StandardFilter.prototype.all_inputs=function(){return this.all_container.find(".Input")};pe.StandardFilter.prototype.summary_inputs=function(){return this.summary_container.find(".Input")};
pe.StandardFilter.prototype.select=function(a){this.selected_values=_.union(this.selected_values,a)};pe.StandardFilter.prototype.unselect=function(a){this.selected_values=_.without(this.selected_values,a)};pe.StandardFilter.prototype.is_selected=function(a){return _.include(this.selected_values,a)};pe.StandardFilter.prototype.check=function(a){this.select(a);$("#tag_"+a).attr("checked","checked");$("#summary_tag_"+a).attr("checked","checked")};
pe.StandardFilter.prototype.fix_tree_expander=function(){_.each(this.all_container.find("li:not(.Custom,.hidden)"),function(a){var b=$(a).find("li");0!==b.length&&(0===b.filter("li:not(.hidden)").length?$(a).removeClass("collapsable expandable").children(".expandable-hitarea").hide():$(a).hasClass("expandable")||$(a).addClass("expandable").children(".expandable-hitarea").show())})};pe.StandardFilter.prototype.get_filter_field=function(a){return $("#tag_"+a).closest("li")};
pe.StandardFilter.prototype.get_visible_tabs=function(){return this.visible_tabs};pe.StandardFilter.prototype.is_all_checked=function(){return this.all_inputs().length===this.selected_values.length};pe.StandardFilter.prototype.is_any_checked=function(){return 0<this.selected_values.length};pe.StandardFilter.prototype.is_many_items_checked=function(){return 1<this.selected_values.length};pe.StandardFilter.prototype.is_only_one_item_checked=function(){return 1===this.selected_values.length};
pe.StandardFilter.prototype.is_checked=function(a){return _.include(this.selected_values,a)};pe.StandardFilter.prototype.is_nothing_checked=function(){return 0===this.selected_values.length};
pe.StandardFilter.prototype.on_checkbox_changed=function(a){var a=$(a.target).closest(".Input"),b=a.val().toString();this.is_selected(b)?this.uncheck(b):this.check(b);pe.fire_global_event(pe.StandardFilter.events.CHANGED);setTimeout(this.callback(function(){this.update_summary()}),1);this.callbacks.call(pe.StandardFilter.callbacks.AFTER_CHECKBOX_CHANGED,a)};
pe.StandardFilter.prototype.on_dialog_close_button_clicked=function(){this.all_container.dialog("destroy");this.all_container.addClass("hidden");this.view_status=pe.StandardFilter.view_statuses.SUMMARY};
pe.StandardFilter.prototype.on_more_link_clicked=function(){this.all_container.removeClass("hidden");var a=this.all_container.dialog({title:this.title,modal:!0,resizable:!1,buttons:{Close:this.callback(this.on_dialog_close_button_clicked)}});a.parent().css({position:"fixed"}).end();a.find(".Input").unbind("change").bind("change",this.callback(this.on_checkbox_changed));this.view_status=pe.StandardFilter.view_statuses.ALL};
pe.StandardFilter.prototype.on_tab_changed=function(a,b){_.include(this.visible_tabs,b)?this.show():this.hide()};pe.StandardFilter.prototype.read_search_configuration=function(a){this.selected_values=_.compact(_.union([],a.filter_value(this.id)));this.selected_values=_.reject(this.selected_values,function(a){return a.match(/^__parent_tag__/g)});_.each(this.selected_values,function(a){this.check(a)},this);this.update_summary()};pe.StandardFilter.prototype.replace_filter_field=function(a,b){this.get_filter_field(a).html(b)};
pe.StandardFilter.prototype.reset=function(){_.each(this.selected_values,function(a){this.uncheck(a)},this);setTimeout(this.callback(function(){this.update_summary()}),1)};pe.StandardFilter.prototype.uncheck=function(a){this.unselect(a);$("#tag_"+a).removeAttr("checked");$("#summary_tag_"+a).removeAttr("checked")};
pe.StandardFilter.prototype.update_more_button=function(){var a=this.all_container.find(".Top:not(.hidden)");a.length>pe.StandardFilter.SUMMARY_LENGTH||0<a.find(".Child").length?(this.more_link.removeClass("hidden"),this.filter_title_container.removeClass("no_hover"),this.filter_title_container.click(this.callback(this.on_more_link_clicked))):(this.more_link.addClass("hidden"),this.filter_title_container.addClass("no_hover").unbind("click"))};
pe.StandardFilter.prototype.update_ui=function(){0<this.all_container.find(">.Top:not(.hidden)").length?(this.fix_tree_expander(),this.update_summary()):this.hide()};pe.StandardFilter.prototype.free_summary_slots=function(){return pe.StandardFilter.SUMMARY_LENGTH-this.summary_container.children("li").length};
pe.StandardFilter.prototype.update_summary=function(){this.summary_container.empty();this.callbacks.call(pe.StandardFilter.callbacks.BEFORE_UPDATE_SUMMARY);var a=_.first(this.selected_values,this.free_summary_slots());this.add_tags_to_summary(a);var b=this.free_summary_slots();if(0<b)for(var a=_.map(_.difference(this.top_tags(),a),function(a){return $("#tag_"+a)}),c=0;0<b&&c<a.length;c++){var d=a[c].parent().filter("li.Top:not(.Custom)");0<d.length&&(this.add_items_to_summary(d.clone()),b--)}this.update_more_button();
this.callbacks.call(pe.StandardFilter.callbacks.AFTER_UPDATE_SUMMARY)};pe.StandardFilter.prototype.top_tags=function(){var a=_.sortBy(_.values(this.selection_facets),function(a){return 1E4-a},this),a=_.compact(_.union(_.map(a,function(a){return _.map(this.selection_facets,function(b,e){if(b==a)return e})},this))),b=_.difference(_.keys(this.facets),a);return _.union(a,b)};
pe.StandardFilter.prototype.set_facets=function(a){this.facets=a;this.all_container.find("li:not(.Custom)").addClass("hidden");_.each(_.keys(this.facets),function(a){this.get_filter_field(a).removeClass("hidden")},this);_.each(this.selected_values,function(a){this.get_filter_field(a).removeClass("hidden")},this)};pe.StandardFilter.prototype.set_selection_facets=function(a){this.selection_facets=a;setTimeout(this.callback(function(){this.update_ui()}),1)};
pe.StandardFilter.prototype.add_tags_to_summary=function(a){_.each(a,function(a){a=$("#tag_"+a).parent("li").clone();a.hasClass("Custom")||this.summary_container.append(this.convert_to_summary_item(a,!0))},this)};pe.StandardFilter.prototype.add_items_to_summary=function(a){_.each(a,function(a){this.summary_container.append(this.convert_to_summary_item($(a),!0))},this)};
pe.StandardFilter.prototype.convert_to_summary_item=function(a,b){var c=a.find(".Input"),d="summary_"+c.attr("id");c.attr("id",d);a.find("label").attr("for",d);b&&a.find("ul").remove();return a};
pe.WhatFilter=function(a,b){pe.init_widget(this,a);this.standard_filter=new pe.StandardFilter(a,"what",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENT_VENUES,pe.TabsSection.tabs.EVENTS]);this.id=this.standard_filter.id;this.update_filters_fields_for_tab(b);pe.bind_global_event(pe.TabsSection.events.CHANGED,this.callback(this.on_tab_changed));this.standard_filter.callbacks.add("after_update_summary",
this.callback(function(){0===this.standard_filter.all_inputs().length&&this.hide()}))};pe.WhatFilter.prototype.add_search_configuration=function(a){this.update_filters_fields_for_tab(a.filter_value("result_types"));this.standard_filter.add_search_configuration(a)};pe.WhatFilter.prototype.get_all_filter_fields=function(){return this.standard_filter.all_container.find("li")};
pe.WhatFilter.prototype.get_filter_fields_with_parent_category=function(a){return this.standard_filter.all_container.find(".Input[data-parent-category='"+a+"']:not(:checked)").closest("li")};pe.WhatFilter.prototype.get_visible_tabs=function(){return this.standard_filter.get_visible_tabs()};pe.WhatFilter.prototype.is_nothing_checked=function(){return this.standard_filter.is_nothing_checked()};pe.WhatFilter.prototype.on_tab_changed=function(a,b){this.update_filters_fields_for_tab(b)};
pe.WhatFilter.prototype.read_search_configuration=function(a){this.standard_filter.read_search_configuration(a)};pe.WhatFilter.prototype.reset=function(){this.standard_filter.reset()};pe.WhatFilter.prototype.set_facets=function(a){this.standard_filter.set_facets(a)};pe.WhatFilter.prototype.set_selection_facets=function(a){this.standard_filter.set_selection_facets(a)};
pe.WhatFilter.prototype.update_filters_fields_for_tab=function(a){switch(a){case "events":a=["venue-type","performer-type"];break;case "performers":a=["event-type","venue-type"];break;case "venues":a=["event-type","performer-type"];break;default:a=[]}this.get_all_filter_fields().show();$.each(a,this.callback(function(a,c){this.get_filter_fields_with_parent_category(c).hide()}))};
pe.WhenFilter=function(a,b){pe.init_widget(this,a);this.standard_filter=new pe.StandardFilter(a,"when",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENTS,pe.TabsSection.tabs.ENTERTAINERS,pe.TabsSection.tabs.TEAMS]);this.standard_filter.callbacks.add(pe.StandardFilter.callbacks.AFTER_CHECKBOX_CHANGED,this.callback(this.after_checkbox_changed));this.standard_filter.update_summary=this.callback(this.update_summary);
this.start_date_input=this.standard_filter.container.find(".StartDate");this.end_date_input=this.standard_filter.container.find(".EndDate");var c=this.callback(this.calendar_selected),d=this.standard_filter.summary_container.find(".StartDate").datepicker({onSelect:c}),e=this.standard_filter.summary_container.find(".EndDate").datepicker({onSelect:c}),f=this.standard_filter.all_container.find(".StartDate").datepicker({onSelect:c}),c=this.standard_filter.all_container.find(".EndDate").datepicker({onSelect:c});
this.configure_date_picker(e,"minDate",d.val());this.configure_date_picker(d,"maxDate",e.val());this.configure_date_picker(c,"minDate",f.val());this.configure_date_picker(f,"maxDate",c.val());this.update_filter_fields_for_tab(b);pe.bind_global_event(pe.TabsSection.events.CHANGED,this.callback(this.on_tab_changed))};
pe.WhenFilter.prototype.add_search_configuration=function(a){this.standard_filter.add_search_configuration(a);var b=a.filter_value("when");pe.array_contains(b,"custom-date")&&(a.add_filter("start_date",this.start_date_input.val()),a.add_filter("end_date",this.end_date_input.val()))};
pe.WhenFilter.prototype.after_checkbox_changed=function(a){"custom-date"===a.val()&&(a.is(":checked")?(a.closest(".Section").hasClass("All")?this.standard_filter.all_container.find(".StartDate").datepicker("show"):this.standard_filter.summary_container.find(".StartDate").datepicker("show"),this.standard_filter.check("custom-date")):this.standard_filter.uncheck("custom-date"))};
pe.WhenFilter.prototype.calendar_selected=function(a,b){var c=$(b.input).closest(".Top").find(".StartDate"),d=$(b.input).closest(".Top").find(".EndDate");b.input.hasClass("StartDate")&&""===d.val()&&d.val(a);$(b.input).closest(".Section").hasClass("Summary")?(this.standard_filter.all_container.find(".StartDate").val(c.val().toString()),this.standard_filter.all_container.find(".EndDate").val(d.val().toString())):(this.standard_filter.summary_container.find(".StartDate").val(c.val().toString()),this.standard_filter.summary_container.find(".EndDate").val(d.val().toString()));
this.standard_filter.check("custom-date");pe.fire_global_event(pe.StandardFilter.events.CHANGED)};pe.WhenFilter.prototype.configure_date_picker=function(a,b,c){c&&(c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,c),a.datepicker("option",b,c))};pe.WhenFilter.prototype.is_nothing_checked=function(){return this.standard_filter.is_nothing_checked()};pe.WhenFilter.prototype.on_tab_changed=function(a,b){this.update_filter_fields_for_tab(b)};pe.WhenFilter.prototype.set_end_date=function(a){this.end_date_input.val(a)};
pe.WhenFilter.prototype.set_start_date=function(a){this.start_date_input.val(a)};pe.WhenFilter.prototype.read_search_configuration=function(a){var b=a.filter_value("when"),c=a.filter_value("start_date"),a=a.filter_value("end_date");_.isEmpty(b)||(!_.isEmpty(c)&&!_.isEmpty(a)&&(this.set_start_date(c),this.set_end_date(a)),this.standard_filter.check(b));this.standard_filter.update_summary()};pe.WhenFilter.prototype.reset=function(){this.standard_filter.reset()};
pe.WhenFilter.prototype.update_filter_fields_for_tab=function(a){var b=$([this.standard_filter.get_filter_field("dayspot")[0],this.standard_filter.get_filter_field("nightspot")[0],this.standard_filter.get_filter_field("summerspot")[0]]);_.include(["all","venues"],a)?b.removeClass("hidden"):b.addClass("hidden")};
pe.WhenFilter.prototype.update_summary=function(){for(var a=_.difference(_.first(this.standard_filter.selected_values,3),["custom-date"]),b=_.difference(["today","tomorrow","weekend"],a),c=this.standard_filter.summary_inputs(),d=null,e=0;e<a.length;e++)d=this.standard_filter.get_filter_field(a[e]).clone(),$(c[e]).closest("li").replaceWith(this.standard_filter.convert_to_summary_item(d));for(e=0;e<3-a.length;e++)d=this.standard_filter.get_filter_field(b[e]).clone(),$(c[a.length+e]).closest("li").replaceWith(this.standard_filter.convert_to_summary_item(d))};
pe.WhenFilter2=function(a,b){pe.init_widget(this,a);this.standard_filter=new pe.StandardFilter(a,"when",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENT_VENUES,pe.TabsSection.tabs.EVENTS,pe.TabsSection.tabs.ENTERTAINERS,pe.TabsSection.tabs.TEAMS]);this.standard_filter.callbacks.add(pe.StandardFilter.callbacks.AFTER_CHECKBOX_CHANGED,this.callback(this.after_checkbox_changed));this.standard_filter.update_summary=
this.callback(this.update_summary);this.datepicker_block=this.standard_filter.summary_container.find(".DatepickerBlock");this.datepicker_apply=this.datepicker_block.find(".Apply");this.datepicker_apply.click(this.callback(this.datepicker_apply_clicked));this.datepicker_cancel=this.datepicker_block.find(".Cancel");this.datepicker_cancel.click(this.callback(this.datepicker_cancel_clicked));this.datepicker_clear=this.datepicker_block.find(".Clear");this.datepicker_clear.click(this.callback(this.datepicker_clear_clicked));
this.datepicker_container=this.datepicker_block.find(".Datepicker");this.datepicker_notice=this.datepicker_block.find(".Notice");this.datepicker_initialized=!1;this.custom_label=this.standard_filter.container.find(".CustomLabel");this.custom_label.click(this.callback(this.custom_label_clicked));this.start_date_input=this.standard_filter.container.find(".StartDate");this.end_date_input=this.standard_filter.container.find(".EndDate");this.update_filter_fields_for_tab(b);pe.bind_global_event(pe.TabsSection.events.CHANGED,
this.callback(this.on_tab_changed))};pe.WhenFilter2.CUSTOM_LABEL_DEFAULT_HTML="Enter Dates";pe.WhenFilter2.prototype.add_search_configuration=function(a){this.standard_filter.add_search_configuration(a);var b=a.filter_value("when");pe.array_contains(b,"custom-date")&&(a.add_filter("start_date",this.start_date_input.val()),a.add_filter("end_date",this.end_date_input.val()))};
pe.WhenFilter2.prototype.after_checkbox_changed=function(a){"custom-date"===a.val()&&(a.is(":checked")?(this.start_date_input.val()||this.custom_label_clicked(),this.standard_filter.check("custom-date")):this.standard_filter.uncheck("custom-date"))};pe.WhenFilter2.prototype.configure_date_picker=function(a,b,c){c&&(c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,c),a.datepicker("option",b,c))};
pe.WhenFilter2.prototype.datepicker_apply_clicked=function(){var a=this.datepicker_container.DatePickerGetDate(!0);a.length?(this.start_date_input.val(a[0]),this.end_date_input.val(a[1]),this.standard_filter.check("custom-date")):(this.custom_label.html(pe.WhenFilter2.CUSTOM_LABEL_DEFAULT_HTML),this.standard_filter.uncheck("custom-date"));pe.fire_global_event(pe.StandardFilter.events.CHANGED);this.hide_datepicker_block()};
pe.WhenFilter2.prototype.datepicker_cancel_clicked=function(){var a=this.start_date_input.val(),b=this.end_date_input.val();a?(this.datepicker_container.DatePickerSetDate([a,b]),this.set_custom_labels([a,b])):(this.datepicker_container.DatePickerClear(),this.set_custom_labels([]));this.hide_datepicker_block()};pe.WhenFilter2.prototype.datepicker_clear_clicked=function(){this.datepicker_container.DatePickerClear();this.set_custom_labels([])};
pe.WhenFilter2.prototype.init_datepicker=function(){var a=this.callback(this.set_custom_labels),b=[this.start_date_input.val(),this.end_date_input.val()],c=new Date;this.datepicker_container.DatePicker({flat:!0,format:"m/d/Y",current:c.getMonth()+2+"/"+c.getDate()+"/"+c.getFullYear(),date:b,calendars:2,mode:"range",starts:1,onChange:function(b){a(b)}});this.datepicker_initialized=!0};pe.WhenFilter2.prototype.is_nothing_checked=function(){return this.standard_filter.is_nothing_checked()};
pe.WhenFilter2.prototype.custom_label_clicked=function(){this.datepicker_block.toggle();this.datepicker_initialized||this.init_datepicker();this.container.find(".Custom").toggleClass("datepicker_opened")};pe.WhenFilter2.prototype.hide_datepicker_block=function(){this.datepicker_block.hide();this.container.find(".Custom").removeClass("datepicker_opened")};pe.WhenFilter2.prototype.on_tab_changed=function(a,b){this.update_filter_fields_for_tab(b)};
pe.WhenFilter2.prototype.set_custom_labels=function(a){var b=a[0],c=a[1];b?b===c?a="Select second date or apply.":(a="Select new dates or apply.",b=b+" - "+c):(a="Select first date.",b=pe.WhenFilter2.CUSTOM_LABEL_DEFAULT_HTML);this.datepicker_notice.html(a);this.custom_label.html(b)};pe.WhenFilter2.prototype.set_end_date=function(a){this.end_date_input.val(a)};pe.WhenFilter2.prototype.set_start_date=function(a){this.start_date_input.val(a)};
pe.WhenFilter2.prototype.read_search_configuration=function(a){var b=a.filter_value("when"),c=a.filter_value("start_date"),a=a.filter_value("end_date");_.isEmpty(b)||(!_.isEmpty(c)&&!_.isEmpty(a)&&(this.set_custom_labels([c,a]),this.set_start_date(c),this.set_end_date(a)),this.standard_filter.check(b));this.standard_filter.update_summary()};pe.WhenFilter2.prototype.reset=function(){this.standard_filter.reset()};
pe.WhenFilter2.prototype.update_filter_fields_for_tab=function(a){var b=$([this.standard_filter.get_filter_field("dayspot")[0],this.standard_filter.get_filter_field("nightspot")[0],this.standard_filter.get_filter_field("summerspot")[0]]);_.include(_.values(pe.TabsSection.venue_tabs),a)?b.removeClass("hidden"):b.addClass("hidden")};
pe.WhenFilter2.prototype.update_summary=function(){for(var a=_.difference(_.first(this.standard_filter.selected_values,3),["custom-date"]),b=_.difference(["today","tomorrow","weekend"],a),c=this.standard_filter.summary_inputs(),d=null,e=0;e<a.length;e++)d=this.standard_filter.get_filter_field(a[e]).clone(),$(c[e]).closest("li").replaceWith(this.standard_filter.convert_to_summary_item(d));for(e=0;e<3-a.length;e++)d=this.standard_filter.get_filter_field(b[e]).clone(),$(c[a.length+e]).closest("li").replaceWith(this.standard_filter.convert_to_summary_item(d))};
pe.GeocodeErrorDialog=function(a){pe.init_widget(this,null);this.container=$(this.html(a));this.container.appendTo("body");this.container.dialog({title:"Geo system error",modal:!0,resizable:!1,width:300,buttons:{Ok:function(){$(this).remove()}}})};pe.GeocodeErrorDialog.prototype.html=function(a){return"<div>The geocoder returned the error '"+a+"'. Please try again later.</div>"};
pe.GeocodeNoResultsDialog=function(){pe.init_widget(this,null);this.container=$(this.html());this.container.appendTo("body");this.container.dialog({title:"We were unable to find the address you entered.",modal:!0,resizable:!1,width:300,buttons:{Ok:function(){$(this).remove()}}})};pe.GeocodeNoResultsDialog.prototype.html=function(){return"<div>Please try again.</div>"};
pe.MultipleLocationResultsDialog=function(a,b){pe.init_widget(this,null);this.success_callback=b;this.results=a;this.dialog_div=$(this.html(a));this.dialog_div.appendTo("body");this.dialog_div.click(this.callback(this.result_clicked));this.dialog_div.dialog({width:350,modal:!0,title:'The search returned <span class="blue_text">'+this.results.length+" results</span>. Please click on your choice.",resizable:!1,buttons:{Cancel:function(){$(this).remove()}}})};
pe.MultipleLocationResultsDialog.prototype.html=function(a){var b='<div class="ContentContainer">';$.each(a,function(a,d){b+='<div class="Choice" data_position="'+a+'">'+d.formatted_address+"</div>"});return b+="</div>"};pe.MultipleLocationResultsDialog.prototype.result_clicked=function(a){a=$(a.target).closest(".Choice").attr("data_position");this.dialog_div.remove();this.success_callback(this.results[a])};
pe.WhereFilter=function(a,b){pe.init_widget(this,a);this.map=b;this.custom_location=null;this.standard_filter=new pe.StandardFilter(a,"where",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENT_VENUES,pe.TabsSection.tabs.EVENTS,pe.TabsSection.tabs.ENTERTAINERS,pe.TabsSection.tabs.TEAMS]);this.fake_input=this.standard_filter.all_container.find(".FakeInput");this.fake_input.change(this.callback(this.custom_checkbox_changed));
this.custom_location_label=this.standard_filter.container.find(".CustomLocationLabel");this.custom_location_label.html(pe.WhereFilter.DEFAULT_LOCATION_LABEL);this.custom_location_label.bind("click",this.callback(this.custom_label_clicked));this.custom_location_results=[];this.location_popup=$(".LocationPopup");this.location_popup.find(".Cancel").click(this.callback(this.popup_cancel_clicked));this.location_popup.find(".Close").click(this.callback(this.popup_cancel_clicked));this.location_popup.find(".Done").click(this.callback(this.popup_done_clicked));
this.location_popup.find(".CustomLocationInput").keypress(this.callback(this.popup_key_pressed));this.standard_filter.callbacks.add("before_update_summary",this.callback(function(){this.standard_filter.summary_container.append(this.standard_filter.convert_to_summary_item($(this.standard_filter.all_container.find("li.Custom")[0]).clone(!0)))}));pe.bind_global_event(pe.MapSection.events.PINS_UPDATED,this.callback(this.on_map_pins_updated));this.location_popup.click(this.callback(this.popup_clicked));
$(document).click(this.callback(this.popup_cancel_clicked))};pe.WhereFilter.DEFAULT_LOCATION_LABEL="Enter Your Location";pe.WhereFilter.DEFAULT_TRUNCATION_LIMIT=25;pe.WhereFilter.POPUP_OFFSET_LEFT=0;pe.WhereFilter.POPUP_OFFSET_TOP=20;
pe.WhereFilter.events={CUSTOM_LABEL_CHANGED:"WhereFilter_custom_location_label_changed",EMPTY_SELECTION_TRIGGERED:"WhereFilter_empty_selection_triggered",MULTIPLE_SELECTION_TRIGGERED:"WhereFilter_multiple_selection_triggered",CUSTOM_SELECTION_TRIGGERED:"WhereFilter_custom_selection_triggered",SINGLE_SELECTION_TRIGGERED:"WhereFilter_single_selection_triggered"};
pe.WhereFilter.prototype.add_search_configuration=function(a){this.standard_filter.add_search_configuration(a);pe.array_contains(a.filter_value("where"),"custom-address")&&this.custom_location&&(a.add_filter("lat",this.custom_location.latitude),a.add_filter("lng",this.custom_location.longitude),a.add_filter("address",this.custom_location.address))};pe.WhereFilter.prototype.clear_results_list=function(){this.location_popup.find(".Title").empty();this.location_popup.find(".Results").empty()};
pe.WhereFilter.prototype.custom_checkbox_changed=function(a){var a=$(a.target),b=this.checkbox_is_checked(a);this.toggle_fake_inputs(b);this.custom_location?(b?this.standard_filter.check("custom-address"):this.standard_filter.uncheck("custom-address"),pe.fire_global_event(pe.StandardFilter.events.CHANGED)):b?this.show_location_popup(a):(this.location_popup.hide(),this.clear_results_list())};pe.WhereFilter.prototype.checkbox_is_checked=function(a){return a.is(":checked")};
pe.WhereFilter.prototype.custom_label_clicked=function(a){this.show_location_popup($(a.target).siblings(".FakeInput"));return!1};
pe.WhereFilter.prototype.custom_saved=function(a){""===$.trim(a)?(this.custom_location=null,this.standard_filter.uncheck("custom-address"),this.fake_input.attr("checked",!1),this.location_popup.hide(),this.update_custom_label(pe.WhereFilter.DEFAULT_LOCATION_LABEL)):(this.update_custom_label(a),(new google.maps.Geocoder).geocode({address:a,bounds:this.map.map.getBounds()},this.callback(this.geocode_success)))};
pe.WhereFilter.prototype.geocode_success=function(a,b){this.custom_location_results=a;switch(b){case google.maps.GeocoderStatus.OK:if(1===a.length)this.on_custom_location_selected(a[0]);else this.show_multiple_location_results();break;case google.maps.GeocoderStatus.ZERO_RESULTS:this.show_geocode_error();this.revert_custom_address();break;default:this.show_geocode_error(b),this.revert_custom_address()}};pe.WhereFilter.prototype.get_visible_tabs=function(){return this.standard_filter.get_visible_tabs()};
pe.WhereFilter.prototype.is_nothing_checked=function(){return this.standard_filter.is_nothing_checked()};pe.WhereFilter.prototype.multiple_location_results_list_html=function(){var a="";$.each(this.custom_location_results,function(b,c){a+='<div class="Item" data_position="'+b+'">'+c.formatted_address+"</div>"});return a};pe.WhereFilter.prototype.multiple_location_results_title_html=function(a){return'The search returned <span class="blue_text">'+a+" results</span>. Please click on your choice."};
pe.WhereFilter.prototype.on_state_changed=function(){this.standard_filter.is_nothing_checked()?pe.fire_global_event(pe.WhereFilter.events.EMPTY_SELECTION_TRIGGERED):this.standard_filter.is_many_items_checked()?pe.fire_global_event(pe.WhereFilter.events.MULTIPLE_SELECTION_TRIGGERED):this.standard_filter.is_checked("custom")?pe.fire_global_event(pe.WhereFilter.events.CUSTOM_SELECTION_TRIGGERED):pe.fire_global_event(pe.WhereFilter.events.SINGLE_SELECTION_TRIGGERED);pe.fire_global_event(pe.StandardFilter.events.CHANGED)};
pe.WhereFilter.prototype.on_map_pins_updated=function(){this.custom_location&&this.standard_filter.is_checked("custom-address")&&this.update_custom_location_pin()};pe.WhereFilter.prototype.on_tab_changed=function(a,b){this.standard_filter.on_tab_changed(a,b)};
pe.WhereFilter.prototype.on_custom_location_selected=function(a){this.location_popup.find(".ErrorMessage").empty();this.location_popup.hide();this.map.map.fitBounds(a.geometry.viewport);this.custom_location={latitude:a.geometry.location.lat(),longitude:a.geometry.location.lng(),address:a.formatted_address};this.update_custom_location_pin();this.update_custom_label(a.formatted_address);this.standard_filter.check("custom-address");this.toggle_fake_inputs(!0);this.on_state_changed()};
pe.WhereFilter.prototype.popup_clicked=function(a){a.stopPropagation()};pe.WhereFilter.prototype.toggle_fake_inputs=function(a){$(".FakeInput").attr("checked",a)};pe.WhereFilter.prototype.read_search_configuration=function(a){var b=a.filter_value("where"),c=a.filter_value("address");_.isEmpty(b)||this.standard_filter.read_search_configuration(a);_.isEmpty(c)||this.custom_saved(c)};pe.WhereFilter.prototype.reset=function(){this.custom_location=null;this.revert_custom_address();this.standard_filter.reset()};
pe.WhereFilter.prototype.popup_cancel_clicked=function(a){a=$(a.target).hasClass("FakeInput");this.location_popup.is(":visible")&&!a&&(this.location_popup.hide(),this.revert_custom_address())};pe.WhereFilter.prototype.popup_done_clicked=function(){this.custom_saved(this.location_popup.find(".CustomLocationInput").val())};pe.WhereFilter.prototype.popup_key_pressed=function(a){13===a.which&&this.popup_done_clicked()};
pe.WhereFilter.prototype.popup_result_clicked=function(a){this.on_custom_location_selected(this.custom_location_results[$(a.target).closest(".Item").attr("data_position")]);this.clear_results_list();this.location_popup.hide()};
pe.WhereFilter.prototype.revert_custom_address=function(){var a=this.custom_location?this.custom_location.address:pe.WhereFilter.DEFAULT_LOCATION_LABEL;this.update_custom_label(a);a===pe.WhereFilter.DEFAULT_LOCATION_LABEL&&(this.custom_location=null,this.standard_filter.uncheck("custom-address"),this.toggle_fake_inputs(!1))};pe.WhereFilter.prototype.set_facets=function(a){this.standard_filter.set_facets(a)};pe.WhereFilter.prototype.set_selection_facets=function(a){this.standard_filter.set_selection_facets(a)};
pe.WhereFilter.prototype.show_geocode_error=function(a){this.clear_results_list();a=a?"<div>The geocoder returned the error '"+a+"'. Please try again later.</div>":"Can't find that location. Please try again.";this.location_popup.find(".CustomLocationInput").focus();this.location_popup.find(".ErrorMessage").html(a)};
pe.WhereFilter.prototype.show_location_popup=function(a){a=a.position();this.location_popup.position({left:a.left+pe.WhereFilter.POPUP_OFFSET_LEFT,top:a.top+pe.WhereFilter.POPUP_OFFSET_TOP});this.location_popup.show();this.location_popup.find("input").focus()};
pe.WhereFilter.prototype.show_multiple_location_results=function(){this.location_popup.find(".ErrorMessage").empty();var a=this.location_popup.find(".ResultsList"),b=a.find(".Results");a.find(".Title").html(this.multiple_location_results_title_html(this.custom_location_results.length));a=this.multiple_location_results_list_html();b.html(a);b.click(this.callback(this.popup_result_clicked))};
pe.WhereFilter.prototype.update_custom_label=function(a){var b=this.standard_filter.all_container.find(".CustomLocationLabel"),c=pe.truncate_by_words(a,pe.WhereFilter.DEFAULT_TRUNCATION_LIMIT);this.standard_filter.all_container.find(".LongLabel").remove();this.custom_location_label.html(c);c===a?b.removeClass("short_label"):(b.addClass("short_label"),b.after('<label class="LongLabel long_label small_text">'+a+"</label>"),this.standard_filter.all_container.find(".LongLabel").click(this.callback(this.custom_label_clicked)))};
pe.WhereFilter.prototype.update_custom_location_pin=function(){this.map.add_marker({type:pe.Map2.marker_types.USER_LOCATION,latitude:this.custom_location.latitude,longitude:this.custom_location.longitude,icon:pe.Map2.icon_path(pe.Map2.marker_types.USER_LOCATION,""),bubble_html:'<div class="tooltip_content venue"><div class="point_wrapper"><div class="point"></div><div class="inner_point"></div></div><p class="result_name">Your location: </p><p class="result_types">'+this.custom_location.address+"</p></div>"})};
pe.WhereFilterOld=function(a,b){pe.init_widget(this,a);this.map=b;this.custom_location=null;this.standard_filter=new pe.StandardFilter(a,"where",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENTS,pe.TabsSection.tabs.ENTERTAINERS,pe.TabsSection.tabs.TEAMS]);this.standard_filter.callbacks.add("after_update_summary",this.callback(this.after_update_summary));this.standard_filter.callbacks.add(pe.StandardFilter.callbacks.AFTER_CHECKBOX_CHANGED,
this.callback(this.after_checkbox_changed));this.standard_filter.all_container.prepend('<li class="Custom"><input class="Input" type="checkbox" value="custom"> <span class="WhereCustomButton editable_textarea small_text inline_block"></span></li>');this.standard_filter.callbacks.add("before_update_summary",this.callback(function(){var a=this.standard_filter.all_container.find("li.Custom").clone(!0);_.each(a,function(a){this.standard_filter.summary_container.append(this.standard_filter.convert_to_summary_item($(a),
!0))},this)}));this.standard_filter.update_summary();pe.bind_global_event(pe.MapSection.events.PINS_UPDATED,this.callback(this.on_map_pins_updated))};pe.WhereFilterOld.events={EMPTY_SELECTION_TRIGGERED:"WhereFilter_empty_selection_triggered",MULTIPLE_SELECTION_TRIGGERED:"WhereFilter_multiple_selection_triggered",CUSTOM_SELECTION_TRIGGERED:"WhereFilter_custom_selection_triggered",SINGLE_SELECTION_TRIGGERED:"WhereFilter_single_selection_triggered"};
pe.WhereFilterOld.prototype.add_search_configuration=function(a){this.standard_filter.add_search_configuration(a);pe.array_contains(a.filter_value("where"),"custom")&&this.custom_location&&(a.add_filter("lat",this.custom_location.latitude),a.add_filter("lng",this.custom_location.longitude),a.add_filter("address",this.custom_location.address))};pe.WhereFilterOld.prototype.after_update_summary=function(){this.make_editable_input(this.standard_filter.container.find(".WhereCustomButton"))};
pe.WhereFilterOld.prototype.make_editable_input=function(a){a.editable("destroy");a.editable(this.callback(this.custom_saved),{tooltip:"Enter a location or address (e.g. 123 Electric Avenue)",data:" ",submit:"OK",cancel:"Cancel",placeholder:"Enter Location"})};
pe.WhereFilterOld.prototype.custom_saved=function(a){this.standard_filter.view_status===pe.StandardFilter.view_statuses.SUMMARY?this.standard_filter.all_container.find(".WhereCustomButton").html(a):this.standard_filter.view_status===pe.StandardFilter.view_statuses.ALL&&this.standard_filter.summary_container.find(".WhereCustomButton").html(a);if(""===$.trim(a))return this.custom_location=null,this.standard_filter.uncheck("custom"),pe.fire_global_event(pe.StandardFilter.events.CHANGED),"";if(a&&""!==
a)return(new google.maps.Geocoder).geocode({address:a,bounds:this.map.map.getBounds()},this.callback(this.geocode_success)),a};pe.WhereFilterOld.prototype.geocode_success=function(a,b){if(b===google.maps.GeocoderStatus.ZERO_RESULTS)new pe.GeocodeNoResultsDialog,this.revert_custom_address();else if(b!==google.maps.GeocoderStatus.OK)new pe.GeocodeErrorDialog(b),this.revert_custom_address();else if(1===a.length)this.on_custom_location_selected(a[0]);else new pe.MultipleLocationResultsDialog(a,this.callback(this.on_custom_location_selected))};
pe.WhereFilterOld.prototype.after_checkbox_changed=function(a){var b=a.closest(".Top");b.find(".WhereCustomButton");b=$.trim(b.text());if("custom"===a.val()&&a.is(":checked")&&"custom address"===b)this.standard_filter.container.find(".WhereCustomButton").trigger("click.editable");else this.on_state_changed()};pe.WhereFilterOld.prototype.is_nothing_checked=function(){return this.standard_filter.is_nothing_checked()};
pe.WhereFilterOld.prototype.on_state_changed=function(){this.standard_filter.is_nothing_checked()?pe.fire_global_event(pe.WhereFilterOld.events.EMPTY_SELECTION_TRIGGERED):this.standard_filter.is_many_items_checked()?pe.fire_global_event(pe.WhereFilterOld.events.MULTIPLE_SELECTION_TRIGGERED):this.standard_filter.is_checked("custom")?pe.fire_global_event(pe.WhereFilterOld.events.CUSTOM_SELECTION_TRIGGERED):pe.fire_global_event(pe.WhereFilterOld.events.SINGLE_SELECTION_TRIGGERED);pe.fire_global_event(pe.StandardFilter.events.CHANGED)};
pe.WhereFilterOld.prototype.on_map_pins_updated=function(){this.custom_location&&this.standard_filter.is_checked("custom")&&this.update_custom_location_pin()};pe.WhereFilterOld.prototype.on_tab_changed=function(a,b){this.standard_filter.on_tab_changed(a,b)};
pe.WhereFilterOld.prototype.on_custom_location_selected=function(a){this.map.map.fitBounds(a.geometry.viewport);this.custom_location={latitude:a.geometry.location.lat(),longitude:a.geometry.location.lng(),address:a.formatted_address};this.update_custom_location_pin();this.standard_filter.all_container.find(".WhereCustomButton").html(a.formatted_address);this.standard_filter.check("custom");this.on_state_changed()};
pe.WhereFilterOld.prototype.read_search_configuration=function(a){var b=a.filter_value("where"),c=a.filter_value("address");_.isEmpty(b)||this.standard_filter.read_search_configuration(a);_.isEmpty(c)||this.custom_saved(c)};pe.WhereFilterOld.prototype.reset=function(){this.standard_filter.reset()};
pe.WhereFilterOld.prototype.revert_custom_address=function(){var a=this.custom_location?this.custom_location.address:"Enter Location";this.standard_filter.all_container.find(".WhereCustomButton").html(a);this.standard_filter.summary_container.find(".WhereCustomButton").html(a);"Enter Location"===a?(this.custom_location=null,this.standard_filter.uncheck("custom")):pe.fire_global_event(pe.StandardFilter.events.CHANGED)};pe.WhereFilterOld.prototype.set_facets=function(a){this.standard_filter.set_facets(a)};
pe.WhereFilterOld.prototype.update_custom_location_pin=function(){this.map.add_marker({type:pe.Map2.marker_types.USER_LOCATION,latitude:this.custom_location.latitude,longitude:this.custom_location.longitude,icon:pe.Map2.icon_path(pe.Map2.marker_types.USER_LOCATION,""),bubble_html:'<div class="bubble_text"><span class="bubble_headline">Your location: </span><br><span class="bubble_type">'+this.custom_location.address+"</span></div>"})};
pe.PersonalitiesFilter=function(a){pe.init_widget(this,a);this.standard_filter=new pe.StandardFilter(a,"personality",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS]);this.standard_filter.update_summary=function(){};a.find(".WhoAreTheyLink").click(this.callback(this.on_who_are_they_link_clicked));this.who_are_they_dialog_container=a.find(".WhoAreTheyDialog");pe.bind_global_event(pe.TabsSection.events.CHANGED,this.callback(this.on_tab_changed))};
pe.PersonalitiesFilter.prototype.add_search_configuration=function(a){this.standard_filter.add_search_configuration(a)};pe.PersonalitiesFilter.prototype.is_nothing_checked=function(){return this.standard_filter.is_nothing_checked()};pe.PersonalitiesFilter.prototype.on_tab_changed=function(a,b){this.standard_filter.on_tab_changed(a,b)};pe.PersonalitiesFilter.prototype.on_who_are_they_close_button_clicked=function(){this.who_are_they_dialog_container.dialog("destroy");this.who_are_they_dialog_container.addClass("hidden")};
pe.PersonalitiesFilter.prototype.on_who_are_they_link_clicked=function(){this.who_are_they_dialog_container.removeClass("hidden");this.who_are_they_dialog_container.dialog({title:"PE Reviewers",modal:!0,resizable:!1,buttons:{Close:this.callback(this.on_who_are_they_close_button_clicked)}})};pe.PersonalitiesFilter.prototype.read_search_configuration=function(a){this.standard_filter.read_search_configuration(a)};pe.PersonalitiesFilter.prototype.reset=function(){this.standard_filter.reset()};
pe.FiltersSection=function(a,b,c,d){pe.init_widget(this,a);this.city_id=b;this.callbacks=new pe.CallbackHandler;this.filters={};this.filters_div=a.find(".Filters");this.map_section=c;this.selection_facets={};this.tab_section=d;pe.bind_global_event(pe.TabsSection.events.CHANGED,this.callback(this.load_facets));this.show_hide_link=a.find(".ShowHide");this.show_hide_link.addClass("closed");this.show_hide_link.click(this.callback(this.show_hide_link_clicked));this.show_hide_link_label=this.show_hide_link.find(".ShowHideLinkLabel")};
pe.FiltersSection.events={CHANGED:"FiltersSection_CHANGED",FACETS_LOADED:"FiltersSection_FACETS_LOADED",FILTERS_LOADED:"FiltersSection_FILTERS_LOADED",VISIBILITY_CHANGED:"FiltersSection_VISIBILITY_CHANGED"};pe.FiltersSection.prototype.opened=function(){return!this.show_hide_link.hasClass("closed")};pe.FiltersSection.prototype.add_search_configuration=function(a){_.each(this.filters,function(b){b.add_search_configuration(a)});this.is_nothing_checked()||a.add_filter("filters_section_visible","true")};
pe.FiltersSection.prototype.read_search_configuration=function(a,b){this.show_hide_link_clicked(null,this.callback(function(){this.update_ui(a);a.has_filter("filters_section_visible")||this.show_hide_link_clicked(null);b&&b.set_flag("filters_section_loaded")}))};pe.FiltersSection.prototype.changed=function(){this.fire_event(pe.FiltersSection.events.CHANGED)};pe.FiltersSection.prototype.is_nothing_checked=function(){return _.reduce(this.filters,function(a,b){return a&&b.is_nothing_checked()},!0)};
pe.FiltersSection.prototype.load_facets=function(){pe.ajax_loader.tag_facets.load({tab_name:this.tab_section.get_selected_tab_name(),city_id:this.city_id},this.callback(function(a){this.update_tag_facets(a)}))};pe.FiltersSection.prototype.reset=function(){_.each(this.filters,function(a){a.reset()})};pe.FiltersSection.prototype.show_filters_for_tab=function(a){_.each(this.filters,function(b){b.on_tab_changed(null,a)});this.callbacks.call("filters_for_tab_updated")};
pe.FiltersSection.prototype.open=function(a){this.filters_div.hasClass("hidden")?(""===this.filters_div.html()?pe.ajax_loader.search_filters.load({city:this.city_id,timestamp:pe.assets_timestamp()},this.callback(function(b){speed_tracker.start_timer("rendering filters");this.filters_div.html(b);this.filters_div.removeClass("hidden");speed_tracker.start_timer("instantiate filters");var b=new pe.WhatFilter(this.container.find(".WhatFilter"),this.tab_section.get_selected_tab_name()),c=new pe.StandardFilter(this.container.find(".PricesFilter"),
"prices",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS]),d;d=window.new_where_filter?new pe.WhereFilter(this.container.find(".WhereFilter"),this.map_section.get_map()):new pe.WhereFilterOld(this.container.find(".WhereFilter"),this.map_section.get_map());var e;e=window.new_when_filter?new pe.WhenFilter2(this.container.find(".WhenFilter"),this.tab_section.get_selected_tab_name()):new pe.WhenFilter(this.container.find(".WhenFilter"),
this.tab_section.get_selected_tab_name());var f=new pe.PersonalitiesFilter(this.container.find(".PersonalityFilter")),g=new pe.StandardFilter(this.container.find(".EntertainmentFilter"),"entertainment",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENTS,pe.TabsSection.tabs.ENTERTAINERS,pe.TabsSection.tabs.TEAMS]),h=new pe.StandardFilter(this.container.find(".FoodFilter"),"food",[pe.TabsSection.tabs.ALL_RESULTS,
pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS],"Food & Drink"),i=new pe.StandardFilter(this.container.find(".MusicFilter"),"music",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS,pe.TabsSection.tabs.EVENTS,pe.TabsSection.tabs.ENTERTAINERS]),j=new pe.StandardFilter(this.container.find(".CrowdFilter"),"crowd",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,
pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS]),k=new pe.StandardFilter(this.container.find(".VibeFilter"),"vibe",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS]),l=new pe.StandardFilter(this.container.find(".AmenitiesFilter"),"amenities",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS]),m=new pe.StandardFilter(this.container.find(".DressFilter"),
"dress",[pe.TabsSection.tabs.ALL_RESULTS,pe.TabsSection.tabs.THINGS_TO_DO,pe.TabsSection.tabs.BARS_AND_CLUBS,pe.TabsSection.tabs.RESTAURANTS]);this.filters={what:b,prices:c,where:d,when:e,personality:f,entertainment:g,food:h,music:i,crowd:j,vibe:k,amenities:l,dress:m};speed_tracker.stop_timer("instantiate filters");this.show_filters_for_tab(this.tab_section.get_selected_tab_name());this.load_facets();this.update_selection_facets(this.selection_facets);pe.fire_global_event(pe.FiltersSection.events.FILTERS_LOADED,
!0);a&&a();speed_tracker.stop_timer("rendering filters")})):(this.show_hide_link.html("Hide filters"),this.filters_div.removeClass("hidden")),this.show_hide_link_label.html("Hide"),this.show_hide_link.removeClass("closed").addClass("opened"),this.show_hide_link.html("Hide filters"),pe.fire_global_event(pe.FiltersSection.events.VISIBILITY_CHANGED,!0)):(this.show_hide_link_label.html("Hide"),this.show_hide_link.removeClass("closed").addClass("opened"),this.show_hide_link.html("Hide filters"))};
pe.FiltersSection.prototype.close=function(){this.filters_div.hasClass("hidden")||(this.filters_div.addClass("hidden"),this.show_hide_link_label.html("Show"),this.show_hide_link.removeClass("opened").addClass("closed"),this.show_hide_link.html("Show filters"),pe.fire_global_event(pe.FiltersSection.events.VISIBILITY_CHANGED,!1))};pe.FiltersSection.prototype.show_hide_link_clicked=function(a,b){this.filters_div.hasClass("hidden")?this.open(b):this.close()};
pe.FiltersSection.prototype.update_tag_facets=function(a){var b=this.tab_section.get_selected_tab_name();_.each(a,function(a,d){var e=this.filters[d];e&&void 0!==e.get_visible_tabs&&_.include(e.get_visible_tabs(),b)&&e.set_facets(a)},this);_.each(this.filters,function(a){setTimeout(function(){a.update_ui?a.update_ui():a.standard_filter.update_summary()},1)});setTimeout(function(){pe.fire_global_event(pe.FiltersSection.events.FACETS_LOADED,".Filters .All label")},500)};
pe.FiltersSection.prototype.update_selection_facets=function(a){a&&(this.selection_facets=a);var b=this.tab_section.get_selected_tab_name();_.each(a,function(a,d){var e=this.filters[d];e&&_.include(e.get_visible_tabs(),b)&&setTimeout(this.callback(function(){e.set_selection_facets(a)}),0)},this);setTimeout(function(){pe.fire_global_event(pe.FiltersSection.events.FACETS_LOADED,".Filters .Summary label")},500)};pe.FiltersSection.prototype.update_ui=function(a){_.each(this.filters,function(b){b.read_search_configuration(a)})};
