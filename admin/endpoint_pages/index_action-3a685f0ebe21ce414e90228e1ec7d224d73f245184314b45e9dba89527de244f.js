pe.EndpointsTree=function(t,e){pe.init_widget(this,t),this.city=e,$(".Opener").click(this.callback(this.opener_cliked)),$(".Checkbox").live("change",this.callback(this.checkbox_changed))},pe.EndpointsTree.prototype.checkbox_changed=function(t){var e=$(t.target).attr("id");$.post("/admin/cities/"+this.city+"/endpoints/"+e+"/enable",function(){alert("changed!")})},pe.EndpointsTree.prototype.opener_cliked=function(t){var e=$(t.target),n=e.next(".Checkbox").attr("id"),a=e.parent().parent();$.post("/admin/cities/"+this.city+"/endpoint_pages/children",{endpoint_id:n},function(t){a.after(t),e.unbind("click").click(function(){$(".Endpoint"+n).toggle()})})},function(d){var o;d.rails=o={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",fileInputSelector:"input:file",CSRFProtection:function(t){var e=d('meta[name="csrf-token"]').attr("content");e&&t.setRequestHeader("X-CSRF-Token",e)},fire:function(t,e,n){var a=d.Event(e);return t.trigger(a,n),!1!==a.result},confirm:function(t){return confirm(t)},ajax:function(t){return d.ajax(t)},handleRemote:function(a){var t,e,n,i=a.data("type")||d.ajaxSettings&&d.ajaxSettings.dataType;if(o.fire(a,"ajax:before")){if(a.is("form")){t=a.attr("method"),e=a.attr("action"),n=a.serializeArray();var r=a.data("ujs:submit-button");r&&(n.push(r),a.data("ujs:submit-button",null))}else t=a.data("method"),e=a.attr("href"),n=null;o.ajax({url:e,type:t||"GET",data:n,dataType:i,beforeSend:function(t,e){return e.dataType===undefined&&t.setRequestHeader("accept","*/*;q=0.5, "+e.accepts.script),o.fire(a,"ajax:beforeSend",[t,e])},success:function(t,e,n){a.trigger("ajax:success",[t,e,n])},complete:function(t,e){a.trigger("ajax:complete",[t,e])},error:function(t,e,n){a.trigger("ajax:error",[t,e,n])}})}},handleMethod:function(t){var e=t.attr("href"),n=t.data("method"),a=d("meta[name=csrf-token]").attr("content"),i=d("meta[name=csrf-param]").attr("content"),r=d('<form method="post" action="'+e+'"></form>'),o='<input name="_method" value="'+n+'" type="hidden" />';i!==undefined&&a!==undefined&&(o+='<input name="'+i+'" value="'+a+'" type="hidden" />'),r.hide().append(o).appendTo("body"),r.submit()},disableFormElements:function(t){t.find(o.disableSelector).each(function(){var t=d(this),e=t.is("button")?"html":"val";t.data("ujs:enable-with",t[e]()),t[e](t.data("disable-with")),t.attr("disabled","disabled")})},enableFormElements:function(t){t.find(o.enableSelector).each(function(){var t=d(this),e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.removeAttr("disabled")})},allowAction:function(t){var e,n=t.data("confirm"),a=!1;return!n||(o.fire(t,"confirm")&&(a=o.confirm(n),e=o.fire(t,"confirm:complete",[a])),a&&e)},blankInputs:function(t,e,n){var a,i=d(),r=e||"input,textarea";return t.find(r).each(function(){a=d(this),(n?a.val():!a.val())&&(i=i.add(a))}),!!i.length&&i},nonBlankInputs:function(t,e){return o.blankInputs(t,e,!0)},stopEverything:function(t){return t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(t){var e=t.data("events"),n=!0;return e!==undefined&&e.submit!==undefined&&d.each(e.submit,function(t,e){if("function"==typeof e.handler)return n=e.handler(e.data)}),n}},"ajaxPrefilter"in d?d.ajaxPrefilter(function(t,e,n){o.CSRFProtection(n)}):d(document).ajaxSend(function(t,e){o.CSRFProtection(e)}),d(o.linkClickSelector).live("click.rails",function(t){var e=d(this);return o.allowAction(e)?e.data("remote")!==undefined?(o.handleRemote(e),!1):e.data("method")?(o.handleMethod(e),!1):void 0:o.stopEverything(t)}),d(o.formSubmitSelector).live("submit.rails",function(t){var e=d(this),n=e.data("remote")!==undefined,a=o.blankInputs(e,o.requiredInputSelector),i=o.nonBlankInputs(e,o.fileInputSelector);return o.allowAction(e)?a&&o.fire(e,"ajax:aborted:required",[a])?!n:n?i?o.fire(e,"ajax:aborted:file",[i]):d.support.submitBubbles||!1!==o.callFormSubmitBindings(e)?(o.handleRemote(e),!1):o.stopEverything(t):void setTimeout(function(){o.disableFormElements(e)},13):o.stopEverything(t)}),d(o.formInputClickSelector).live("click.rails",function(t){var e=d(this);if(!o.allowAction(e))return o.stopEverything(t);var n=e.attr("name"),a=n?{name:n,value:e.val()}:null;e.closest("form").data("ujs:submit-button",a)}),d(o.formSubmitSelector).live("ajax:beforeSend.rails",function(t){this==t.target&&o.disableFormElements(d(this))}),d(o.formSubmitSelector).live("ajax:complete.rails",function(t){this==t.target&&o.enableFormElements(d(this))})}(jQuery),$(document).ready(function(){new pe.EndpointsTree($(".Tree"),window.current_city)});