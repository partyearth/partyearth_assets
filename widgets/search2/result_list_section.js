pe.mouse_position={};pe.mouse_position.x=0;pe.mouse_position.y=0;pe.mouse_position.on_mouse_move=function(a){pe.mouse_position.x=a.pageX;pe.mouse_position.y=a.pageY};pe.mouse_position.track=function(){$("body").mousemove(pe.mouse_position.on_mouse_move)};
pe.Map2=function(a,b){pe.init_widget(this,a);this.options=b;this.options.bubbles=this.options.bubbles||"ALL";this.options.min_zoom=this.options.min_zoom||11;this.zoom=b.zoom||10;this.map=new google.maps.Map(a[0],{center:new google.maps.LatLng(b.latitude,b.longitude),mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},mapTypeId:b.mapTypeId,minZoom:b.min_zoom,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},scrollwheel:b.scrollwheel,zoom:b.zoom});var c=
new google.maps.OverlayView;c.draw=function(){};c.setMap(this.map);this.overlay=c;pe.mouse_position.track();this.tooltip_div=$('<div class="new_map_tooltip" style="display:none;"></div>');$("body").append(this.tooltip_div);this.infopopup_div=$('<div class="map_infowindow" style="display:none;"></div>');$("body").append(this.infopopup_div);this.markers=[]};pe.Map2.events={MARKER_CLICKED:"Map_MARKER_CLICKED",MARKER_HOVERED:"Map_MARKER_HOVERED",MARKER_BLURRED:"Map_MARKER_BLURRED"};
pe.Map2.marker_types={EVENT:"EVENT",USER_LOCATION:"USER_LOCATION",VENUE:"VENUE"};
pe.Map2.prototype.add_marker=function(a){var b=new google.maps.Marker({position:new google.maps.LatLng(a.latitude,a.longitude),map:this.map,icon:a.icon,cursor:"pointer",zIndex:a.z_index});b.bubble_html=a.bubble_html||"";b.popup_html=a.popup_html||"";b.type=a.type;b.object_id=a.object_id;b.z_index=a.z_index;b.clicked=!1;b.hovered=!1;var c=this;google.maps.event.addListener(b,"click",function(){c.fire_event(pe.Map2.events.MARKER_CLICKED,this)});google.maps.event.addListener(b,"mouseover",function(){c.fire_event(pe.Map2.events.MARKER_HOVERED,
this)});google.maps.event.addListener(b,"mouseout",function(){c.fire_event(pe.Map2.events.MARKER_BLURRED,this)});this.markers.push(b)};pe.Map2.prototype.find_marker_by_id=function(a){return _.detect(this.markers,function(b){return b.object_id===a})};pe.Map2.prototype.get_center_coordinates=function(){var a=this.map.getCenter();return{latitude:a.lat(),longitude:a.lng()}};
pe.Map2.prototype.highlight_marker=function(a){_.each(this.markers,function(a){this.shade_marker(a)},this);a.setIcon(pe.Map2.icon_path(a.type,a.object_id,!0));a.setZIndex(1E3)};pe.Map2.prototype.shade_marker=function(a){a.setIcon(pe.Map2.icon_path(a.type,a.object_id));a.setZIndex(a.z_index)};
pe.Map2.icon_path=function(a,b,c){if(a===pe.Map2.marker_types.USER_LOCATION)return"http://www.partyearth.com/assets/map/location.png?"+pe.assets_timestamp();a={type:a.toLowerCase(),id:pe.Map2.format_marker_id(b),timestamp:pe.assets_timestamp()};return pe.templatize(c?"http://cdn.partyearth.com/assets/map/pins/selected/map/{{id}}.png?{{timestamp}}":"http://cdn.partyearth.com/assets/map/pins/{{type}}/map/{{id}}.png?{{timestamp}}",a)};
pe.Map2.format_marker_id=function(a){return 3<a.length?"0000":"0000".substr(0,4-a.length)+a};pe.Map2.prototype.locate=function(a,b){(new google.maps.Geocoder).geocode({address:a},this.callback(function(a,d){if(d==google.maps.GeocoderStatus.OK){var e=a[0].geometry.location;this.map.setCenter(e);b&&b.success&&b.success(e)}else b&&b.fail&&b.fail()}))};pe.Map2.prototype.marker_position_on_map=function(a){var b=this.overlay.getProjection(),a=a.getPosition();return b.fromLatLngToContainerPixel(a)};
pe.Map2.prototype.marker_position_on_page=function(a){a=this.marker_position_on_map(a);return{x:this.container.offset().left+a.x,y:this.container.offset().top+a.y}};pe.Map2.marker_type=function(a){switch(a){case "EVENT":return pe.Map2.marker_types.EVENT;case "VENUE":return pe.Map2.marker_types.VENUE;case "USER_LOCATION":return pe.Map2.marker_types.USER_LOCATION;default:return alert("Unknown marker type")}};
pe.Map2.prototype.set_map_to_fit_markers=function(){if(this.markers.length){var a=new google.maps.LatLngBounds;_.each(this.markers,function(b){a.extend(b.getPosition())},this);this.map.setOptions({minZoom:null});this.map.fitBounds(a);var b=this.map.getZoom(),c=this.zoom;17<b&&this.map.setZoom(c);b>this.options.min_zoom&&(b=this.options.min_zoom);this.map.setOptions({minZoom:b})}};
pe.Map2.prototype.set_objects=function(a){$.each(this.markers,this.callback(function(a,c){c.setMap(null)}));this.markers=[];a.length&&($.each(a,this.callback(function(b,c){if(c.lat&&c.lng){var d=pe.Map2.marker_type(c.type),e=c.id;this.add_marker({type:d,icon:pe.Map2.icon_path(d,e),object_id:e,latitude:c.lat,longitude:c.lng,bubble_html:c.bubble_html,popup_html:c.popup_html,z_index:a.length-b})}})),this.set_map_to_fit_markers())};
pe.AjaxPaginator=function(a,b,c,d){pe.init_widget(this,a);a={cells_count:13,total_items:0,total_pages:1,per_page:10,initial_page:1,dots:"..."};"undefined"!==typeof c&&$.extend(a,c);this.cells=[];this.cells_container=this.container.find(".Cells");this.current_page=a.initial_page;this.next_button=this.container.find(".ShowNextPageButton");this.prev_button=this.container.find(".ShowPrevPageButton");this.referrer=d;this.mini_paginator_container=b;this.count_container=this.mini_paginator_container.find(".Total");
this.from_container=this.mini_paginator_container.find(".From");this.to_container=this.mini_paginator_container.find(".To");this.mini_paginator_next_button=this.mini_paginator_container.find(".ShowNextPageTopButton");this.mini_paginator_prev_button=this.mini_paginator_container.find(".ShowPrevPageTopButton");this.per_page=a.per_page;this.total_pages=a.total_pages;this.total_items=a.total_items;this.CELLS_COUNT=a.cells_count;this.DOTS_CELL_CONTENT=a.dots;this.update_display({page:this.current_page,
total_pages:this.total_pages});this.prev_button.click(this.callback(this.show_previous_page));this.next_button.click(this.callback(this.show_next_page));this.mini_paginator_prev_button.click(this.callback(this.show_previous_page));this.mini_paginator_next_button.click(this.callback(this.show_next_page))};pe.AjaxPaginator.events={PAGE_CHANGED:"AjaxPaginator_PageChanged"};
pe.AjaxPaginator.prototype.add_search_configuration=function(a){a.add_filter("page",this.current_page);a.add_filter("total_pages",this.total_pages);a.add_filter("total_results",this.total_items)};pe.AjaxPaginator.prototype.cell_clicked=function(a){this.set_current_page(parseInt($(a.target).data("page"),0))};pe.AjaxPaginator.prototype.cell_html=function(){return'<span class="PaginationCell inline_block"></span>'};
pe.AjaxPaginator.prototype.change_per_page_limit=function(a,b){this.current_page=Math.ceil(this.from()/b);this.per_page=b;this.total_pages=Math.ceil(this.total_items/this.per_page);this.fire_event(pe.AjaxPaginator.events.PAGE_CHANGED)};pe.AjaxPaginator.prototype.from=function(){return(this.current_page-1)*this.per_page+1};pe.AjaxPaginator.prototype.to=function(){return Math.min(this.current_page*this.per_page,this.total_items)};
pe.AjaxPaginator.prototype.read_search_configuration=function(a){var b=this.referrer?a.filter_value("page"):1,c=a.filter_value("per_page"),d=a.filter_value("total_pages"),a=a.filter_value("total_results");this.update_display({current_page:b,per_page:c,total_pages:d,total_results:a})};
pe.AjaxPaginator.prototype.render=function(a){var a=a||0,b=this.cell_html();this.cells_container.empty();$.each(this.cells,this.callback(function(c,d){var e=$(b).append(d);d===this.DOTS_CELL_CONTENT?e.addClass("Dots"):(e.addClass("Number").data("page",d),a==c?e.addClass("Current"):e.click(this.callback(this.cell_clicked)));this.cells_container.append(e)}));this.from_container.html(this.from()+"");this.to_container.html(this.to()+"");this.count_container.html(this.total_items+"")};
pe.AjaxPaginator.prototype.show_next_page=function(){this.current_page!==this.total_pages&&this.set_current_page(this.current_page+1)};pe.AjaxPaginator.prototype.show_previous_page=function(){1!==this.current_page&&this.set_current_page(this.current_page-1)};pe.AjaxPaginator.prototype.set_current_page=function(a){this.current_page=a;this.fire_event(pe.AjaxPaginator.events.PAGE_CHANGED)};
pe.AjaxPaginator.prototype.update_display=function(a){a=a||{};this.total_pages=a.total_pages||1;this.current_page=a.current_page||1;this.total_items=a.total_results||0;this.per_page=a.per_page||10;this.container.toggle(0<this.total_items);this.mini_paginator_container.toggle(0<this.total_items);if(0!==this.total_items){this.cells=[];var a=Math.min(this.CELLS_COUNT,this.total_pages),b=Math.floor((a-4)/2),c=0,c=this.current_page<=1+b+1?this.current_page-1:this.current_page>=this.total_pages-b-1?a-(this.total_pages-
this.current_page)-1:Math.floor(a/2);this.cells[c]=this.current_page;this.cells[0]=1;this.cells[a-1]=this.total_pages;b=0;for(b=c+1;b<a-1;b++)this.cells[b]=this.cells[b-1]+1;for(b=c-1;0<b;b--)this.cells[b]=this.cells[b+1]-1;if(1<a&&(1!=this.total_pages-this.cells[a-2]&&(this.cells[a-2]=this.DOTS_CELL_CONTENT),1!=this.cells[1]-1))this.cells[1]=this.DOTS_CELL_CONTENT;this.render(c);a=this.current_page===this.total_pages;c=1===this.current_page;this.prev_button.toggleClass("disabled",c);this.next_button.toggleClass("disabled",
a);this.mini_paginator_prev_button.toggleClass("disabled",c);this.mini_paginator_next_button.toggleClass("disabled",a)}};
pe.ResultListSection=function(a,b){pe.init_widget(this,a);this.highlighted_result=null;this.result_list=pe.load(a.find(".ResultsList"));this.paginator=b;this.place_numbers();var c=this.result_list.find('.Result:not(:".Performer")');c.live("mouseenter",this.callback(this.on_result_entry_mouse_enter));c.live("mouseleave",this.callback(this.on_result_entry_mouse_leave));pe.bind_global_event("MapSection_MARKER_BLURRED",this.callback(this.on_map_marker_blur));pe.bind_global_event("MapSection_MARKER_HIGHLIGHTED",
this.callback(this.on_map_marker_hover))};pe.ResultListSection.events={RESULT_CLICKED:"ResultList_RESULT_CLICKED",RESULT_HOVERED:"ResultList_RESULT_HOVERED",RESULT_BLURRED:"ResultList_RESULT_BLURRED",RESULTS_UPDATED:"ResultList_RESULTS_UPDATED"};
pe.ResultListSection.prototype.highlight_result=function(a){this.highlighted_result=this.result_list.find('.Result[data-number="'+a+'"]');0!==this.highlighted_result.length&&!this.highlighted_result.hasClass("selected")&&(this.highlighted_result.addClass("selected"),this.set_icon(this.highlighted_result,!0))};
pe.ResultListSection.prototype.icon_html=function(a,b,c){if(!a||!b||"performer"===a.toLowerCase())return"";a={type:a.toLowerCase(),id:pe.Map2.format_marker_id(b.toString()),timestamp:pe.assets_timestamp()};return c?pe.templatize('<img src="http://cdn.partyearth.com/assets/map/pins/selected/results/{{id}}.png?{{timestamp}}">',a):pe.templatize('<img src="http://cdn.partyearth.com/assets/map/pins/{{type}}/results/{{id}}.png?{{timestamp}}">',a)};pe.ResultListSection.prototype.on_map_marker_blur=function(){this.shade_result()};
pe.ResultListSection.prototype.on_map_marker_hover=function(a,b){this.highlight_result(b.object_id)};pe.ResultListSection.prototype.on_result_entry_mouse_enter=function(a){a=$(a.target).closest(".Result").data("number").toString();this.highlight_result(a);pe.fire_global_event(pe.ResultListSection.events.RESULT_HOVERED,[a])};
pe.ResultListSection.prototype.on_result_entry_mouse_leave=function(a){a=$(a.target).closest(".Result").data("number").toString();this.shade_result();pe.fire_global_event(pe.ResultListSection.events.RESULT_BLURRED,[a])};pe.ResultListSection.prototype.place_numbers=function(){var a=this.callback(function(a,c){this.set_icon($(c).attr("data-number",this.paginator.from()+a),!1)});$.each(this.result_list.find(".Result"),a)};
pe.ResultListSection.prototype.set_icon=function(a,b){var c=a.find(".Number");c.data("type")&&c.html(this.icon_html(c.data("type").toString(),parseInt(a.attr("data-number"),10),b))};pe.ResultListSection.prototype.shade_result=function(){this.highlighted_result&&(this.highlighted_result.removeClass("selected"),this.set_icon(this.highlighted_result,!1),this.highlighted_result=null)};pe.ResultListSection.prototype.update_results=function(a){this.result_list.html(a);this.place_numbers();pe.fire_global_event(pe.ResultListSection.events.RESULTS_UPDATED)};
