(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};pe.gigya=pe.gigya||{};var c=pe.gigya,b=function(b){var c=this;this.container=b;this.input_field_focused=a(this.input_field_focused,this);this.input_field_focusouted=a(this.input_field_focusouted,this);this.error_message_container_clicked=a(this.error_message_container_clicked,this);this.on_list_created=a(this.on_list_created,this);this.submit_button_clicked=a(this.submit_button_clicked,this);this.error_message_container=
this.container.find(".Error");this.input_field=this.container.find(".Input");this.submit_button=this.container.find(".CreateButton");this.cancel_button=this.container.find(".CancelButton");this.input_field.attr("placeholder",pe.gigya.ListCreator.default_label);this.input_field.focus(this.input_field_focused);this.input_field.focusout(this.input_field_focusouted);this.input_field.keypress(function(a){c.hide_error_message();if(13===a.which)return a.preventDefault(),c.hide_error_message(),a=c.input_field.val(),
_.isEmpty(a.replace(/\s/g,""))||c.create_list(a),!1});this.error_message_container.click(this.error_message_container_clicked);this.submit_button.click(this.submit_button_clicked);this.cancel_button.click(function(){return c.put_name(pe.gigya.ListCreator.default_label)});this.hide_error_message();this.put_name(pe.gigya.ListCreator.default_label)};b.default_label="Please enter a title for your new list";b.prototype.create_list=function(a){this.on_before_create();return $.post("/api/user_lists",{user_list:{name:a}},
this.on_list_created,"json")};b.prototype.put_name=function(a){return this.input_field.val(a)};b.prototype.validate=function(){return!this.is_empty()};b.prototype.show_error_message=function(){this.container.addClass("failed");this.input_field.val(pe.gigya.ListCreator.default_label);return this.input_field.css("color","red")};b.prototype.hide_error_message=function(){this.input_field.css("color","");this.input_field.val()===pe.gigya.ListCreator.default_label&&this.input_field.val("");return this.container.removeClass("failed")};
b.prototype.is_empty=function(){var a;a=this.input_field.val();return _.isEmpty(a)||a===pe.gigya.ListCreator.default_label};b.prototype.submit_button_clicked=function(){return this.validate()?(this.hide_error_message(),this.create_list(this.input_field.val()),this.put_name("")):this.show_error_message()};b.prototype.on_list_created=function(a){return 0===a.status?(this.put_name(""),this.on_after_create(a.instance)):alert("Something went wrong: ListCreator#on_list_created")};b.prototype.on_after_create=
function(){return!0};b.prototype.on_before_create=function(){return!0};b.prototype.after_create=function(a){return this.on_after_create=a};b.prototype.before_create=function(a){return this.on_before_create=a};b.prototype.error_message_container_clicked=function(){this.hide_error_message();this.put_name("");return this.input_field.focus()};b.prototype.input_field_focusouted=function(){if(_.isEmpty(this.input_field.val()))return this.put_name(pe.gigya.ListCreator.default_label)};b.prototype.input_field_focused=
function(){this.hide_error_message();if(this.is_empty())return this.put_name("")};c.ListCreator=b}).call(this);pe.HelpModule2=function(){var a=$(".HelperModule");a.length&&(pe.init_widget(this,a),this.container.live("click",this.callback(this.helper_module_div_clicked)),this.container.live("hover",this.callback(this.helper_module_div_hovered)),this.active_popup=null)};pe.HelpModule2.prototype.close_button_clicked=function(){this.destroy_active_popup()};
pe.HelpModule2.prototype.create_popup=function(a,c){this.active_popup=$(c);a.append(this.active_popup);$("body").bind("click",this.callback(this.close_button_clicked))};pe.HelpModule2.prototype.destroy_active_popup=function(){$("body").unbind("click");this.active_popup.remove();this.active_popup=null};
pe.HelpModule2.prototype.helper_module_div_hovered=function(a){a=$(a.target);(a=(a.hasClass("HelperModule")?a:a.closest(".HelperModule")).data("page-id"))&&pe.ajax_loader.help_page.load({page_id:a},this.callback(function(){}))};
pe.HelpModule2.prototype.helper_module_div_clicked=function(a){var c=$(a.target),b;b=c.hasClass("HelperModule")?c:c.closest(".HelperModule");this.active_popup&&this.destroy_active_popup();(c=b.data("page-id"))&&pe.ajax_loader.help_page.load({page_id:c},this.callback(function(a){this.create_popup(b,this.popup_html(a))}));a.stopPropagation()};
pe.HelpModule2.prototype.popup_html=function(a){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <span class="title">{{title}}:&nbsp;&nbsp;</span> {{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',a)};
pe.routes={map:{search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",
new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",
map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",
user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",
send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",mobile_subscribe:"/services/subscriptions/mobile"}};
pe.routes.build_path=function(a,c){var b=pe.routes.map[a],e=b.match(/\{\{\*(.+)\}\}/);_.each(e,function(a){c[a]&&(c[a]=c[a].join("/"))});b=b.replace(/\*/,"");return pe.routes.clean_url(pe.templatize(b,c))};pe.routes.clean_url=function(a){return("/"+a).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var a=pe.routes.recognize_path(window.location.pathname);return a?a.params:{}};
pe.routes.recognize_path=function(a){a=pe.routes.clean_url(a);var c,b,e=_.find(_.keys(pe.routes.map),function(d){c=pe.routes.map[d];b=RegExp(c.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return b.test(a)});if(e){for(var f=_.map(c.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),g=a.match(b).slice(1,99),h={params:{}},j=function(a){return!_.isEmpty(a)},d=0;d<f.length;d++)"*"==f[d][0]&&(f[d]=f[d].replace(/\*/g,""),g[d]=_.select(g[d].replace(/\*/g,"").split("/"),j)),
h.params[f[d]]=g[d];h.path_info={name:e,template:c};return h}return!1};pe.routes.Request=function(a,c,b){pe.routes.map[a]?(this.path=a,"object"!==typeof c&&(c={id:c}),this.params=c,this.callback=b):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(a,c,b){return new pe.routes.Request(a,c,b)};pe.routes.Request.from_current_location=function(a,c,b){c=c||{};var e=pe.routes.current_url_params();return new pe.routes.Request(a,_.extend(e,c),b)};
pe.routes.Request.prototype.ajax=function(a,c){var b="function"===typeof c?c:this.callback;$.ajax({url:this.build_path(),data:this.params,type:a,success:b})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(a){this.ajax("GET",a)};pe.routes.Request.prototype.post=function(a){this.ajax("POST",a)};
(function(){$(document).ready(function(){pe.init_page_framework();_.each($(".ListCreator"),function(a){return(new pe.gigya.ListCreator($(a))).after_create(pe.on_list_created)});pe.bind_toggle_trigger($(".ListCreatorToggleTrigger"),$(".ListCreator"));return $(".ListCreatorToggleTrigger").click(function(){$(".ListCreator .Input").val(pe.gigya.ListCreator.default_label).css("color","");return $(".ListCreator").removeClass("failed")})});pe.on_list_created=function(a){return window.location=pe.routes.build_path("user_list",
{user_id:window.user_id,id:a.url_param})}}).call(this);
