pe.SearchSorter=function(a){pe.init_widget(this,a);this.LABELS={distance_desc:"Distance",date_asc:"Date",name_asc:"A-Z",name_desc:"Z-A",rating:"Highest Rated",relevance_desc:"Best Match"};this.OPTIONS={all_results:["relevance_desc","name_asc","name_desc","distance_desc"],things_to_do:["relevance_desc","name_asc","name_desc","date_asc","distance_desc"],bars_and_clubs:["relevance_desc","name_asc","name_desc","date_asc","distance_desc"],restaurants:["relevance_desc","name_asc","name_desc","date_asc",
"distance_desc"],event_venues:["relevance_desc","name_asc","name_desc","date_asc","distance_desc"],events:["relevance_desc","name_asc","name_desc","date_asc","distance_desc"],entertainers:["relevance_desc","name_asc","name_desc"],teams:["relevance_desc","name_asc","name_desc"]};this.collection="";this.sort_by="relevance";this.field_selectbox=this.container.find("select.FieldSelector");this.field_selectbox.change(this.callback(this.field_selectbox_state_changed));this.set_active_tab("all_results");
pe.bind_global_event(pe.WhereFilter.events.CUSTOM_SELECTION_TRIGGERED,this.callback(function(){this.enable_option("distance_desc")}));pe.bind_global_event(pe.WhereFilter.events.SINGLE_SELECTION_TRIGGERED,this.callback(function(){this.disable_option("distance_desc")}));pe.bind_global_event(pe.WhereFilter.events.EMPTY_SELECTION_TRIGGERED,this.callback(function(){this.disable_option("distance_desc")}));pe.bind_global_event(pe.WhereFilter.events.MULTIPLE_SELECTION_TRIGGERED,this.callback(function(){this.disable_option("distance_desc")}))};
pe.SearchSorter.events={CHANGED:"PE_SORTER_CHANGED",COLLECTION_CHANGED:"PE_SORTER_COLLECTION_CHANGED",SORT_FIELD_CHANGED:"PE_SORTER_SORT_FIELD_CHANGED"};pe.SearchSorter.prototype.add_search_configuration=function(a){a.add_filter("sort_by",this.sort_by)};pe.SearchSorter.prototype.enable_option=function(a){this.field_selectbox.find("option[value="+a+"]").show()};pe.SearchSorter.prototype.disable_option=function(a){this.field_selectbox.find("option[value="+a+"]").hide();this.sort_by===a&&this.set_option("relevance_desc")};
pe.SearchSorter.prototype.field_selectbox_state_changed=function(){this.sort_by=this.field_selectbox.find("option:selected").val()+"";this.fire_event(pe.SearchSorter.events.SORT_FIELD_CHANGED,this.sort_by)};pe.SearchSorter.prototype.fill_field_selectbox_with_options=function(){this.field_selectbox.empty();_.each(this.OPTIONS[this.collection],function(a){$("<option>").appendTo(this.field_selectbox).val(a).text(this.LABELS[a])},this);this.field_selectbox.val(this.sort_by)};
pe.SearchSorter.prototype.read_search_configuration=function(a){this.collection=a.filter_value("category")||"all_results";var b=a.filter_value("sort_by");b&&(this.sort_by=b);this.fill_field_selectbox_with_options();a=a.filter_value("where");(!a||1!==a.length||"custom"!==a)&&this.disable_option("distance_desc")};
pe.SearchSorter.prototype.set_active_tab=function(a){if(this.collection!==a){if(-1===$.inArray(this.sort_by,this.OPTIONS[a]||[]))this.sort_by="relevance_desc";this.collection=a;this.fill_field_selectbox_with_options();this.fire_event(pe.SearchSorter.events.COLLECTION_CHANGED)}return this};pe.SearchSorter.prototype.set_option=function(a){this.sort_by=a;this.field_selectbox.val(this.sort_by);return this};
