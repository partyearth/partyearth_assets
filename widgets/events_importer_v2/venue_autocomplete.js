pe.EventHelperTools={};pe.EventHelperTools.autocomplete_closed=function(){pe.EventHelperTools.autocomplete_open=!1};pe.EventHelperTools.autocomplete_opened=function(){pe.EventHelperTools.autocomplete_open=!0};pe.EventHelperTools.remove_comma_at_the_end=function(a){return!a?"":a.replace(/,$/,"")};
pe.EventHelperTools.show_message=function(a,c){a.removeClass("wrong correct new").parent().find(".errors").remove().find(".message").remove();c?a.addClass("wrong").after('<span class="errors">'+c+"</span>"):a.addClass("correct")};pe.EventHelperTools.validate_url=function(a){return!a?!0:/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/i.test(a)};
pe.AutoSuggestModule=function(a,c,b){pe.init_widget(this,a);b.preFill=b.preFill||{};b.minChars=b.minChars||3;b.selectedValuesProp=b.selectedValuesProp||"value";this.options=b;this.input_field=this.container.find(".AutoSuggestInput");this.input_field.autoSuggest(c,this.options);this.selected_entries_container=this.container.find(".as-selections");this.selected_data_ids_field=this.container.find(".as-values")};
pe.AutoSuggestModule.prototype.add_entries=function(a){a&&0!==a.length&&$.each(a,this.callback(function(a,b){this.add_entry(b)}))};pe.AutoSuggestModule.prototype.add_entry=function(a){if(0>$.inArray(a[this.options.selectedValuesProp].toString(),this.val().split(",")))window.AutoSuggest_hacks[this.input_field[0].id](a,Math.floor(1001*Math.random()).toString())};pe.AutoSuggestModule.prototype.last_li=function(){return this.selected_entries_container.find(".as-selection-item:last")};
pe.AutoSuggestModule.prototype.last_value=function(){return _.last(this.val().split(","))};pe.AutoSuggestModule.prototype.remove_last_entry=function(){this.last_li().find(".as-close").click()};pe.AutoSuggestModule.prototype.replace_last_entry=function(a){this.remove_last_entry();this.add_entry(a)};pe.AutoSuggestModule.prototype.set_val=function(a){a&&this.selected_data_ids_field.val(a+",")};pe.AutoSuggestModule.prototype.val=function(){return pe.EventHelperTools.remove_comma_at_the_end(this.selected_data_ids_field.val().toString())};
pe.NewVenueDialogForm=function(a,c,b,d,e,f){pe.init_widget(this,a);this.success_callback_method=e;this.cancel_callback_method=f;this.city_data_ids=$.map(b,function(a){return a.value.toString()});this.endpoint_ids=$.map(d,function(a){return a.value.toString()});this.dialog_box=$(this.dialog_html(c));this.venue_name_input=this.dialog_box.find(".VenueName");this.venue_city_input=this.dialog_box.find(".VenueCity");this.venue_endpoint_input=this.dialog_box.find(".VenueEndpoint");this.venue_address_input=
this.dialog_box.find(".VenueFullAddress");this.dialog_box.dialog({modal:!0,show:!1,close:this.callback(this.close_button_clicked),buttons:{"Create Venue":this.callback(this.create_button_clicked),Close:this.callback(this.close_button_clicked)}});this.venue_endpoints_autosuggest=new pe.AutoSuggestModule(this.dialog_box.find(".EndpointInputContainer"),d,{startText:"Select an Endpoint",emptyText:"No Endpoint found",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",neverSubmit:!0,
selectionLimit:1});this.venue_city_autosuggest_module=new pe.AutoSuggestModule(this.dialog_box.find(".CityInputContainer"),b,{startText:"Select a City",emptyText:"No city found",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",neverSubmit:!0,selectionLimit:1})};pe.NewVenueDialogForm.prototype.close_button_clicked=function(){this.destroy_dialog();this.cancel_callback_method()};
pe.NewVenueDialogForm.prototype.create_button_clicked=function(){var a=this.venue_name_input.val();if(!a)return pe.EventHelperTools.show_message(this.venue_name_input,"Name is required"),!1;if(150<a.length)return pe.EventHelperTools.show_message(this.venue_name_input,"Name is too long"),!1;var c=this.venue_city_autosuggest_module.val();if(!c)return pe.EventHelperTools.show_message(this.venue_city_input,"City is required"),!1;if(!pe.array_contains(this.city_data_ids,c))return pe.EventHelperTools.show_message(this.venue_city_input,
"Select a valid city from the list"),!1;var b=this.venue_endpoints_autosuggest.val();if(!b)return pe.EventHelperTools.show_message(this.venue_endpoint_input,"Endpoint is required"),!1;if(!pe.array_contains(this.endpoint_ids,b))return pe.EventHelperTools.show_message(this.venue_endpoint_input,"Select a valid endpoint from the list"),!1;$.ajax({url:"/admin/events_admin/venue_create",type:"POST",data:{name:a,city_id:c,endpoint_id:b,full_address:this.venue_address_input.val()},error:pe.ajax_error,success:this.callback(function(a){a.error?
pe.EventHelperTools.show_message(this.venue_name_input,a.error):(this.destroy_dialog(),this.success_callback_method(a))})})};pe.NewVenueDialogForm.prototype.destroy_dialog=function(){this.dialog_box.dialog("destroy");this.dialog_box.remove()};pe.NewVenueDialogForm.prototype.dialog_html=function(a){return'<div title="Create Venue"><ul><li><label for="venue_name">Name</label> <input name="venue_name" class="VenueName" value="'+a+'"></li><li class="CityInputContainer"><input name="venue_city" class="VenueCity AutoSuggestInput" value=""></li><li class="EndpointInputContainer"><input name="venue_endpoint" class="VenueEndpoint AutoSuggestInput" value=""></li><li><label for="venue_address">Full Address</label> <textarea name="venue_address" class="VenueFullAddress"></textarea></li></ul></div>'};
pe.VenueAutocomplete=function(a,c,b,d){pe.init_widget(this,a);this.city_data_source=b;this.venue_endpoints_data=d;this.venue_input_field=this.container.find(".VenueAutocompleteInput");this.venue_input_field.blur(this.callback(this.venue_input_field_blurred));this.autosuggest_module=new pe.AutoSuggestModule(this.container,c,{startText:"",emptyText:"Press Tab or type comma to create a new venue",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",queryParam:"term",neverSubmit:!0,
preFill:this.venue_input_field.data("event-data"),resultClick:this.callback(this.search_result_clicked),selectionAdded:this.callback(this.search_result_selection_added)});this.city_id=this.get_city_id(this.venue_input_field.data("event-data"));this.last_valid_input=this.val()};pe.VenueAutocomplete.events={CHANGED:"VenueAutocomplete_CHANGED"};pe.VenueAutocomplete.prototype.add_venues=function(a){this.autosuggest_module.add_entries(a);this.last_valid_input=this.val()};
pe.VenueAutocomplete.prototype.as_enum=function(){return{venue_ids:this.val().split(",")}};pe.VenueAutocomplete.prototype.display_message=function(a){pe.EventHelperTools.show_message(this.venue_input_field,a)};pe.VenueAutocomplete.prototype.get_city_id=function(a){return!a?null:a[0].city_id};
pe.VenueAutocomplete.prototype.open_new_venue_dialog_form=function(){new pe.NewVenueDialogForm(this.container,this.venue_input_field.val(),this.city_data_source,this.venue_endpoints_data,this.callback(this.replace_last_venue),this.callback(this.remove_last_venue))};pe.VenueAutocomplete.prototype.remove_last_venue=function(){this.autosuggest_module.remove_last_entry()};pe.VenueAutocomplete.prototype.replace_last_venue=function(a){this.autosuggest_module.replace_last_entry(a);this.search_result_selection_added()};
pe.VenueAutocomplete.prototype.search_result_clicked=function(a){a=a.attributes.city_id||null;if(this.city_id&&a!==this.city_id)return this.autosuggest_module.remove_last_entry(),this.display_message("Please select venues from the same city"),!1;this.city_id=a};pe.VenueAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&this.venue_input_field.val()===this.autosuggest_module.last_value()&&this.open_new_venue_dialog_form()};pe.VenueAutocomplete.prototype.val=function(){return this.autosuggest_module.val()};
pe.VenueAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()};pe.VenueAutocomplete.prototype.venue_input_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.VenueAutocomplete.events.CHANGED,this.as_enum()));this.display_message("")};
