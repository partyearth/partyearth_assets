(function(){var b,d,c,e,a,f={}.hasOwnProperty;d=function(a,b){function e(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};var m=this,k=function(){};c=b=this.Stripe=(k.version=2,k.endpoint="https://api.stripe.com/v1",k.setPublishableKey=function(a){k.key=a},k.complete=function(a){return function(b){var f;if("success"!==b)return f=Math.round((new Date).getTime()/1E3),(new Image).src="http://q.stripe.com?event=stripejs-error&type="+
b+"&key="+k.key+"&timestamp="+f,"function"==typeof a?a(500,{error:{code:b,type:b,message:"An unexpected error has occurred with Stripe.js. This may\nbe due to network connectivity issues, so you should try\nagain (you won't be charged twice). If you're still having\nproblems, please let us know!"}}):void 0}},k);e=function(){};e=(e.validate=function(a,b){if(!a)throw b+" required";if("object"!=typeof a)throw b+" invalid";},e.formatData=function(a,f){return b.utils.isElement(a)&&(a=b.utils.paramsFromForm(a,
f)),b.utils.underscoreKeys(a),a},e.create=function(a,f){return a.key||(a.key=b.key||b.publishableKey),b.utils.validateKey(a.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens",data:a,method:"POST",success:function(a,b){return"function"==typeof f?f(b,a):void 0},complete:b.complete(f),timeout:4E4})},e.get=function(a,f){if(!a)throw"token required";return b.utils.validateKey(b.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens/"+a,data:{key:b.key},success:function(a,b){return"function"==typeof f?f(b,a):void 0},complete:b.complete(f),
timeout:4E4})},e);c.token=e;c=this.Stripe;var h=function(){return h.__super__.constructor.apply(this,arguments)};d(h,this.Stripe.token);h.tokenName="card";h.whitelistedAttrs="number cvc exp_month exp_year name address_line1 address_line2 address_city address_state address_zip address_country".split(" ");h.createToken=function(a,f,e){var c;return null==f&&(f={}),b.token.validate(a,"card"),"function"==typeof f?(e=f,f={}):"object"!=typeof f&&(c=parseInt(f,10),f={},0<c&&(f.amount=c)),f[h.tokenName]=b.token.formatData(a,
h.whitelistedAttrs),b.token.create(f,e)};h.getToken=function(a,f){return b.token.get(a,f)};h.validateCardNumber=function(a){return a=(a+"").replace(/\s+|-/g,""),10<=a.length&&16>=a.length&&h.luhnCheck(a)};h.validateCVC=function(a){return a=b.utils.trim(a),/^\d+$/.test(a)&&3<=a.length&&4>=a.length};h.validateExpiry=function(a,f){var e,c;return a=b.utils.trim(a),f=b.utils.trim(f),/^\d+$/.test(a)?/^\d+$/.test(f)?12>=parseInt(a,10)?(c=new Date(f,a),e=new Date,c.setMonth(c.getMonth()-1),c.setMonth(c.getMonth()+
1,1),c>e):!1:!1:!1};h.luhnCheck=function(a){var f,b,e,c,m;b=!0;e=0;f=(a+"").split("").reverse();c=0;for(m=f.length;c<m;c++){a=f[c];a=parseInt(a,10);if(b=!b)a*=2;9<a&&(a-=9);e+=a}return 0===e%10};h.cardType=function(a){return h.cardTypes[a.slice(0,2)]||"Unknown"};var j;a={};for(e=j=40;49>=j;e=++j)a[e]="Visa";for(e=j=50;59>=j;e=++j)a[e]="MasterCard";e=(a[34]=a[37]="American Express",a[60]=a[62]=a[64]=a[65]="Discover",a[35]="JCB",a[30]=a[36]=a[38]=a[39]="Diners Club",a);e=(h.cardTypes=e,h);c.card=e;
c=this.Stripe;var g=function(){return g.__super__.constructor.apply(this,arguments)};d=(d(g,this.Stripe.token),g.tokenName="bank_account",g.whitelistedAttrs=["country","routing_number","account_number"],g.createToken=function(a,f,e){return null==f&&(f={}),b.token.validate(a,"bank account"),"function"==typeof f&&(e=f,f={}),f[g.tokenName]=b.token.formatData(a,g.whitelistedAttrs),b.token.create(f,e)},g.getToken=function(a,f){return b.token.get(a,f)},g.validateRoutingNumber=function(a,f){a=b.utils.trim(a);
switch(f){case "US":return/^\d+$/.test(a)&&9===a.length&&g.routingChecksum(a);case "CA":return/\d{5}\-\d{3}/.test(a)&&9===a.length;default:return!0}},g.validateAccountNumber=function(a,f){a=b.utils.trim(a);switch(f){case "US":return/^\d+$/.test(a)&&1<=a.length&&17>=a.length;default:return!0}},g.routingChecksum=function(a){var f,b,e,c,m;b=0;a=(a+"").split("");m=[0,3,6];e=0;for(c=m.length;e<c;e++)f=m[e],b+=3*parseInt(a[f]),b+=7*parseInt(a[f+1]),b+=parseInt(a[f+2]);return 0!==b&&0===b%10},g);c.bankAccount=
d;d="createToken getToken cardType validateExpiry validateCVC validateCardNumber".split(" ");e=0;for(a=d.length;e<a;e++)c=d[e],this.Stripe[c]=this.Stripe.card[c];"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe);"function"==typeof define&&define("stripe",[],function(){return m.Stripe})}).call(this);
(function(){var b,d,c,e=[].slice;b=encodeURIComponent;d=(new Date).getTime();c=function(a,f,e){var k,d;null==f&&(f=[]);for(k in a)d=a[k],e&&(k=""+e+"["+k+"]"),"object"==typeof d?c(d,f,k):f.push(""+k+"="+b(d));return f.join("&").replace(/%20/g,"+")};this.Stripe.ajaxJSONP=function(a){var f,b,k,h,j,g;return null==a&&(a={}),k="sjsonp"+ ++d,j=document.createElement("script"),b=null,f=function(f){var e;return null==f&&(f="abort"),clearTimeout(b),null!=(e=j.parentNode)&&e.removeChild(j),k in window&&(window[k]=
function(){}),"function"==typeof a.complete?a.complete(f,g,a):void 0},g={abort:f},j.onerror=function(){return g.abort(),"function"==typeof a.error?a.error(g,a):void 0},window[k]=function(){var f;f=1<=arguments.length?e.call(arguments,0):[];clearTimeout(b);j.parentNode.removeChild(j);try{delete window[k]}catch(c){window[k]=void 0}return"function"==typeof a.success&&a.success.apply(a,f),"function"==typeof a.complete?a.complete("success",g,a):void 0},a.data||(a.data={}),a.data.callback=k,a.method&&(a.data._method=
a.method),j.src=a.url+"?"+c(a.data),h=document.getElementsByTagName("head")[0],h.appendChild(j),0<a.timeout&&(b=setTimeout(function(){return g.abort("timeout")},a.timeout)),g}}).call(this);
(function(){var b=[].indexOf||function(b){for(var a=0,f=this.length;a<f;a++)if(a in this&&this[a]===b)return a;return-1},d=this.Stripe,c;c=function(){};c=(c.trim=function(b){return(b+"").replace(/^\s+|\s+$/g,"")},c.underscore=function(b){return(b+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},c.underscoreKeys=function(b){var a,f,c;c=[];for(a in b)f=b[a],delete b[a],c.push(b[this.underscore(a)]=f);return c},c.isElement=function(b){return"object"!=typeof b?!1:"undefined"!=
typeof jQuery&&null!==jQuery&&b instanceof jQuery?!0:1===b.nodeType},c.paramsFromForm=function(e,a){var f,c,k,d,j,g,p;null==a&&(a=[]);"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(e=e[0]);k=e.getElementsByTagName("input");d=e.getElementsByTagName("select");j={};g=0;for(p=k.length;g<p;g++)c=k[g],f=this.underscore(c.getAttribute("data-stripe")),0>b.call(a,f)||(j[f]=c.value);k=0;for(g=d.length;k<g;k++)c=d[k],f=this.underscore(c.getAttribute("data-stripe")),0>b.call(a,f)||null!=c.selectedIndex&&
(j[f]=c.options[c.selectedIndex].value);return j},c.validateKey=function(b){if(!b||"string"!=typeof b)throw Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(b))throw Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(b))throw Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js");
},c);d.utils=c}).call(this);
(function(){var b=[].indexOf||function(b){for(var c=0,e=this.length;c<e;c++)if(c in this&&this[c]===b)return c;return-1};this.Stripe.validator={"boolean":function(b,c){if("true"!==c&&"false"!==c)return"Enter a boolean string (true or false)"},integer:function(b,c){if(!/^\d+$/.test(c))return"Enter an integer"},positive:function(b,c){if(this.integer(b,c)||!(0<parseInt(c,10)))return"Enter a positive value"},range:function(d,c){var e;if(e=parseInt(c,10),0>b.call(d,e))return"Needs to be between "+d[0]+
" and "+d[d.length-1]},required:function(b,c){if(b&&(null==c||""===c))return"Required"},year:function(b,c){if(!/^\d{4}$/.test(c))return"Enter a 4-digit year"},birthYear:function(b,c){var e;if(e=this.year(b,c))return e;if(2E3<parseInt(c,10))return"You must be over 18";if(1900>parseInt(c,10))return"Enter your birth year"},month:function(b,c){if(this.integer(b,c))return"Please enter a month";if(this.range([1,2,3,4,5,6,7,8,9,10,11,12],c))return"Needs to be between 1 and 12"},choices:function(d,c){if(0>
b.call(d,c))return"Not an acceptable value for this field"},email:function(b,c){if(!/^[^@<\s>]+@[^@<\s>]+$/.test(c))return"That doesn't look like an email address"},url:function(b,c){if(!/^https?:\/\/.+\..+/.test(c))return"Not a valid url"},usTaxID:function(b,c){if(!/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(c))return"Not a valid tax ID"},ein:function(b,c){if(!/^\d{2}-?\d{7}$/.test(c))return"Not a valid EIN"},ssnLast4:function(b,c){if(!/^\d{4}$/.test(c))return"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(b,
c){var e;a:{switch(b){case "CA":e=/^\d{3}-?\d{3}-?\d{3}$/.test(c);break a;case "US":e=!0;break a}e=void 0}if(!e)return"Not a valid ID"},bizTaxID:function(b,c){var e,a,f,m,k,h;a={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]}[b];if(null!=a){e=a[0];m=a[1];a=!1;k=0;for(h=m.length;k<h;k++)if(f=m[k],f.test(c)){a=!0;break}if(!a)return"Not a valid "+e}},zip:function(b,c){var e;a:{switch(b.toUpperCase()){case "CA":e=/^[\d\w]{6}$/.test(null!=c?c.replace(/\s+/g,""):void 0);break a;case "US":e=/^\d{5}$/.test(c)||
/^\d{9}$/.test(c);break a}e=void 0}if(!e)return"Not a valid zip"},bankAccountNumber:function(b,c){if(!/^\d{1,17}$/.test(c))return"Invalid bank account number"},usRoutingNumber:function(b){var c,e,a,f,m,k;if(!/^\d{9}$/.test(b))return"Routing number must have 9 digits";c=m=f=0;for(k=b.length-1;m<=k;c=m+=3)e=3*parseInt(b.charAt(c),10),a=7*parseInt(b.charAt(c+1),10),c=parseInt(b.charAt(c+2),10),f+=e+a+c;if(0===f||0!==f%10)return"Invalid routing number"},caRoutingNumber:function(b){if(!/^\d{5}\-\d{3}$/.test(b))return"Invalid transit number"},
routingNumber:function(b,c){switch(b.toUpperCase()){case "CA":return this.caRoutingNumber(c);case "US":return this.usRoutingNumber(c)}},phoneNumber:function(b,c){if(10!==c.replace(/[^0-9]/g,"").length)return"Invalid phone number"},bizDBA:function(b,c){if(!/^.{1,23}$/.test(c))return"Statement descriptors can only have up to 23 characters"},nameLength:function(b,c){if(1===c.length)return"Names need to be longer than one character"}}}).call(this);
pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",
new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",
map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",
generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",
list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",
tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",
admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",
subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"};
pe.routes.build_path=function(b,d){var c=pe.routes.map[b],e=c.match(/\{\{\*(.+)\}\}/);_.each(e,function(a){d[a]&&(d[a]=d[a].join("/"))});c=c.replace(/\*/,"");d=d||{};return pe.routes.clean_url(pe.templatize(c,d))};pe.routes.clean_url=function(b){return("/"+b).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var b=pe.routes.recognize_path(window.location.pathname);return b?b.params:{}};
pe.routes.recognize_path=function(b){b=pe.routes.clean_url(b);var d,c,e=_.find(_.keys(pe.routes.map),function(a){d=pe.routes.map[a];c=RegExp(d.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return c.test(b)});if(e){for(var a=_.map(d.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),f=b.match(c).slice(1,99),m={params:{}},k=function(a){return!_.isEmpty(a)},h=0;h<a.length;h++)"*"==a[h][0]&&(a[h]=a[h].replace(/\*/g,""),f[h]=_.select(f[h].replace(/\*/g,"").split("/"),k)),
m.params[a[h]]=f[h];m.path_info={name:e,template:d};return m}return!1};pe.routes.Request=function(b,d,c){pe.routes.map[b]?(this.path=b,"object"!==typeof d&&(d={id:d}),this.params=d,this.callback=c):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(b,d,c){return new pe.routes.Request(b,d,c)};pe.routes.Request.from_current_location=function(b,d,c){d=d||{};var e=pe.routes.current_url_params();return new pe.routes.Request(b,_.extend(e,d),c)};
pe.routes.Request.prototype.ajax=function(b,d){var c="function"===typeof d?d:this.callback;$.ajax({url:this.build_path(),data:this.params,type:b,success:c})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(b){this.ajax("GET",b)};pe.routes.Request.prototype.post=function(b){this.ajax("POST",b)};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},d=pe,c=function(e,a,f,c){this.form=e;this.path_name=a;this.needs_token=f;this.on_success=c;this.on_submit_button_clicked=b(this.on_submit_button_clicked,this);this.on_submit=b(this.on_submit,this);this.on_charge=b(this.on_charge,this);this.enable_submit_button=b(this.enable_submit_button,this);this.disable_submit_button=b(this.disable_submit_button,this);this.form.find("select, input[type=text]").each(function(){return $(this).val("")});
if(!this.init_stripe())return this.form.submit(function(a){return a.preventDefault()}),!1;this.errors_container=this.form.find(".Errors");this.messages_container=this.form.find(".Messages");this.card_inputs=this.form.find(".CardInput");this.billing_inputs=this.form.find(".BillingInput");this.attendee_inputs=this.form.find(".AttendeeQuestions input, .AttendeeQuestions textarea, .AttendeeQuestions select");this.buyer_inputs=this.form.find(".BuyerQuestions input, .BuyerQuestions textarea, .BuyerQuestions select");
this.processing_label=this.form.find(".ProcessingLabel");this.submit_button=this.form.find(".SubmitButton");this.submit_button.click(this.on_submit_button_clicked);this.form.submit(this.on_submit)};c.prototype.apply_values=function(b){var a=this;return _.each(b,function(b,e){return a.form.find("[data-key='"+e+"']").val(b)})};c.prototype.collect_card_data=function(b){var a;b||(b=$(".BillingInput, .CardInput"));a={};_.each(b,function(b){var e;b=$(b);"radio"===b.attr("type")&&(b=b.filter(":checked"));
if(0<b.length&&(e=b.data("key")))return a[e]=b.val()});return a};c.prototype.disable_submit_button=function(){this.submit_button.addClass("Disabled").hide();return this.processing_label.show()};c.prototype.enable_submit_button=function(){this.processing_label.hide();return this.submit_button.removeClass("Disabled").show()};c.prototype.init_stripe=function(){if(window.publishable_stripe_key)return Stripe.setPublishableKey(window.publishable_stripe_key),!0;alert("No window.publishable_stripe_key set to use stripe");
return!1};c.prototype.on_charge=function(b,a){var f,c=this;if(a&&a.error)return $("body").css("cursor","inherit"),this.show_error(a.error.message),this.enable_submit_button();this.show_message("Please wait...");f=this.collect_card_data(this.billing_inputs);f.buyer_info=this.buyer_inputs.serialize();f.attendee_info=this.attendee_inputs.serialize();f={id:f.id,ticket_order:f};f.card_token=a?a.id:"failed";return pe.routes.Request.factory(this.path_name,f).post(function(a){$("body").css("cursor","inherit");
if(1===a.status)return c.show_error(a.message),c.enable_submit_button();if(c.on_success)return c.on_success()})};c.prototype.on_submit=function(b){b&&b.preventDefault();return!1};c.prototype.collect_stripe_data=function(){var b,a;a=this.collect_card_data(this.card_inputs);b=this.collect_card_data(this.billing_inputs);a.name=""+b.first_name+" "+b.last_name;a.address_line1=b.address_1;a.address_line2=b.address_2;a.address_city=b.city;a.address_state=this.form.find("select[data-key=state]").val();a.address_country=
"USA";return a};c.prototype.charge=function(){if(!this.submit_button.hasClass("Disabled"))return this.disable_submit_button(),$("body").css("cursor","wait"),this.needs_token?Stripe.card.createToken(this.collect_stripe_data(),this.on_charge):this.on_charge()};c.prototype.on_submit_button_clicked=function(){return this.charge()};c.prototype.show_error=function(b){this.errors_container.show().html(b);this.messages_container.hide();pe.install_easing();pe.animated_scrolling(this.errors_container,10);this.card_inputs.filter(".CCType").prepend("<option value=''>Select One</option>");
return _.each(this.card_inputs,function(a){$(a).val("");return $(a).parent().find(".inline-success").remove()})};c.prototype.show_message=function(){return this.errors_container.hide()};d.StripeForm=c}).call(this);
pe.Floater=function(b,d,c){pe.init_widget(this,b);this.bottom_margin=c||0;this.start_point_div=b.find(".FloatingAreaStart");this.end_point_div=d||null;this.stop_at=this.start_from=0;this.sticked=this.is_floating=!1;this.floater=this.container.find(".Floater");this.offset=0;this.disabled=!1;this.top=parseInt(this.floater.css("margin-top"),10)||0;$(window).scroll(this.callback(this.scrolling));this.set_floating_area();pe.Floater.register_floater(this)};
pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"};pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top;this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)};
pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var b=$(window).scrollTop(),d=b+this.offset+this.bottom_margin<=this.start_from,c=b+this.offset+this.bottom_margin>this.start_from,e=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;!this.is_floating&&c&&!e&&!this.sticked?(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this)):this.is_floating&&d?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,
this)):this.end_point_div&&(!this.sticked&&e?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&b+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick())}};pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed");this.floater.removeClass("bottom");this.is_floating=!0;this.sticked=!1;this.set_offset()};
pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.sticked=!0};pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.disabled=this.sticked=!0};
pe.Floater.prototype.enable=function(){this.disabled=!1};pe.Floater.prototype.unstick=function(){this.floater.css("margin-top","");this.floater.css("top","");this.floater.css("position","");this.start_floating();this.fire_event(pe.Floater.events.FLOATING,this)};pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top","");this.floater.removeClass("fixed");this.floater.removeClass("bottom");this.sticked=this.is_floating=!1;this.set_offset()};
pe.Floater.prototype.set_offset=function(b){b&&(this.offset=b);0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")};pe.Floater.registered_floaters=[];pe.Floater.register_floater=function(b){pe.Floater.registered_floaters.push(b);pe.Floater.update_positions()};
pe.Floater.update_positions=function(){pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(b){return b.container.offset().top},null);if(pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var b=1;b<pe.Floater.registered_floaters.length;b++){var d=pe.Floater.registered_floaters[b-1].offset+pe.Floater.registered_floaters[b-1].floater.outerHeight();pe.Floater.registered_floaters[b].offset=d;pe.Floater.registered_floaters[b].is_floating&&
pe.Floater.registered_floaters[b].start_floating();pe.Floater.registered_floaters[b].set_floating_area()}};pe.Validator=function(b){this.message=b.message||"Invalid value.";this.callback=b.callback;this.unless_callback=b.unless||function(){return!1};this.options=b;this.value=b.value?b.value:function(d){return b.callback(d)}};pe.Validator.prototype.passed=function(b){return!!this.callback($(b))};pe.Validator.prototype.failed=function(b){return!this.passed(b)};pe.Validator.prototype.unless=function(){return this.unless_callback()};
pe.validation.name_validator=new pe.Validator({callback:function(b){return _.isEmpty($.trim(b.val()))?(this.message="Required.",!1):50<b.val().length?(this.message="Please shorten your name.",!1):!0},message:"Invalid name."});pe.validation.not_blank_validator=new pe.Validator({callback:function(b){return"checkbox"==b.attr("type")?$(b).is(":checked"):!_.isEmpty($.trim(b.val()))},message:"Required."});
pe.validation.cc_number_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCardNumber(b.val())},message:"Invalid card number."});pe.validation.cvc_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCVC(b.val())},message:"Invalid CVC."});pe.validation.zip_code_validator=new pe.Validator({callback:function(b){return!!b.val().match(/^\d{5}(\s*\-\s*\d{4})?$/)},message:"Please enter a valid zip code."});
pe.validation.email_format_validator=new pe.Validator({callback:function(b){return pe.validation.check_email_format(b.val())},message:"Please enter a valid email address."});pe.validation.check_email_format=function(b){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(b))};
pe.validation.email_confirmation_validator=new pe.Validator({callback:function(b){return!pe.validation.check_email_format(b.val())?!1:$(b.data("email_field")).val()!=b.val()?(this.message="Email addresses do not match.",!1):!0},message:"Please enter a valid email address."});pe.validation.check_email_format=function(b){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(b))};
(function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(b){var d,c,e,a,f;d=_.map($(b).find("select"),function(a){return $(a).val()});f=d[2];b=d[0];e=d[1];if(!f||!b||!e)return!1;c=new Date(""+b+"/"+e+"/"+f);a=c.getMonth()+1+"";d=c.getDate()+"";c=c.getFullYear()+"";return a===b&&d===e&&c===f}})}).call(this);(function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(b){return 0<b.find("input:checked").length}})}).call(this);
pe.ValidatableForm=function(b,d,c,e){pe.init_widget(this,b);this.bindings=c||{};this.chained_fields=[];this.errors={};this.rules=d||{};_.each(b.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(a){a=$(a);var b="#"+a.attr("id"),c=a.data("validator");this.rules[b]=c?eval(c):pe.validation.not_blank_validator;(c=a.data("binding"))?this.bindings[b]=c:"text"==a.attr("type")||"textarea"==a.attr("tagName")?this.bindings[b]=
"blur":this.rules[b]==pe.validation.dob_validator?a.find("select").each(this.callback(function(a,c){$(c).change(this.callback(function(){this.validate_field(b)}))})):this.bindings[b]="change"}));this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.after_submit=e;this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(b,d){"string"===typeof b?$(d).bind(b,this.callback(function(){this.validate_field(d)})):"function"===typeof b&&this.callback(b)();this.rules[d].value($(d))&&this.validate_field(d)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var b=this.validate();this.highlight_first_failed();b&&this.after_submit&&this.after_submit();return b};pe.ValidatableForm.prototype.delete_error=function(b){delete this.errors[b];_.each(this.chained_fields,function(d){_.include(d,b)&&_.each(d,function(b){this.errors[b]&&this.delete_error(b)},this)},this)};
pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var b=_.keys(this.errors)[0];this.render_field_error(b)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(b,d){this.render_field_error(d)},this)};
pe.ValidatableForm.prototype.render_field_error=function(b){var d=$(b).parents("li.input:first");0===d.length&&(d=$(b));d.find(".inline-errors").remove();d.append('<span class="inline-errors">'+this.errors[b]+"</span>");d.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(b){var d=$(b).parents("li.input:first");0===d.length&&(d=$(b));d.find(".inline-success").remove();d.append('<img class="inline-success" src="/assets/users/check.png" />');d.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(b){this.render_field_success(b)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(b){var d=this.rules[b],c=d.passed(b);d.unless()?this.delete_error(b):c?(this.delete_error(b),this.render_field_success(b)):(this.errors[b]=$(b).data("message")||d.message,this.render_field_error(b));this.toggle_submit();return c};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};
pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(b,d){b.failed(d)?this.errors[d]=$(d).data("message")||b.message:delete this.errors[d]},this);return this.valid()};pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},d=pe,c=function(c){this.container=c;this.show_message=b(this.show_message,this);this.on_submit=b(this.on_submit,this);this.show_form=b(this.show_form,this);this.click=b(this.click,this);this.link=this.container.find(".Link");this.link.click(this.show_form);this.form_container=this.container.find(".FormContainer");this.form=this.form_container.find("form");this.form.submit(this.on_submit);this.message=this.container.find(".Message")};
c.prototype.click=function(b){return this.on_click_callback=b};c.prototype.show_form=function(){var b;b=new pe.Validator({callback:function(a){a=$.trim(a.val());if(_.isEmpty(a))return this.message="Email cannot be blank.",!1;this.message="Invalid email.";return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test(a)}});new pe.ValidatableForm(this.form,{"#question_name":pe.validation.name_validator,"#question_email":b,"#question_text":pe.validation.not_blank_validator},{"#question_name":"keyup",
"#question_email":"keyup","#question_text":"keyup"});this.link.hide();this.form_container.show();return this.on_click_callback()};c.prototype.on_submit=function(b){b.preventDefault();$.post(pe.routes.build_path("ask_party_earth"),this.form.serialize(),"json");return this.show_message()};c.prototype.show_message=function(){this.form_container.hide();return this.message.show()};d.AskPartyEarth=c}).call(this);
(function(b){function d(){function a(b){b=1E12>b?c?performance.now()+performance.timing.navigationStart:f():b||f();1E3<=b-d&&(e._updateTargets(),d=b);k(a)}this.regional=[];this.regional[""]={labels:"Years Months Weeks Days Hours Minutes Seconds".split(" "),labels1:"Year Month Week Day Hour Minute Second".split(" "),compactLabels:["y","m","w","d"],whichLabels:null,digits:"0123456789".split(""),timeSeparator:":",isRTL:!1};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",
layout:"",compact:!1,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:!1,onExpiry:null,onTick:null,tickInterval:1};b.extend(this._defaults,this.regional[""]);this._serverSyncs=[];var f="function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},c=window.performance&&"function"==typeof window.performance.now,k=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
null,d=0;!k||b.noRequestAnimationFrame?(b.noRequestAnimationFrame=null,setInterval(function(){e._updateTargets()},980)):(d=window.animationStartTime||window.webkitAnimationStartTime||window.mozAnimationStartTime||window.oAnimationStartTime||window.msAnimationStartTime||f(),k(a))}b.extend(d.prototype,{markerClassName:"hasCountdown",propertyName:"countdown",_rtlClass:"countdown_rtl",_sectionClass:"countdown_section",_amountClass:"countdown_amount",_rowClass:"countdown_row",_holdingClass:"countdown_holding",
_showClass:"countdown_show",_descrClass:"countdown_descr",_timerTargets:[],setDefaults:function(a){this._resetExtraLabels(this._defaults,a);b.extend(this._defaults,a||{})},UTCDate:function(a,b,c,e,d,j,g,p){"object"==typeof b&&b.constructor==Date&&(p=b.getMilliseconds(),g=b.getSeconds(),j=b.getMinutes(),d=b.getHours(),e=b.getDate(),c=b.getMonth(),b=b.getFullYear());var n=new Date;n.setUTCFullYear(b);n.setUTCDate(1);n.setUTCMonth(c||0);n.setUTCDate(e||1);n.setUTCHours(d||0);n.setUTCMinutes((j||0)-(30>
Math.abs(a)?60*a:a));n.setUTCSeconds(g||0);n.setUTCMilliseconds(p||0);return n},periodsToSeconds:function(a){return 31557600*a[0]+2629800*a[1]+604800*a[2]+86400*a[3]+3600*a[4]+60*a[5]+a[6]},_attachPlugin:function(a,f){a=b(a);if(!a.hasClass(this.markerClassName)){var c={options:b.extend({},this._defaults),_periods:[0,0,0,0,0,0,0]};a.addClass(this.markerClassName).data(this.propertyName,c);this._optionPlugin(a,f)}},_addTarget:function(a){this._hasTarget(a)||this._timerTargets.push(a)},_hasTarget:function(a){return-1<
b.inArray(a,this._timerTargets)},_removeTarget:function(a){this._timerTargets=b.map(this._timerTargets,function(b){return b==a?null:b})},_updateTargets:function(){for(var a=this._timerTargets.length-1;0<=a;a--)this._updateCountdown(this._timerTargets[a])},_optionPlugin:function(a,f,c){a=b(a);var e=a.data(this.propertyName);if(!f||"string"==typeof f&&null==c){var d=f;return(f=(e||{}).options)&&d?f[d]:f}a.hasClass(this.markerClassName)&&(f=f||{},"string"==typeof f&&(d=f,f={},f[d]=c),f.layout&&(f.layout=
f.layout.replace(/&lt;/g,"<").replace(/&gt;/g,">")),this._resetExtraLabels(e.options,f),c=e.options.timezone!=f.timezone,b.extend(e.options,f),this._adjustSettings(a,e,null!=f.until||null!=f.since||c),f=new Date,(e._since&&e._since<f||e._until&&e._until>f)&&this._addTarget(a[0]),this._updateCountdown(a,e))},_updateCountdown:function(a,f){var c=b(a);if(f=f||c.data(this.propertyName)){c.html(this._generateHTML(f)).toggleClass(this._rtlClass,f.options.isRTL);if(b.isFunction(f.options.onTick)){var e=
"lap"!=f._hold?f._periods:this._calculatePeriods(f,f._show,f.options.significant,new Date);(1==f.options.tickInterval||0==this.periodsToSeconds(e)%f.options.tickInterval)&&f.options.onTick.apply(a,[e])}if("pause"!=f._hold&&(f._since?f._now.getTime()<f._since.getTime():f._now.getTime()>=f._until.getTime())&&!f._expiring){f._expiring=!0;if(this._hasTarget(a)||f.options.alwaysExpire)this._removeTarget(a),b.isFunction(f.options.onExpiry)&&f.options.onExpiry.apply(a,[]),f.options.expiryText&&(e=f.options.layout,
f.options.layout=f.options.expiryText,this._updateCountdown(a,f),f.options.layout=e),f.options.expiryUrl&&(window.location=f.options.expiryUrl);f._expiring=!1}else"pause"==f._hold&&this._removeTarget(a);c.data(this.propertyName,f)}},_resetExtraLabels:function(a,b){var c=!1,e;for(e in b)if("whichLabels"!=e&&e.match(/[Ll]abels/)){c=!0;break}if(c)for(e in a)e.match(/[Ll]abels[02-9]|compactLabels1/)&&(a[e]=null)},_adjustSettings:function(a,f,c){for(var e=0,e=null,d=0;d<this._serverSyncs.length;d++)if(this._serverSyncs[d][0]==
f.options.serverSync){e=this._serverSyncs[d][1];break}null!=e?(e=f.options.serverSync?e:0,a=new Date):(e=b.isFunction(f.options.serverSync)?f.options.serverSync.apply(a,[]):null,a=new Date,e=e?a.getTime()-e.getTime():0,this._serverSyncs.push([f.options.serverSync,e]));d=f.options.timezone;d=null==d?-a.getTimezoneOffset():d;if(c||!c&&null==f._until&&null==f._since)f._since=f.options.since,null!=f._since&&(f._since=this.UTCDate(d,this._determineTime(f._since,null)),f._since&&e&&f._since.setMilliseconds(f._since.getMilliseconds()+
e)),f._until=this.UTCDate(d,this._determineTime(f.options.until,a)),e&&f._until.setMilliseconds(f._until.getMilliseconds()+e);f._show=this._determineShow(f)},_destroyPlugin:function(a){a=b(a);a.hasClass(this.markerClassName)&&(this._removeTarget(a[0]),a.removeClass(this.markerClassName).empty().removeData(this.propertyName))},_pausePlugin:function(a){this._hold(a,"pause")},_lapPlugin:function(a){this._hold(a,"lap")},_resumePlugin:function(a){this._hold(a,null)},_hold:function(a,f){var c=b.data(a,
this.propertyName);if(c){if("pause"==c._hold&&!f){c._periods=c._savePeriods;var e=c._since?"-":"+";c[c._since?"_since":"_until"]=this._determineTime(e+c._periods[0]+"y"+e+c._periods[1]+"o"+e+c._periods[2]+"w"+e+c._periods[3]+"d"+e+c._periods[4]+"h"+e+c._periods[5]+"m"+e+c._periods[6]+"s");this._addTarget(a)}c._hold=f;c._savePeriods="pause"==f?c._periods:null;b.data(a,this.propertyName,c);this._updateCountdown(a,c)}},_getTimesPlugin:function(a){a=b.data(a,this.propertyName);return!a?null:"pause"==
a._hold?a._savePeriods:!a._hold?a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date)},_determineTime:function(a,b){var c;if(null==a)c=b;else if("string"==typeof a){c=a.toLowerCase();for(var d=new Date,h=d.getFullYear(),j=d.getMonth(),g=d.getDate(),p=d.getHours(),n=d.getMinutes(),d=d.getSeconds(),l=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,r=l.exec(c);r;){switch(r[2]||"s"){case "s":d+=parseInt(r[1],10);break;case "m":n+=parseInt(r[1],10);break;case "h":p+=parseInt(r[1],10);break;case "d":g+=
parseInt(r[1],10);break;case "w":g+=7*parseInt(r[1],10);break;case "o":j+=parseInt(r[1],10);g=Math.min(g,e._getDaysInMonth(h,j));break;case "y":h+=parseInt(r[1],10),g=Math.min(g,e._getDaysInMonth(h,j))}r=l.exec(c)}c=new Date(h,j,g,p,n,d,0)}else"number"==typeof a?(c=new Date,c.setTime(c.getTime()+1E3*a)):c=a;c&&c.setMilliseconds(0);return c},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_normalLabels:function(a){return a},_generateHTML:function(a){var c=this;a._periods=a._hold?
a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date);for(var d=!1,k=0,h=a.options.significant,j=b.extend({},a._show),g=0;6>=g;g++)d|="?"==a._show[g]&&0<a._periods[g],j[g]="?"==a._show[g]&&!d?null:a._show[g],k+=j[g]?1:0,h-=0<a._periods[g]?1:0;for(var p=[!1,!1,!1,!1,!1,!1,!1],g=6;0<=g;g--)a._show[g]&&(a._periods[g]?p[g]=!0:(p[g]=0<h,h--));var n=a.options.compact?a.options.compactLabels:a.options.labels,l=a.options.whichLabels||this._normalLabels,d=function(b){var e=a.options["compactLabels"+
l(a._periods[b])];return j[b]?c._translateDigits(a,a._periods[b])+(e?e[b]:n[b])+" ":""},h=function(b){var d=a.options["labels"+l(a._periods[b])];return!a.options.significant&&j[b]||a.options.significant&&p[b]?'<span class="'+e._sectionClass+'"><span class="'+e._amountClass+'">'+c._translateDigits(a,a._periods[b])+"</span><br/>"+(d?d[b]:n[b])+"</span>":""};return a.options.layout?this._buildLayout(a,j,a.options.layout,a.options.compact,a.options.significant,p):(a.options.compact?'<span class="'+this._rowClass+
" "+this._amountClass+(a._hold?" "+this._holdingClass:"")+'">'+d(0)+d(1)+d(2)+d(3)+(j[4]?this._minDigits(a,a._periods[4],2):"")+(j[5]?(j[4]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[5],2):"")+(j[6]?(j[4]||j[5]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[6],2):""):'<span class="'+this._rowClass+" "+this._showClass+(a.options.significant||k)+(a._hold?" "+this._holdingClass:"")+'">'+h(0)+h(1)+h(2)+h(3)+h(4)+h(5)+h(6))+"</span>"+(a.options.description?'<span class="'+this._rowClass+
" "+this._descrClass+'">'+a.options.description+"</span>":"")},_buildLayout:function(a,c,e,d,h,j){var g=a.options[d?"compactLabels":"labels"],p=a.options.whichLabels||this._normalLabels,n=function(b){return(a.options[(d?"compactLabels":"labels")+p(a._periods[b])]||g)[b]},l=function(b,c){return a.options.digits[Math.floor(b/c)%10]},n={desc:a.options.description,sep:a.options.timeSeparator,yl:n(0),yn:this._minDigits(a,a._periods[0],1),ynn:this._minDigits(a,a._periods[0],2),ynnn:this._minDigits(a,a._periods[0],
3),y1:l(a._periods[0],1),y10:l(a._periods[0],10),y100:l(a._periods[0],100),y1000:l(a._periods[0],1E3),ol:n(1),on:this._minDigits(a,a._periods[1],1),onn:this._minDigits(a,a._periods[1],2),onnn:this._minDigits(a,a._periods[1],3),o1:l(a._periods[1],1),o10:l(a._periods[1],10),o100:l(a._periods[1],100),o1000:l(a._periods[1],1E3),wl:n(2),wn:this._minDigits(a,a._periods[2],1),wnn:this._minDigits(a,a._periods[2],2),wnnn:this._minDigits(a,a._periods[2],3),w1:l(a._periods[2],1),w10:l(a._periods[2],10),w100:l(a._periods[2],
100),w1000:l(a._periods[2],1E3),dl:n(3),dn:this._minDigits(a,a._periods[3],1),dnn:this._minDigits(a,a._periods[3],2),dnnn:this._minDigits(a,a._periods[3],3),d1:l(a._periods[3],1),d10:l(a._periods[3],10),d100:l(a._periods[3],100),d1000:l(a._periods[3],1E3),hl:n(4),hn:this._minDigits(a,a._periods[4],1),hnn:this._minDigits(a,a._periods[4],2),hnnn:this._minDigits(a,a._periods[4],3),h1:l(a._periods[4],1),h10:l(a._periods[4],10),h100:l(a._periods[4],100),h1000:l(a._periods[4],1E3),ml:n(5),mn:this._minDigits(a,
a._periods[5],1),mnn:this._minDigits(a,a._periods[5],2),mnnn:this._minDigits(a,a._periods[5],3),m1:l(a._periods[5],1),m10:l(a._periods[5],10),m100:l(a._periods[5],100),m1000:l(a._periods[5],1E3),sl:n(6),sn:this._minDigits(a,a._periods[6],1),snn:this._minDigits(a,a._periods[6],2),snnn:this._minDigits(a,a._periods[6],3),s1:l(a._periods[6],1),s10:l(a._periods[6],10),s100:l(a._periods[6],100),s1000:l(a._periods[6],1E3)},r=e;for(e=0;6>=e;e++)l="yowdhms".charAt(e),r=r.replace(RegExp("\\{"+l+"<\\}([\\s\\S]*)\\{"+
l+">\\}","g"),!h&&c[e]||h&&j[e]?"$1":"");b.each(n,function(a,b){r=r.replace(RegExp("\\{"+a+"\\}","g"),b)});return r},_minDigits:function(a,b,c){b=""+b;if(b.length>=c)return this._translateDigits(a,b);b="0000000000"+b;return this._translateDigits(a,b.substr(b.length-c))},_translateDigits:function(a,b){return(""+b).replace(/[0-9]/g,function(b){return a.options.digits[b]})},_determineShow:function(a){a=a.options.format;var b=[];b[0]=a.match("y")?"?":a.match("Y")?"!":null;b[1]=a.match("o")?"?":a.match("O")?
"!":null;b[2]=a.match("w")?"?":a.match("W")?"!":null;b[3]=a.match("d")?"?":a.match("D")?"!":null;b[4]=a.match("h")?"?":a.match("H")?"!":null;b[5]=a.match("m")?"?":a.match("M")?"!":null;b[6]=a.match("s")?"?":a.match("S")?"!":null;return b},_calculatePeriods:function(a,b,c,d){a._now=d;a._now.setMilliseconds(0);var h=new Date(a._now.getTime());a._since?d.getTime()<a._since.getTime()?a._now=d=h:d=a._since:(h.setTime(a._until.getTime()),d.getTime()>a._until.getTime()&&(a._now=d=h));var j=[0,0,0,0,0,0,
0];if(b[0]||b[1]){var g=e._getDaysInMonth(d.getFullYear(),d.getMonth()),p=e._getDaysInMonth(h.getFullYear(),h.getMonth()),p=h.getDate()==d.getDate()||h.getDate()>=Math.min(g,p)&&d.getDate()>=Math.min(g,p),p=Math.max(0,12*(h.getFullYear()-d.getFullYear())+h.getMonth()-d.getMonth()+(h.getDate()<d.getDate()&&!p||p&&60*(60*h.getHours()+h.getMinutes())+h.getSeconds()<60*(60*d.getHours()+d.getMinutes())+d.getSeconds()?-1:0));j[0]=b[0]?Math.floor(p/12):0;j[1]=b[1]?p-12*j[0]:0;d=new Date(d.getTime());g=d.getDate()==
g;p=e._getDaysInMonth(d.getFullYear()+j[0],d.getMonth()+j[1]);d.getDate()>p&&d.setDate(p);d.setFullYear(d.getFullYear()+j[0]);d.setMonth(d.getMonth()+j[1]);g&&d.setDate(p)}var n=Math.floor((h.getTime()-d.getTime())/1E3);d=function(a,c){j[a]=b[a]?Math.floor(n/c):0;n-=j[a]*c};d(2,604800);d(3,86400);d(4,3600);d(5,60);d(6,1);if(0<n&&!a._since){a=[1,12,4.3482,7,24,60,60];d=6;h=1;for(g=6;0<=g;g--)b[g]&&(j[d]>=h&&(j[d]=0,n=1),0<n&&(j[g]++,n=0,d=g,h=1)),h*=a[g]}if(c)for(g=0;6>=g;g++)c&&j[g]?c--:c||(j[g]=
0);return j}});var c=["getTimes"];b.fn.countdown=function(a){var f=Array.prototype.slice.call(arguments,1),d;d="option"==a&&(0==f.length||1==f.length&&"string"==typeof f[0])?!0:-1<b.inArray(a,c);return d?e["_"+a+"Plugin"].apply(e,[this[0]].concat(f)):this.each(function(){if("string"==typeof a){if(!e["_"+a+"Plugin"])throw"Unknown command: "+a;e["_"+a+"Plugin"].apply(e,[this].concat(f))}else e._attachPlugin(this,a||{})})};var e=b.countdown=new d})(jQuery);
(function(b){var d=(b.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};b.fn.extend({caret:function(b,a){if(0!=this.length){if("number"==typeof b)return a="number"==typeof a?a:b,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(b,a);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0);c.moveEnd("character",a);c.moveStart("character",b);c.select()}});if(this[0].setSelectionRange)b=
this[0].selectionStart,a=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var c=document.selection.createRange();b=0-c.duplicate().moveStart("character",-1E5);a=b+c.text.length}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(e,a){if(!e&&0<this.length){var f=b(this[0]),m=f.data("tests");return b.map(f.data("buffer"),function(a,b){return m[b]?a:null}).join("")}a=b.extend({placeholder:"_",completed:null},a);var k=b.mask.definitions,
m=[],h=e.length,j=null,g=e.length;b.each(e.split(""),function(a,b){"?"==b?(g--,h=a):k[b]?(m.push(RegExp(k[b])),null==j&&(j=m.length-1)):m.push(null)});return this.each(function(){function f(a){for(;++a<=g&&!m[a];);return a}function n(e){var d=b(this).caret();e=e.keyCode;v=16>e||16<e&&32>e||32<e&&41>e;0!=d.begin-d.end&&(!v||8==e||46==e)&&r(d.begin,d.end);if(8==e||46==e||c&&127==e){for(d=d.begin+(46==e?0:-1);!m[d]&&0<=--d;);for(e=d;e<g;e++)if(m[e]){s[e]=a.placeholder;var h=f(e);if(h<g&&m[e].test(s[h]))s[e]=
s[h];else break}u();q.caret(Math.max(j,d));return!1}if(27==e)return q.val(w),q.caret(0,t()),!1}function l(c){if(v)return v=!1,8==c.keyCode?!1:null;c=c||window.event;var e=c.charCode||c.keyCode||c.which,d=b(this).caret();if(c.ctrlKey||c.altKey||c.metaKey)return!0;if(32<=e&&125>=e||186<e)if(c=f(d.begin-1),c<g&&(e=String.fromCharCode(e),m[c].test(e))){for(var d=c,h=a.placeholder;d<g;d++)if(m[d]){var j=f(d),k=s[d];s[d]=h;if(j<g&&m[j].test(k))h=k;else break}s[c]=e;u();c=f(c);b(this).caret(c);a.completed&&
c==g&&a.completed.call(q)}return!1}function r(b,c){for(var e=b;e<c&&e<g;e++)m[e]&&(s[e]=a.placeholder)}function u(){return q.val(s.join("")).val()}function t(b){for(var c=q.val(),e=-1,d=0,f=0;d<g;d++)if(m[d]){for(s[d]=a.placeholder;f++<c.length;){var k=c.charAt(f-1);if(m[d].test(k)){s[d]=k;e=d;break}}if(f>c.length)break}else s[d]==c[f]&&d!=h&&(f++,e=d);if(!b&&e+1<h)q.val(""),r(0,g);else if(b||e+1>=h)u(),b||q.val(q.val().substring(0,e+1));return h?d:j}var q=b(this),s=b.map(e.split(""),function(b){if("?"!=
b)return k[b]?a.placeholder:b}),v=!1,w=q.val();q.data("buffer",s).data("tests",m);q.attr("readonly")||q.one("unmask",function(){q.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){w=q.val();var a=t();u();setTimeout(function(){a==e.length?q.caret(0,a):q.caret(a)},0)}).bind("blur.mask",function(){t();q.val()!=w&&q.change()}).bind("keydown.mask",n).bind("keypress.mask",l).bind(d,function(){setTimeout(function(){q.caret(t(!0))},0)});t()})}})})(jQuery);
pe.HelpModule=function(b,d,c){pe.init_widget(this,b);this.help_module_open=!1;this.help_id=d;this.container.append(this.html(c));this.container.click(this.callback(this.help_button_clicked));this.help_button_div=this.container.find(".HelpButton");(this.admin_link=this.container.find(".AdminLink"))&&this.admin_link.click(this.callback(this.admin_link_clicked))};
pe.HelpModule.prototype.html=function(b){var d="";0===this.container.contents().length&&(d+='<div class="help_btn HelpButton"></div>');b&&(d+='<div><a class="AdminLink admin_edit" target="_blank" href="/admin/pages/'+this.help_id+'/edit">Edit Tip</a></div>');return d};pe.HelpModule.prototype.admin_link_clicked=function(b){b.stopPropagation()};
pe.HelpModule.prototype.help_button_clicked=function(b){this.help_module_open?b.stopPropagation():pe.ajax_loader.help_page.load({page_id:this.help_id},this.callback(function(b){b=$(this.dialog_box_html(b));this.help_button_div.append(b);this.help_module_open=!0;new pe.CloseButton(b,this.callback(this.close_dialog,b))}))};
pe.HelpModule.prototype.dialog_box_html=function(b){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <h1>{{title}}</h1>{{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',b)};pe.HelpModule.prototype.close_dialog=function(b,d){this.help_module_open=!1;b.remove();d.stopPropagation()};
(function(){pe.validation.promo_code_validator=new pe.Validator({message:"Invalid code",callback:function(b){b=$.trim(b.val());this.message="Invalid code";return _.isEmpty(b)?(this.message="Please enter a promo code",!1):25<b.length?(this.message="Length is limited by 25 characters",!1):/^[\w-_@.]+$/.test(b)}})}).call(this);
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},d=pe,c=function(c){var a=this;this.container=c;this.remove_promo=b(this.remove_promo,this);this.assign_promo=b(this.assign_promo,this);this.apply_promo=b(this.apply_promo,this);this.input=this.container.find(".Input");this.input.val(this.container.data("value"));this.input.keypress(function(b){if(13===b.keyCode)return a.apply_promo()});this.apply_button=this.container.find(".ApplyCodeButton");this.apply_button.data("label",
this.apply_button.html());this.remove_button=this.container.find(".RemoveCodeButton");this.remove_button.data("label",this.remove_button.html());this.apply_button.click(this.apply_promo);this.remove_button.click(this.remove_promo);this.container.find(".Toggler").click(function(){a.container.find(".Fields").show();a.container.find(".Toggler").hide();return a.input.focus()});this.error=this.container.find(".Error");this.message=this.container.find(".Message");this.container.data("valid")?this.assign_promo():
this.initialize()};c.prototype.promo_code_entered=function(){return!_.isEmpty(this.promo_code())};c.prototype.promo_code=function(){return this.input.val()};c.prototype.hide_error=function(){this.error.html("");return this.error.hide()};c.prototype.show_error=function(b){this.error.html("<span>"+b+"</span>");return this.error.show()};c.prototype.show_message=function(b){this.message.html(b);return this.message.show()};c.prototype.hide_message=function(){return this.message.hide()};c.prototype.initialize=
function(){this.promo_code_entered()?(this.container.find(".Toggler").hide(),this.container.find(".Fields").show()):(this.container.find(".Fields").hide(),this.container.find(".Toggler").show());this.input.show();return this.apply_button.show()};c.prototype.reload_table=function(){var b,a;b=$(this.container.data("target"));b.css("opacity",0.5);a=b.data("url");return $.get(a,function(a){b.replaceWith(a);$(".TotalAmount").html($(".Supermoney").html());return pe.load_order_form()})};c.prototype.apply_promo=
function(){var b,a=this;return pe.validation.promo_code_validator.passed(this.input)?(this.error.hide(),this.apply_button.html("Please wait...").addClass("disabled"),b={},b.ticket_order={promo:this.promo_code()},pe.routes.Request.from_current_location("api_apply_ticket_order_promo_code",b).post(function(b){a.apply_button.html(a.apply_button.data("label"));a.apply_button.removeClass("disabled");if(1===b.status)return a.show_error(b.message);a.hide_message();a.assign_promo();return a.reload_table()})):
this.show_error(pe.validation.promo_code_validator.message)};c.prototype.applied=function(){return this.container.data("applied")};c.prototype.assign_promo=function(){this.container.data("applied",!0);this.container.find(".Fields").show();this.container.find(".Toggler").hide();this.input.hide();this.apply_button.hide();this.hide_error();this.show_message("Promo Applied: "+this.promo_code());return this.remove_button.show()};c.prototype.remove_promo=function(){var b=this;this.container.data("applied",
!1);this.remove_button.addClass("disabled").html("Please wait...");return pe.routes.Request.from_current_location("api_remove_ticket_order_promo_code").post(function(a){b.remove_button.html(b.remove_button.data("label"));b.remove_button.removeClass("disabled");if(1===a.status)return b.show_error(a.message);b.hide_error();b.reload_table();b.container.find(".Fields").show();b.hide_error();b.hide_message();b.remove_button.hide();b.input.val("");b.input.show();return b.apply_button.show()})};d.TicketPromoApplier=
c;pe.on_expire=function(){window.onbeforeunload=null;$(".Timer").html("0:00");alert("The time limit has been exceeded and your tickets have been released. \n\nThe purpose of the time limit is to give all fans a fair shot at tickets and ensure tickets are available to as many people as possible. We are sorry for the inconvenience.");$("body").css("cursor","wait");return pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){return window.location=pe.routes.build_path("tickets",
pe.routes.current_url_params())})};pe.on_tick=function(){return $(".Timer").html($(".Timer").html().replace(/0(\d+):/,"$1:"))};window.onbeforeunload=function(){return"You have not completed the purchase process."};pe.check_order_status=function(){return pe.routes.Request.factory("api_ticket_order_status",{id:pe.order_id}).get(function(b){if("pending"!==b.status)return window.onbeforeunload=null,alert("You already ordered this tickets"),window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())})};
$(function(){return pe.init_page_framework(function(){setTimeout(function(){return pe.check_order_status()},5);pe.routes.Request.factory("api_ticket_orders_countdown_seconds").get(function(b){var a;a=new Date;a=new Date(a.getTime()+1E3*b.data.seconds);return $(".Timer").countdown({until:a,compact:!0,format:"MS",description:"",onExpiry:pe.on_expire,onTick:pe.on_tick})});$(".EditOrderLink").click(function(b){window.onbeforeunload=null;if(confirm("Your tickets will be released for others to purchase if you leave this page.\n\nDo you wish to forfeit your tickets?"))return $(this).html("Please wait..."),
$("body").css("cursor","wait"),pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){var a;a=pe.routes.build_path("tickets",pe.routes.current_url_params());pe.promo&&pe.promo.applied()&&(a=""+a+"?promo="+pe.promo.promo_code());return window.location=a});b.preventDefault();return b.stopPropagation()});pe.load_order_form();setTimeout(function(){return pe.promo=new pe.TicketPromoApplier($(".PromoCode"))},5);pe.right_rail_floater=new pe.Floater($(".FloaterContainer"),$(".FloaterLimiter"));
pe.ask_party_earth=new pe.AskPartyEarth($(".AskPartyEarth"));return pe.ask_party_earth.click(function(){pe.right_rail_floater.start_floating();return pe.right_rail_floater.scrolling()})})});pe.init_has_email_delivery=function(){return $(".HasEmailDelivery").change(function(){return"true"===$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")})};
pe.load_order_form=function(){var b;b=pe.free_form;pe.free_form=pe.page_container.find(".ReloadArea").data("free");pe.order_tickets_form&&(pe.form_data=pe.order_tickets_form.collect_card_data());if(b!==pe.free_form)return pe.free_form?pe.load_free_order_form():pe.load_purchase_form()};pe.load_free_order_form=function(){return pe.routes.Request.from_current_location("tickets_purchase_form").get(function(b){pe.page_container.find(".FormContainer").html(b);pe.init_free_order_form();if(pe.form_data&&
pe.form)return pe.order_tickets_form.apply_values(pe.form_data),pe.form.validate()})};pe.load_purchase_form=function(){return pe.routes.Request.from_current_location("tickets_purchase_form").get(function(b){pe.page_container.find(".FormContainer").html(b);pe.init_full_purchase_form();if(pe.form_data&&pe.form)return pe.order_tickets_form.apply_values(pe.form_data),pe.form.validate(),$(".Phone").mask("(999) 999-9999")})};pe.init_free_order_form=function(){var b,a,c;$("#OrderTicketsPaypalForm").hide();
a=$("#OrderTicketsForm");if(0<a.length)return pe.order_tickets_form=new pe.StripeForm(a,"api_close_ticket_order",!1,function(){window.onbeforeunload=null;return window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),c={"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Email":pe.validation.email_format_validator,"#ConfirmEmail":pe.validation.email_confirmation_validator},b={"#FirstName":"blur","#LastName":"blur","#Email":"blur",
"#ConfirmEmail":"blur"},$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")}),$("#Phone").mask("(999) 999-9999"),$(".Phone").mask("(999) 999-9999"),pe.form=new pe.ValidatableForm(a,c,b),b=a.find(".SubmitButton"),b.unbind("click"),b.click(function(a){a.preventDefault();a.stopPropagation();pe.form.on_submit()&&pe.order_tickets_form.charge();return!1}),pe.init_has_email_delivery()};pe.init_full_purchase_form=function(){var b,a,c,d;a=$("#OrderTicketsForm");0<a.length&&($(".CCType").change(function(){var a,
b,c;_.isEmpty($(".CCType").val())?$(".CCContainer").hide():$(".CCContainer").show();"PayPal"===$(this).val()?($("#OrderTicketsForm").hide(),$("#OrderTicketsPaypalForm").show(),$(".AdditionalInfo").appendTo($("#OrderTicketsPaypalForm .AdditionalInfoContainer")),b=$("#OrderTicketsPaypalForm"),0<b.length&&(pe.init_has_email_delivery(),c={"#PayPalEmail":pe.validation.email_format_validator,"#PayPalConfirmEmail":pe.validation.email_confirmation_validator},a={"#PayPalEmail":"blur","#PayPalConfirmEmail":"blur"},
pe.paypal_form=new pe.ValidatableForm(b,c,a,function(){window.onbeforeunload=null;return b.submit()}))):($("#OrderTicketsForm").show(),$("#OrderTicketsPaypalForm").hide(),$(".AdditionalInfo").appendTo($("#OrderTicketsForm .AdditionalInfoContainer")));return $(".CCType").val($(this).val())}),$(".CCType").change(),$(".CCType").change(function(){return $(this).find('option[value=""]').remove()}),pe.order_tickets_form=new pe.StripeForm(a,"api_close_ticket_order",!0,function(){window.onbeforeunload=null;
return window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),c=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||_.isEmpty($("#ExpYear").val())}}),d=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||
_.isEmpty($("#ExpYear").val())}}));c={"#payment_type":new pe.Validator({message:"Please select payment type matching card info",callback:function(){return Stripe.card.cardType($("#CardNumber").val())===$("#payment_type").val()},unless:function(){return!pe.validation.cc_number_validator.passed($("#CardNumber"))}}),"#CardNumber":pe.validation.cc_number_validator,"#ExpMonth":c,"#ExpYear":d,"#Cvc":pe.validation.cvc_validator,"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,
"#Address1":pe.validation.not_blank_validator,"#City":pe.validation.not_blank_validator,"#state":pe.validation.not_blank_validator,"#Zip":pe.validation.zip_code_validator,"#Email":pe.validation.email_format_validator,"#ConfirmEmail":pe.validation.email_confirmation_validator};$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")});$("#Phone").mask("(999) 999-9999");$(".Phone").mask("(999) 999-9999");pe.form=new pe.ValidatableForm(a,c,{"#payment_type":"change","#CardNumber":"blur",
"#ExpMonth":"change","#ExpYear":"change","#Cvc":"blur","#FirstName":"blur","#LastName":"blur","#Address1":"blur","#City":"blur","#state":"change","#Zip":"blur","#Email":"blur","#ConfirmEmail":"blur"});a=a.find(".SubmitButton");a.unbind("click");a.click(function(a){a.preventDefault();a.stopPropagation();pe.form.on_submit()&&pe.order_tickets_form.charge();return!1});$(".CCTypeButton").click(function(){$(".CCTypeButton").removeClass("selected").addClass("disabled");$(this).addClass("selected");$(".CCType").val($(this).data("value"));
$(".CCType").change();return pe.form.validate_field("#payment_type")});$(".BillingInput[name=has_email_delivery]").change(function(){return"true"===$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")});b=$(".CodeTipContent");if(0<b.length)return $(".CodeTipLink").click(function(){return b.toggle()}),$(".CodeTipClose").click(function(){return b.hide()})}}).call(this);
