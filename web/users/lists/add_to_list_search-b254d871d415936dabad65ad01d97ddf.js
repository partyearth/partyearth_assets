(function(){var d=function(a,b){return function(){return a.apply(b,arguments)}},e=pe,c=function(a){this.container=a;this.on_add_button_clicked=d(this.on_add_button_clicked,this);this.on_dialog_closed=d(this.on_dialog_closed,this);this.on_tab_button_clicked=d(this.on_tab_button_clicked,this);this.on_search_button_clicked=d(this.on_search_button_clicked,this);this.on_city_changed=d(this.on_city_changed,this);this.on_keypress=d(this.on_keypress,this);this.input=this.container.find(".Input");this.input.keyup(this.on_keypress);
this.placeholder=this.input.attr("placeholder");this.autocomplete_container=this.container.find(".Autocomplete");this.tab_button=this.container.find(".TabButton");this.tab_button.click(this.on_tab_button_clicked);this.city_dropdown=this.container.find(".CityDropdown");this.city_dropdown.change(this.on_city_changed);this.search_button=this.container.find(".SearchButton");this.search_button.click(this.on_search_button_clicked);this.search_results_container=this.container.find(".SearchResults");pe.bind_toggle_trigger(this.container.find(".ToggleAddToListOptionsTrigger"),
this.container.find(".TabButtonsContainer"));this.dialog_container=this.container.find(".Dialog");this.dialog=this.dialog_container.dialog({title:"Search and add to list",modal:!0,width:"auto",height:"auto",position:["middle","middle"],autoOpen:!1,close:this.on_dialog_closed})};c.prototype.on_keypress=function(a){if(13===a.keyCode)return this.on_search_button_clicked(),a.preventDefault();this.input.removeClass("invalid");this.input.val()===this.placeholder&&this.input.val("");return 2<this.input.val().length?
this.show_autocomplete():this.hide_autocomplete()};c.prototype.show_autocomplete=function(){var a,b=this;a=this.get_query();this.request=new pe.routes.Request("search_autocomplete",{city_id:this.city_dropdown.val(),query:a,result_types:this.tab_id});return this.request.post(function(a){b.autocomplete_container.show();b.autocomplete_container.html(a);_.isEmpty(a)&&b.hide_autocomplete();return b.autocomplete_container.find("li").click(function(a){b.input.val($(a.currentTarget).data("label"));return b.on_search_button_clicked()})})};
c.prototype.hide_autocomplete=function(){this.autocomplete_container.html("");return this.autocomplete_container.hide()};c.prototype.on_city_changed=function(){return this.query=null};c.prototype.on_search_button_clicked=function(){var a,b=this;a=this.get_query();if(_.isEmpty(a))return this.input.addClass("invalid"),this.input.val(this.placeholder),this.search_results_container.html("");if(this.query!==a)return this.query=a,this.search_results_container.html('<div class="lspinner" style="text-align: center;"><h2>Please Wait</h2><img src="/assets/content_bg/spinner.gif"/></div>'),
a={result_types:this.tab_id,query:this.query,city_id:this.city_dropdown.val()},pe.routes.Request.from_current_location("list_items",a).get(function(a){b.hide_autocomplete();b.search_results_container.html(a);b.search_results_container.find(".AddButton").click(b.on_add_button_clicked);return b.dialog.dialog("option","position",["middle","middle"])})};c.prototype.get_query=function(){var a;this.input.val(this.input.val().replace(/\s+/g," ").replace(/^\s+$/g,""));a=this.input.val();a===this.placeholder&&
(a="");return a};c.prototype.on_tab_button_clicked=function(a){$("body").css("overflow","hidden");this.change_tab($(a.currentTarget).data("tab"));this.dialog.dialog("open");return this.reset_input()};c.prototype.reset_input=function(){this.input.removeClass("invalid");if(this.input.val()===this.placeholder)return this.input.val("")};c.prototype.select_tab=function(a){this.hide_autocomplete();this.tab_button.removeClass("active");this.tab_button.filter("."+a).addClass("active");this.tab_id=a;return this.query=
null};c.prototype.change_tab=function(a){if(this.tab_id!==a)return this.select_tab(a),this.on_search_button_clicked()};c.prototype.on_dialog_closed=function(){this.dialog.dialog("open");this.dialog.html('<div class="lspinner" style="text-align: center;"><h2>Please Wait</h2><img src="/assets/content_bg/spinner.gif"/></div>');this.dialog.dialog("option","position",["middle","middle"]);return window.location.reload()};c.prototype.on_add_button_clicked=function(a){var b,c;b=$(a.currentTarget);if(!b.hasClass("Disabled"))return b.addClass("disabled Disabled"),
b.html("Add"),a=b.data("id"),c=b.data("type"),a={favorite:{listable_id:a,listable_type:c}},pe.routes.Request.from_current_location("api_user_list_favorites",a).post(function(){return b.html("Added")})};e.AddToListSearch=c}).call(this);
