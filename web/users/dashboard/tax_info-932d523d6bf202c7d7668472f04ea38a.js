(function(b){var a=(b.browser.msie?"paste":"input")+".mask",f=void 0!=window.orientation;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};b.fn.extend({caret:function(b,a){if(0!=this.length){if("number"==typeof b)return a="number"==typeof a?a:b,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(b,a);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0);c.moveEnd("character",a);c.moveStart("character",b);c.select()}});if(this[0].setSelectionRange)b=
this[0].selectionStart,a=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var d=document.selection.createRange();b=0-d.duplicate().moveStart("character",-1E5);a=b+d.text.length}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(h,l){if(!h&&0<this.length){var d=b(this[0]),c=d.data("tests");return b.map(d.data("buffer"),function(b,a){return c[a]?b:null}).join("")}l=b.extend({placeholder:"_",completed:null},l);var t=b.mask.definitions,
c=[],n=h.length,q=null,m=h.length;b.each(h.split(""),function(b,a){"?"==a?(m--,n=b):t[a]?(c.push(RegExp(t[a])),null==q&&(q=c.length-1)):c.push(null)});return this.each(function(){function d(b){for(;++b<=m&&!c[b];);return b}function w(a){var j=b(this).caret();a=a.keyCode;r=16>a||16<a&&32>a||32<a&&41>a;0!=j.begin-j.end&&(!r||8==a||46==a)&&v(j.begin,j.end);if(8==a||46==a||f&&127==a){for(j=j.begin+(46==a?0:-1);!c[j]&&0<=--j;);for(a=j;a<m;a++)if(c[a]){k[a]=l.placeholder;var e=d(a);if(e<m&&c[a].test(k[e]))k[a]=
k[e];else break}s();g.caret(Math.max(q,j));return!1}if(27==a)return g.val(u),g.caret(0,p()),!1}function x(a){if(r)return r=!1,8==a.keyCode?!1:null;a=a||window.event;var j=a.charCode||a.keyCode||a.which,e=b(this).caret();if(a.ctrlKey||a.altKey||a.metaKey)return!0;if(32<=j&&125>=j||186<j)if(a=d(e.begin-1),a<m&&(j=String.fromCharCode(j),c[a].test(j))){for(var e=a,f=l.placeholder;e<m;e++)if(c[e]){var h=d(e),n=k[e];k[e]=f;if(h<m&&c[h].test(n))f=n;else break}k[a]=j;s();a=d(a);b(this).caret(a);l.completed&&
a==m&&l.completed.call(g)}return!1}function v(a,b){for(var e=a;e<b&&e<m;e++)c[e]&&(k[e]=l.placeholder)}function s(){return g.val(k.join("")).val()}function p(a){for(var b=g.val(),e=-1,d=0,f=0;d<m;d++)if(c[d]){for(k[d]=l.placeholder;f++<b.length;){var h=b.charAt(f-1);if(c[d].test(h)){k[d]=h;e=d;break}}if(f>b.length)break}else k[d]==b[f]&&d!=n&&(f++,e=d);if(!a&&e+1<n)g.val(""),v(0,m);else if(a||e+1>=n)s(),a||g.val(g.val().substring(0,e+1));return n?d:q}var g=b(this),k=b.map(h.split(""),function(a){if("?"!=
a)return t[a]?l.placeholder:a}),r=!1,u=g.val();g.data("buffer",k).data("tests",c);g.attr("readonly")||g.one("unmask",function(){g.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){u=g.val();var a=p();s();setTimeout(function(){a==h.length?g.caret(0,a):g.caret(a)},0)}).bind("blur.mask",function(){p();g.val()!=u&&g.change()}).bind("keydown.mask",w).bind("keypress.mask",x).bind(a,function(){setTimeout(function(){g.caret(p(!0))},0)});p()})}})})(jQuery);
pe.Validator=function(b){this.message=b.message||"Invalid value.";this.callback=b.callback;this.unless_callback=b.unless||function(){return!1};this.options=b;this.value=b.value?b.value:function(a){return b.callback(a)}};pe.Validator.prototype.passed=function(b){return!!this.callback($(b))};pe.Validator.prototype.failed=function(b){return!this.passed(b)};pe.Validator.prototype.unless=function(){return this.unless_callback()};
pe.validation.name_validator=new pe.Validator({callback:function(b){return _.isEmpty($.trim(b.val()))?(this.message="Required.",!1):50<b.val().length?(this.message="Please shorten your name.",!1):!0},message:"Invalid name."});pe.validation.not_blank_validator=new pe.Validator({callback:function(b){return"checkbox"==b.attr("type")?$(b).is(":checked"):!_.isEmpty($.trim(b.val()))},message:"Required."});
(function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(b){var a,f,h,l,d;a=_.map($(b).find("select"),function(a){return $(a).val()});d=a[2];b=a[0];h=a[1];if(!d||!b||!h)return!1;f=new Date(""+b+"/"+h+"/"+d);l=f.getMonth()+1+"";a=f.getDate()+"";f=f.getFullYear()+"";return l===b&&a===h&&f===d}})}).call(this);(function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(b){return 0<b.find("input:checked").length}})}).call(this);
pe.ValidatableForm=function(b,a,f,h){pe.init_widget(this,b);this.bindings=f||{};this.chained_fields=[];this.errors={};this.rules=a||{};_.each(b.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(a){a=$(a);var b="#"+a.attr("id"),c=a.data("validator");this.rules[b]=c?eval(c):pe.validation.not_blank_validator;(c=a.data("binding"))?this.bindings[b]=c:"text"==a.attr("type")||"textarea"==a.attr("tagName")?this.bindings[b]=
"blur":this.rules[b]==pe.validation.dob_validator?a.find("select").each(this.callback(function(a,c){$(c).change(this.callback(function(){this.validate_field(b)}))})):this.bindings[b]="change"}));this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.after_submit=h;this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(b,a){"string"===typeof b?$(a).bind(b,this.callback(function(){this.validate_field(a)})):"function"===typeof b&&this.callback(b)();this.rules[a].value($(a))&&this.validate_field(a)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var b=this.validate();this.highlight_first_failed();b&&this.after_submit&&this.after_submit();return b};pe.ValidatableForm.prototype.delete_error=function(b){delete this.errors[b];_.each(this.chained_fields,function(a){_.include(a,b)&&_.each(a,function(a){this.errors[a]&&this.delete_error(a)},this)},this)};
pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var b=_.keys(this.errors)[0];this.render_field_error(b)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(b,a){this.render_field_error(a)},this)};
pe.ValidatableForm.prototype.render_field_error=function(b){var a=$(b).parents("li.input:first");0===a.length&&(a=$(b));a.find(".inline-errors").remove();a.append('<span class="inline-errors">'+this.errors[b]+"</span>");a.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(b){var a=$(b).parents("li.input:first");0===a.length&&(a=$(b));a.find(".inline-success").remove();a.append('<img class="inline-success" src="/assets/users/check.png" />');a.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(b){this.render_field_success(b)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(b){var a=this.rules[b],f=a.passed(b);a.unless()?this.delete_error(b):f?(this.delete_error(b),this.render_field_success(b)):(this.errors[b]=$(b).data("message")||a.message,this.render_field_error(b));this.toggle_submit();return f};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};
pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(b,a){b.failed(a)?this.errors[a]=$(a).data("message")||b.message:delete this.errors[a]},this);return this.valid()};pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
(function(){pe.tax_id_type_changed=function(){pe.tax_id_no.val("");pe.tax_id_no.unmask();pe.mask_tax_id_no();return pe.tax_id_no.change()};pe.mask_tax_id_no=function(){return"Employer Identification Number"===pe.tax_id_type.val()?pe.tax_id_no.mask("99-9999999"):pe.tax_id_no.mask("999-99-9999")};$(function(){var b;pe.tax_id_type=$("#IdentificationType");pe.tax_id_no=$("#TaxIdentificationNo");pe.tax_id_type.change(pe.tax_id_type_changed);pe.mask_tax_id_no();b={"#Name":pe.validation.name_validator,"#Address":pe.validation.not_blank_validator,
"#City":pe.validation.not_blank_validator,"#State":pe.validation.not_blank_validator,"#ZipCode":pe.validation.not_blank_validator,"#TaxIdentificationNo":pe.validation.not_blank_validator,"#Signature":pe.validation.not_blank_validator};window.x=new pe.ValidatableForm($("form.TaxInfo"),b,{"#Name":"blur","#Address":"blur","#City":"blur","#State":"blur","#ZipCode":"blur","#TaxIdentificationNo":"change","#Signature":"blur"});return pe.init_page_framework()})}).call(this);
