(function(){var e=function(t,e){return function(){return t.apply(e,arguments)}};pe.Searchable=function(){function t(t){this.container=t,this.on_keydown=e(this.on_keydown,this),this.on_item_selected=e(this.on_item_selected,this),this.on_hide_button_click=e(this.on_hide_button_click,this),this.on_city_changed=e(this.on_city_changed,this),this.on_add_button_clicked=e(this.on_add_button_clicked,this),this.add_button=this.container.find(".AddButton"),this.cities_selector=this.container.find(".CitiesSelector"),this.input=this.container.find(".SearchInput"),this.results_container=this.container.find(".Results"),this.hide_button=this.container.find(".HideSearchableTrigger"),this.add_button.click(this.on_add_button_clicked),this.cities_selector.change(this.on_city_changed),this.input.keydown(this.on_keydown),this.hide_button.click(this.on_hide_button_click),this.results_container.find("li").live("click",this.on_item_selected),this.on_city_changed()}return t.prototype.get_query=function(){return this.input.val()},t.prototype.on_add_button_clicked=function(){var t;return this.selected_item&&0<this.results_container.find("li.selected").length?(t={favorite:this.selected_item},pe.routes.Request.from_current_location("api_user_list_favorites",t).post(function(){return window.location.reload()})):alert("you must select item first")},t.prototype.on_city_changed=function(){var t;return t=this.cities_selector.val(),this.request=new pe.routes.Request("search_autocomplete",{city_id:t}),this.search()},t.prototype.on_hide_button_click=function(){return this.container.hide(),this.input.val(""),this.results_container.empty()},t.prototype.on_item_selected=function(t){var e,i,n;return this.results_container.find("li").removeClass("selected"),(i=$(t.currentTarget)).addClass("selected"),e=i.data("id"),n=i.data("type"),this.selected_item={listable_id:e,listable_type:n}},t.prototype.on_keydown=function(t){if(13!==t.keycode)return this.search()},t.prototype.search=function(){var t,e;return 2<(t=this.get_query()).length?(this.request.params.q=t,this.request.post((e=this,function(t){return e.results_container.html(t)}))):this.results_container.empty()},t}()}).call(this);