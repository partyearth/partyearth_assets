pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"},pe.routes.build_path=function(e,t){var i=pe.routes.map[e],s=i.match(/\{\{\*(.+)\}\}/);return _.each(s,function(e){t[e]&&(t[e]=t[e].join("/"))}),i=i.replace(/\*/,""),t=t||{},pe.routes.clean_url(pe.templatize(i,t))},pe.routes.clean_url=function(e){return("/"+e).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")},pe.routes.current_url_params=function(){var e=pe.routes.recognize_path(window.location.pathname);return e?e.params:{}},pe.routes.recognize_path=function(t){var i,s;t=pe.routes.clean_url(t);var e=_.find(_.keys(pe.routes.map),function(e){return i=pe.routes.map[e],(s=new RegExp(i.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"))).test(t)});if(e){for(var r=_.map(i.match(/\{\{[^\}]+\}\}/g),function(e){return e.replace(/\{|\}/g,"")}),a=t.match(s).slice(1,99),n={params:{}},o=function(e){return!_.isEmpty(e)},l=0;l<r.length;l++)"*"==r[l][0]&&(r[l]=r[l].replace(/\*/g,""),a[l]=_.select(a[l].replace(/\*/g,"").split("/"),o)),n.params[r[l]]=a[l];return n.path_info={name:e,template:i},n}return!1},pe.routes.Request=function(e,t,i){pe.routes.map[e]?(this.path=e,"object"!=typeof t&&(t={id:t}),this.params=t,this.callback=i):alert("This path is not registered in the routes map.")},pe.routes.Request.factory=function(e,t,i){return new pe.routes.Request(e,t,i)},pe.routes.Request.from_current_location=function(e,t,i){t=t||{};var s=pe.routes.current_url_params();return new pe.routes.Request(e,_.extend(s,t),i)},pe.routes.Request.prototype.ajax=function(e,t){var i="function"==typeof t?t:this.callback;$.ajax({url:this.build_path(),data:this.params,type:e,success:i})},pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)},pe.routes.Request.prototype.get=function(e){this.ajax("GET",e)},pe.routes.Request.prototype.post=function(e){this.ajax("POST",e)},pe.Validator=function(t){this.message=t.message||"Invalid value.",this.callback=t.callback,this.unless_callback=t.unless||function(){return!1},(this.options=t).value?this.value=t.value:this.value=function(e){return t.callback(e)}},pe.Validator.prototype.passed=function(e){return!!this.callback($(e))},pe.Validator.prototype.failed=function(e){return!this.passed(e)},pe.Validator.prototype.unless=function(){return this.unless_callback()},pe.validation.name_validator=new pe.Validator({callback:function(e){return _.isEmpty($.trim(e.val()))?!(this.message="Required."):!(50<e.val().length)||!(this.message="Please shorten your name.")},message:"Invalid name."}),pe.validation.not_blank_validator=new pe.Validator({callback:function(e){return"checkbox"==e.attr("type")?$(e).is(":checked"):!_.isEmpty($.trim(e.val()))},message:"Required."}),function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(e){var t,i,s,r,a,n,o,l;return l=(n=_.map($(e).find("select"),function(e){return $(e).val()}))[2],a=n[0],s=n[1],!!(l&&a&&s)&&(r=(i=new Date(a+"/"+s+"/"+l)).getMonth()+1+"",t=i.getDate()+"",o=i.getFullYear()+"",r===a&&t===s&&o===l)}})}.call(this),function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(e){return 0<e.find("input:checked").length}})}.call(this),pe.ValidatableForm=function(container,rules,bindings,after_submit){pe.init_widget(this,container),this.bindings=bindings||{},this.chained_fields=[],this.errors={},this.rules=rules||{},_.each(container.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(element){element=$(element);var selector="#"+element.attr("id"),validator=element.data("validator");this.rules[selector]=validator?eval(validator):pe.validation.not_blank_validator;var binding=element.data("binding");binding?this.bindings[selector]=binding:"text"==element.attr("type")||"textarea"==element.attr("tagName")?this.bindings[selector]="blur":this.rules[selector]==pe.validation.dob_validator?element.find("select").each(this.callback(function(e,t){$(t).change(this.callback(function(){this.validate_field(selector)}))})):this.bindings[selector]="change"})),this.save_button=this.container.find(".SaveButton"),this.submit_button=this.container.find(".SubmitButton"),this.after_submit=after_submit,this.init_bindings(),this.validate(),this.toggle_submit(),this.submit_button.click(this.callback(this.on_submit))},pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")})),_.each(this.bindings,function(e,t){"string"==typeof e?$(t).bind(e,this.callback(function(){this.validate_field(t)})):"function"==typeof e&&this.callback(e)(),this.rules[t].value($(t))&&this.validate_field(t)},this)},pe.ValidatableForm.prototype.on_submit=function(){var e=this.validate();return this.highlight_first_failed(),e&&this.after_submit&&this.after_submit(),e},pe.ValidatableForm.prototype.delete_error=function(t){delete this.errors[t],_.each(this.chained_fields,function(e){_.include(e,t)&&_.each(e,function(e){this.errors[e]&&this.delete_error(e)},this)},this)},pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1},pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var e=_.keys(this.errors)[0];this.render_field_error(e)}this.focus_on_failed()}},pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(e,t){this.render_field_error(t)},this)},pe.ValidatableForm.prototype.render_field_error=function(e){var t=$(e).parents("li.input:first");0===t.length&&(t=$(e)),t.find(".inline-errors").remove(),t.append('<span class="inline-errors">'+this.errors[e]+"</span>"),t.find(".inline-success").remove()},pe.ValidatableForm.prototype.render_field_success=function(e){var t=$(e).parents("li.input:first");0===t.length&&(t=$(e)),t.find(".inline-success").remove(),t.append('<img class="inline-success" src="/assets/users/check.png" />'),t.find(".inline-errors").remove()},pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(e){this.render_field_success(e)},this)},pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")},pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))},pe.ValidatableForm.prototype.validate_field=function(e){var t=this.rules[e],i=t.passed(e);return t.unless()?this.delete_error(e):i?(this.delete_error(e),this.render_field_success(e)):(this.errors[e]=$(e).data("message")||t.message,this.render_field_error(e)),this.toggle_submit(),i},pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)},pe.ValidatableForm.prototype.validate=function(){return _.each(this.rules,function(e,t){e.failed(t)?this.errors[t]=$(t).data("message")||e.message:delete this.errors[t]},this),this.valid()},pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)},pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length},function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};pe.AskPartyEarth=function(){function e(e){this.container=e,this.show_message=t(this.show_message,this),this.on_submit=t(this.on_submit,this),this.show_form=t(this.show_form,this),this.click=t(this.click,this),this.link=this.container.find(".Link"),this.link.click(this.show_form),this.form_container=this.container.find(".FormContainer"),this.form=this.form_container.find("form"),this.form.submit(this.on_submit),this.message=this.container.find(".Message")}return e.prototype.click=function(e){return this.on_click_callback=e},e.prototype.show_form=function(){var e,t,i;return t=new pe.Validator({callback:function(e){var t;return t=$.trim(e.val()),_.isEmpty(t)?!(this.message="Email cannot be blank."):(this.message="Invalid email.",/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test(t))}}),i={"#question_name":pe.validation.name_validator,"#question_email":t,"#question_text":pe.validation.not_blank_validator},e={"#question_name":"keyup","#question_email":"keyup","#question_text":"keyup"},new pe.ValidatableForm(this.form,i,e),this.link.hide(),this.form_container.show(),this.on_click_callback()},e.prototype.on_submit=function(e){return e.preventDefault(),$.post(pe.routes.build_path("ask_party_earth"),this.form.serialize(),"json"),this.show_message()},e.prototype.show_message=function(){return this.form_container.hide(),this.message.show()},e}()}.call(this);