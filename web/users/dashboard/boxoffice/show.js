(function(){var f=function(c,a){return function(){return c.apply(a,arguments)}},d=pe,a=function(c){var a=this;this.container=c;this.on_submit_button_clicked=f(this.on_submit_button_clicked,this);this.on_close_dialog=f(this.on_close_dialog,this);c={title:"Enter [12 Digit] Barcode Number",modal:!0,autoOpen:!1,close:this.on_close_dialog};this.dialog=$(".Dialog").dialog(c);this.error=this.container.find(".Error");this.submit_button=this.container.find(".SubmitButton");this.submit_button.click(this.on_submit_button_clicked);
this.input=this.container.find(".Input");this.input.keydown(function(b){if(13===b.which)return a.on_submit_button_clicked(),b.stopPropagation(),b.preventDefault()});this.input.keyup(function(b){if(189===b.which)b.stopPropagation(),b.preventDefault();else{b=a.ticket_number();if(2<b.length&&6>=b.length)return a.input.val(""+(b[0]||"")+(b[1]||"")+"-"+(b[2]||"")+(b[3]||"")+(b[4]||"")+(b[5]||""));if(2<b.length)return a.input.val(""+b[0]+b[1]+"-"+b[2]+b[3]+b[4]+b[5]+"-"+(b[6]||"")+(b[7]||"")+(b[8]||"")+
(b[9]||"")+(b[10]||"")+(b[11]||""))}})};a.prototype.open=function(){this.dialog.dialog("open");if(this.on_show)return this.on_show()};a.prototype.show=function(c){return this.on_show=c};a.prototype.close=function(c){return this.on_close=c};a.prototype.submit=function(c){return this.on_submit=c};a.prototype.valid=function(){return 12===this.ticket_number().length};a.prototype.ticket_number=function(){return $.trim(this.input.val().replace(/(-|_| )/g,""))};a.prototype.show_error=function(c){this.error.removeClass("hidden");
return this.error.html(c)};a.prototype.hide_error=function(){this.error.html("");return this.error.addClass("hidden")};a.prototype.on_close_dialog=function(){if(this.on_close)this.on_close();this.hide_error();return this.input.val("")};a.prototype.on_submit_button_clicked=function(){if(this.valid()){this.hide_error();if(this.on_submit)this.on_submit();this.dialog.dialog("close");return this.on_close_dialog()}this.input.focus();return this.show_error("Invalid format <br> Entry must be 12 numbers")};
d.ManualInput=a;d=pe;a=function(c){this.container=c;this.data_fields=this.container.find(".Data");this.status=this.container.find(".Status");this.fields=_.uniq(_.map(this.data_fields,function(c){return $(c).data("field")}))};a.prototype.apply_data=function(c){var a,b,d=this;c.initialized=!0;_.each(this.fields,function(b){var a,e;a=d.container.find("[data-field="+b+"]");e=c[b];return _.each(a,function(b){b=$(b);switch(b.data("attribute")){case "visible":return b.toggleClass("hidden",!e);case "hidden":return b.toggleClass("hidden",
!!e);default:return b.html(e)}})});b=[];for(a=0;3>a;++a)b.push(this.status.fadeTo("fast",0.3).fadeTo("fast",1));return b};d.DataContainer=a;d=pe;a=function(a){this.container=a;this.keypress=f(this.keypress,this);this.disable();this.enable()};a.prototype.disable=function(){this.stack=[];if(this.enabled)return this.enabled=!1,$(document).unbind("keypress")};a.prototype.enable=function(){this.stack=[];if(!this.enabled)return this.enabled=!0,$(document).bind("keypress",this.keypress)};a.prototype.keypress=
function(a){if(20<this.stack.length)return this.submit();if(13===a.which)return this.submit(),this.container.html("");this.stack.push(a.keyCode-48);return this.container.html(this.stack.join(" "))};a.prototype.send=function(a){return this.on_return=a};a.prototype.submit=function(a){a=a||this.stack.join("");if(this.on_return)this.on_return(a);return this.stack=[]};d.KeyboardHook=a;$(function(){var a;a=$(".DataContainer");window.page=new pe.DataContainer(a);window.logger=new pe.KeyboardHook($(".Debugger"));
window.manual_input=new pe.ManualInput($(".Dialog"));window.manual_input.show(function(){return window.logger.disable()});window.manual_input.close(function(){return window.logger.enable()});window.manual_input.submit(function(){return window.logger.submit(window.manual_input.ticket_number())});$(".DialogTrigger").click(function(){return window.manual_input.open()});return window.logger.send(function(a){return pe.routes.Request.from_current_location("boxoffice_check_ticket_number",{ticket_number:a}).post(function(a){return window.page.apply_data(a)})})})}).call(this);
