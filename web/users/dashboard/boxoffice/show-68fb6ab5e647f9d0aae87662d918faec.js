(function(){var f=function(a,c){return function(){return a.apply(c,arguments)}},d=pe,c=function(a){var c=this;this.container=a;this.on_submit_button_clicked=f(this.on_submit_button_clicked,this);this.on_close_dialog=f(this.on_close_dialog,this);a={title:"Enter [12 Digit] Barcode Number",modal:!0,autoOpen:!1,close:this.on_close_dialog};this.dialog=$(".Dialog").dialog(a);this.error=this.container.find(".Error");this.submit_button=this.container.find(".SubmitButton");this.submit_button.click(this.on_submit_button_clicked);
this.input=this.container.find(".Input");this.input.keydown(function(b){if(13===b.which)return c.on_submit_button_clicked(),b.stopPropagation(),b.preventDefault()});this.input.keyup(function(b){if(189===b.which)b.stopPropagation(),b.preventDefault();else{b=c.ticket_number();if(2<b.length&&6>=b.length)return c.input.val(""+(b[0]||"")+(b[1]||"")+"-"+(b[2]||"")+(b[3]||"")+(b[4]||"")+(b[5]||""));if(2<b.length)return c.input.val(""+b[0]+b[1]+"-"+b[2]+b[3]+b[4]+b[5]+"-"+(b[6]||"")+(b[7]||"")+(b[8]||"")+
(b[9]||"")+(b[10]||"")+(b[11]||""))}})};c.prototype.open=function(){this.dialog.dialog("open");if(this.on_show)return this.on_show()};c.prototype.show=function(a){return this.on_show=a};c.prototype.close=function(a){return this.on_close=a};c.prototype.submit=function(a){return this.on_submit=a};c.prototype.valid=function(){return 12===this.ticket_number().length};c.prototype.ticket_number=function(){return $.trim(this.input.val().replace(/(-|_| )/g,""))};c.prototype.show_error=function(a){this.error.removeClass("hidden");
return this.error.html(a)};c.prototype.hide_error=function(){this.error.html("");return this.error.addClass("hidden")};c.prototype.on_close_dialog=function(){if(this.on_close)this.on_close();this.hide_error();return this.input.val("")};c.prototype.on_submit_button_clicked=function(){if(this.valid()){this.hide_error();if(this.on_submit)this.on_submit();this.dialog.dialog("close");return this.on_close_dialog()}this.input.focus();return this.show_error("Invalid format <br> Entry must be 12 numbers")};
d.ManualInput=c;d=pe;c=function(a){this.container=a;this.data_fields=this.container.find(".Data");this.fields=_.uniq(_.map(this.data_fields,function(a){return $(a).data("field")}))};c.prototype.apply_data=function(a){var c=this;a.initialized=!0;return _.each(this.fields,function(b){var d,e;d=c.container.find("[data-field="+b+"]");e=a[b];return _.each(d,function(a){a=$(a);switch(a.data("attribute")){case "visible":return a.toggleClass("hidden",!e);case "hidden":return a.toggleClass("hidden",!!e);default:return a.html(e)}})})};
d.DataContainer=c;d=pe;c=function(a){this.container=a;this.keypress=f(this.keypress,this);this.disable();this.enable()};c.prototype.disable=function(){this.stack=[];if(this.enabled)return this.enabled=!1,$(document).unbind("keypress")};c.prototype.enable=function(){this.stack=[];if(!this.enabled)return this.enabled=!0,$(document).bind("keypress",this.keypress)};c.prototype.keypress=function(a){if(20<this.stack.length)return this.submit();if(13===a.which)return this.submit(),this.container.html("");
this.stack.push(a.keyCode-48);return this.container.html(this.stack.join(" "))};c.prototype.send=function(a){return this.on_return=a};c.prototype.submit=function(a){a=a||this.stack.join("");if(this.on_return)this.on_return(a);return this.stack=[]};d.KeyboardHook=c;$(function(){var a;a=$(".DataContainer");window.page=new pe.DataContainer(a);window.logger=new pe.KeyboardHook($(".Debugger"));window.manual_input=new pe.ManualInput($(".Dialog"));window.manual_input.show(function(){return window.logger.disable()});
window.manual_input.close(function(){return window.logger.enable()});window.manual_input.submit(function(){return window.logger.submit(window.manual_input.ticket_number())});$(".DialogTrigger").click(function(){return window.manual_input.open()});return window.logger.send(function(a){return pe.routes.Request.from_current_location("boxoffice_check_ticket_number",{ticket_number:a}).post(function(a){return window.page.apply_data(a)})})})}).call(this);
