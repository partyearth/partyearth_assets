pe.Calendar=function(e,a){pe.init_widget(this,e),this.arity=a||1,this.datepicker_block=this.container.find(".DatepickerBlock"),this.datepicker_apply=this.datepicker_block.find(".Apply"),this.datepicker_apply.click(this.callback(this.datepicker_apply_clicked)),this.datepicker_cancel=this.datepicker_block.find(".Cancel"),this.datepicker_cancel.click(this.callback(this.datepicker_cancel_clicked)),this.datepicker_clear=this.datepicker_block.find(".Clear"),this.datepicker_clear.click(this.callback(this.datepicker_clear_clicked)),this.datepicker_container=this.datepicker_block.find(".Datepicker"),this.datepicker_notice=this.datepicker_block.find(".Notice"),this.datepicker_initialized=!1,this.custom_label=this.container.find(".CustomLabel"),this.custom_label.click(this.callback(this.custom_label_clicked)),this.start_date_input=this.container.find(".StartDate"),this.end_date_input=this.container.find(".EndDate")},pe.Calendar.events={DATES_APPLIED:"Calendar_DATES_APPLIED"},pe.Calendar.prototype.datepicker_apply_clicked=function(){var e=this.datepicker_container.DatePickerGetDate(!0);e[0].match(/NaN/)?e=[]:(this.set_start_date(e[0]),this.set_end_date(e[1])),this.hide_datepicker_block(),pe.fire_global_event(pe.Calendar.events.DATES_APPLIED,e)},pe.Calendar.prototype.datepicker_cancel_clicked=function(){var e=this.start_date_input.val(),a=this.end_date_input.val();e?(this.datepicker_container.DatePickerSetDate([e,a]),this.set_datepicker_notification([e,a])):(this.datepicker_container.DatePickerClear(),this.set_datepicker_notification([])),this.hide_datepicker_block()},pe.Calendar.prototype.datepicker_clear_clicked=function(){this.datepicker_container.DatePickerClear(),this.set_datepicker_notification([])},pe.Calendar.prototype.init_datepicker=function(){var e,a=this.callback(this.set_datepicker_notification),t=[this.start_date_input.val(),this.end_date_input.val()],s=new Date;e=1===this.arity?1:2;var n={flat:!0,format:"m/d/Y",current:s.getMonth()+e+"/"+s.getDate()+"/"+s.getFullYear(),date:t,calendars:this.arity,mode:"range",starts:0,onChange:function(e){a(e)}};this.datepicker_container.DatePicker(n),this.datepicker_initialized=!0},pe.Calendar.prototype.custom_label_clicked=function(){this.datepicker_block.toggle(),this.datepicker_initialized||this.init_datepicker()},pe.Calendar.prototype.hide_datepicker_block=function(){this.datepicker_block.hide()},pe.Calendar.prototype.set_datepicker_notification=function(e){var a,t=e[0],s=e[1];a=t?t===s?"Select second date or apply.":"Select new dates or apply.":"Select first date.",this.datepicker_notice.html(a)},pe.Calendar.prototype.set_end_date=function(e){this.end_date_input.val(e)},pe.Calendar.prototype.set_start_date=function(e){this.start_date_input.val(e)},pe.SortableList=function(e,a,t,s){pe.init_widget(this,e),this.field_container=e.find(".Field"),this.cookie_name=a,this.cookie_path=t||"/",this.item_template=s||"<li data-value='{{value}}'>{{title}}</li>",this.save_ordering_button=e.find(".SaveOrderingButton"),this.displayed_values_container=e.find(".DisplayedValues"),this.displayed_values=$.parseJSON(this.displayed_values_container.text()),this.sortable_container=$(this.container.find(".List")).sortable({stop:this.callback(this.update_field_value)}),this.sortable_container.disableSelection(),this.fill_in_list(this.field_container.val().split(";")),this.save_ordering_button.click(this.callback(this.save_ordering))},pe.SortableList.prototype.fill_in_list=function(e){this.sortable_container.find("li").remove();for(var a=0;a<e.length;a++){var t=e[a];this.sortable_container.append($(pe.templatize(this.item_template,{value:t,title:this.displayed_values[t]})))}},pe.SortableList.prototype.update_field_value=function(){var e=this.sortable_container.find("li").map(function(){return $(this).data("value")}).toArray();this.field_container.val(e.join(";"))},pe.SortableList.prototype.save_ordering=function(){document.cookie=this.cookie_name+"="+escape(""+this.field_container.val())+"; root="+this.cookie_path},function(m){var i,w,e,o,r,g,a,c,l,p,h,t,k,f,s=(e={flat:!(w={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',head:["<td>",'<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>','<th colspan="5" class="datepickerMonth"><a href="#"><span></span></a></th>','<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>","<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>','<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>','<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>','<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>','<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>','<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>','<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>','<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]}),starts:1,prev:"&#9664;",next:"&#9654;",lastSel:!(i={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"}),mode:"single",view:"days",calendars:1,format:"Y-m-d",position:"bottom",eventName:"click",onRender:function(){return{}},onChange:function(){return!0},onShow:function(){return!0},onBeforeShow:function(){return!0},onHide:function(){return!0},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},o=function(e){var a,t,s,n,d,i,r,c=m(e).data("datepicker"),l=m(e),o=Math.floor(c.calendars/2),p=0;l.find("td>table tbody").remove();for(var h=0;h<c.calendars;h++){switch((a=new Date(c.current)).addMonths(-o+h),(r=l.find("table").eq(h+1))[0].className){case"datepickerViewDays":f=g(a,"B, Y");break;case"datepickerViewMonths":f=a.getFullYear();break;case"datepickerViewYears":f=a.getFullYear()-6+" - "+(a.getFullYear()+5)}r.find("thead tr:first th:eq(1) span").text(f),f=a.getFullYear()-6,t={data:[],className:"datepickerYears"};for(var k=0;k<12;k++)t.data.push(f+k);i=tmpl(w.months.join(""),t),a.setDate(1),t={weeks:[],test:10},s=a.getMonth();var f=(a.getDay()-c.starts)%7;for(a.addDays(-(f+(f<0?7:0))),-1,p=0;p<42;){n=parseInt(p/7,10),d=p%7,t.weeks[n]||(t.weeks[n]={days:[]}),t.weeks[n].days[d]={text:a.getDate(),classname:[]},s!=a.getMonth()&&t.weeks[n].days[d].classname.push("datepickerNotInMonth"),0==a.getDay()&&t.weeks[n].days[d].classname.push("datepickerSunday"),6==a.getDay()&&t.weeks[n].days[d].classname.push("datepickerSaturday");var u=c.onRender(a),y=a.valueOf();(u.selected||c.date==y||-1<m.inArray(y,c.date)||"range"==c.mode&&y>=c.date[0]&&y<=c.date[1])&&t.weeks[n].days[d].classname.push("datepickerSelected"),u.disabled&&t.weeks[n].days[d].classname.push("datepickerDisabled"),u.className&&t.weeks[n].days[d].classname.push(u.className),t.weeks[n].days[d].classname=t.weeks[n].days[d].classname.join(" "),p++,a.addDays(1)}i=tmpl(w.days.join(""),t)+i,t={data:c.locale.monthsShort,className:"datepickerMonths"},i=tmpl(w.months.join(""),t)+i,r.append(i)}},r=function(e,a){if(e.constructor==Date)return new Date(e);for(var t,s,n,d,i,r=e.split(/\W+/),c=a.split(/\W+/),l=new Date,o=0;o<r.length;o++)switch(c[o]){case"d":case"e":t=parseInt(r[o],10);break;case"m":s=parseInt(r[o],10)-1;break;case"Y":case"y":n=parseInt(r[o],10),n+=100<n?0:n<29?2e3:1900;break;case"H":case"I":case"k":case"l":d=parseInt(r[o],10);break;case"P":case"p":/pm/i.test(r[o])&&d<12?d+=12:/am/i.test(r[o])&&12<=d&&(d-=12);break;case"M":i=parseInt(r[o],10)}return new Date(n===undefined?l.getFullYear():n,s===undefined?l.getMonth():s,t===undefined?l.getDate():t,d===undefined?l.getHours():d,i===undefined?l.getMinutes():i,0)},g=function(e,a){var t=e.getMonth(),s=e.getDate(),n=e.getFullYear(),d=e.getDay(),i=e.getHours(),r=12<=i,c=r?i-12:i,l=e.getDayOfYear();0==c&&(c=12);for(var o,p=e.getMinutes(),h=e.getSeconds(),k=a.split(""),f=0;f<k.length;f++){switch(o=k[f],k[f]){case"a":o=e.getDayName();break;case"A":o=e.getDayName(!0);break;case"b":o=e.getMonthName();break;case"B":o=e.getMonthName(!0);break;case"C":o=1+Math.floor(n/100);break;case"d":o=s<10?"0"+s:s;break;case"e":o=s;break;case"H":o=i<10?"0"+i:i;break;case"I":o=c<10?"0"+c:c;break;case"j":o=l<100?l<10?"00"+l:"0"+l:l;break;case"k":o=i;break;case"l":o=c;break;case"m":o=t<9?"0"+(1+t):1+t;break;case"M":o=p<10?"0"+p:p;break;case"p":case"P":o=r?"PM":"AM";break;case"s":o=Math.floor(e.getTime()/1e3);break;case"S":o=h<10?"0"+h:h;break;case"u":o=d+1;break;case"w":o=d;break;case"y":o=(""+n).substr(2,2);break;case"Y":o=n}k[f]=o}return k.join("")},a=function(e){Date.prototype.tempDate||(Date.prototype.tempDate=null,Date.prototype.months=e.months,Date.prototype.monthsShort=e.monthsShort,Date.prototype.days=e.days,Date.prototype.daysShort=e.daysShort,Date.prototype.getMonthName=function(e){return this[e?"months":"monthsShort"][this.getMonth()]},Date.prototype.getDayName=function(e){return this[e?"days":"daysShort"][this.getDay()]},Date.prototype.addDays=function(e){this.setDate(this.getDate()+e),this.tempDate=this.getDate()},Date.prototype.addMonths=function(e){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.addYears=function(e){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setFullYear(this.getFullYear()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.getMaxDays=function(){var e,a=new Date(Date.parse(this)),t=28;for(e=a.getMonth(),t=28;a.getMonth()==e;)t++,a.setDate(t);return t-1},Date.prototype.getFirstDay=function(){var e=new Date(Date.parse(this));return e.setDate(1),e.getDay()},Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0)-new Date(this.getFullYear(),0,0,0,0,0);return Math.floor(e/24*60*60*1e3)})},c=function(e){var a=m(e).data("datepicker"),t=m("#"+a.id);if(!a.extraHeight){var s=m(e).find("div");a.extraHeight=s.get(0).offsetHeight+s.get(1).offsetHeight,a.extraWidth=s.get(2).offsetWidth+s.get(3).offsetWidth}var n=t.find("table:first").get(0),d=n.offsetWidth,i=n.offsetHeight;t.css({width:d+a.extraWidth+"px",height:i+a.extraHeight+"px"}).find("div.datepickerContainer").css({width:d+"px",height:i+"px"})},l=function(e){m(e.target).is("span")&&(e.target=e.target.parentNode);var a=m(e.target);if(a.is("a")){if(e.target.blur(),a.hasClass("datepickerDisabled"))return!1;var t=m(this).data("datepicker"),s=a.parent(),n=s.parent().parent().parent(),d=m("table",this).index(n.get(0))-1,i=new Date(t.current),r=!1,c=!1;if(s.is("th")){if(s.hasClass("datepickerWeek")&&"range"==t.mode&&!s.next().hasClass("datepickerDisabled")){var l=parseInt(s.next().text(),10);i.addMonths(d-Math.floor(t.calendars/2)),s.next().hasClass("datepickerNotInMonth")&&i.addMonths(15<l?-1:1),i.setDate(l),t.date[0]=i.setHours(0,0,0,0).valueOf(),i.setHours(23,59,59,0),i.addDays(6),t.date[1]=i.valueOf(),r=c=!0,t.lastSel=!1}else if(s.hasClass("datepickerMonth"))switch(i.addMonths(d-Math.floor(t.calendars/2)),n.get(0).className){case"datepickerViewDays":n.get(0).className="datepickerViewMonths",a.find("span").text(i.getFullYear());break;case"datepickerViewMonths":n.get(0).className="datepickerViewYears",a.find("span").text(i.getFullYear()-6+" - "+(i.getFullYear()+5));break;case"datepickerViewYears":n.get(0).className="datepickerViewDays",a.find("span").text(g(i,"B, Y"))}else if(s.parent().parent().is("thead")){switch(n.get(0).className){case"datepickerViewDays":t.current.addMonths(s.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewMonths":t.current.addYears(s.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewYears":t.current.addYears(s.hasClass("datepickerGoPrev")?-12:12)}c=!0}}else if(s.is("td")&&!s.hasClass("datepickerDisabled")){switch(n.get(0).className){case"datepickerViewMonths":t.current.setMonth(n.find("tbody.datepickerMonths td").index(s)),t.current.setFullYear(parseInt(n.find("thead th.datepickerMonth span").text(),10)),t.current.addMonths(Math.floor(t.calendars/2)-d),n.get(0).className="datepickerViewDays";break;case"datepickerViewYears":t.current.setFullYear(parseInt(a.text(),10)),n.get(0).className="datepickerViewMonths";break;default:l=parseInt(a.text(),10);switch(i.addMonths(d-Math.floor(t.calendars/2)),s.hasClass("datepickerNotInMonth")&&i.addMonths(15<l?-1:1),i.setDate(l),t.mode){case"multiple":l=i.setHours(0,0,0,0).valueOf(),-1<m.inArray(l,t.date)?m.each(t.date,function(e,a){if(a==l)return t.date.splice(e,1),!1}):t.date.push(l);break;case"range":t.lastSel||(t.date[0]=i.setHours(0,0,0,0).valueOf()),(l=i.setHours(23,59,59,0).valueOf())<t.date[0]?(t.date[1]=t.date[0]+86399e3,t.date[0]=l-86399e3):t.date[1]=l,t.lastSel=!t.lastSel;break;default:t.date=i.valueOf()}}r=c=!0}c&&o(this),r&&t.onChange.apply(this,p(t))}return!1},p=function(s){var n;return"single"==s.mode?(n=new Date(s.date),[g(n,s.format),n,s.el]):(n=[[],[],s.el],m.each(s.date,function(e,a){var t=new Date(a);n[0].push(g(t,s.format)),n[1].push(t)}),n)},h=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},t=function(e,a,t){if(e==a)return!0;if(e.contains)return e.contains(a);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(a));for(var s=a.parentNode;s&&s!=t;){if(s==e)return!0;s=s.parentNode}return!1},k=function(){var e=m("#"+m(this).data("datepickerId"));if(!e.is(":visible")){var a=e.get(0);o(a);var t=e.data("datepicker");t.onBeforeShow.apply(this,[e.get(0)]);var s=m(this).offset(),n=h(),d=s.top,i=s.left;m.curCSS(a,"display");switch(e.css({visibility:"hidden",display:"block"}),c(a),t.position){case"top":d-=a.offsetHeight;break;case"left":i-=a.offsetWidth;break;case"right":i+=this.offsetWidth;break;case"bottom":d+=this.offsetHeight}d+a.offsetHeight>n.t+n.h&&(d=s.top-a.offsetHeight),d<n.t&&(d=s.top+this.offsetHeight+a.offsetHeight),i+a.offsetWidth>n.l+n.w&&(i=s.left-a.offsetWidth),i<n.l&&(i=s.left+this.offsetWidth),e.css({visibility:"visible",display:"block",top:d+"px",left:i+"px"}),0!=t.onShow.apply(this,[e.get(0)])&&e.show(),m(document).bind("mousedown",{cal:e,trigger:this},f)}return!1},f=function(e){e.target==e.data.trigger||t(e.data.cal.get(0),e.target,e.data.cal.get(0))||(0!=e.data.cal.data("datepicker").onHide.apply(this,[e.data.cal.get(0)])&&e.data.cal.hide(),m(document).unbind("mousedown",f))},{init:function(d){return d=m.extend({},e,d||{}),a(d.locale),d.calendars=Math.max(1,parseInt(d.calendars,10)||1),d.mode=/single|multiple|range/.test(d.mode)?d.mode:"single",this.each(function(){if(!m(this).data("datepicker")){if(d.el=this,d.date.constructor==String&&(d.date=r(d.date,d.format),d.date.setHours(0,0,0,0)),"single"!=d.mode)if(d.date.constructor!=Array)d.date=[d.date.valueOf()],"range"==d.mode&&d.date.push(new Date(d.date[0]).setHours(23,59,59,0).valueOf());else{for(var e=0;e<d.date.length;e++)d.date[e]=r(d.date[e],d.format).setHours(0,0,0,0).valueOf();"range"==d.mode&&(d.date[1]=new Date(d.date[1]).setHours(23,59,59,0).valueOf())}else d.date=d.date.valueOf();d.current?d.current=r(d.current,d.format):d.current=new Date,d.current.setDate(1),d.current.setHours(0,0,0,0);var a,t="datepicker_"+parseInt(1e3*Math.random());d.id=t,m(this).data("datepickerId",d.id);var s=m(w.wrapper).attr("id",t).bind("click",l).data("datepicker",d);d.className&&s.addClass(d.className);var n="";for(e=0;e<d.calendars;e++)a=d.starts,0<e&&(n+=w.space),n+=tmpl(w.head.join(""),{prev:d.prev,next:d.next,day1:d.locale.daysMin[a++%7],day2:d.locale.daysMin[a++%7],day3:d.locale.daysMin[a++%7],day4:d.locale.daysMin[a++%7],day5:d.locale.daysMin[a++%7],day6:d.locale.daysMin[a++%7],day7:d.locale.daysMin[a++%7]});s.find("tr:first").append(n).find("table").addClass(i[d.view]),o(s.get(0)),d.flat?(s.appendTo(this).show().css("position","relative"),c(s.get(0))):(s.appendTo(document.body),m(this).bind(d.eventName,k))}})},showPicker:function(){return this.each(function(){m(this).data("datepickerId")&&k.apply(this)})},hidePicker:function(){return this.each(function(){m(this).data("datepickerId")&&m("#"+m(this).data("datepickerId")).hide()})},setDate:function(s,n){return this.each(function(){if(m(this).data("datepickerId")){var e=m("#"+m(this).data("datepickerId")),a=e.data("datepicker");if(a.date=s,a.date.constructor==String&&(a.date=r(a.date,a.format),a.date.setHours(0,0,0,0)),"single"!=a.mode)if(a.date.constructor!=Array)a.date=[a.date.valueOf()],"range"==a.mode&&a.date.push(new Date(a.date[0]).setHours(23,59,59,0).valueOf());else{for(var t=0;t<a.date.length;t++)a.date[t]=r(a.date[t],a.format).setHours(0,0,0,0).valueOf();"range"==a.mode&&(a.date[1]=new Date(a.date[1]).setHours(23,59,59,0).valueOf())}else a.date=a.date.valueOf();n&&(a.current=new Date("single"!=a.mode?a.date[0]:a.date)),o(e.get(0))}})},getDate:function(e){if(0<this.size())return p(m("#"+m(this).data("datepickerId")).data("datepicker"))[e?0:1]},clear:function(){return this.each(function(){if(m(this).data("datepickerId")){var e=m("#"+m(this).data("datepickerId")),a=e.data("datepicker");"single"!=a.mode&&(a.date=[],o(e.get(0)))}})},fixLayout:function(){return this.each(function(){if(m(this).data("datepickerId")){var e=m("#"+m(this).data("datepickerId"));e.data("datepicker").flat&&c(e.get(0))}})}});m.fn.extend({DatePicker:s.init,DatePickerHide:s.hidePicker,DatePickerShow:s.showPicker,DatePickerSetDate:s.setDate,DatePickerGetDate:s.getDate,DatePickerClear:s.clear,DatePickerLayout:s.fixLayout})}(jQuery),function(){var n={};this.tmpl=function e(a,t){var s=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):n[a]=n[a]||e(document.getElementById(a).innerHTML);return t?s(t):s}}(),$(document).ready(function(){pe.calendar=new pe.Calendar($(".Calendar"),2),0<$(".SortableCities").length&&(pe.cities_sortable=new pe.SortableList($(".SortableCities"),"pe_event_report_city_ids","/events",'<li class="ui-state-default" data-value="{{value}}"><p class="inline_block">{{title}}</p></li>')),pe.init_page_framework()});