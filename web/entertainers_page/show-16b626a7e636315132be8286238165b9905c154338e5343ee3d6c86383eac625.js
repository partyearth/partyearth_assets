pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"},pe.routes.build_path=function(e,t){var i=pe.routes.map[e],a=i.match(/\{\{\*(.+)\}\}/);return _.each(a,function(e){t[e]&&(t[e]=t[e].join("/"))}),i=i.replace(/\*/,""),t=t||{},pe.routes.clean_url(pe.templatize(i,t))},pe.routes.clean_url=function(e){return("/"+e).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")},pe.routes.current_url_params=function(){var e=pe.routes.recognize_path(window.location.pathname);return e?e.params:{}},pe.routes.recognize_path=function(t){var i,a;t=pe.routes.clean_url(t);var e=_.find(_.keys(pe.routes.map),function(e){return i=pe.routes.map[e],(a=new RegExp(i.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"))).test(t)});if(e){for(var s=_.map(i.match(/\{\{[^\}]+\}\}/g),function(e){return e.replace(/\{|\}/g,"")}),n=t.match(a).slice(1,99),o={params:{}},r=function(e){return!_.isEmpty(e)},l=0;l<s.length;l++)"*"==s[l][0]&&(s[l]=s[l].replace(/\*/g,""),n[l]=_.select(n[l].replace(/\*/g,"").split("/"),r)),o.params[s[l]]=n[l];return o.path_info={name:e,template:i},o}return!1},pe.routes.Request=function(e,t,i){pe.routes.map[e]?(this.path=e,"object"!=typeof t&&(t={id:t}),this.params=t,this.callback=i):alert("This path is not registered in the routes map.")},pe.routes.Request.factory=function(e,t,i){return new pe.routes.Request(e,t,i)},pe.routes.Request.from_current_location=function(e,t,i){t=t||{};var a=pe.routes.current_url_params();return new pe.routes.Request(e,_.extend(a,t),i)},pe.routes.Request.prototype.ajax=function(e,t){var i="function"==typeof t?t:this.callback;$.ajax({url:this.build_path(),data:this.params,type:e,success:i})},pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)},pe.routes.Request.prototype.get=function(e){this.ajax("GET",e)},pe.routes.Request.prototype.post=function(e){this.ajax("POST",e)},pe.init_calendar_buttons=function(){new pe.AddToCalendarButton},pe.AddToCalendarButton=function(){pe.init_widget(this,null),$(".AddToCalendarButton").live("click",this.callback(this.show_dialog))},pe.AddToCalendarButton.prototype.close_dialog=function(){},pe.AddToCalendarButton.prototype.show_dialog=function(e){var t=$('<div title="Add to your calendar">'),i=function(){t.empty(),t.dialog("destroy")};t.dialog({modal:!0,show:!1,close:i}),t.html('<div style="margin:0 auto; width: 80px;"><img src="/assets/content_bg/spinner.gif"/></div>');var a=$(e.currentTarget);if(params={event_id:a.data("event_id")},date=a.data("date"),params.date=date||null,_.isEmpty(a.data("event_id"))){var s=a.data("source_path");if(_.isEmpty(s))alert("NOR event_id, source_path is set for calendar button");else{var n=pe.routes.recognize_path(s);n?pe.routes.Request.factory(n.path_info.name+"_calendar",n.params,function(e){t.html(e),t.find("a").click(i)}).get():alert("Calendar route is not recognized")}}else pe.ajax_loader.add_to_calendar_dialog.load(params,function(e){t.html(e),t.find("a").click(i)});return!1},pe.Scroller=function(e,t,i,a,s,n,o,r){pe.init_widget(this,e),this.scroller_container=this.container.find(".ScreensContainer"),this.current_item=0,this.scroll_duration=t,this.inactive_button_class=i,this.visible_items_count=a||1,this.scroll_by=s||1,this.single_item_width=n,this.individual_items=this.scroller_container.find(".IndividualItem"),this.items_count=this.individual_items.length,this.next_button=this.container.find(".NextButton"),this.next_button.click(this.callback(this.next_button_clicked)),this.previous_button=this.container.find(".PreviousButton"),this.previous_button.click(this.callback(this.previous_button_clicked)),this.page_display_container=this.container.find(".PageDisplay"),this.page_display_format=o||"",this.loop_scrolling=r||!1,this.update_display()},pe.Scroller.prototype.animate_scrolling=function(e){if(e!=this.current_item){this.current_item=e;var t=this.current_item*(this.single_item_width||this.individual_items.width());this.scroller_container.animate({left:"-"+t+"px"},this.scroll_duration,"cubicEaseInOut"),this.update_display()}},pe.Scroller.prototype.update_display=function(){this.current_item<=0?this.previous_button.addClass(this.inactive_button_class):this.previous_button.removeClass(this.inactive_button_class),this.current_item>=this.items_count-this.visible_items_count?this.next_button.addClass(this.inactive_button_class):this.next_button.removeClass(this.inactive_button_class),this.page_display_container.html(pe.templatize(this.page_display_format,{current_item_number:this.current_item+1,items_count:this.items_count}))},pe.Scroller.prototype.next_button_clicked=function(){var e=this.current_item+this.scroll_by;e>this.items_count-this.visible_items_count&&(e=this.loop_scrolling?0:this.items_count-this.visible_items_count),this.animate_scrolling(e)},pe.Scroller.prototype.previous_button_clicked=function(){var e=this.current_item-this.scroll_by;e<0&&(e=this.loop_scrolling?this.items_count-this.visible_items_count:0),this.animate_scrolling(e)},pe.ChangeImageOnHover=function(e,t){pe.init_widget(this,e),this.image_container=this.container.find(".ImageContainer"),this.link_parent_class=t||null,this.include_caption=this.container.data("include-caption")||!1,this.object_links=this.container.find(".HoverLinkToChange"),this.object_links.mouseover(this.callback(this.object_link_hovered));var i=t?this.container.find("."+t):[];this.link_wrappers=0<i.length?i:this.object_links.parent()},pe.ChangeImageOnHover.prototype.image_html=function(e){var t='<a href="{{object_url}}" title="{{link_title}}" class="thumbnail_link"><img src="{{image_url}}" alt="{{alt_tag}}"></a>';this.include_caption&&(t+='<p class="name"><span class="date">{{link_prefix}}</span><a href="{{object_url}}">{{image_caption}}</a></p>');var i={object_url:e.attr("href"),image_url:e.data("image-url"),link_title:e.data("title")||"",alt_tag:e.data("image-alt-tag")||"",link_prefix:e.data("link-prefix")||"",image_caption:e.html()};return pe.templatize(t,i)},pe.ChangeImageOnHover.instantiate_all=function(t){return $.map($(".ChangeImageOnHoverContainer"),function(e){return new pe.ChangeImageOnHover($(e),t)})},pe.ChangeImageOnHover.prototype.object_link_hovered=function(e){var t=$(e.target);this.object_links.removeClass("selected"),this.link_wrappers.removeClass("selected"),t.addClass("selected"),this.link_wrapper(t).addClass("selected"),this.image_container.html(this.image_html(t)),pe.convert_to_rounded_corners()},pe.ChangeImageOnHover.prototype.link_wrapper=function(e){return this.link_parent_class?e.closest("."+this.link_parent_class):e.parent()},pe.PrefetcherModule=function(e){pe.init_widget(this,e),this.elements_with_prefetch_urls=this.container.find("[data-prefetch-url]"),this.prefetch_data()},pe.PrefetcherModule.instantiate=function(){return new pe.PrefetcherModule($("body"))},pe.PrefetcherModule.prototype.is_image_url=function(e){return/\.(jpe?g|gif|png)(\?.*)?$/i.test(e)},pe.PrefetcherModule.prototype.prefetch_ajax_request=function(e){$.getScript(e)},pe.PrefetcherModule.prototype.prefetch_data=function(){$.each(this.elements_with_prefetch_urls,this.callback(function(e,t){var i=(t=$(t)).data("prefetch-url");this.is_image_url(i)?this.prefetch_image(i):this.prefetch_ajax_request(i),t.removeAttr("data-prefetch-url")}))},pe.PrefetcherModule.prototype.prefetch_image=function(e){this.container.append(pe.templatize('<div style="display:none;"><img src="{{url}}"></div>',{url:e}))},pe.ServersidePaginator=function(e,t){pe.init_widget(this,e),this.current_page_number=0,this.loader=new pe.ajax_loader.MultiLoader(t,pe.ajax_loader.Loader.data_types.EHTML),this.objects_list=pe.load(this.container.find(".ObjectsList")),this.previous_button=pe.load(this.container.find(".PrevButton")),this.previous_button.click(this.callback(this.previous_button_clicked)),this.next_button=pe.load(this.container.find(".NextButton")),this.next_button.click(this.callback(this.next_button_clicked)),this.current_page_number_display=pe.load(this.container.find(".CurrentPageNumber")),this.max_page_number_display=pe.load(this.container.find(".MaxPageNumber")),this.max_page_number=parseInt(this.max_page_number_display.text(),10),this.update_buttons(),pe.convert_to_rounded_corners(this.objects_list.find(".ConvertToRoundedCorners"))},pe.ServersidePaginator.events={PAGE_CHANGED:"ServersidePaginator_PAGE_CHANGED"},pe.ServersidePaginator.prototype.destroy=function(){this.previous_button.unbind("click"),this.next_button.unbind("click"),this.loader=null,this.objects_list=null,this.previous_button=null,this.next_button=null,this.current_page_number_display=null},pe.ServersidePaginator.prototype.show_page=function(e){this.current_page_number=e,this.current_page_number_display.html((e+1).toString()),this.update_buttons(),this.loader.load(e.toString(),this.callback(function(e){this.objects_list.html(e),this.fire_event(pe.ServersidePaginator.events.PAGE_CHANGED),pe.convert_to_rounded_corners(this.objects_list.find(".ConvertToRoundedCorners")),""===e&&this.current_page_number_display.html("0")}))},pe.ServersidePaginator.prototype.next_button_clicked=function(e){this.current_page_number>=this.max_page_number-1?e.stopPropagation():this.show_page(this.current_page_number+1)},pe.ServersidePaginator.prototype.previous_button_clicked=function(e){0!==this.current_page_number?this.show_page(this.current_page_number-1):e.stopPropagation()},pe.ServersidePaginator.prototype.update_buttons=function(){0===this.current_page_number?(this.previous_button.addClass("disabled"),this.max_page_number<2?this.next_button.addClass("disabled"):this.next_button.removeClass("disabled")):this.current_page_number>=this.max_page_number-1?(this.previous_button.removeClass("disabled"),this.next_button.addClass("disabled")):(this.previous_button.removeClass("disabled"),this.next_button.removeClass("disabled"))},pe.TweetSection=function(e,t,i,a){pe.init_widget(this,e),this.tweets_display=e.find(".Tweets"),this.live_update_url=t+".ehtml",a&&this.update_tweets(),this.tweet_update_delay=10,this.paginator=i?new pe.ServersidePaginator(e,i+"?page={{id}}"):null},pe.TweetSection.prototype.update_tweets=function(){$.ajax({url:this.live_update_url,type:"GET",dataType:"text",success:this.callback(this.update_tweets_success)})},pe.TweetSection.prototype.update_tweets_success=function(e){if("later"===e)return setTimeout(this.callback(function(){this.update_tweets()}),1e3*this.tweet_update_delay),void(this.tweet_update_delay*=2);this.tweets_display.html(e)},pe.ReadMore=function(e,t,i){0<e.length&&(pe.init_widget(this,e),this.read_more_control_selector=".ReadMoreControl",this.read_more_control=this.container.find(this.read_more_control_selector),this.read_less_control_selector=".ReadLessControl",this.read_less_control=this.container.find(this.read_less_control_selector),this.read_more_link=this.container.find(".ReadMoreLink"),this.read_more_link.click(this.callback(this.on_read_more_link_clicked)),this.read_less_link=this.container.find(".ReadLessLink"),this.read_less_link.click(this.callback(this.on_read_less_link_clicked)),this.long_description_selector=".LongDescription",this.long_description=this.container.find(this.long_description_selector),this.thumbs_selector=".thumbnails",this.thumbs=this.container.find(this.thumbs_selector),this.photos_selector=".photo",this.photos=this.container.find(this.photos_selector),this.read_more_handler=t,this.read_less_handler=i)},pe.ReadMore.events={LONG_DESC_OPENED:"ReadMore_LONG_DESC_OPENED"},pe.ReadMore.instantiate_all=function(){var e=$(".ReadMore");0<e.length&&new pe.ReadMore(e)},pe.ReadMore.prototype.on_read_more_link_clicked=function(e){this.expand_section($(e.currentTarget).closest(this.container.selector)),pe.fire_global_event(pe.ReadMore.events.LONG_DESC_OPENED),"function"==typeof this.read_more_handler&&this.read_more_handler()},pe.ReadMore.prototype.expand_section=function(e){0<e.length?(e.find(this.long_description_selector).removeClass("clipped"),e.find(this.read_less_control_selector).show(),e.find(this.read_more_control_selector).hide(),e.find(this.thumbs_selector).addClass("hidden"),e.find(this.photos_selector).removeClass("hidden")):(this.long_description.removeClass("clipped"),this.read_less_control.show(),this.read_more_control.hide(),this.thumbs.addClass("hidden"),this.photos.removeClass("hidden"))},pe.ReadMore.prototype.collapse_section=function(e){0<e.length?(e.find(this.read_less_control_selector).hide(),e.find(this.read_more_control_selector).show(),e.find(this.thumbs_selector).removeClass("hidden"),e.find(this.photos_selector).addClass("hidden"),e.find(this.long_description_selector).addClass("clipped")):(this.read_less_control.hide(),this.read_more_control.show(),this.thumbs.removeClass("hidden"),this.photos.addClass("hidden"),this.long_description.addClass("clipped"))},pe.ReadMore.prototype.on_read_less_link_clicked=function(e){this.collapse_section($(e.currentTarget).closest(this.container.selector)),"function"==typeof this.read_less_handler&&this.read_less_handler()},pe.ReadMore.instantiate=function(){return $.map($(".ReadMore"),function(e){return new pe.ReadMore($(e))})},pe.CloseButton=function(e,t){if(pe.init_widget(this,e),this.close_button=e.find(".CloseButton"),"function"==typeof t)this.close_button.click(t);else switch(t){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}},pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"},pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"},pe.CloseButton.prototype.remove_container=function(){return this.container.detach(),this.fire_event(pe.CloseButton.events.CLOSED),this.container.remove(),!1},pe.CloseButton.prototype.hide_container=function(){return this.fire_event(pe.CloseButton.events.CLOSED),this.container.hide(),!1},pe.BottombarPopupModule=function(e,t,i,a,s,n){pe.BottombarPopupModule.active_popup&&pe.BottombarPopupModule.active_popup.close(),e.append(this.html(t,s,n)),pe.init_widget(this,e.find("."+t)),this.container.attr("height",a),this.container.attr("width",i),this.parent_container=e;var o=this.parent_container.attr("title");this.parent_container_link_title="string"==typeof o?o:"",this.form_container=this.container.find(".FormContainer"),(pe.BottombarPopupModule.active_popup=this).close_button=new pe.CloseButton(this.container,pe.CloseButton.close_methods.REMOVE),this.close_button.bind_event(pe.CloseButton.events.CLOSED,this.callback(this.closed)),this.container.hover(this.callback(this.mouse_enter),this.callback(this.mouse_leave)),this.container.click(this.callback(this.popup_element_clicked))},pe.BottombarPopupModule.prototype.html=function(e,t,i){return'<div class="'+e+'">  <div class="CloseButton fake_link"></div>  <div class="title headline">'+t+'</div>  <div class="FormContainer">'+i+'</div>  <div class="bottom_arrow"></div></div>'},pe.BottombarPopupModule.prototype.closed=function(){pe.BottombarPopupModule.active_popup&&pe.BottombarPopupModule.active_popup.mouse_leave(),pe.BottombarPopupModule.active_popup=null},pe.BottombarPopupModule.prototype.close=function(){return this.close_button.remove_container(),this.closed(),!1},pe.BottombarPopupModule.prototype.mouse_enter=function(){this.parent_container.attr("title","")},pe.BottombarPopupModule.prototype.mouse_leave=function(){this.parent_container.attr("title",this.parent_container_link_title)},pe.BottombarPopupModule.prototype.show_thank_you=function(e){this.form_container.html(this.thank_you_html(e))},pe.BottombarPopupModule.prototype.thank_you_html=function(e){return"<div>  <p>"+e+"</p></div>"},pe.BottombarPopupModule.prototype.popup_element_clicked=function(e){e.stopPropagation()},pe.validation.autocomplete_open=!1,pe.validate_on_key_up=function(e,t){return e.keyup(function(){t(e)}),e.val()&&t(e),e},pe.validate_on_blur=function(e,t,i){return e.blur(function(){t(e)}),!i&&e.val()&&t(e),e},pe.validate_on_change=function(e,t,i){return e.change(function(){t(e)}),!i&&e.val()&&t(e),e},pe.validate_before_submit=function(n){n.submit(function(){pe.validation.clear_error_messages(n),n.find("input").each(function(e,t){var i=$(t);i.data("text_entered",!0),i.keyup(),i.blur()}),n.find("select").each(function(e,t){var i=$(t);i.data("text_entered",!0),i.change()}),n.find("textarea").each(function(e,t){var i=$(t);i.data("text_entered",!0),i.keyup(),i.blur()});var i=!0;if($.each(pe.validatables,function(e,t){i=t.validate_on_submit()&&i}),0<n.find(".inline-errors").length||!i){var e=n.find(".inline-errors:first").parent(),t=e.find("input:first");if(0<t.length)t.is(":hidden")?(t.show(),t.focus(),t.hide()):t.focus();else{var a=e.find("textarea"),s=e.find('select option:selected[value=""]').parent();a&&a.focus(),s&&s.focus()}return!1}})},pe.validate_user_exists=function(t,i){form=$(t.parents("form")[0]),form.submit(function(){return pe.validation.clear_error_messages(form),$.post("/api/users/check_user_exists",{login:t.val(),password:i.val()},function(e){pe.validation.show_message(t,e.username),pe.validation.show_message(i,e.password),_.isEmpty(e)&&(form.unbind("submit"),form.submit())}),!1})},pe.validation.clear_error_messages=function(e){pe.validation.find_error_messages(e).remove()},pe.validation.find_error_messages=function(e){return e.find(".inline-errors")},pe.validation.show_message=function(e,t){e.parent().find(".inline-errors,img").remove(),t?e.after('<span class="inline-errors">'+t+"</span>"):e.after('<img src="/assets/users/check.png" />')},pe.validation.is_more_than_5_words=function(e){return!!e.match(/(\w+\s+){5}\w+/)},pe.validation.is_single_non_character=function(e){return!!e&&!e.match(/[a-zA-Z]+/)},pe.validation.is_valid_email_address=function(e){return!!e.match(/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/)},pe.validation.is_valid_email_list=function(e){if(!e)return"Please enter at least one email.";var t=e.split(","),i="";return $.each(t,function(e,t){if(t=$.trim(t),!pe.validation.is_valid_email_address(t))return i=t+" is not a valid email address.",!1}),i},pe.validation.contains_illegal_characters=function(e){return!!e.match(/[\!@#\$%\^&\*\(\)\{\}\[\]\/\=\"<>\~\;_\+\?\\]/)},pe.validation.ensure_email_not_blank_and_is_valid=function(e){var t=e.val();if("string"==typeof t&&(t||e.data("text_entered"))){e.data("text_entered",!0);var i=e.attr("data_label")||"Email";if(0!==t.length){var a=!0,s=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/;$.each(t.split(","),function(e,t){a=a&&0<t.length&&s.test($.trim(t))}),a?(pe.validation.show_message(e,""),e.data("text_entered",!0)):pe.validation.show_message(e,"Please enter a valid email.")}else pe.validation.show_message(e,i+" cannot be blank.")}},pe.validation.validate_name=function(e){var t=e.val();"string"==typeof t&&(t||e.data("text_entered"))&&(e.data("text_entered",!0),pe.validation.is_single_non_character(t)?pe.validation.show_message(e,"Please enter a valid "+pe.validation.get_name_error_message(e)+"."):pe.validation.contains_illegal_characters(t)?pe.validation.show_message(e,"Please enter a valid name."):50<t.length?pe.validation.show_message(e,"Please shorten your name."):pe.validation.is_more_than_5_words(t)?pe.validation.show_message(e,"Please enter fewer than 5 words."):0<t.length?pe.validation.show_message(e,""):0<e[0].id.indexOf("first_name")?pe.validation.show_message(e,"Please enter your first name."):0<e[0].id.indexOf("last_name")?pe.validation.show_message(e,"Please enter your last name."):pe.validation.show_message(e,"Please enter your name."))},pe.validation.ensure_not_blank=function(e){var t=e.val();if("string"==typeof t&&(t||e.data("text_entered")))if(e.data("text_entered",!0),0===e.val().length){var i=e.attr("data_label")||"Field";pe.validation.show_message(e,i+" cannot be blank.")}else pe.validation.show_message(e,""),e.data("text_entered",!0)},pe.validation.validate_credit_card_number=function(e){var t=e.val();if(!(t.length<16)||e.data("text_entered"))return e.data("text_entered",!0),"string"==typeof t&&pe.is_valid_credit_card_number(t)?void pe.validation.show_message(e,""):void pe.validation.show_message(e,"Please enter a valid card number.")},pe.validation.validate_email=function(t){var e=t.val();(e||t.data("text_entered"))&&(t.data("text_entered",!0),$.getJSON("/api/users/check_email",{email:e},function(e){pe.validation.show_message(t,e.message)}))},pe.validation.validate_edited_email=function(e,t){var i=t.val();(i||t.data("text_entered"))&&(t.data("text_entered",!0),$.getJSON("/api/users/"+e+"/check_edited_email",{email:i},function(e){pe.validation.show_message(t,e.message)}))},pe.validation.validate_email_format=function(e){var t=e.val(),i=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/;0<t.length&&!i.test(t)?pe.validation.show_message(e,"Please enter a valid email."):0<t.length&&i.test(t)&&(pe.validation.show_message(e,""),e.data("text_entered",!0))},pe.validation.validate_email_list=function(e){var t=e.val();if("string"==typeof t){var i=pe.validation.is_valid_email_list(t);i&&pe.validation.show_message(e,i)}},pe.validation.validate_password=function(e){var t=e.val();t?0<t.length&&-1<t.indexOf(" ")?pe.validation.show_message(e,"No spaces allowed for password."):t.length<6?pe.validation.show_message(e,"Please enter a longer password."):(pe.validation.show_message(e,""),e.data("text_entered",!0)):e.data("text_entered")&&pe.validation.show_message(e,"Please enter a password.")},pe.validation.validate_security_code=function(e){var t=e.val();t.length<3&&!e.data("text_entered")||(e.data("text_entered",!0),t.match(/^\d{3}$/)||pe.validation.show_message(e,"Please enter a valid security code."))},pe.validation.validate_user_name=function(t){var e=t.val();t.attr("disabled")||(e||t.data("text_entered"))&&(t.data("text_entered",!0),50<e.length?pe.validation.show_message(t,"Please shorten your name."):0!==e.length?$.getJSON("/api/users/check_username",{username:e},function(e){pe.validation.show_message(t,e.message)}):pe.validation.show_message(t,"Please enter a user name."))},pe.validation.validate_change_of_username=function(e,t){var i=t.val();(i||t.data("text_entered"))&&(t.data("text_entered",!0),50<i.length?pe.validation.show_message(t,"Please shorten your name."):0!==i.length?$.getJSON("/api/users/"+e+"/check_edited_username",{username:i},function(e){pe.validation.show_message(t,e.message)}):pe.validation.show_message(t,"Please enter a user name."))},pe.validation.validate_zip_code=function(e){var t=e.val();t.length<5&&!e.data("text_entered")||(e.data("text_entered",!0),t.length<5?pe.validation.show_message(e,"Please enter a valid zip code."):"string"==typeof t&&pe.is_valid_zip_code(t)?pe.validation.show_message(e,""):pe.validation.show_message(e,"Please enter a valid zip code."))},pe.validation.terms_accepted=function(e){(e.attr("checked")||e.data("text_entered"))&&(e.data("text_entered",!0),e.attr("checked")?pe.validation.show_message(e.parent(),""):pe.validation.show_message(e.parent(),"Please accept the terms of use"))},pe.validation.get_name_error_message=function(e){return 0<e[0].id.indexOf("first_name")?"first name":0<e[0].id.indexOf("last_name")?"last name":"name"},pe.BottombarMissingPerformerDialog=function(e){pe.init_widget(this,e),pe.BottombarPopupModule.active_popup&&pe.BottombarPopupModule.active_popup.close(),(pe.BottombarPopupModule.active_popup=this).parent_container=this.container,this.dialog_box=$('<div title="Are we missing an entertainer?"></div>'),this.dialog_box.html(this.html()),this.performer_input=this.dialog_box.find(".Performer"),pe.validate_on_blur(this.performer_input,pe.validation.ensure_not_blank),this.your_email_input=this.dialog_box.find(".YourEmail"),pe.validate_on_blur(this.your_email_input,pe.validation.ensure_email_not_blank_and_is_valid),this.message_input=this.dialog_box.find(".MessageInput"),this.submit_button=this.dialog_box.find(".Submit"),this.submit_button.click(this.callback(this.submit_button_clicked)),this.dialog_box.find(".Cancel").click(this.callback(this.close)),this.dialog_box.dialog({modal:!0,show:!1,close:this.callback(this.close),dialogClass:"missing_dialog"})},pe.BottombarMissingPerformerDialog.prototype.close=function(){this.dialog_box.empty(),this.dialog_box.dialog("destroy"),pe.BottombarPopupModule.active_popup=null},pe.BottombarMissingPerformerDialog.prototype.html=function(){return'<fieldset><ol><li><label for="venue_event">Performer\'s Name <span class="ast">*</span></label><input id="venue_event" data_label="Performer" class="Performer" type="text"></li><li><label for="message">Message</label><textarea id="message" class="MessageInput"></textarea></li><li><label for="email">Your E-mail <span class="ast">*</span></label><input id="email" data_label="Your email" class="YourEmail" type="text"></li></ol></fieldset><div class="footer clearfix"><span class="note"><span class="ast">*</span> - required fields</span><span class="Submit blue_btn">Submit</span><span class="Cancel fake_link">Cancel</span></div>'},pe.BottombarMissingPerformerDialog.prototype.submit_button_clicked=function(){if(!this.validate_on_submit())return!1;$.ajax({url:"/api/missing_performer.json",data:{email:this.your_email_input.val(),performer:this.performer_input.val(),message:this.message_input.val()},type:"POST",success:this.callback(function(e){this.form_submitted(e)})})},pe.BottombarMissingPerformerDialog.prototype.form_submitted=function(e){if(1!==e.message)return this.submit_button.before('<p class="inline-errors">'+e.message+"</p>"),!1;this.show_thank_you()},pe.BottombarMissingPerformerDialog.prototype.show_thank_you=function(){this.dialog_box.html("<div><p>Thank you for your suggestion, we appreciate your input</p></div>")},pe.BottombarMissingPerformerDialog.prototype.validate_on_submit=function(){return pe.validation.clear_error_messages(this.container),this.your_email_input.data("text_entered",!0).blur(),this.performer_input.data("text_entered",!0).blur(),0===this.dialog_box.find(".inline-errors").length},$(document).ready(function(){pe.ChangeImageOnHover.instantiate_all(),pe.install_easing(),pe.convert_to_rounded_corners();var e=$(".TeamsScroller");6<e.find(".IndividualItem").length&&new pe.Scroller(e,1100,"disabled",6,6),pe.init_calendar_buttons(),new pe.ReadMore($(".MissingEntertainerReadMore")),pe.init_page_framework(function(){$(".MissingPerformerLink").click(pe.missing_performer_link_clicked),pe.PrefetcherModule.instantiate(),0<$(".TweetSection").length&&new pe.TweetSection($(".TweetSection"),"/performers/"+window.main_performer_url_param+"/tweets/last",null,window.update_tweets)})}),pe.missing_performer_link_clicked=function(){new pe.BottombarMissingPerformerDialog($(".MissingPerformerLink"))};