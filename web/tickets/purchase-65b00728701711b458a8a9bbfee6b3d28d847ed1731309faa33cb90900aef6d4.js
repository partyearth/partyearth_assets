(function(){var o,e,t,i,n,r={}.hasOwnProperty,s=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},a=this;for(this.Stripe=function(){function n(){}return n.version=2,n.endpoint="https://api.stripe.com/v1",n.setPublishableKey=function(e){n.key=e},n.complete=function(i){return function(e){var t;if("success"!==e)return t=Math.round((new Date).getTime()/1e3),(new Image).src="http://q.stripe.com?event=stripejs-error&type="+e+"&key="+n.key+"&timestamp="+t,"function"==typeof i?i(500,{error:{code:e,type:e,message:"An unexpected error has occurred with Stripe.js. This may\nbe due to network connectivity issues, so you should try\nagain (you won't be charged twice). If you're still having\nproblems, please let us know!"}}):void 0}},n}.call(this),o=this.Stripe,this.Stripe.token=function(){function e(){}return e.validate=function(e,t){if(!e)throw t+" required";if("object"!=typeof e)throw t+" invalid"},e.formatData=function(e,t){return o.utils.isElement(e)&&(e=o.utils.paramsFromForm(e,t)),o.utils.underscoreKeys(e),e},e.create=function(e,i){return e.key||(e.key=o.key||o.publishableKey),o.utils.validateKey(e.key),o.ajaxJSONP({url:o.endpoint+"/tokens",data:e,method:"POST",success:function(e,t){return"function"==typeof i?i(t,e):void 0},complete:o.complete(i),timeout:4e4})},e.get=function(e,i){if(!e)throw"token required";return o.utils.validateKey(o.key),o.ajaxJSONP({url:o.endpoint+"/tokens/"+e,data:{key:o.key},success:function(e,t){return"function"==typeof i?i(t,e):void 0},complete:o.complete(i),timeout:4e4})},e}.call(this),this.Stripe.card=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return s(r,e),r.tokenName="card",r.whitelistedAttrs=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],r.createToken=function(e,t,i){var n;return null==t&&(t={}),o.token.validate(e,"card"),"function"==typeof t?(i=t,t={}):"object"!=typeof t&&(n=parseInt(t,10),t={},0<n&&(t.amount=n)),t[r.tokenName]=o.token.formatData(e,r.whitelistedAttrs),o.token.create(t,i)},r.getToken=function(e,t){return o.token.get(e,t)},r.validateCardNumber=function(e){return 10<=(e=(e+"").replace(/\s+|-/g,"")).length&&e.length<=16&&r.luhnCheck(e)},r.validateCVC=function(e){return e=o.utils.trim(e),/^\d+$/.test(e)&&3<=e.length&&e.length<=4},r.validateExpiry=function(e,t){var i,n;return e=o.utils.trim(e),t=o.utils.trim(t),!!/^\d+$/.test(e)&&(!!/^\d+$/.test(t)&&(parseInt(e,10)<=12&&(n=new Date(t,e),i=new Date,n.setMonth(n.getMonth()-1),n.setMonth(n.getMonth()+1,1),i<n)))},r.luhnCheck=function(e){var t,i,n,r,o,s;for(n=!0,o=r=0,s=(i=(e+"").split("").reverse()).length;o<s;o++)t=i[o],t=parseInt(t,10),(n=!n)&&(t*=2),9<t&&(t-=9),r+=t;return r%10==0},r.cardType=function(e){return r.cardTypes[e.slice(0,2)]||"Unknown"},r.cardTypes=function(){var e,t,i,n;for(t={},e=i=40;i<=49;e=++i)t[e]="Visa";for(e=n=50;n<=59;e=++n)t[e]="MasterCard";return t[34]=t[37]="American Express",t[60]=t[62]=t[64]=t[65]="Discover",t[35]="JCB",t[30]=t[36]=t[38]=t[39]="Diners Club",t}(),r}.call(this,this.Stripe.token),this.Stripe.bankAccount=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.tokenName="bank_account",n.whitelistedAttrs=["country","routing_number","account_number"],n.createToken=function(e,t,i){return null==t&&(t={}),o.token.validate(e,"bank account"),"function"==typeof t&&(i=t,t={}),t[n.tokenName]=o.token.formatData(e,n.whitelistedAttrs),o.token.create(t,i)},n.getToken=function(e,t){return o.token.get(e,t)},n.validateRoutingNumber=function(e,t){switch(e=o.utils.trim(e),t){case"US":return/^\d+$/.test(e)&&9===e.length&&n.routingChecksum(e);case"CA":return/\d{5}\-\d{3}/.test(e)&&9===e.length;default:return!0}},n.validateAccountNumber=function(e,t){switch(e=o.utils.trim(e),t){case"US":return/^\d+$/.test(e)&&1<=e.length&&e.length<=17;default:return!0}},n.routingChecksum=function(e){var t,i,n,r,o,s;for(n=0,t=(e+"").split(""),o=(s=[r=0,3,6]).length;r<o;r++)i=s[r],n+=3*parseInt(t[i]),n+=7*parseInt(t[i+1]),n+=parseInt(t[i+2]);return 0!==n&&n%10==0},n}.call(this,this.Stripe.token),i=0,n=(e=["createToken","getToken","cardType","validateExpiry","validateCVC","validateCardNumber"]).length;i<n;i++)t=e[i],this.Stripe[t]=this.Stripe.card[t];"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe),"function"==typeof define&&define("stripe",[],function(){return a.Stripe})}).call(this),function(){var o,e,a,t=[].slice;o=encodeURIComponent,e=(new Date).getTime(),a=function(e,t,i){var n,r;for(n in null==t&&(t=[]),e)r=e[n],i&&(n=i+"["+n+"]"),"object"==typeof r?a(r,t,n):t.push(n+"="+o(r));return t.join("&").replace(/%20/g,"+")},this.Stripe.ajaxJSONP=function(i){var n,r,o,s;return null==i&&(i={}),r="sjsonp"+ ++e,o=document.createElement("script"),n=null,s={abort:function(e){var t;return null==e&&(e="abort"),clearTimeout(n),null!=(t=o.parentNode)&&t.removeChild(o),r in window&&(window[r]=function(){}),"function"==typeof i.complete?i.complete(e,s,i):void 0}},o.onerror=function(){return s.abort(),"function"==typeof i.error?i.error(s,i):void 0},window[r]=function(){var e;e=1<=arguments.length?t.call(arguments,0):[],clearTimeout(n),o.parentNode.removeChild(o);try{delete window[r]}catch(a){window[r]=void 0}return"function"==typeof i.success&&i.success.apply(i,e),"function"==typeof i.complete?i.complete("success",s,i):void 0},i.data||(i.data={}),i.data.callback=r,i.method&&(i.data._method=i.method),o.src=i.url+"?"+a(i.data),document.getElementsByTagName("head")[0].appendChild(o),0<i.timeout&&(n=setTimeout(function(){return s.abort("timeout")},i.timeout)),s}}.call(this),function(){var d=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};this.Stripe.utils=function(){function e(){}return e.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},e.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},e.underscoreKeys=function(e){var t,i,n;for(t in n=[],e)i=e[t],delete e[t],n.push(e[this.underscore(t)]=i);return n},e.isElement=function(e){return"object"==typeof e&&("undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery||1===e.nodeType)},e.paramsFromForm=function(e,t){var i,n,r,o,s,a,l,u,c,p;for(null==t&&(t=[]),"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(e=e[0]),r=e.getElementsByTagName("input"),s=e.getElementsByTagName("select"),a={},l=0,c=r.length;l<c;l++)n=r[l],i=this.underscore(n.getAttribute("data-stripe")),d.call(t,i)<0||(a[i]=n.value);for(u=0,p=s.length;u<p;u++)o=s[u],i=this.underscore(o.getAttribute("data-stripe")),d.call(t,i)<0||null!=o.selectedIndex&&(a[i]=o.options[o.selectedIndex].value);return a},e.validateKey=function(e){if(!e||"string"!=typeof e)throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(e))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(e))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},e}()}.call(this),function(){var n=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};this.Stripe.validator={"boolean":function(e,t){if("true"!==t&&"false"!==t)return"Enter a boolean string (true or false)"},integer:function(e,t){if(!/^\d+$/.test(t))return"Enter an integer"},positive:function(e,t){if(this.integer(e,t)||!(0<parseInt(t,10)))return"Enter a positive value"},range:function(e,t){var i;if(i=parseInt(t,10),n.call(e,i)<0)return"Needs to be between "+e[0]+" and "+e[e.length-1]},required:function(e,t){if(e&&(null==t||""===t))return"Required"},year:function(e,t){if(!/^\d{4}$/.test(t))return"Enter a 4-digit year"},birthYear:function(e,t){return this.year(e,t)||(2e3<parseInt(t,10)?"You must be over 18":parseInt(t,10)<1900?"Enter your birth year":void 0)},month:function(e,t){return this.integer(e,t)?"Please enter a month":this.range([1,2,3,4,5,6,7,8,9,10,11,12],t)?"Needs to be between 1 and 12":void 0},choices:function(e,t){if(n.call(e,t)<0)return"Not an acceptable value for this field"},email:function(e,t){if(!/^[^@<\s>]+@[^@<\s>]+$/.test(t))return"That doesn't look like an email address"},url:function(e,t){if(!/^https?:\/\/.+\..+/.test(t))return"Not a valid url"},usTaxID:function(e,t){if(!/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(t))return"Not a valid tax ID"},ein:function(e,t){if(!/^\d{2}-?\d{7}$/.test(t))return"Not a valid EIN"},ssnLast4:function(e,t){if(!/^\d{4}$/.test(t))return"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(e,t){if(!function(){switch(e){case"CA":return/^\d{3}-?\d{3}-?\d{3}$/.test(t);case"US":return!0}}())return"Not a valid ID"},bizTaxID:function(e,t){var i,n,r,o,s,a;if(null!=(o={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]}[e])){for(i=o[0],n=!1,s=0,a=(r=o[1]).length;s<a;s++)if(r[s].test(t)){n=!0;break}if(!n)return"Not a valid "+i}},zip:function(e,t){if(!function(){switch(e.toUpperCase()){case"CA":return/^[\d\w]{6}$/.test(null!=t?t.replace(/\s+/g,""):void 0);case"US":return/^\d{5}$/.test(t)||/^\d{9}$/.test(t)}}())return"Not a valid zip"},bankAccountNumber:function(e,t){if(!/^\d{1,17}$/.test(t))return"Invalid bank account number"},usRoutingNumber:function(e){var t,i,n,r;if(!/^\d{9}$/.test(e))return"Routing number must have 9 digits";for(t=n=i=0,r=e.length-1;n<=r;t=n+=3)i+=3*parseInt(e.charAt(t),10)+7*parseInt(e.charAt(t+1),10)+parseInt(e.charAt(t+2),10);return 0===i||i%10!=0?"Invalid routing number":void 0},caRoutingNumber:function(e){if(!/^\d{5}\-\d{3}$/.test(e))return"Invalid transit number"},routingNumber:function(e,t){switch(e.toUpperCase()){case"CA":return this.caRoutingNumber(t);case"US":return this.usRoutingNumber(t)}},phoneNumber:function(e,t){if(10!==t.replace(/[^0-9]/g,"").length)return"Invalid phone number"},bizDBA:function(e,t){if(!/^.{1,23}$/.test(t))return"Statement descriptors can only have up to 23 characters"},nameLength:function(e,t){if(1===t.length)return"Names need to be longer than one character"}}}.call(this),pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"},pe.routes.build_path=function(e,t){var i=pe.routes.map[e],n=i.match(/\{\{\*(.+)\}\}/);return _.each(n,function(e){t[e]&&(t[e]=t[e].join("/"))}),i=i.replace(/\*/,""),t=t||{},pe.routes.clean_url(pe.templatize(i,t))},pe.routes.clean_url=function(e){return("/"+e).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")},pe.routes.current_url_params=function(){var e=pe.routes.recognize_path(window.location.pathname);return e?e.params:{}},pe.routes.recognize_path=function(t){var i,n;t=pe.routes.clean_url(t);var e=_.find(_.keys(pe.routes.map),function(e){return i=pe.routes.map[e],(n=new RegExp(i.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"))).test(t)});if(e){for(var r=_.map(i.match(/\{\{[^\}]+\}\}/g),function(e){return e.replace(/\{|\}/g,"")}),o=t.match(n).slice(1,99),s={params:{}},a=function(e){return!_.isEmpty(e)},l=0;l<r.length;l++)"*"==r[l][0]&&(r[l]=r[l].replace(/\*/g,""),o[l]=_.select(o[l].replace(/\*/g,"").split("/"),a)),s.params[r[l]]=o[l];return s.path_info={name:e,template:i},s}return!1},pe.routes.Request=function(e,t,i){pe.routes.map[e]?(this.path=e,"object"!=typeof t&&(t={id:t}),this.params=t,this.callback=i):alert("This path is not registered in the routes map.")},pe.routes.Request.factory=function(e,t,i){return new pe.routes.Request(e,t,i)},pe.routes.Request.from_current_location=function(e,t,i){t=t||{};var n=pe.routes.current_url_params();return new pe.routes.Request(e,_.extend(n,t),i)},pe.routes.Request.prototype.ajax=function(e,t){var i="function"==typeof t?t:this.callback;$.ajax({url:this.build_path(),data:this.params,type:e,success:i})},pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)},pe.routes.Request.prototype.get=function(e){this.ajax("GET",e)},pe.routes.Request.prototype.post=function(e){this.ajax("POST",e)},function(){var r=function(e,t){return function(){return e.apply(t,arguments)}};pe.StripeForm=function(){function e(e,t,i,n){if(this.form=e,this.path_name=t,this.needs_token=i,this.on_success=n,this.on_submit_button_clicked=r(this.on_submit_button_clicked,this),this.on_submit=r(this.on_submit,this),this.on_charge=r(this.on_charge,this),this.enable_submit_button=r(this.enable_submit_button,this),this.disable_submit_button=r(this.disable_submit_button,this),this.form.find("select, input[type=text]").each(function(){return $(this).val("")}),!this.init_stripe())return this.form.submit(function(e){return e.preventDefault()}),!1;this.errors_container=this.form.find(".Errors"),this.messages_container=this.form.find(".Messages"),this.card_inputs=this.form.find(".CardInput"),this.billing_inputs=this.form.find(".BillingInput"),this.attendee_inputs=this.form.find(".AttendeeQuestions input, .AttendeeQuestions textarea, .AttendeeQuestions select"),this.buyer_inputs=this.form.find(".BuyerQuestions input, .BuyerQuestions textarea, .BuyerQuestions select"),this.processing_label=this.form.find(".ProcessingLabel"),this.submit_button=this.form.find(".SubmitButton"),this.submit_button.click(this.on_submit_button_clicked),this.form.submit(this.on_submit)}return e.prototype.apply_values=function(e){return _.each(e,(i=this,function(e,t){return i.form.find("[data-key='"+t+"']").val(e)}));var i},e.prototype.collect_card_data=function(e){var i;return e||(e=$(".BillingInput, .CardInput")),i={},_.each(e,function(e){var t;if("radio"===(e=$(e)).attr("type")&&(e=e.filter(":checked")),0<e.length&&(t=e.data("key")))return i[t]=e.val()}),i},e.prototype.disable_submit_button=function(){return this.submit_button.addClass("Disabled").hide(),this.processing_label.show()},e.prototype.enable_submit_button=function(){return this.processing_label.hide(),this.submit_button.removeClass("Disabled").show()},e.prototype.init_stripe=function(){return window.publishable_stripe_key?(Stripe.setPublishableKey(window.publishable_stripe_key),!0):(alert("No window.publishable_stripe_key set to use stripe"),!1)},e.prototype.on_charge=function(e,t){var i,n,r;return t&&t.error?($("body").css("cursor","inherit"),this.show_error(t.error.message),this.enable_submit_button()):(this.show_message("Please wait..."),(n=this.collect_card_data(this.billing_inputs)).buyer_info=this.buyer_inputs.serialize(),n.attendee_info=this.attendee_inputs.serialize(),(i={id:n.id,ticket_order:n}).card_token=t?t.id:"failed",pe.routes.Request.factory(this.path_name,i).post((r=this,function(e){return $("body").css("cursor","inherit"),1===e.status?(r.show_error(e.message),r.enable_submit_button()):r.on_success?r.on_success():void 0})))},e.prototype.on_submit=function(e){return e&&e.preventDefault(),!1},e.prototype.collect_stripe_data=function(){var e,t;return t=this.collect_card_data(this.card_inputs),e=this.collect_card_data(this.billing_inputs),t.name=e.first_name+" "+e.last_name,t.address_line1=e.address_1,t.address_line2=e.address_2,t.address_city=e.city,t.address_state=this.form.find("select[data-key=state]").val(),t.address_country="USA",t},e.prototype.charge=function(){if(!this.submit_button.hasClass("Disabled"))return this.disable_submit_button(),$("body").css("cursor","wait"),this.needs_token?Stripe.card.createToken(this.collect_stripe_data(),this.on_charge):this.on_charge()},e.prototype.on_submit_button_clicked=function(){return this.charge()},e.prototype.show_error=function(e){return this.errors_container.show().html(e),this.messages_container.hide(),pe.install_easing(),pe.animated_scrolling(this.errors_container,10),this.card_inputs.filter(".CCType").prepend("<option value=''>Select One</option>"),_.each(this.card_inputs,function(e){return $(e).val(""),$(e).parent().find(".inline-success").remove()})},e.prototype.show_message=function(){return this.errors_container.hide()},e}()}.call(this),pe.Floater=function(e,t,i){pe.init_widget(this,e),this.bottom_margin=i||0,this.start_point_div=e.find(".FloatingAreaStart"),this.end_point_div=t||null,this.start_from=0,this.stop_at=0,this.is_floating=!1,this.sticked=!1,this.floater=this.container.find(".Floater"),this.offset=0,this.disabled=!1,this.top=parseInt(this.floater.css("margin-top"),10)||0,$(window).scroll(this.callback(this.scrolling)),this.set_floating_area(),pe.Floater.register_floater(this)},pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"},pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top,this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)},pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var e=$(window).scrollTop(),t=e+this.offset+this.bottom_margin<=this.start_from,i=e+this.offset+this.bottom_margin>this.start_from,n=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;this.is_floating||!i||n||this.sticked?this.is_floating&&t?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,this)):this.end_point_div&&(!this.sticked&&n?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&e+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick()):(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this))}},pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed"),this.floater.removeClass("bottom"),this.is_floating=!0,this.sticked=!1,this.set_offset()},pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px"),this.floater.removeClass("fixed"),this.floater.css("position","absolute"),this.is_floating=!1,this.sticked=!0},pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px"),this.floater.removeClass("fixed"),this.floater.css("position","absolute"),this.is_floating=!1,this.sticked=!0,this.disabled=!0},pe.Floater.prototype.enable=function(){this.disabled=!1},pe.Floater.prototype.unstick=function(){this.floater.css("margin-top",""),this.floater.css("top",""),this.floater.css("position",""),this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this)},pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top",""),this.floater.removeClass("fixed"),this.floater.removeClass("bottom"),this.is_floating=!1,this.sticked=!1,this.set_offset()},pe.Floater.prototype.set_offset=function(e){e&&(this.offset=e),0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")},pe.Floater.registered_floaters=[],pe.Floater.register_floater=function(e){pe.Floater.registered_floaters.push(e),pe.Floater.update_positions()},pe.Floater.update_positions=function(){if(pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(e){return e.container.offset().top},null),pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var e=1;e<pe.Floater.registered_floaters.length;e++){var t=pe.Floater.registered_floaters[e-1].floater,i=(pe.Floater.registered_floaters[e].floater,pe.Floater.registered_floaters[e-1].offset+t.outerHeight());pe.Floater.registered_floaters[e].offset=i,pe.Floater.registered_floaters[e].is_floating&&pe.Floater.registered_floaters[e].start_floating(),pe.Floater.registered_floaters[e].set_floating_area()}},pe.Validator=function(t){this.message=t.message||"Invalid value.",this.callback=t.callback,this.unless_callback=t.unless||function(){return!1},(this.options=t).value?this.value=t.value:this.value=function(e){return t.callback(e)}},pe.Validator.prototype.passed=function(e){return!!this.callback($(e))},pe.Validator.prototype.failed=function(e){return!this.passed(e)},pe.Validator.prototype.unless=function(){return this.unless_callback()},pe.validation.name_validator=new pe.Validator({callback:function(e){return _.isEmpty($.trim(e.val()))?!(this.message="Required."):!(50<e.val().length)||!(this.message="Please shorten your name.")},message:"Invalid name."}),pe.validation.not_blank_validator=new pe.Validator({callback:function(e){return"checkbox"==e.attr("type")?$(e).is(":checked"):!_.isEmpty($.trim(e.val()))},message:"Required."}),pe.validation.cc_number_validator=new pe.Validator({callback:function(e){return Stripe.card.validateCardNumber(e.val())},message:"Invalid card number."}),pe.validation.cvc_validator=new pe.Validator({callback:function(e){return Stripe.card.validateCVC(e.val())},message:"Invalid CVC."}),pe.validation.zip_code_validator=new pe.Validator({callback:function(e){return!!e.val().match(/^\d{5}(\s*\-\s*\d{4})?$/)},message:"Please enter a valid zip code."}),pe.validation.email_format_validator=new pe.Validator({callback:function(e){return pe.validation.check_email_format(e.val())},message:"Please enter a valid email address."}),pe.validation.check_email_format=function(e){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(e))},pe.validation.email_confirmation_validator=new pe.Validator({callback:function(e){return!!pe.validation.check_email_format(e.val())&&($(e.data("email-field")).val()==e.val()||!(this.message="Email addresses do not match."))},message:"Please enter a valid email address."}),pe.validation.check_email_format=function(e){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(e))},function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(e){var t,i,n,r,o,s,a,l;return l=(s=_.map($(e).find("select"),function(e){return $(e).val()}))[2],o=s[0],n=s[1],!!(l&&o&&n)&&(r=(i=new Date(o+"/"+n+"/"+l)).getMonth()+1+"",t=i.getDate()+"",a=i.getFullYear()+"",r===o&&t===n&&a===l)}})}.call(this),function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(e){return 0<e.find("input:checked").length}})}.call(this),pe.ValidatableForm=function(container,rules,bindings,after_submit){pe.init_widget(this,container),this.bindings=bindings||{},this.chained_fields=[],this.errors={},this.rules=rules||{},_.each(container.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(element){element=$(element);var selector="#"+element.attr("id"),validator=element.data("validator");this.rules[selector]=validator?eval(validator):pe.validation.not_blank_validator;var binding=element.data("binding");binding?this.bindings[selector]=binding:"text"==element.attr("type")||"textarea"==element.attr("tagName")?this.bindings[selector]="blur":this.rules[selector]==pe.validation.dob_validator?element.find("select").each(this.callback(function(e,t){$(t).change(this.callback(function(){this.validate_field(selector)}))})):this.bindings[selector]="change"})),this.save_button=this.container.find(".SaveButton"),this.submit_button=this.container.find(".SubmitButton"),this.after_submit=after_submit,this.init_bindings(),this.validate(),this.toggle_submit(),this.submit_button.click(this.callback(this.on_submit))},pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")})),_.each(this.bindings,function(e,t){"string"==typeof e?$(t).bind(e,this.callback(function(){this.validate_field(t)})):"function"==typeof e&&this.callback(e)(),this.rules[t].value($(t))&&this.validate_field(t)},this)},pe.ValidatableForm.prototype.on_submit=function(){var e=this.validate();return this.highlight_first_failed(),e&&this.after_submit&&this.after_submit(),e},pe.ValidatableForm.prototype.delete_error=function(t){delete this.errors[t],_.each(this.chained_fields,function(e){_.include(e,t)&&_.each(e,function(e){this.errors[e]&&this.delete_error(e)},this)},this)},pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1},pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var e=_.keys(this.errors)[0];this.render_field_error(e)}this.focus_on_failed()}},pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(e,t){this.render_field_error(t)},this)},pe.ValidatableForm.prototype.render_field_error=function(e){var t=$(e).parents("li.input:first");0===t.length&&(t=$(e)),t.find(".inline-errors").remove(),t.append('<span class="inline-errors">'+this.errors[e]+"</span>"),t.find(".inline-success").remove()},pe.ValidatableForm.prototype.render_field_success=function(e){var t=$(e).parents("li.input:first");0===t.length&&(t=$(e)),t.find(".inline-success").remove(),t.append('<img class="inline-success" src="/assets/users/check.png" />'),t.find(".inline-errors").remove()},pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(e){this.render_field_success(e)},this)},pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")},pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))},pe.ValidatableForm.prototype.validate_field=function(e){var t=this.rules[e],i=t.passed(e);return t.unless()?this.delete_error(e):i?(this.delete_error(e),this.render_field_success(e)):(this.errors[e]=$(e).data("message")||t.message,this.render_field_error(e)),this.toggle_submit(),i},pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)},pe.ValidatableForm.prototype.validate=function(){return _.each(this.rules,function(e,t){e.failed(t)?this.errors[t]=$(t).data("message")||e.message:delete this.errors[t]},this),this.valid()},pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)},pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length},function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};pe.AskPartyEarth=function(){function e(e){this.container=e,this.show_message=t(this.show_message,this),this.on_submit=t(this.on_submit,this),this.show_form=t(this.show_form,this),this.click=t(this.click,this),this.link=this.container.find(".Link"),this.link.click(this.show_form),this.form_container=this.container.find(".FormContainer"),this.form=this.form_container.find("form"),this.form.submit(this.on_submit),this.message=this.container.find(".Message")}return e.prototype.click=function(e){return this.on_click_callback=e},e.prototype.show_form=function(){var e,t,i;return t=new pe.Validator({callback:function(e){var t;return t=$.trim(e.val()),_.isEmpty(t)?!(this.message="Email cannot be blank."):(this.message="Invalid email.",/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test(t))}}),i={"#question_name":pe.validation.name_validator,"#question_email":t,"#question_text":pe.validation.not_blank_validator},e={"#question_name":"keyup","#question_email":"keyup","#question_text":"keyup"},new pe.ValidatableForm(this.form,i,e),this.link.hide(),this.form_container.show(),this.on_click_callback()},e.prototype.on_submit=function(e){return e.preventDefault(),$.post(pe.routes.build_path("ask_party_earth"),this.form.serialize(),"json"),this.show_message()},e.prototype.show_message=function(){return this.form_container.hide(),this.message.show()},e}()}.call(this),function(m){function e(){function i(e){var t=e<1e12?r?performance.now()+performance.timing.navigationStart:n():e||n();1e3<=t-s&&(F._updateTargets(),s=t),o(i)}this.regional=[],this.regional[""]={labels:["Years","Months","Weeks","Days","Hours","Minutes","Seconds"],labels1:["Year","Month","Week","Day","Hour","Minute","Second"],compactLabels:["y","m","w","d"],whichLabels:null,digits:["0","1","2","3","4","5","6","7","8","9"],timeSeparator:":",isRTL:!1},this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",layout:"",compact:!1,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:!1,onExpiry:null,onTick:null,tickInterval:1},m.extend(this._defaults,this.regional[""]),this._serverSyncs=[];var n="function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},r=window.performance&&"function"==typeof window.performance.now,
o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null,s=0;!o||m.noRequestAnimationFrame?(m.noRequestAnimationFrame=null,setInterval(function(){F._updateTargets()},980)):(s=window.animationStartTime||window.webkitAnimationStartTime||window.mozAnimationStartTime||window.oAnimationStartTime||window.msAnimationStartTime||n(),o(i))}function i(e,t){return"option"==e&&(0==t.length||1==t.length&&"string"==typeof t[0])||-1<m.inArray(e,n)}var b=0,y=1,k=2,w=3,C=4,T=5,$=6;m.extend(e.prototype,{markerClassName:"hasCountdown",propertyName:"countdown",_rtlClass:"countdown_rtl",_sectionClass:"countdown_section",_amountClass:"countdown_amount",_rowClass:"countdown_row",_holdingClass:"countdown_holding",_showClass:"countdown_show",_descrClass:"countdown_descr",_timerTargets:[],setDefaults:function(e){this._resetExtraLabels(this._defaults,e),m.extend(this._defaults,e||{})},UTCDate:function(e,t,i,n,r,o,s,a){"object"==typeof t&&t.constructor==Date&&(a=t.getMilliseconds(),s=t.getSeconds(),o=t.getMinutes(),r=t.getHours(),n=t.getDate(),i=t.getMonth(),t=t.getFullYear());var l=new Date;return l.setUTCFullYear(t),l.setUTCDate(1),l.setUTCMonth(i||0),l.setUTCDate(n||1),l.setUTCHours(r||0),l.setUTCMinutes((o||0)-(Math.abs(e)<30?60*e:e)),l.setUTCSeconds(s||0),l.setUTCMilliseconds(a||0),l},periodsToSeconds:function(e){return 31557600*e[0]+2629800*e[1]+604800*e[2]+86400*e[3]+3600*e[4]+60*e[5]+e[6]},_attachPlugin:function(e,t){if(!(e=m(e)).hasClass(this.markerClassName)){var i={options:m.extend({},this._defaults),_periods:[0,0,0,0,0,0,0]};e.addClass(this.markerClassName).data(this.propertyName,i),this._optionPlugin(e,t)}},_addTarget:function(e){this._hasTarget(e)||this._timerTargets.push(e)},_hasTarget:function(e){return-1<m.inArray(e,this._timerTargets)},_removeTarget:function(t){this._timerTargets=m.map(this._timerTargets,function(e){return e==t?null:e})},_updateTargets:function(){for(var e=this._timerTargets.length-1;0<=e;e--)this._updateCountdown(this._timerTargets[e])},_optionPlugin:function(e,t,i){var n=(e=m(e)).data(this.propertyName);if(!t||"string"==typeof t&&null==i){var r=t;return(t=(n||{}).options)&&r?t[r]:t}if(e.hasClass(this.markerClassName)){if("string"==typeof(t=t||{})){r=t;(t={})[r]=i}t.layout&&(t.layout=t.layout.replace(/&lt;/g,"<").replace(/&gt;/g,">")),this._resetExtraLabels(n.options,t);var o=n.options.timezone!=t.timezone;m.extend(n.options,t),this._adjustSettings(e,n,null!=t.until||null!=t.since||o);var s=new Date;(n._since&&n._since<s||n._until&&n._until>s)&&this._addTarget(e[0]),this._updateCountdown(e,n)}},_updateCountdown:function(e,t){var i=m(e);if(t=t||i.data(this.propertyName)){if(i.html(this._generateHTML(t)).toggleClass(this._rtlClass,t.options.isRTL),m.isFunction(t.options.onTick)){var n="lap"!=t._hold?t._periods:this._calculatePeriods(t,t._show,t.options.significant,new Date);1!=t.options.tickInterval&&this.periodsToSeconds(n)%t.options.tickInterval!=0||t.options.onTick.apply(e,[n])}if("pause"!=t._hold&&(t._since?t._now.getTime()<t._since.getTime():t._now.getTime()>=t._until.getTime())&&!t._expiring){if(t._expiring=!0,this._hasTarget(e)||t.options.alwaysExpire){if(this._removeTarget(e),m.isFunction(t.options.onExpiry)&&t.options.onExpiry.apply(e,[]),t.options.expiryText){var r=t.options.layout;t.options.layout=t.options.expiryText,this._updateCountdown(e,t),t.options.layout=r}t.options.expiryUrl&&(window.location=t.options.expiryUrl)}t._expiring=!1}else"pause"==t._hold&&this._removeTarget(e);i.data(this.propertyName,t)}},_resetExtraLabels:function(e,t){var i=!1;for(var n in t)if("whichLabels"!=n&&n.match(/[Ll]abels/)){i=!0;break}if(i)for(var n in e)n.match(/[Ll]abels[02-9]|compactLabels1/)&&(e[n]=null)},_adjustSettings:function(e,t,i){for(var n,r=0,o=null,s=0;s<this._serverSyncs.length;s++)if(this._serverSyncs[s][0]==t.options.serverSync){o=this._serverSyncs[s][1];break}if(null!=o)r=t.options.serverSync?o:0,n=new Date;else{var a=m.isFunction(t.options.serverSync)?t.options.serverSync.apply(e,[]):null;n=new Date,r=a?n.getTime()-a.getTime():0,this._serverSyncs.push([t.options.serverSync,r])}var l=t.options.timezone;l=null==l?-n.getTimezoneOffset():l,(i||!i&&null==t._until&&null==t._since)&&(t._since=t.options.since,null!=t._since&&(t._since=this.UTCDate(l,this._determineTime(t._since,null)),t._since&&r&&t._since.setMilliseconds(t._since.getMilliseconds()+r)),t._until=this.UTCDate(l,this._determineTime(t.options.until,n)),r&&t._until.setMilliseconds(t._until.getMilliseconds()+r)),t._show=this._determineShow(t)},_destroyPlugin:function(e){(e=m(e)).hasClass(this.markerClassName)&&(this._removeTarget(e[0]),e.removeClass(this.markerClassName).empty().removeData(this.propertyName))},_pausePlugin:function(e){this._hold(e,"pause")},_lapPlugin:function(e){this._hold(e,"lap")},_resumePlugin:function(e){this._hold(e,null)},_hold:function(e,t){var i=m.data(e,this.propertyName);if(i){if("pause"==i._hold&&!t){i._periods=i._savePeriods;var n=i._since?"-":"+";i[i._since?"_since":"_until"]=this._determineTime(n+i._periods[0]+"y"+n+i._periods[1]+"o"+n+i._periods[2]+"w"+n+i._periods[3]+"d"+n+i._periods[4]+"h"+n+i._periods[5]+"m"+n+i._periods[6]+"s"),this._addTarget(e)}i._hold=t,i._savePeriods="pause"==t?i._periods:null,m.data(e,this.propertyName,i),this._updateCountdown(e,i)}},_getTimesPlugin:function(e){var t=m.data(e,this.propertyName);return t?"pause"==t._hold?t._savePeriods:t._hold?this._calculatePeriods(t,t._show,t.options.significant,new Date):t._periods:null},_determineTime:function(e,t){var i=function(e){var t=new Date;return t.setTime(t.getTime()+1e3*e),t},n=null==e?t:"string"==typeof e?function(e){e=e.toLowerCase();for(var t=new Date,i=t.getFullYear(),n=t.getMonth(),r=t.getDate(),o=t.getHours(),s=t.getMinutes(),a=t.getSeconds(),l=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,u=l.exec(e);u;){switch(u[2]||"s"){case"s":a+=parseInt(u[1],10);break;case"m":s+=parseInt(u[1],10);break;case"h":o+=parseInt(u[1],10);break;case"d":r+=parseInt(u[1],10);break;case"w":r+=7*parseInt(u[1],10);break;case"o":n+=parseInt(u[1],10),r=Math.min(r,F._getDaysInMonth(i,n));break;case"y":i+=parseInt(u[1],10),r=Math.min(r,F._getDaysInMonth(i,n))}u=l.exec(e)}return new Date(i,n,r,o,s,a,0)}(e):"number"==typeof e?i(e):e;return n&&n.setMilliseconds(0),n},_getDaysInMonth:function(e,t){return 32-new Date(e,t,32).getDate()},_normalLabels:function(e){return e},_generateHTML:function(i){var n=this;i._periods=i._hold?i._periods:this._calculatePeriods(i,i._show,i.options.significant,new Date);for(var e=!1,t=0,r=i.options.significant,o=m.extend({},i._show),s=b;s<=$;s++)e|="?"==i._show[s]&&0<i._periods[s],o[s]="?"!=i._show[s]||e?i._show[s]:null,t+=o[s]?1:0,r-=0<i._periods[s]?1:0;var a=[!1,!1,!1,!1,!1,!1,!1];for(s=$;b<=s;s--)i._show[s]&&(i._periods[s]?a[s]=!0:(a[s]=0<r,r--));var l=i.options.compact?i.options.compactLabels:i.options.labels,u=i.options.whichLabels||this._normalLabels,c=function(e){var t=i.options["compactLabels"+u(i._periods[e])];return o[e]?n._translateDigits(i,i._periods[e])+(t?t[e]:l[e])+" ":""},p=function(e){var t=i.options["labels"+u(i._periods[e])];return!i.options.significant&&o[e]||i.options.significant&&a[e]?'<span class="'+F._sectionClass+'"><span class="'+F._amountClass+'">'+n._translateDigits(i,i._periods[e])+"</span><br/>"+(t?t[e]:l[e])+"</span>":""};return i.options.layout?this._buildLayout(i,o,i.options.layout,i.options.compact,i.options.significant,a):(i.options.compact?'<span class="'+this._rowClass+" "+this._amountClass+(i._hold?" "+this._holdingClass:"")+'">'+c(b)+c(y)+c(k)+c(w)+(o[C]?this._minDigits(i,i._periods[C],2):"")+(o[T]?(o[C]?i.options.timeSeparator:"")+this._minDigits(i,i._periods[T],2):"")+(o[$]?(o[C]||o[T]?i.options.timeSeparator:"")+this._minDigits(i,i._periods[$],2):""):'<span class="'+this._rowClass+" "+this._showClass+(i.options.significant||t)+(i._hold?" "+this._holdingClass:"")+'">'+p(b)+p(y)+p(k)+p(w)+p(C)+p(T)+p($))+"</span>"+(i.options.description?'<span class="'+this._rowClass+" "+this._descrClass+'">'+i.options.description+"</span>":"")},_buildLayout:function(i,e,t,n,r,o){for(var s=i.options[n?"compactLabels":"labels"],a=i.options.whichLabels||this._normalLabels,l=function(e){return(i.options[(n?"compactLabels":"labels")+a(i._periods[e])]||s)[e]},u=function(e,t){return i.options.digits[Math.floor(e/t)%10]},c={desc:i.options.description,sep:i.options.timeSeparator,yl:l(b),yn:this._minDigits(i,i._periods[b],1),ynn:this._minDigits(i,i._periods[b],2),ynnn:this._minDigits(i,i._periods[b],3),y1:u(i._periods[b],1),y10:u(i._periods[b],10),y100:u(i._periods[b],100),y1000:u(i._periods[b],1e3),ol:l(y),on:this._minDigits(i,i._periods[y],1),onn:this._minDigits(i,i._periods[y],2),onnn:this._minDigits(i,i._periods[y],3),o1:u(i._periods[y],1),o10:u(i._periods[y],10),o100:u(i._periods[y],100),o1000:u(i._periods[y],1e3),wl:l(k),wn:this._minDigits(i,i._periods[k],1),wnn:this._minDigits(i,i._periods[k],2),wnnn:this._minDigits(i,i._periods[k],3),w1:u(i._periods[k],1),w10:u(i._periods[k],10),w100:u(i._periods[k],100),w1000:u(i._periods[k],1e3),dl:l(w),dn:this._minDigits(i,i._periods[w],1),dnn:this._minDigits(i,i._periods[w],2),dnnn:this._minDigits(i,i._periods[w],3),d1:u(i._periods[w],1),d10:u(i._periods[w],10),d100:u(i._periods[w],100),d1000:u(i._periods[w],1e3),hl:l(C),hn:this._minDigits(i,i._periods[C],1),hnn:this._minDigits(i,i._periods[C],2),hnnn:this._minDigits(i,i._periods[C],3),h1:u(i._periods[C],1),h10:u(i._periods[C],10),h100:u(i._periods[C],100),h1000:u(i._periods[C],1e3),ml:l(T),mn:this._minDigits(i,i._periods[T],1),mnn:this._minDigits(i,i._periods[T],2),mnnn:this._minDigits(i,i._periods[T],3),m1:u(i._periods[T],1),m10:u(i._periods[T],10),m100:u(i._periods[T],100),m1000:u(i._periods[T],1e3),sl:l($),sn:this._minDigits(i,i._periods[$],1),snn:this._minDigits(i,i._periods[$],2),snnn:this._minDigits(i,i._periods[$],3),s1:u(i._periods[$],1),s10:u(i._periods[$],10),s100:u(i._periods[$],100),s1000:u(i._periods[$],1e3)},p=t,d=b;d<=$;d++){var _="yowdhms".charAt(d),h=new RegExp("\\{"+_+"<\\}([\\s\\S]*)\\{"+_+">\\}","g");p=p.replace(h,!r&&e[d]||r&&o[d]?"$1":"")}return m.each(c,function(e,t){var i=new RegExp("\\{"+e+"\\}","g");p=p.replace(i,t)}),p},_minDigits:function(e,t,i){return(t=""+t).length>=i?this._translateDigits(e,t):(t="0000000000"+t,this._translateDigits(e,t.substr(t.length-i)))},_translateDigits:function(t,e){return(""+e).replace(/[0-9]/g,function(e){return t.options.digits[e]})},_determineShow:function(e){var t=e.options.format,i=[];return i[b]=t.match("y")?"?":t.match("Y")?"!":null,i[y]=t.match("o")?"?":t.match("O")?"!":null,i[k]=t.match("w")?"?":t.match("W")?"!":null,i[w]=t.match("d")?"?":t.match("D")?"!":null,i[C]=t.match("h")?"?":t.match("H")?"!":null,i[T]=t.match("m")?"?":t.match("M")?"!":null,i[$]=t.match("s")?"?":t.match("S")?"!":null,i},_calculatePeriods:function(e,i,t,n){e._now=n,e._now.setMilliseconds(0);var r=new Date(e._now.getTime());e._since?n.getTime()<e._since.getTime()?e._now=n=r:n=e._since:(r.setTime(e._until.getTime()),n.getTime()>e._until.getTime()&&(e._now=n=r));var o=[0,0,0,0,0,0,0];if(i[b]||i[y]){var s=F._getDaysInMonth(n.getFullYear(),n.getMonth()),a=F._getDaysInMonth(r.getFullYear(),r.getMonth()),l=r.getDate()==n.getDate()||r.getDate()>=Math.min(s,a)&&n.getDate()>=Math.min(s,a),u=function(e){return 60*(60*e.getHours()+e.getMinutes())+e.getSeconds()},c=Math.max(0,12*(r.getFullYear()-n.getFullYear())+r.getMonth()-n.getMonth()+(r.getDate()<n.getDate()&&!l||l&&u(r)<u(n)?-1:0));o[b]=i[b]?Math.floor(c/12):0,o[y]=i[y]?c-12*o[b]:0;var p=(n=new Date(n.getTime())).getDate()==s,d=F._getDaysInMonth(n.getFullYear()+o[b],n.getMonth()+o[y]);n.getDate()>d&&n.setDate(d),n.setFullYear(n.getFullYear()+o[b]),n.setMonth(n.getMonth()+o[y]),p&&n.setDate(d)}var _=Math.floor((r.getTime()-n.getTime())/1e3),h=function(e,t){o[e]=i[e]?Math.floor(_/t):0,_-=o[e]*t};if(h(k,604800),h(w,86400),h(C,3600),h(T,60),h($,1),0<_&&!e._since)for(var m=[1,12,4.3482,7,24,60,60],f=$,g=1,v=$;b<=v;v--)i[v]&&(o[f]>=g&&(o[f]=0,_=1),0<_&&(o[v]++,_=0,f=v,g=1)),g*=m[v];if(t)for(v=b;v<=$;v++)t&&o[v]?t--:t||(o[v]=0);return o}});var n=["getTimes"];m.fn.countdown=function(e){var t=Array.prototype.slice.call(arguments,1);return i(e,t)?F["_"+e+"Plugin"].apply(F,[this[0]].concat(t)):this.each(function(){if("string"==typeof e){if(!F["_"+e+"Plugin"])throw"Unknown command: "+e;F["_"+e+"Plugin"].apply(F,[this].concat(t))}else F._attachPlugin(this,e||{})})};var F=m.countdown=new e}(jQuery),function(b){var y=(b.browser.msie?"paste":"input")+".mask",k=window.orientation!=undefined;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},b.fn.extend({caret:function(t,i){if(0!=this.length){if("number"==typeof t)return i="number"==typeof i?i:t,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(t,i);else if(this.createTextRange){var e=this.createTextRange();e.collapse(!0),e.moveEnd("character",i),e.moveStart("character",t),e.select()}});if(this[0].setSelectionRange)t=this[0].selectionStart,i=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var e=document.selection.createRange();t=0-e.duplicate().moveStart("character",-1e5),i=t+e.text.length}return{begin:t,end:i}}},unmask:function(){return this.trigger("unmask")},mask:function(i,_){if(!i&&0<this.length){var e=b(this[0]),h=e.data("tests");return b.map(e.data("buffer"),function(e,t){return h[t]?e:null}).join("")}_=b.extend({placeholder:"_",completed:null},_);var m=b.mask.definitions,f=(h=[],i.length),g=null,v=i.length;return b.each(i.split(""),function(e,t){"?"==t?(v--,f=e):m[t]?(h.push(new RegExp(m[t])),null==g&&(g=h.length-1)):h.push(null)}),this.each(function(){function s(e){for(;++e<=v&&!h[e];);return e}function n(e){for(;!h[e]&&0<=--e;);for(var t=e;t<v;t++)if(h[t]){p[t]=_.placeholder;var i=s(t);if(!(i<v&&h[t].test(p[i])))break;p[t]=p[i]}u(),c.caret(Math.max(g,e))}function a(e){for(var t=e,i=_.placeholder;t<v;t++)if(h[t]){var n=s(t),r=p[t];if(p[t]=i,!(n<v&&h[n].test(r)))break;i=r}}function e(e){var t=b(this).caret(),i=e.keyCode;return d=i<16||16<i&&i<32||32<i&&i<41,t.begin-t.end==0||d&&8!=i&&46!=i||l(t.begin,t.end),8==i||46==i||k&&127==i?(n(t.begin+(46==i?0:-1)),!1):27==i?(c.val(o),c.caret(0,r()),!1):void 0}function t(e){if(d)return d=!1,8!=e.keyCode&&null;var t=(e=e||window.event).charCode||e.keyCode||e.which,i=b(this).caret();if(e.ctrlKey||e.altKey||e.metaKey)return!0;if(32<=t&&t<=125||186<t){var n=s(i.begin-1);if(n<v){var r=String.fromCharCode(t);if(h[n].test(r)){a(n),p[n]=r,u();var o=s(n);b(this).caret(o),_.completed&&o==v&&_.completed.call(c)}}}return!1}function l(e,t){for(var i=e;i<t&&i<v;i++)h[i]&&(p[i]=_.placeholder)}function u(){return c.val(p.join("")).val()}function r(e){for(var t=c.val(),i=-1,n=0,r=0;n<v;n++)if(h[n]){for(p[n]=_.placeholder;r++<t.length;){var o=t.charAt(r-1);if(h[n].test(o)){p[n]=o,i=n;break}}if(r>t.length)break}else p[n]==t[r]&&n!=f&&(r++,i=n);return!e&&i+1<f?(c.val(""),l(0,v)):(e||f<=i+1)&&(u(),e||c.val(c.val().substring(0,i+1))),f?n:g}var c=b(this),p=b.map(i.split(""),function(e){if("?"!=e)return m[e]?_.placeholder:e}),d=!1,o=c.val();c.data("buffer",p).data("tests",h),c.attr("readonly")||c.one("unmask",function(){c.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){o=c.val();var e=r();u(),setTimeout(function(){e==i.length?c.caret(0,e):c.caret(e)},0)}).bind("blur.mask",function(){r(),c.val()!=o&&c.change()}).bind("keydown.mask",e).bind("keypress.mask",t).bind(y,function(){setTimeout(function(){c.caret(r(!0))},0)}),r()})}})}(jQuery),pe.HelpModule=function(e,t,i){pe.init_widget(this,e),this.help_module_open=!1,this.help_id=t,this.container.append(this.html(i)),this.container.click(this.callback(this.help_button_clicked)),this.help_button_div=this.container.find(".HelpButton"),this.admin_link=this.container.find(".AdminLink"),this.admin_link&&this.admin_link.click(this.callback(this.admin_link_clicked))},pe.HelpModule.prototype.html=function(e){var t="";return 0===this.container.contents().length&&(t+='<div class="help_btn HelpButton"></div>'),e&&(t+='<div><a class="AdminLink admin_edit" target="_blank" href="/admin/pages/'+this.help_id+'/edit">Edit Tip</a></div>'),t},pe.HelpModule.prototype.admin_link_clicked=function(e){e.stopPropagation()},pe.HelpModule.prototype.help_button_clicked=function(e){this.help_module_open?e.stopPropagation():pe.ajax_loader.help_page.load({page_id:this.help_id},this.callback(function(e){var t=$(this.dialog_box_html(e));this.help_button_div.append(t),this.help_module_open=!0,new pe.CloseButton(t,this.callback(this.close_dialog,t))}))},pe.HelpModule.prototype.dialog_box_html=function(e){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <h1>{{title}}</h1>{{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',e)},pe.HelpModule.prototype.close_dialog=function(e,t){this.help_module_open=!1,e.remove(),t.stopPropagation()},function(){pe.validation.promo_code_validator=new pe.Validator({message:"Invalid code",callback:function(e){var t;return t=$.trim(e.val()),this.message="Invalid code",_.isEmpty(t)?!(this.message="Please enter a promo code"):25<t.length?!(this.message="Length is limited by 25 characters"):/^[\w-_@.]+$/.test(t)}})}.call(this),function(){var n=function(e,t){return function(){return e.apply(t,arguments)}};pe.TicketPromoApplier=function(){function e(e){var t,i;this.container=e,this.remove_promo=n(this.remove_promo,this),this.assign_promo=n(this.assign_promo,this),this.apply_promo=n(this.apply_promo,this),this.input=this.container.find(".Input"),this.input.val(this.container.data("value")),this.input.keypress((t=this,function(e){if(13===e.keyCode)return t.apply_promo()})),this.apply_button=this.container.find(".ApplyCodeButton"),this.apply_button.data("label",this.apply_button.html()),this.remove_button=this.container.find(".RemoveCodeButton"),this.remove_button.data("label",this.remove_button.html()),this.apply_button.click(this.apply_promo),this.remove_button.click(this.remove_promo),this.container.find(".Toggler").click((i=this,function(){return i.container.find(".Fields").show(),i.container.find(".Toggler").hide(),i.input.focus()})),this.error=this.container.find(".Error"),this.message=this.container.find(".Message"),this.container.data("valid")?this.assign_promo():this.initialize()}return e.prototype.promo_code_entered=function(){return!_.isEmpty(this.promo_code())},e.prototype.promo_code=function(){return this.input.val()},e.prototype.hide_error=function(){return this.error.html(""),this.error.hide()},e.prototype.show_error=function(e){return this.error.html("<span>"+e+"</span>"),this.error.show()},e.prototype.show_message=function(e){return this.message.html(e),this.message.show()},e.prototype.hide_message=function(){return this.message.hide()},e.prototype.initialize=function(){return this.promo_code_entered()?(this.container.find(".Toggler").hide(),this.container.find(".Fields").show()):(this.container.find(".Fields").hide(),this.container.find(".Toggler").show()),this.input.show(),this.apply_button.show()},e.prototype.reload_table=function(){var t,e;return(t=$(this.container.data("target"))).css("opacity",.5),e=t.data("url"),$.get(e,function(e){return t.replaceWith(e),$(".TotalAmount").html($(".Supermoney").html()),pe.load_order_form()})},e.prototype.apply_promo=function(){var e,t;return pe.validation.promo_code_validator.passed(this.input)?(this.error.hide(),this.apply_button.html("Please wait...").addClass("disabled"),(e={}).ticket_order={promo:this.promo_code()},pe.routes.Request.from_current_location("api_apply_ticket_order_promo_code",e).post((t=this,function(e){return t.apply_button.html(t.apply_button.data("label")),t.apply_button.removeClass("disabled"),1===e.status?t.show_error(e.message):(t.hide_message(),t.assign_promo(),t.reload_table())}))):this.show_error(pe.validation.promo_code_validator.message)},e.prototype.applied=function(){return this.container.data("applied")},e.prototype.assign_promo=function(){return this.container.data("applied",!0),this.container.find(".Fields").show(),this.container.find(".Toggler").hide(),this.input.hide(),this.apply_button.hide(),this.hide_error(),this.show_message("Promo Applied: "+this.promo_code()),this.remove_button.show()},e.prototype.remove_promo=function(){return this.container.data("applied",!1),this.remove_button.addClass("disabled").html("Please wait..."),pe.routes.Request.from_current_location("api_remove_ticket_order_promo_code").post((t=this,function(e){return t.remove_button.html(t.remove_button.data("label")),t.remove_button.removeClass("disabled"),1===e.status?t.show_error(e.message):(t.hide_error(),t.reload_table(),t.container.find(".Fields").show(),t.hide_error(),t.hide_message(),t.remove_button.hide(),t.input.val(""),t.input.show(),t.apply_button.show())}));var t},e}(),pe.on_expire=function(){return window.onbeforeunload=null,$(".Timer").html("0:00"),alert("The time limit has been exceeded and your tickets have been released. \n\nThe purpose of the time limit is to give all fans a fair shot at tickets and ensure tickets are available to as many people as possible. We are sorry for the inconvenience."),$("body").css("cursor","wait"),pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){return window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())})},pe.on_tick=function(){return $(".Timer").html($(".Timer").html().replace(/0(\d+):/,"$1:"))},window.onbeforeunload=function(){return"You have not completed the purchase process."},pe.check_order_status=function(){return pe.routes.Request.factory("api_ticket_order_status",{id:pe.order_id}).get(function(e){if("pending"!==e.status)return window.onbeforeunload=null,alert("You already ordered this tickets"),window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())})},$(function(){return pe.init_page_framework(function(){return setTimeout(function(){return pe.check_order_status()},5),pe.routes.Request.factory("api_ticket_orders_countdown_seconds").get(function(e){var t;return t=new Date,t=new Date(t.getTime()+1e3*e.data.seconds),$(".Timer").countdown({until:t,compact:!0,format:"MS",description:"",onExpiry:pe.on_expire,onTick:pe.on_tick})}),$(".EditOrderLink").click(function(e){return window.onbeforeunload=null,confirm("Your tickets will be released for others to purchase if you leave this page.\n\nDo you wish to forfeit your tickets?")?($(this).html("Please wait..."),$("body").css("cursor","wait"),pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){var e;return e=pe.routes.build_path("tickets",pe.routes.current_url_params()),pe.promo&&pe.promo.applied()&&(e=e+"?promo="+pe.promo.promo_code()),window.location=e})):(e.preventDefault(),e.stopPropagation())}),pe.load_order_form(),setTimeout(function(){return pe.promo=new pe.TicketPromoApplier($(".PromoCode"))},5),pe.right_rail_floater=new pe.Floater($(".FloaterContainer"),$(".FloaterLimiter")),pe.ask_party_earth=new pe.AskPartyEarth($(".AskPartyEarth")),pe.ask_party_earth.click(function(){return pe.right_rail_floater.start_floating(),pe.right_rail_floater.scrolling()})})}),pe.init_has_email_delivery=function(){return $(".HasEmailDelivery").change(function(){return"true"===$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")})},pe.load_order_form=function(){var e;if(e=pe.free_form,pe.free_form=pe.page_container.find(".ReloadArea").data("free"),pe.order_tickets_form&&(pe.form_data=pe.order_tickets_form.collect_card_data()),e!==pe.free_form)return pe.free_form?pe.load_free_order_form():0<pe.page_container.find(".FormContainer").length?pe.load_purchase_form():pe.initialize_paypal_form()},pe.load_free_order_form=function(){return pe.routes.Request.from_current_location("tickets_purchase_form").get(function(e){if(pe.page_container.find(".FormContainer").html(e),pe.init_free_order_form(),pe.form_data&&pe.form)return pe.order_tickets_form.apply_values(pe.form_data),pe.form.validate()})},pe.load_purchase_form=function(){return pe.routes.Request.from_current_location("tickets_purchase_form").get(function(e){if(pe.page_container.find(".FormContainer").html(e),pe.init_full_purchase_form(),pe.form_data&&pe.form)return pe.order_tickets_form.apply_values(pe.form_data),pe.form.validate(),$(".Phone").mask("(999) 999-9999")})},pe.init_free_order_form=function(){var e,t,i,n;if($("#OrderTicketsPaypalForm").hide(),t=$("#OrderTicketsForm"),$(".AdditionalInfo").appendTo($("#OrderTicketsForm .AdditionalInfoContainer")),0<t.length)return pe.order_tickets_form=new pe.StripeForm(t,"api_close_ticket_order",!1,function(){return window.onbeforeunload=null,window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),i={"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Email":pe.validation.email_format_validator,"#ConfirmEmail":pe.validation.email_confirmation_validator},e={"#FirstName":"blur","#LastName":"blur","#Email":"blur","#ConfirmEmail":"blur"},$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")}),$("#Phone").mask("(999) 999-9999"),$(".Phone").mask("(999) 999-9999"),pe.form=new pe.ValidatableForm(t,i,e),(n=t.find(".SubmitButton")).unbind("click"),n.click(function(e){return e.preventDefault(),e.stopPropagation(),pe.form.on_submit()&&pe.order_tickets_form.charge(),!1}),pe.init_has_email_delivery()},pe.initialize_paypal_form=function(){var e,t,i;if($("#OrderTicketsForm").hide(),$("#OrderTicketsPaypalForm").show(),$(".AdditionalInfo").appendTo($("#OrderTicketsPaypalForm .AdditionalInfoContainer")),0<(t=$("#OrderTicketsPaypalForm")).length)return pe.init_has_email_delivery(),0<t.find("#PayPalFirstName").length?(i={"#PayPalFirstName":pe.validation.name_validator,"#PayPalLastName":pe.validation.name_validator},e={"#PayPalFirstName":"blur","#PayPalLastName":"blur"}):(i={},e={}),i=_.extend(i,{"#PayPalEmail":pe.validation.email_format_validator,"#PayPalConfirmEmail":pe.validation.email_confirmation_validator}),e=_.extend(e,{"#PayPalEmail":"blur","#PayPalConfirmEmail":"blur"}),pe.paypal_form=new pe.ValidatableForm(t,i,e,function(){return window.onbeforeunload=null,t.submit()})},pe.init_full_purchase_form=function(){var e,t,i,n,r,o,s;if(0<(i=$("#OrderTicketsForm")).length&&($(".CCType").change(function(){return _.isEmpty($(".CCType").val())?$(".CCContainer").hide():$(".CCContainer").show(),"PayPal"===$(this).val()?pe.initialize_paypal_form():($("#OrderTicketsForm").show(),$("#OrderTicketsPaypalForm").hide(),$(".AdditionalInfo").appendTo($("#OrderTicketsForm .AdditionalInfoContainer"))),$(".CCType").val($(this).val())}),$(".CCType").change(),$(".CCType").change(function(){return $(this).find('option[value=""]').remove()}),pe.order_tickets_form=new pe.StripeForm(i,"api_close_ticket_order",!0,function(){return window.onbeforeunload=null,window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),n=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||_.isEmpty($("#ExpYear").val())}}),s=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||_.isEmpty($("#ExpYear").val())}}),r={"#payment_type":new pe.Validator({message:"Please select payment type matching card info",callback:function(){return Stripe.card.cardType($("#CardNumber").val())===$("#payment_type").val()},unless:function(){return!pe.validation.cc_number_validator.passed($("#CardNumber"))}}),"#CardNumber":pe.validation.cc_number_validator,"#ExpMonth":n,"#ExpYear":s,"#Cvc":pe.validation.cvc_validator,"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Address1":pe.validation.not_blank_validator,"#City":pe.validation.not_blank_validator,"#state":pe.validation.not_blank_validator,"#Zip":pe.validation.zip_code_validator,"#Email":pe.validation.email_format_validator,"#ConfirmEmail":pe.validation.email_confirmation_validator},e={"#payment_type":"change","#CardNumber":"blur","#ExpMonth":"change","#ExpYear":"change","#Cvc":"blur","#FirstName":"blur","#LastName":"blur","#Address1":"blur","#City":"blur","#state":"change","#Zip":"blur","#Email":"blur","#ConfirmEmail":"blur"},$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")}),$("#Phone").mask("(999) 999-9999"),$(".Phone").mask("(999) 999-9999"),pe.form=new pe.ValidatableForm(i,r,e),(o=i.find(".SubmitButton")).unbind("click"),o.click(function(e){return e.preventDefault(),e.stopPropagation(),pe.form.on_submit()&&pe.order_tickets_form.charge(),!1}),$(".CCTypeButton").click(function(){return $(".CCTypeButton").removeClass("selected").addClass("disabled"),$(this).addClass("selected"),$(".CCType").val($(this).data("value")),$(".CCType").change(),pe.form.validate_field("#payment_type")}),$(".BillingInput[name=has_email_delivery]").change(function(){return"true"===$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")}),0<(t=$(".CodeTipContent")).length))return $(".CodeTipLink").click(function(){return t.toggle()}),$(".CodeTipClose").click(function(){return t.hide()})}}.call(this);