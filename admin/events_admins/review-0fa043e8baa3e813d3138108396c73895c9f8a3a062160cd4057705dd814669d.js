pe.EventHelperTools={},pe.EventHelperTools.autocomplete_closed=function(){pe.EventHelperTools.autocomplete_open=!1},pe.EventHelperTools.autocomplete_opened=function(){pe.EventHelperTools.autocomplete_open=!0},pe.EventHelperTools.remove_comma_at_the_end=function(e){return e?e.replace(new RegExp(",$"),""):""},pe.EventHelperTools.show_message=function(e,t){e.removeClass("wrong correct new").parent().find(".errors").remove().find(".message").remove(),t?e.addClass("wrong").after('<span class="errors">'+t+"</span>"):e.addClass("correct")},pe.EventHelperTools.validate_url=function(e){return!e||/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/i.test(e)},pe.AutoSuggestModule=function(e,t,i){pe.init_widget(this,e),i.preFill=i.preFill||{},i.minChars=i.minChars||3,i.selectedValuesProp=i.selectedValuesProp||"value",this.options=i,this.input_field=this.container.find(".AutoSuggestInput"),this.input_field.autoSuggest(t,this.options),this.selected_entries_container=this.container.find(".as-selections"),this.selected_data_ids_field=this.container.find(".as-values")},pe.AutoSuggestModule.prototype.add_entries=function(e){e&&0!==e.length&&$.each(e,this.callback(function(e,t){this.add_entry(t)}))},pe.AutoSuggestModule.prototype.add_entry=function(e){$.inArray(e[this.options.selectedValuesProp].toString(),this.val().split(","))<0&&window.AutoSuggest_hacks[this.input_field[0].id](e,Math.floor(1001*Math.random()).toString())},pe.AutoSuggestModule.prototype.last_li=function(){return this.selected_entries_container.find(".as-selection-item:last")},pe.AutoSuggestModule.prototype.last_value=function(){return _.last(this.val().split(","))},pe.AutoSuggestModule.prototype.remove_last_entry=function(){this.last_li().find(".as-close").click()},pe.AutoSuggestModule.prototype.replace_last_entry=function(e){this.remove_last_entry(),this.add_entry(e)},pe.AutoSuggestModule.prototype.set_val=function(e){e&&this.selected_data_ids_field.val(e+",")},pe.AutoSuggestModule.prototype.val=function(){return pe.EventHelperTools.remove_comma_at_the_end(this.selected_data_ids_field.val().toString())},pe.CityAutocomplete=function(e,t){pe.init_widget(this,e),this.city_input_field=this.container.find(".CityAutocompleteInput"),this.city_input_field.blur(this.callback(this.city_input_field_blurred)),this.city_ids=$.map(t,function(e){return e.value.toString()}),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{startText:"",emptyText:"No city found",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",neverSubmit:!0,selectionLimit:1,preFill:this.city_input_field.data("event-data"),selectionAdded:this.callback(this.search_result_selection_added)}),this.last_valid_input=this.val()},pe.CityAutocomplete.events={CHANGED:"CityAutocomplete_CHANGED"},pe.CityAutocomplete.prototype.add_cities=function(e){this.autosuggest_module.add_entries(e),this.last_valid_input=this.val()},pe.CityAutocomplete.prototype.as_enum=function(){return{city_ids:this.val().split(",")}},pe.CityAutocomplete.prototype.city_input_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.CityAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")},pe.CityAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.city_input_field,e)},pe.CityAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&(pe.array_contains(this.city_ids,this.autosuggest_module.last_value())||(this.autosuggest_module.remove_last_entry(),this.display_message("Please select cities from the list.")))},pe.CityAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.CityAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.ContentTagsAutocomplete=function(e,t){pe.init_widget(this,e),this.content_tags_input_field=this.container.find(".ContentTagsAutocompleteInput"),this.content_tags_input_field.blur(this.callback(this.content_tags_input_field_blurred)),this.content_tag_ids=$.map(t,function(e){return e.value.toString()}),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",startText:"",minChars:2,neverSubmit:!0,preFill:this.content_tags_input_field.data("event-data"),selectionAdded:this.callback(this.search_result_selection_added)}),this.last_valid_input=this.val()},pe.ContentTagsAutocomplete.events={CHANGED:"ContentTagsAutocomplete_CHANGED"},pe.ContentTagsAutocomplete.prototype.add_content_tags=function(e){this.autosuggest_module.add_entries(e),this.last_valid_input=this.val()},pe.ContentTagsAutocomplete.prototype.as_enum=function(){return{ordered_content_tag_ids:this.val().split(",")}},pe.ContentTagsAutocomplete.prototype.content_tags_input_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.ContentTagsAutocomplete.events.CHANGED,this.as_enum())),pe.EventHelperTools.show_message(this.content_tags_input_field,"")},pe.ContentTagsAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&(pe.array_contains(this.content_tag_ids,this.autosuggest_module.last_value())||(this.autosuggest_module.remove_last_entry(),pe.EventHelperTools.show_message(this.content_tags_input_field,"Please select tags from the list.")))},pe.ContentTagsAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.ContentTagsAutocomplete.prototype.value_changed=function(){return this.val()!==this.last_valid_input},pe.EndpointAutocomplete=function(e,t){pe.init_widget(this,e),this.endpoint_input_field=this.container.find(".EndpointAutocompleteInput"),this.endpoint_input_field.blur(this.callback(this.endpoint_input_field_blurred)),this.endpoint_ids=$.map(t,function(e){return e.value.toString()}),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{startText:"",emptyText:"No endpoint found",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",neverSubmit:!0,selectionLimit:1,preFill:this.endpoint_input_field.data("event-data"),selectionAdded:this.callback(this.search_result_selection_added),selectionRemoved:this.callback(this.selection_removed)}),this.last_valid_input=this.val()},pe.EndpointAutocomplete.events={CHANGED:"EndpointAutocomplete_CHANGED",REMOVED:"EndpointAutocomplete_REMOVED"},pe.EndpointAutocomplete.prototype.add_endpoint=function(e){e&&(this.val()?this.autosuggest_module.replace_last_entry(e[0]):this.autosuggest_module.add_entries(e),this.last_valid_input=this.val())},pe.EndpointAutocomplete.prototype.as_enum=function(){return{ordered_endpoint_ids:this.val().split(",")}},pe.EndpointAutocomplete.prototype.endpoint_input_field_blurred=function(){this.val()?(this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.EndpointAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")):this.display_message("Endpoint is required")},pe.EndpointAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.endpoint_input_field,e)},pe.EndpointAutocomplete.prototype.restore_value=function(){this.autosuggest_module.set_val(this.last_valid_input)},pe.EndpointAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&(pe.array_contains(this.endpoint_ids,this.autosuggest_module.last_value())||(this.autosuggest_module.remove_last_entry(),this.display_message("Please select endpoints from the list.")))},pe.EndpointAutocomplete.prototype.selection_removed=function(e){this.fire_event(pe.EndpointAutocomplete.events.REMOVED,e)},pe.EndpointAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.EndpointAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.EventDatesTextModule=function(e){pe.init_widget(this,e),this.dates_input_field=this.container.find(".EventDatesTextInput"),this.dates_input_field.blur(this.callback(this.dates_input_field_blurred)),this.last_valid_input=this.val()},pe.EventDatesTextModule.events={CHANGED:"EventDatesTextModule_CHANGED"},pe.EventDatesTextModule.prototype.as_enum=function(){return{event_dates_text:this.val()}},pe.EventDatesTextModule.prototype.dates_input_field_blurred=function(){this.is_valid(this.callback(function(e,t){e?(this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.EventDatesTextModule.events.CHANGED,this.as_enum())),this.display_message("")):this.display_message(t)}))},pe.EventDatesTextModule.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.dates_input_field,e)},pe.EventDatesTextModule.prototype.is_valid=function(t){this.value_changed()||t(!0,""),$.ajax({url:"/api/events/check_dates",data:{dates:this.val()},error:pe.ajax_error,success:function(e){"error"==e.message?t(!1,"Please enter valid event dates"):t(!0,"")}})},pe.EventDatesTextModule.prototype.val=function(){return this.dates_input_field.val().toString()},pe.EventDatesTextModule.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.EventTypesAutocomplete=function(e,t){pe.init_widget(this,e),this.event_types_input_field=this.container.find(".EventTypesAutocompleteInput"),this.event_types_input_field.blur(this.callback(this.event_types_input_field_blurred)),this.event_type_ids=$.map(t,function(e){return e.value.toString()}),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",startText:"",minChars:2,neverSubmit:!0,preFill:this.event_types_input_field.data("event-data"),selectionAdded:this.callback(this.search_result_selection_added)}),this.last_valid_input=this.val()},pe.EventTypesAutocomplete.events={CHANGED:"EventTypesAutocomplete_CHANGED"},pe.EventTypesAutocomplete.prototype.as_enum=function(){return{ordered_type_ids:this.val().split(",")}},pe.EventTypesAutocomplete.prototype.add_event_types=function(e){this.autosuggest_module.add_entries(e),this.last_valid_input=this.val()},pe.EventTypesAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.event_types_input_field,e)},pe.EventTypesAutocomplete.prototype.event_types_input_field_blurred=function(){this.val()?(this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.EventTypesAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")):this.display_message("Event Types are required")},pe.EventTypesAutocomplete.prototype.is_valid=function(){return!!this.val()},pe.EventTypesAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&(pe.array_contains(this.event_type_ids,this.autosuggest_module.last_value())||(this.autosuggest_module.remove_last_entry(),this.display_message("Please select types from the list.")))},pe.EventTypesAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.EventTypesAutocomplete.prototype.value_changed=function(){return this.val()!==this.last_valid_input},pe.EventWebsiteModule=function(e){pe.init_widget(this,e),this.website_input_field=this.container.find(".EventWebsite"),this.website_input_field.blur(this.callback(this.website_input_field_blurred)),this.last_valid_input=this.val()},pe.EventWebsiteModule.events={CHANGED:"EventWebsiteModule_CHANGED"},pe.EventWebsiteModule.prototype.as_enum=function(){return{url:this.val()}},pe.EventWebsiteModule.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.website_input_field,e)},pe.EventWebsiteModule.prototype.is_valid=function(){return!this.val()||pe.EventHelperTools.validate_url(this.val())},pe.EventWebsiteModule.prototype.set_value=function(e){this.website_input_field.val(e),this.last_valid_input=e},pe.EventWebsiteModule.prototype.val=function(){return this.website_input_field.val().toString()},pe.EventWebsiteModule.prototype.website_input_field_blurred=function(){this.is_valid()?(this.val()!==this.last_valid_input&&(this.last_valid_input=this.val(),this.fire_event(pe.EventWebsiteModule.events.CHANGED,this.as_enum())),pe.EventHelperTools.show_message(this.website_input_field,"")):pe.EventHelperTools.show_message(this.website_input_field,"Please enter a valid url.")},function(){var n=function(e,t){return function(){return e.apply(t,arguments)}};pe.HolidayAutocomplete=function(){function e(e,t,i){this.container=e,this.data_source_url=t,this.field_name=i,this.value_changed=n(this.value_changed,this),this.val=n(this.val,this),this.search_result_selection_added=n(this.search_result_selection_added,this),this.autocomplete_field_blurred=n(this.autocomplete_field_blurred,this),this.display_message=n(this.display_message,this),this.as_enum=n(this.as_enum,this),pe.init_widget(this,this.container),this.autocomplete_field=this.container.find(".HolidaysAutocompleteInput"),this.autocomplete_field.blur(this.autocomplete_field_blurred),this.autosuggest_module=new pe.AutoSuggestModule(this.container,this.data_source_url,{startText:"",emptyText:"No Holiday found",selectedItemProp:"search",selectedValuesProp:"id",searchObjProps:"search",queryParam:"term",neverSubmit:!0,preFill:this.autocomplete_field.data("event-data"),resultClick:this.search_result_clicked,selectionAdded:this.search_result_selection_added}),this.last_valid_input=this.val()}return e.events={CHANGED:"HolidayAutocomplete_CHANGED",SELECTED:"HolidayAutocomplete_SELECTED"},e.prototype.as_enum=function(){var e;return(e={})[this.field_name]=this.val().split(","),e},e.prototype.display_message=function(e){return pe.EventHelperTools.show_message(this.autocomplete_field,e)},e.prototype.autocomplete_field_blurred=function(){return this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.HolidayAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")},e.prototype.search_result_selection_added=function(){return!this.autosuggest_module||(this.autocomplete_field.val()===this.autosuggest_module.last_value()?(this.autosuggest_module.remove_last_entry(),this.display_message("Please select holidays from the list.")):void 0)},e.prototype.val=function(){return this.autosuggest_module.val()},e.prototype.value_changed=function(){return this.last_valid_input!==this.val()},e}()}.call(this),pe.ParentEventAutocomplete=function(e,t){pe.init_widget(this,e),this.parent_input_field=this.container.find(".ParentEventAutocompleteInput"),this.parent_input_field.blur(this.callback(this.parent_input_field_blurred)),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{startText:"",emptyText:"No parent event found",queryParam:"term",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",neverSubmit:!0,selectionLimit:1,preFill:this.parent_input_field.data("event-data"),selectionAdded:this.callback(this.search_result_selection_added)}),this.last_valid_input=this.val()},pe.ParentEventAutocomplete.events={CHANGED:"ParentEventAutocomplete_CHANGED",SELECTED:"ParentEventAutocomplete_SELECTED"},pe.ParentEventAutocomplete.prototype.as_enum=function(){return{parent_id:this.val()}},pe.ParentEventAutocomplete.prototype.add_parent_event=function(e){this.autosuggest_module.add_entry(e)},pe.ParentEventAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.parent_input_field,e)},pe.ParentEventAutocomplete.prototype.parent_input_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.ParentEventAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")},pe.ParentEventAutocomplete.prototype.search_result_selection_added=function(){if(this.autosuggest_module)return this.parent_input_field.val()===this.autosuggest_module.last_value()?(this.autosuggest_module.remove_last_entry(),void this.display_message("Cannot create parent event. Please select from list")):void $.ajax({url:"/api/events/parent_event_data",data:{parent_id:this.val()},error:pe.ajax_error,success:this.callback(function(e){e.error?(this.autosuggest_module.remove_last_entry(),this.display_message(e.error)):this.fire_event(pe.ParentEventAutocomplete.events.SELECTED,e)})})},pe.ParentEventAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.ParentEventAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.accentMap={"&":"and","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xe7":"c","\xc0":"a","\xc1":"a","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xc8":"e","\xc9":"e","\xec":"i","\xf1":"n","\xed":"i","\xee":"i","\xef":"i","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","!":"i",$:"s","-":""," ":"","'":"","\u2019":"",".":""},pe.ajax_error=function(){alert("The request failed. Please try again later.")},pe.ajax_send=function(e,t){var i=$("meta[name='csrf-token']").attr("content");t.setRequestHeader("X-CSRF-Token",i)},pe.alert=function(e){alert(e)},pe.animated_scrolling=function(e,t){if(0!==e.length){var i=e.offset().top-(t||25);$("html,body").stop().animate({scrollTop:i+"px"},800,"cubicEaseInOut",function(){return!1})}},pe.scrolling=function(e,t){if(0!==e.length){var i=e.offset().top-(t||25);$("html,body").scrollTop(i)}},pe.days_of_week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],pe.array_contains=function(e,t){return _.isArray(t)?0===_.difference(t,e).length:-1<_.indexOf(e,t)},pe.arrays_equal=function(e,t){if(!e&&!t)return!0;if(!e&&0===t.length||0===e.length&&!t)return!0;if(e.length!=t.length)return!1;for(var i=e.sort(),n=t.sort(),s=0,o=e.length;s<o;s++)if(i[s]!==n[s])return!1;return!0},pe.array_match=function(e,i){var n=!1;return $.each(e,function(e,t){if(-1<i.indexOf(t))return!(n=!0)}),n},pe.array_merge=function(e,t){var i=e.concat(t);return i.sort(),i},pe.array_remove=function(e,t){return e?pe.is_array(t)?$.grep(e,function(e){return-1===t.indexOf(e)}):$.grep(e,function(e){return e!==t}):e},pe.assign_photo_size=function(e,t,i){return e?"original"===t?e.replace("xxx.jpg",t+".jpg"):e.replace("xxx.jpg","s"+t+".jpg"):"/assets/no_image_"+i+".png"},pe.remove_timestamp_from_asset_url=function(e){return e.split("?")[0]},pe.browser_is_ie8=function(){return $.browser.msie&&"8.0"===$.browser.version},pe.build_dob_field_name=function(e,t,i){return t?t+="_":t="",[e=e||"user","[",t,"dob(",i,"i)]"].join("")},pe.capitalise_first_letter=function(e){return null===e?"":e.charAt(0).toUpperCase()+e.slice(1)},pe.classes_starting_with=function(e,t){return $.map(e.attr("class").split(/\s+/),function(e){if(pe.string_starts_with(e,t))return e})},pe.compare=function(e,t){return pe.is_array(e)&&pe.is_array(t)?pe.arrays_equal(e,t):e===t},pe.convert_to_rounded_corners=function(e){var t=e||$(".ConvertToRoundedCorners");return t.each(function(e,t){var i=$(t);i.removeClass("ConvertToRoundedCorners"),i.addClass("rounded_corner_wrapper"),$('<div class="rounded_corner top_left"></div>').appendTo(i),$('<div class="rounded_corner top_right"></div>').appendTo(i),$('<div class="rounded_corner bottom_left"></div>').appendTo(i),$('<div class="rounded_corner bottom_right"></div>').appendTo(i)}),t},pe.convert_to_tabbed_pod=function(e,u){return $.map(e,function(e){var t=$(e);if(!t.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+t[0].className);var i=t.children("ul");i.addClass("tab"),i.children("li").each(function(e,t){var i=(t=$(t)).html();t.html(pe.templatize('<div class="left_end pod_sprite float_left"></div>{{content}}<div class="right_end pod_sprite float_left"></div>',{content:i}))});var n=i.html();i.remove();var s=t.html(),o=pe.classes_starting_with(t,"width");if(0===o.length)return alert("no width class found");if(1<o.length)return alert("more than 1 width class found");var a=o[0].substr(5);t.addClass("tabs"),t.removeClass("ConvertToTabs"),t.removeClass(o[0]),t.html(pe.templatize('<div><table class="width{{width}}" cellpadding="0" cellspacing="0"><tbody><tr><td class="header" colspan="4"><div class="header_row"><ul class="tab">{{headers}}</ul><div class="mid_section"></div><div class="right_corner pod_sprite"></div></div></td></tr><tr class="content_container"><td class="left_side pod_sides"></td><td class="content">{{content}}</td><td class="right_side pod_sides"></td></tr><tr class="footer_row"><td class="left_corner pod_sprite"></td><td class="mid_section"></td><td class="right_corner pod_sprite"></td></tr></tbody></table></div>',{width:a,headers:n,content:s}));var r=t.children().tabs(u),l=["first","second","third","fourth"];return t.find("ul.tab li").each(function(e,t){$(t).addClass(l[e])}),r})},pe.new_convert_to_tabbed_pod=function(e,u){return $.map(e,function(e){var t=$(e);if(!t.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+t[0].className);var i=t.children("ul"),n=i.html();i.remove();var s=t.html(),o=pe.classes_starting_with(t,"width");if(0===o.length)return alert("no width class found");if(1<o.length)return alert("more than 1 width class found");var a=o[0].substr(5);t.addClass("tabs"),t.removeClass("ConvertToTabs"),t.removeClass(o[0]),t.html(pe.templatize('<div class="width{{width}}"><ul class="tab">{{headers}}</ul>{{content}}</div>',{width:a,headers:n,content:s}));var r=t.children().tabs(u),l=["first","second","third","fourth"];return t.find("ul.tab li").each(function(e,t){$(t).addClass(l[e])}),r})},pe.date_string=function(e){return"string"==typeof e?e:e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()},pe.days_between_dates=function(e,t){var i="string"==typeof e?Date.parse(e):e,n="string"==typeof t?Date.parse(t):t;return Math.abs(Math.floor((i-n)/864e5))},pe.empty=function(){},pe.event_search_text=function(e){var i=[e.name,e.description,e.location_name,e.category,e.neighborhood_name,e.neighborhood_id];return e.tags&&$.each(e.tags,function(e,t){i.push(t)}),e.performer_names&&$.each(e.performer_names,function(e,t){i.push(t)}),i.join(" ")},pe.fetch_photo_id_from_url=function(e){return e.split("/photos/")[1]},pe.fix_ie7_rendering_bug=function(){$(".ConvertToTabbedPod").addClass("IeSucks")},pe.format_date=function(e){return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()},pe.format_price=function(e){var t=Math.floor(e/100).toString(),i=(e%100).toString();return i.length<2&&(i="0"+i),"$"+t+"."+i},pe.format_duration=function(e,t){if(!e)return"0:00";var i=Math.floor(e/60),n=Math.floor(e%60);return pe.string_padding_left(i.toString(),t||1,"0")+":"+pe.string_padding_left(n.toString(),2,"0")},pe.get_city_id=function(){return window.city_id},pe.get_url_parameter=function(e,t){var i=new RegExp("[\\?&]"+t+"=([^&]+)","i").exec(e);return i?i[1]:null},pe.hash_length=function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&t++;return t},pe.hashes_equal=function(e,t){if(e===t)return!0;if(pe.hash_length(e)!=pe.hash_length(t))return!1;for(var i in e){var n=e[i],s=t[i];if(pe.is_array(n)){if(!pe.arrays_equal(n,s))return!1}else if(n!==s)return!1}return!0},pe.hashes_match=function(e,t){for(var i in e){var n=e[i],s=t[i];if(pe.is_array(n)){if(!pe.array_contains(s,n))return!1}else if(n!==s)return!1}return!0},pe.https=function(e){return-1===window.location.href.indexOf("https://")?e:e.replace("http://","https://")},pe.inject=function(e,t,i){var n=t;return $.each(e,function(e,t){n=i(n,t)}),n},pe.init_widget=function(e,t){"string"!=typeof t&&(null===t||t.length?(e.container=t,e.callback=function(e){for(var t=[e,this],i=1;i<arguments.length;i++)t.push(arguments[i]);return pe.bind_this.apply(this,t)},e.check_bind=function(e){if("undefined"==typeof this.container)throw" in: "+e},e.bind_event=function(e,t){pe.assert(e,"bind_event: parameter 'event_type' is empty"),this.container.bind(e,t)},e.fire_event=function(e,t){void 0===e&&alert("Must provide the event type to fire."),void 0===t&&(t={}),this.container.trigger(e,t)},e.show=function(){this.container.show()},e.hide=function(){this.container.hide()},e.toggle=function(e){this.container.toggle(e)},e.is_visible=function(){return this.container.is(":visible")}):alert("No container given."))},pe.install_easing=function(){jQuery.easing.cubicEaseInOut||(jQuery.easing.cubicEaseInOut=function(e,t,i,n){var s=i+n;return(e/=.5)<1?s/2*e*e*e+i:s/2*((e-=2)*e*e+2)+i})},pe.is_array=function(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.splice||e.propertyIsEnumerable("length"))},pe.is_valid_credit_card_number=function(e){return!!e.match(/^\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}$/)},pe.is_valid_date=function(e){var t=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/;return!!e.match(t)&&(e===$.datepicker.formatDate("m/d/yy",new Date(e))||e===$.datepicker.formatDate("mm/dd/yy",new Date(e)))},pe.is_valid_zip_code=function(e){return!!e.match(/^\d{5}(\s*\-\s*\d{4})?$/)},pe.load=function(e){return pe.assert(e,"error loading data"),e},pe.link_title_for_city=function(e){return"See the latest hotspots and events happening in "+e+"."},pe.link_title_for_city_party_climate=function(e){return"Check out the overview and photos of "+e+"."},pe.link_title_for_event=function(e,t){return t?"Check out event details, photos and videos of "+e+" at "+t+".":"Check out event details, photos and videos of "+e+"."},pe.link_title_for_neighborhood=function(e,t){return"Check out "+e+" description, photos, and venues in "+t+"."},pe.link_title_for_performer=function(e){return"See the latest "+e+" schedule, photos, videos and news."},pe.link_title_for_reviewer=function(e){switch(e){case"Lucas":return"Meet Lucas, the quintessential fun- loving, pub-crawling \u201cguy\u2019s guy\u201d. Learn about his personality and ratings.";case"Adriana":return"Meet Adriana, the epitome of a cosmopolitan girl. Learn about her personality and ratings.";case"Jonah":return"Meet Jonah, an affable, non-mainstream guy with natural curiosity about people and cultures. Learn about his personality and ratings.";case"Emma":return"Meet Emma, a lively, witty, and sociable \u201cgirl next door\u201d. Learn about her personality and ratings.";case"All":return"Meet Lucas, Adriana, Jonah and Emma. Learn how their personalities can help you maximize your social experiences in your city and your travels."}},pe.link_title_for_venue=function(e,t,i){return i?"Check out the review, photos, videos, map and events schedule of "+e+" - "+i+" in "+t+".":"Check out the review, photos, videos, map and events schedule of "+e+" in "+t+"."},pe.normalize=function(e){for(var t="",i=0,n=e.length;i<n;i++){var s=e.charAt(i),o=pe.accentMap[s];t+=void 0===o?s:o}return t},pe.object_hash_from_array=function(e){var i={};return $.each(e,function(e,t){i[t.id]=t}),i},pe.object_length=function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},pe.parse_price=function(e){return Math.ceil(100*parseFloat(e.substring(1)))},pe.prepare_autocomplete_data=function(e){var n=[];return $.each(e,function(i,e){$.each(e,function(e,t){t.category=i,n.push(t)})}),n},pe.remove_anchor_from_url=function(e){return e?e.split("#")[0]:""},pe.remove_query_string_from_url=function(e){return e?e.split("?")[0]:""},pe.set_autocomplete_source=function(e,t,i){var n=pe.normalize(t.term).toLowerCase(),s=new RegExp($.ui.autocomplete.escapeRegex(n),"i"),o=$.grep(pe.prepare_autocomplete_data(e),function(e){return e=e.label||e.value||e,s.test(e)||s.test(pe.normalize(e))});i(o=_.sortBy(o,function(e){var t=e.label||e.value||e;return t=pe.normalize(t).toLowerCase(),[e.category,t!=n,e.label]}))},pe.shuffle_array=function(e){if(!e)return[];for(var t,i,n=e.length;n;)t=parseInt(Math.random()*n,10),i=e[--n],e[n]=e[t],e[t]=i;return e},pe.string_padding_left=function(e,t,i){for(var n=e;n.length<t;)n=i+n;return n},pe.string_starts_with=function(e,t){return e.substr(0,t.length)===t},pe.string_ends_with=function(e,t){return e.substr(e.length-t.length)===t},pe.structured_tags_as_flat_array=function(e){var i=[];return $.each(e,function(e,t){$.merge(i,t)}),i},pe.text_contains_query=function(i,e){var t=e.split(" "),n=!0;return $.each(t,function(e,t){if(-1===i.indexOf(t))return!(n=!1)}),n},pe.today_date_string=function(){var e=new Date;return pe.date_string(e)},pe.truncate_by_words=function(e,t,i){if(!e||!t)return alert("Sorry, but an error happened. We are already warned about that.");if(i=i||"...",e.length<t)return e;var n=e.slice(0,t-1);if(" "!==_.last(n)){var s=n.lastIndexOf(" ");n=n.slice(0,s)}return $.trim(n)+i},pe.value_from_cookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^ ;]+)"));return t?t[2]:null},pe.venue_search_text=function(e){var i=[e.name,e.description,e.address,e.hotspot_text,e.neighborhood_name];return e.types&&$.each(e.types,function(e,t){i.push(t)}),e.tags&&$.each(e.tags,function(e,t){i.push(t)}),i.join(" ")},pe.xor=function(e,t){return!!(e?!t:t)},$(document).ready(function(){$(document).ajaxSend(pe.ajax_send)}),pe.NewPerformerDialogForm=function(e,t,i,n){pe.init_widget(this,e),this.performer_name=t,this.success_callback_method=i,this.cancel_callback_method=n,this.dialog_box=$(this.dialog_html()),this.performer_name_input=this.dialog_box.find(".PerformerName"),this.performer_url_input=this.dialog_box.find(".PerformerURL"),this.performer_description_input=this.dialog_box.find(".PerformerDescription"),this.dialog_box.dialog({modal:!0,show:!1,close:this.callback(this.close_button_clicked),buttons:{"Create Performer":this.callback(this.create_button_clicked),Close:this.callback(this.close_button_clicked)}})},pe.NewPerformerDialogForm.prototype.close_button_clicked=function(){this.destroy_dialog(),this.cancel_callback_method(this.performer_name)},pe.NewPerformerDialogForm.prototype.create_button_clicked=function(){var e=this.performer_name_input.val();if(!e)return pe.EventHelperTools.show_message(this.performer_name_input,"Name is required"),!1;if(150<e.length)return pe.EventHelperTools.show_message(this.performer_name_input,"Name is too long"),!1;var t=this.performer_url_input.val();if(t&&!pe.EventHelperTools.validate_url(t))return pe.EventHelperTools.show_message(this.performer_url_input,"Please input a valid url"),!1;$.ajax({url:"/admin/events_admin/performer_create",type:"POST",data:{name:e,url:t,description:this.performer_description_input.val()},error:pe.ajax_error,success:this.callback(function(e){e.error?pe.EventHelperTools.show_message(this.performer_name_input,e.error):(this.destroy_dialog(),this.success_callback_method(e))})})},pe.NewPerformerDialogForm.prototype.destroy_dialog=function(){this.dialog_box.dialog("destroy"),this.dialog_box.remove()},pe.NewPerformerDialogForm.prototype.dialog_html=function(){return'<div title="Create Performer"><ul><li><label><strong>Only Entertainer Type can be created in the Events Importer</strong></label><br></li><li><label for="performer_name">Name</label> <input name="performer_name" class="PerformerName" value="'+this.performer_name+'"></li><li><label for="performer_url">Official Site</label> <input name="performer_url" class="PerformerURL" value=""></li><li><label for="performer_description">Description</label> <textarea name="performer_description" class="PerformerDescription"></textarea></li></ul></div>'},pe.PerformerAutocomplete=function(e,t,i){pe.init_widget(this,e),this.attribute_name=i,this.performer_autocomplete_field=this.container.find(".PerformerAutocompleteInput"),this.performer_autocomplete_field.blur(this.callback(this.performer_autocomplete_field_blurred)),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{startText:"",emptyText:"Press Tab or Type Comma to create a performer",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",queryParam:"term",neverSubmit:!0,preFill:this.performer_autocomplete_field.data("event-data"),resultClick:this.callback(this.search_result_clicked),selectionAdded:this.callback(this.search_result_selection_added)}),this.last_valid_input=this.val()},pe.PerformerAutocomplete.events={CHANGED:"PerformerAutocomplete_CHANGED",SELECTED:"PerformerAutocomplete_SELECTED"},pe.PerformerAutocomplete.prototype.as_enum=function(){var e={};return e[this.attribute_name]=this.val().split(","),e},pe.PerformerAutocomplete.prototype.add_performers=function(e){if(this.autosuggest_module.add_entries(e),this.last_valid_input=this.val(),e&&0<e.length){var t=_.flatten($.map(e,function(e){return e.content_tag_ids})),i=_.flatten($.map(e,function(e){return e.type_ids}));this.fire_event(pe.PerformerAutocomplete.events.SELECTED,{content_tag_ids:t,type_ids:i})}},pe.PerformerAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.performer_autocomplete_field,e)},pe.PerformerAutocomplete.prototype.open_new_performer_dialog_form=function(){new pe.NewPerformerDialogForm(this.container,
this.performer_autocomplete_field.val(),this.callback(this.replace_last_performer),this.callback(this.remove_last_selected_performer))},pe.PerformerAutocomplete.prototype.performer_autocomplete_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.PerformerAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")},pe.PerformerAutocomplete.prototype.remove_last_selected_performer=function(e){this.autosuggest_module.selected_entries_container.find("li.as-selection-item").filter(function(){return $(this).find("span.as-selection-label").text()===e}).find(".as-close").click()},pe.PerformerAutocomplete.prototype.replace_last_performer=function(e){this.autosuggest_module.replace_last_entry(e)},pe.PerformerAutocomplete.prototype.search_result_clicked=function(e){this.fire_event(pe.PerformerAutocomplete.events.SELECTED,{content_tag_ids:e.attributes.content_tag_ids,type_ids:e.attributes.type_ids,venues:e.attributes.venues})},pe.PerformerAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&this.performer_autocomplete_field.val()===this.autosuggest_module.last_value()&&this.open_new_performer_dialog_form()},pe.PerformerAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.PerformerAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.RecurringParentAutocomplete=function(e,t){pe.init_widget(this,e),this.autosuggest_input_field=this.container.find(".RecurringParentAutocompleteInput"),this.autosuggest_input_field.blur(this.callback(this.autosuggest_input_field_blurred)),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{startText:"",emptyText:"No recurring event found",queryParam:"term",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",neverSubmit:!0,selectionLimit:1,preFill:this.autosuggest_input_field.data("event-data"),selectionAdded:this.callback(this.search_result_selection_added),selectionRemoved:this.callback(this.selection_removed)}),this.last_valid_input=this.val()},pe.RecurringParentAutocomplete.events={CHANGED:"RecurringParentAutocomplete_CHANGED",REMOVED:"RecurringParentAutocomplete_REMOVED",SELECTED:"RecurringParentAutocomplete_SELECTED"},pe.RecurringParentAutocomplete.prototype.as_enum=function(){return{recurring_parent_id:this.val()}},pe.RecurringParentAutocomplete.prototype.autosuggest_input_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.RecurringParentAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")},pe.RecurringParentAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.autosuggest_input_field,e)},pe.RecurringParentAutocomplete.prototype.search_result_selection_added=function(){if(this.autosuggest_module)return this.autosuggest_input_field.val()===this.autosuggest_module.last_value()?(this.autosuggest_module.remove_last_entry(),void this.display_message("Cannot create recurring parent. Please select from list")):void $.ajax({url:"/admin/events_admin/recurring_parent_event_data",data:{recurring_parent_id:this.val()},error:pe.ajax_error,success:this.callback(function(e){e.error?(this.autosuggest_module.remove_last_entry(),this.display_message(e.error)):this.fire_event(pe.RecurringParentAutocomplete.events.SELECTED,e)})})},pe.RecurringParentAutocomplete.prototype.selection_removed=function(e){$(e).remove(),this.fire_event(pe.RecurringParentAutocomplete.events.REMOVED,null)},pe.RecurringParentAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.RecurringParentAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.TextAreaModule=function(e,t){pe.init_widget(this,e),this.attribute_key=t,this.input_field=this.container.find("textarea"),this.input_field.blur(this.callback(this.text_area_blurred)),this.last_input=this.val()},pe.TextAreaModule.events={BLURRED:"TextAreaModule_BLURRED",CHANGED:"TextAreaModule_CHANGED"},pe.TextAreaModule.prototype.as_enum=function(){var e={};return e[this.attribute_key]=this.val(),e},pe.TextAreaModule.prototype.text_area_blurred=function(){this.last_input!==this.val()&&(this.last_input=this.val(),this.fire_event(pe.TextAreaModule.events.CHANGED,this.as_enum())),this.fire_event(pe.TextAreaModule.events.BLURRED),pe.EventHelperTools.show_message(this.input_field,"")},pe.TextAreaModule.prototype.set_value=function(e){e&&(this.input_field.val(e),this.last_input=e)},pe.TextAreaModule.prototype.val=function(){return this.input_field.val().toString()},pe.TextInputModule=function(e,t){pe.init_widget(this,e),this.attribute_key=t,this.input_field=this.container.find("input"),this.input_field.blur(this.callback(this.input_field_blurred)),this.last_input=this.val()},pe.TextInputModule.events={BLURRED:"TextInputModule_BLURRED",CHANGED:"TextInputModule_CHANGED"},pe.TextInputModule.prototype.as_enum=function(){var e={};return e[this.attribute_key]=this.val(),e},pe.TextInputModule.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.input_field,e)},pe.TextInputModule.prototype.input_field_blurred=function(){this.last_input!==this.val()&&(this.last_input=this.val(),this.fire_event(pe.TextInputModule.events.CHANGED,this.as_enum())),this.fire_event(pe.TextInputModule.events.BLURRED),pe.EventHelperTools.show_message(this.input_field,"")},pe.TextInputModule.prototype.set_value=function(e){e&&(this.input_field.val(e),this.last_input=e)},pe.TextInputModule.prototype.val=function(){return this.input_field.val().toString()},pe.NewVenueDialogForm=function(e,t,i,n,s,o){pe.init_widget(this,e),this.venue_name=t,this.success_callback_method=s,this.cancel_callback_method=o,this.city_data_ids=$.map(i,function(e){return e.value.toString()}),this.endpoint_ids=$.map(n,function(e){return e.value.toString()}),this.dialog_box=$(this.dialog_html()),this.venue_name_input=this.dialog_box.find(".VenueName"),this.venue_city_input=this.dialog_box.find(".VenueCity"),this.venue_endpoint_input=this.dialog_box.find(".VenueEndpoint"),this.venue_address_input=this.dialog_box.find(".VenueFullAddress"),this.dialog_box.dialog({modal:!0,show:!1,close:this.callback(this.close_button_clicked),buttons:{"Create Venue":this.callback(this.create_button_clicked),Close:this.callback(this.close_button_clicked)}}),this.venue_endpoints_autosuggest=new pe.AutoSuggestModule(this.dialog_box.find(".EndpointInputContainer"),n,{startText:"Select an Endpoint",emptyText:"No Endpoint found",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",neverSubmit:!0,selectionLimit:1}),this.venue_city_autosuggest_module=new pe.AutoSuggestModule(this.dialog_box.find(".CityInputContainer"),i,{startText:"Select a City",emptyText:"No city found",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"label",neverSubmit:!0,selectionLimit:1})},pe.NewVenueDialogForm.prototype.close_button_clicked=function(){this.destroy_dialog(),this.cancel_callback_method(this.venue_name)},pe.NewVenueDialogForm.prototype.create_button_clicked=function(){var e=this.venue_name_input.val();if(!e)return pe.EventHelperTools.show_message(this.venue_name_input,"Name is required"),!1;if(150<e.length)return pe.EventHelperTools.show_message(this.venue_name_input,"Name is too long"),!1;var t=this.venue_city_autosuggest_module.val();if(!t)return pe.EventHelperTools.show_message(this.venue_city_input,"City is required"),!1;if(!pe.array_contains(this.city_data_ids,t))return pe.EventHelperTools.show_message(this.venue_city_input,"Select a valid city from the list"),!1;var i=this.venue_endpoints_autosuggest.val();return i?pe.array_contains(this.endpoint_ids,i)?void $.ajax({url:"/admin/events_admin/venue_create",type:"POST",data:{name:e,city_id:t,endpoint_id:i,full_address:this.venue_address_input.val()},error:pe.ajax_error,success:this.callback(function(e){e.error?pe.EventHelperTools.show_message(this.venue_name_input,e.error):(this.destroy_dialog(),this.success_callback_method(e))})}):(pe.EventHelperTools.show_message(this.venue_endpoint_input,"Select a valid endpoint from the list"),!1):(pe.EventHelperTools.show_message(this.venue_endpoint_input,"Endpoint is required"),!1)},pe.NewVenueDialogForm.prototype.destroy_dialog=function(){this.dialog_box.dialog("destroy"),this.dialog_box.remove()},pe.NewVenueDialogForm.prototype.dialog_html=function(){return'<div title="Create Venue"><ul><li><label for="venue_name">Name</label> <input name="venue_name" class="VenueName" value="'+this.venue_name+'"></li><li class="CityInputContainer"><input name="venue_city" class="VenueCity AutoSuggestInput" value=""></li><li class="EndpointInputContainer"><input name="venue_endpoint" class="VenueEndpoint AutoSuggestInput" value=""></li><li><label for="venue_address">Full Address</label> <textarea name="venue_address" class="VenueFullAddress"></textarea></li></ul></div>'},pe.VenueAutocomplete=function(e,t,i,n){pe.init_widget(this,e),this.city_data_source=i,this.venue_endpoints_data=n,this.venue_input_field=this.container.find(".VenueAutocompleteInput"),this.venue_input_field.blur(this.callback(this.venue_input_field_blurred)),this.autosuggest_module=new pe.AutoSuggestModule(this.container,t,{startText:"",emptyText:"Press Tab or type comma to create a new venue",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",queryParam:"term",neverSubmit:!0,preFill:this.venue_input_field.data("event-data"),resultClick:this.callback(this.search_result_clicked),selectionAdded:this.callback(this.search_result_selection_added)}),this.city_id=this.get_city_id(this.venue_input_field.data("event-data")),this.last_valid_input=this.val()},pe.VenueAutocomplete.events={CHANGED:"VenueAutocomplete_CHANGED"},pe.VenueAutocomplete.prototype.add_venues=function(e){this.city_id=this.get_city_id(e),this.autosuggest_module.add_entries(e),this.last_valid_input=this.val()},pe.VenueAutocomplete.prototype.as_enum=function(){return{venue_ids:this.val().split(",")}},pe.VenueAutocomplete.prototype.display_message=function(e){pe.EventHelperTools.show_message(this.venue_input_field,e)},pe.VenueAutocomplete.prototype.get_city_id=function(e){return e&&0!==e.length?e[0].city_id:null},pe.VenueAutocomplete.prototype.open_new_venue_dialog_form=function(){new pe.NewVenueDialogForm(this.container,this.venue_input_field.val(),this.city_data_source,this.venue_endpoints_data,this.callback(this.replace_last_venue),this.callback(this.remove_last_venue))},pe.VenueAutocomplete.prototype.remove_last_venue=function(e){this.autosuggest_module.selected_entries_container.find("li.as-selection-item").filter(function(){return $(this).find("span.as-selection-label").text()===e}).find(".as-close").click(),""===this.val()&&(this.city_id=null)},pe.VenueAutocomplete.prototype.replace_last_venue=function(e){this.autosuggest_module.replace_last_entry(e),this.search_result_selection_added()},pe.VenueAutocomplete.prototype.search_result_clicked=function(e){var t=e.attributes.city_id||null;if(1<this.val().split(",").length&&this.city_id&&null!==this.city_id&&t!==this.city_id)return this.autosuggest_module.remove_last_entry(),this.display_message("Please select venues from the same city"),!1;this.city_id=t},pe.VenueAutocomplete.prototype.search_result_selection_added=function(){this.autosuggest_module&&this.venue_input_field.val()===this.autosuggest_module.last_value()&&this.open_new_venue_dialog_form()},pe.VenueAutocomplete.prototype.val=function(){return this.autosuggest_module.val()},pe.VenueAutocomplete.prototype.value_changed=function(){return this.last_valid_input!==this.val()},pe.VenueAutocomplete.prototype.venue_input_field_blurred=function(){this.value_changed()&&(this.last_valid_input=this.val(),this.fire_event(pe.VenueAutocomplete.events.CHANGED,this.as_enum())),this.display_message("")},pe.ReviewRowModule=function(e,t,i,n,s,o){pe.init_widget(this,e),this.city_data=t,this.event_type_data=i,this.content_tags_data=n,this.event_endpoints_data=s,this.venue_endpoints_data=o,this.event_id=this.container.data("event-id"),this.event_url=this.container.data("event-url"),this.recurring_event_autocomplete=new pe.RecurringParentAutocomplete(this.container.find(".RecurringParentAutocompleteContainer"),"/api/events/recurring_parents"),this.recurring_event_autocomplete.bind_event(pe.RecurringParentAutocomplete.events.CHANGED,this.callback(this.recurring_parent_changed)),this.recurring_event_autocomplete.bind_event(pe.RecurringParentAutocomplete.events.REMOVED,this.callback(this.recurring_parent_removed)),this.recurring_event_autocomplete.bind_event(pe.RecurringParentAutocomplete.events.SELECTED,this.callback(this.recurring_parent_selected)),this.parent_event_autocomplete=new pe.ParentEventAutocomplete(this.container.find(".ParentEventAutocompleteContainer"),"/api/events/parents"),this.parent_event_autocomplete.bind_event(pe.ParentEventAutocomplete.events.CHANGED,this.callback(this.parent_event_changed)),this.parent_event_autocomplete.bind_event(pe.ParentEventAutocomplete.events.SELECTED,this.callback(this.parent_event_selected)),this.endpoint_autocomplete=new pe.EndpointAutocomplete(this.container.find(".EndpointAutocompleteContainer"),s),this.endpoint_autocomplete.bind_event(pe.EndpointAutocomplete.events.CHANGED,this.callback(this.attribute_changed)),this.endpoint_autocomplete.bind_event(pe.EndpointAutocomplete.events.REMOVED,this.callback(this.endpoint_removed)),this.event_dates_text_module=new pe.EventDatesTextModule(this.container.find(".EventDatesTextContainer")),this.event_dates_text_module.bind_event(pe.EventDatesTextModule.events.CHANGED,this.callback(this.attribute_changed)),this.is_top_checkbox=this.container.find(".IsTop"),this.is_top_checkbox.click(this.callback(this.is_top_checkbox_clicked)),this.headliners_autocomplete=new pe.PerformerAutocomplete(this.container.find(".HeadlinerAutocompleteContainer"),"/api/events/performers","ordered_headliner_ids"),this.headliners_autocomplete.bind_event(pe.PerformerAutocomplete.events.CHANGED,this.callback(this.performer_changed)),this.headliners_autocomplete.bind_event(pe.PerformerAutocomplete.events.SELECTED,this.callback(this.performer_selected)),this.opening_acts_autocomplete=new pe.PerformerAutocomplete(this.container.find(".OpeningActAutocompleteContainer"),"/api/events/performers","ordered_opening_act_ids"),this.opening_acts_autocomplete.bind_event(pe.PerformerAutocomplete.events.CHANGED,this.callback(this.performer_changed)),this.opening_acts_autocomplete.bind_event(pe.PerformerAutocomplete.events.SELECTED,this.callback(this.performer_selected)),this.event_name_module=new pe.TextInputModule(this.container.find(".EventNameContainer"),"name"),this.event_name_module.bind_event(pe.TextInputModule.events.CHANGED,this.callback(this.attribute_changed)),this.venues_autocomplete=new pe.VenueAutocomplete(this.container.find(".VenueAutocompleteContainer"),"/api/events/venues",t,o),this.venues_autocomplete.bind_event(pe.VenueAutocomplete.events.CHANGED,this.callback(this.event_location_changed)),this.cities_autocomplete=new pe.CityAutocomplete(this.container.find(".CityAutocompleteContainer"),t),this.cities_autocomplete.bind_event(pe.CityAutocomplete.events.CHANGED,this.callback(this.event_location_changed)),this.event_types_autocomplete=new pe.EventTypesAutocomplete(this.container.find(".EventTypeAutocompleteContainer"),i),this.event_types_autocomplete.bind_event(pe.EventTypesAutocomplete.events.CHANGED,this.callback(this.tags_changed)),this.content_tags_autocomplete=new pe.ContentTagsAutocomplete(this.container.find(".ContentTagsAutocompleteContainer"),n),this.content_tags_autocomplete.bind_event(pe.ContentTagsAutocomplete.events.CHANGED,this.callback(this.tags_changed)),this.holidays_autocomplete=new pe.HolidayAutocomplete(this.container.find(".HolidaysAutocompleteContainer"),"/api/holidays/autocomplete","holiday_ids"),this.holidays_autocomplete.bind_event(pe.HolidayAutocomplete.events.CHANGED,this.callback(this.attribute_changed)),this.event_description_module=new pe.TextAreaModule(this.container.find(".EventDescriptionContainer"),"description"),this.event_description_module.bind_event(pe.TextAreaModule.events.CHANGED,this.callback(this.attribute_changed)),this.event_website_module=new pe.EventWebsiteModule(this.container.find(".EventWebsiteContainer")),this.event_website_module.bind_event(pe.EventWebsiteModule.events.CHANGED,this.callback(this.attribute_changed)),this.event_price_module=new pe.TextInputModule(this.container.find(".EventTicketPricesContainer"),"price"),this.event_price_module.bind_event(pe.TextInputModule.events.CHANGED,this.callback(this.attribute_changed)),this.accept_button=this.container.find(".AcceptButton"),this.accept_button.click(this.callback(this.accept_button_clicked)),this.reject_button=this.container.find(".RejectButton"),this.reject_button.click(this.callback(this.reject_button_clicked)),this.delete_button=this.container.find(".DeleteButton"),this.delete_button.click(this.callback(this.delete_button_clicked))},pe.ReviewRowModule.prototype.attribute_changed=function(e,t){this.is_valid()&&this.update_event_attributes(t)},pe.ReviewRowModule.prototype.accept_button_clicked=function(){this.is_valid()&&this.update_event_attributes({status:"active"},this.callback(function(){this.container.remove()}))},pe.ReviewRowModule.prototype.reject_button_clicked=function(){this.is_valid()&&this.update_event_attributes({status:"reject"},this.callback(function(){this.container.remove()}))},pe.ReviewRowModule.prototype.delete_button_clicked=function(){$.ajax({url:"/admin/events_admin/event_delete",type:"PUT",data:{event_id:this.event_id},error:pe.ajax_error,success:this.callback(function(e){e?this.recurring_event_autocomplete.display_message(e):this.container.remove()})})},pe.ReviewRowModule.prototype.endpoint_removed=function(e,t){$(t).remove()},pe.ReviewRowModule.prototype.event_location_changed=function(){if(this.is_valid()){var e={};$.extend(e,this.cities_autocomplete.as_enum()),$.extend(e,this.venues_autocomplete.as_enum()),this.update_event_attributes(e)}},pe.ReviewRowModule.get_tags_using_ids=function(e,t){return $.map(e,function(e){if(-1<$.inArray(e.value,t))return e})},pe.ReviewRowModule.intialize_row_modules=function(i,n,s,o,a){$.each($(".EventReviewRowModule"),function(e,t){new pe.ReviewRowModule($(t),i,n,s,o,a)})},pe.ReviewRowModule.prototype.is_top_checkbox_clicked=function(){this.is_valid()&&this.update_event_attributes({is_top:this.is_top_checkbox.is(":checked")})},pe.ReviewRowModule.prototype.is_valid=function(){var e=!0;return this.recurring_event_autocomplete.val()&&this.parent_event_autocomplete.val()?(this.recurring_event_autocomplete.display_message("An event cannot have both recurring and parent event."),this.parent_event_autocomplete.display_message("An event cannot have both recurring and parent event."),e=!1):(this.recurring_event_autocomplete.display_message(""),this.parent_event_autocomplete.display_message("")),this.endpoint_autocomplete.val()?this.endpoint_autocomplete.display_message(""):(this.endpoint_autocomplete.display_message("Endpoint is required"),e=!1),this.event_dates_text_module.val()?this.event_dates_text_module.display_message(""):(this.event_dates_text_module.display_message("Please enter event dates."),e=!1),this.cities_autocomplete.val()&&this.venues_autocomplete.val()?(this.venues_autocomplete.display_message("An event cannot have both cities and venues."),e=!1):this.cities_autocomplete.val()||this.venues_autocomplete.val()?this.venues_autocomplete.display_message(""):(this.venues_autocomplete.display_message("Please select cities or venues as event locations"),e=!1),this.event_types_autocomplete.val()?this.event_types_autocomplete.display_message(""):(this.event_types_autocomplete.display_message("Event Types is required"),e=!1),this.event_name_module.val()?this.event_name_module.display_message(""):(this.event_name_module.display_message("Please enter an event name."),e=!1),this.event_website_module.is_valid()?this.event_website_module.display_message(""):(this.event_website_module.display_message("Please enter a valid url"),e=!1),e},pe.ReviewRowModule.prototype.parent_event_selected=function(e,t){this.cities_autocomplete.add_cities(t.cities),this.content_tags_autocomplete.add_content_tags(t.content_tags),this.endpoint_autocomplete.add_endpoint(t.endpoint),this.event_types_autocomplete.add_event_types(t.event_types),this.event_website_module.set_value(t.url),this.venues_autocomplete.add_venues(t.venues)},pe.ReviewRowModule.prototype.parent_event_changed=function(){if(this.is_valid()){var e={};$.extend(e,this.cities_autocomplete.as_enum()),$.extend(e,this.content_tags_autocomplete.as_enum()),$.extend(e,this.endpoint_autocomplete.as_enum()),$.extend(e,this.event_types_autocomplete.as_enum()),$.extend(e,this.event_website_module.as_enum()),$.extend(e,this.venues_autocomplete.as_enum()),this.update_event_attributes(e)}},pe.ReviewRowModule.prototype.performer_selected=function(e,t){var i=t.content_tag_ids;i&&0<i.length&&this.content_tags_autocomplete.add_content_tags(pe.ReviewRowModule.get_tags_using_ids(this.content_tags_data,i));var n=t.type_ids;n&&0<n.length&&this.event_types_autocomplete.add_event_types(pe.ReviewRowModule.get_tags_using_ids(this.event_type_data,n)),this.venues_autocomplete.add_venues(t.venues)},pe.ReviewRowModule.prototype.performer_changed=function(){if(this.is_valid()){var e={};$.extend(e,this.content_tags_autocomplete.as_enum()),$.extend(e,this.event_types_autocomplete.as_enum()),$.extend(e,this.headliners_autocomplete.as_enum()),$.extend(e,this.opening_acts_autocomplete.as_enum()),$.extend(e,this.venues_autocomplete.as_enum()),$.extend(e,this.cities_autocomplete.as_enum()),this.update_event_attributes(e)}},pe.ReviewRowModule.prototype.recurring_parent_selected=function(e,t){this.cities_autocomplete.add_cities(t.cities),this.content_tags_autocomplete.add_content_tags(t.content_tags),this.endpoint_autocomplete.add_endpoint(t.endpoint),this.event_description_module.set_value(t.description),this.event_types_autocomplete.add_event_types(t.event_types),this.event_website_module.set_value(t.url),this.headliners_autocomplete.add_performers(t.headliners),this.opening_acts_autocomplete.add_performers(t.opening_acts),this.venues_autocomplete.add_venues(t.venues)},pe.ReviewRowModule.prototype.recurring_parent_changed=function(){if(this.is_valid()){var e={};$.extend(e,this.cities_autocomplete.as_enum()),$.extend(e,this.content_tags_autocomplete.as_enum()),$.extend(e,this.endpoint_autocomplete.as_enum()),$.extend(e,this.event_description_module.as_enum()),$.extend(e,this.event_types_autocomplete.as_enum()),$.extend(e,this.event_website_module.as_enum()),$.extend(e,this.headliners_autocomplete.as_enum()),$.extend(e,this.opening_acts_autocomplete.as_enum()),$.extend(e,this.venues_autocomplete.as_enum()),this.update_event_attributes(e)}},pe.ReviewRowModule.prototype.recurring_parent_removed=function(){this.endpoint_autocomplete.autosuggest_module.remove_last_entry()},pe.ReviewRowModule.prototype.tags_changed=function(){if(this.is_valid()){var e={};$.extend(e,this.content_tags_autocomplete.as_enum()),$.extend(e,this.event_types_autocomplete.as_enum()),this.update_event_attributes(e)}},pe.ReviewRowModule.prototype.update_event_attributes=function(e,t){$.ajax({url:"/admin/events_admin/event_update",type:"PUT",data:{event_id:this.event_id,event:e},error:pe.ajax_error,success:this.callback(function(e){e?this.recurring_event_autocomplete.display_message(e):t&&t(!0)})})},function(D){D.fn.autoSuggest=function(e,t){var i={asHtmlID:!1,startText:"Enter Name Here",emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",retrieveLimit:!1,extraParams:"",matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,neverSubmit:!1,selectionLimit:!1,showResultList:!0,start:function(){},selectionClick:function(){},selectionAdded:function(){},selectionRemoved:function(e){e.remove()},formatList:!1,beforeRetrieve:function(e){return e},retrieveComplete:function(e){return e},resultClick:function(){},resultsComplete:function(){}},w=D.extend(i,t),C="object",x=0;if("string"==typeof e){C="string";var T=e}else{var P=e;for(k in e)e.hasOwnProperty(k)&&x++}if("object"==C&&0<x||"string"==C)return this.each(function(e){function a(){if(46==lastKeyPressCode||8<lastKeyPressCode&&lastKeyPressCode<32)return f.hide();var i=h.val().replace(/[\\]+|[\/]+/g,"");if(i!=b)if((b=i).length>=w.minChars)if(m.addClass("loading"),"string"==C){var e="";w.retrieveLimit&&(e="&limit="+encodeURIComponent(w.retrieveLimit)),w.beforeRetrieve&&(i=w.beforeRetrieve.call(this,i)),D.getJSON(T+"?"+w.queryParam+"="+encodeURIComponent(i)+e+w.extraParams,function(e){x=0;var t=w.retrieveComplete.call(this,e);for(k in t)t.hasOwnProperty(k)&&x++;n(t,i)})}else w.beforeRetrieve&&(i=w.beforeRetrieve.call(this,i)),n(P,i);else m.removeClass("loading"),f.hide()}function n(e,t){w.matchCase||(t=t.toLowerCase());var i=0;f.html(g.html("")).hide();for(var n=0;n<x;n++){var s=n;E++;var o=!1;if("value"==w.searchObjProps)var a=e[s].value;else{a="";for(var r=w.searchObjProps.split(","),l=0;l<r.length;l++){var u=D.trim(r[l]);a=a+e[s][u]+" "}}if(a&&(w.matchCase||(a=a.toLowerCase()),T&&-1==y.val().search("\\b"+e[s][w.selectedValuesProp]+",")&&-1==y.val().search(","+e[s][w.selectedValuesProp]+",")?o=!0:-1!=a.search(t)&&-1==y.val().search("\\b"+e[s][w.selectedValuesProp]+",")&&-1==y.val().search(","+e[s][w.selectedValuesProp]+",")&&(o=!0)),o){var p=D('<li class="as-result-item" id="as-result-item-'+s+'"></li>').click(function(){var e=D(this).data("data"),t=e.num;if(D("#as-selection-"+t,m).length<=0&&!A){var i=e.attributes;h.val("").focus(),b="",d(i,t),w.resultClick.call(this,e),f.hide()}A=!1}).mousedown(function(){v=!1}).mouseover(function(){D("li",g).removeClass("active"),D(this).addClass("active")}).data("data",{attributes:e[s],num:E}),c=D.extend({},e[s]);if(w.matchCase)_=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","g");else var _=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi");if(w.resultsHighlight&&(c[w.selectedItemProp]=c[w.selectedItemProp].replace(_,"<em>$1</em>")),p=w.formatList?w.formatList.call(this,c,p):p.html(c[w.selectedItemProp]),g.append(p),delete c,i++,w.retrieveLimit&&w.retrieveLimit==i)break}}m.removeClass("loading"),i<=0&&g.html('<li class="as-message">'+w.emptyText+"</li>"),g.css("width",m.outerWidth()),f.show(),w.resultsComplete.call(this)}function d(t,e){y.val(y.val()+t[w.selectedValuesProp]+",");var i=D('<li class="as-selection-item" id="as-selection-'+e+'"></li>').click(function(){w.selectionClick.call(this,D(this)),m.children().removeClass("selected"),D(this).addClass("selected")}).mousedown(function(){v=!1}),n=D('<a class="as-close">&times;</a>').click(function(){var e=new RegExp("\\b"+t[w.selectedValuesProp]+",");return y.val(y.val().replace(e,"")),w.selectionRemoved.call(this,i),v=!0,h.focus(),!1});l.before(i.html('<span class="as-selection-label">'+t[w.selectedItemProp]+"</span>").prepend(n)),w.selectionAdded.call(this,l.prev())}function r(e){if(0<D(":visible",f).length){var t=D("li",f);if("down"==e)var i=t.eq(0);else i=t.filter(":last");var n=D("li.active:first",f);0<n.length&&(i="down"==e?n.next():n.prev()),t.removeClass("active"),i.addClass("active")}}if(w.asHtmlID)t=e=w.asHtmlID;else var t="as-input-"+(e=e+""+Math.floor(10000001*Math.random()));w.start.call(this);var h=D(this);h.attr("autocomplete","off").addClass("as-input").attr("id",t).val(w.startText);var v=!1;h.wrap('<ul class="as-selections" id="as-selections-'+e+'"></ul>').wrap('<li class="as-original" id="as-original-'+e+'"></li>');var m=D("#as-selections-"+e),l=D("#as-original-"+e),f=D('<div class="as-results" id="as-results-'+e+'"></div>').hide(),g=D('<ul class="as-list"></ul>'),y=D('<input type="hidden" class="as-values" name="as_values_'+e+'" id="as-values-'+e+'" />'),i="";if("string"==typeof w.preFill){for(var s=w.preFill.split(","),o=0;o<s.length;o++){var u={};u[w.selectedValuesProp]=s[o],""!=s[o]&&d(u,"000"+o)}i=w.preFill}else{i="";var p=0;for(k in w.preFill)w.preFill.hasOwnProperty(k)&&p++;if(0<p)for(o=0;o<p;o++){var c=w.preFill[o][w.selectedValuesProp];c==undefined&&(c=""),i=i+c+",",""!=c&&d(w.preFill[o],"000"+o)}}""!=i&&(h.val(""),","!=i.substring(i.length-1)&&(i+=","),y.val(i),D("li.as-selection-item",m).addClass("blur").removeClass("selected"));h.after(y),m.click(function(){v=!0,h.focus()}).mousedown(function(){v=!1}).after(f);var _=null,b="",A=!1;h.focus(function(){return D(this).val()==w.startText&&""==y.val()?D(this).val(""):v&&(D("li.as-selection-item",m).removeClass("blur"),""!=D(this).val()&&(g.css("width",m.outerWidth()),f.show())),v=!0}).blur(function(){""==D(this).val()&&""==y.val()&&""==i?D(this).val(w.startText):v&&(D("li.as-selection-item",m).addClass("blur").removeClass("selected"),f.hide())}).keydown(function(e){switch(lastKeyPressCode=e.keyCode,first_focus=!1,e.keyCode){case 38:e.preventDefault(),r("up");break;case 40:e.preventDefault(),r("down");break;case 8:if(""==h.val()){var t=y.val().split(",");if(t=t[t.length-2],m.children().not(l.prev()).removeClass("selected"),l.prev().hasClass("selected")){var i=new RegExp("\\b"+t+",");y.val(y.val().replace(i,"")),w.selectionRemoved.call(this,l.prev())}else w.selectionClick.call(this,l.prev()),l.prev().addClass("selected")}1==h.val().length&&(f.hide(),b=""),0<D(":visible",f).length&&(_&&clearTimeout(_),_=setTimeout(function(){a()},w.keyDelay));break;case 9:case 188:A=!0;var n=h.val().replace(/(,)/g,"");if(""===n)break;if(y.val().search(","+n+",")<0&&n.length>=w.minChars){e.preventDefault();var s={};s[w.selectedItemProp]=n,s[w.selectedValuesProp]=n,d(s,"00"+(D("li",m).length+1)),h.val("")}case 13:A=!1;var o=D("li.active:first",f);0<o.length&&(o.click(),f.hide()),(w.neverSubmit||0<o.length)&&e.preventDefault();break;default:w.showResultList&&(w.selectionLimit&&D("li.as-selection-item",m).length>=w.selectionLimit?(g.html('<li class="as-message">'+w.limitText+"</li>"),f.show()):(_&&clearTimeout(_),_=setTimeout(function(){a()},w.keyDelay)))}});var E=0;window.AutoSuggest_hacks=window.AutoSuggest_hacks||{},window.AutoSuggest_hacks[this.id]=function(e,t){d(e,t)}})}}(jQuery),pe.EventLayoutJobsPipeline=function(e){pe.init_widget(this,e),this.event_jobs=[],this.request_in_process=!1,this.interval_to_render_layout=1500,$(window).bind("beforeunload",this.callback(this.window_close_button_clicked))},pe.EventLayoutJobsPipeline.prototype.window_close_button_clicked=function(){if(this.request_in_process)return alert("Do not close the window as event layout updates are running in the background!"),!1},pe.EventLayoutJobsPipeline.prototype.add_job=function(e){this.event_jobs.push(e),!this.request_in_process&&0<this.event_jobs.length&&this.process_next_job()},pe.EventLayoutJobsPipeline.prototype.process_next_job=function(){this.request_in_process=!0;var t=this.event_jobs.pop();$.ajax({url:t+"/get_layout.ehtml",error:pe.ajax_error,success:this.callback(function(e){this.container.html(e),setTimeout(this.callback(pe.bind(this.update_layout_type,t)),this.interval_to_render_layout)})})},pe.EventLayoutJobsPipeline.prototype.update_layout_type=function(e){var i=0;$.each(this.container.find(".left_section .ShortLayout"),function(e,t){i+=parseInt($(t).outerHeight(!0),10)}),$.ajax({url:e+"/update_layout.json",type:"PUT",data:{layout_type:292<i?2:1},error:pe.ajax_error,success:this.callback(function(){this.container.html(""),0===this.event_jobs.length?this.request_in_process=!1:this.process_next_job()})})},$(document).ready(function(){pe.depender=new pe.DependencyManager,new pe.AutoSuggestModule($(".VenueSearch"),"/api/events/venues",{asHtmlID:"venue_id",startText:"Search Venue",selectedItemProp:"label",selectedValuesProp:"value",searchObjProps:"search",queryParam:"term",neverSubmit:!1}),pe.ajax_loader.event_cities.load(function(e){pe.event_cities=e,pe.depender.set_flag("event_cities")}),pe.ajax_loader.content_tags.load(function(e){pe.content_tags=e,pe.depender.set_flag("content_tags")}),pe.ajax_loader.event_types.load(function(e){pe.event_types=e,pe.depender.set_flag("event_types")}),pe.ajax_loader.event_endpoints.load(function(e){pe.event_endpoints=e,pe.depender.set_flag("event_endpoints")}),pe.depender.call_when(["event_cities","content_tags","event_types","event_endpoints"],function(){pe.ajax_loader.venue_endpoints.load(function(e){pe.venue_endpoints=e,pe.depender.set_flag("venue_endpoints")})}),pe.depender.call_when(["event_cities","content_tags","event_types","event_endpoints","venue_endpoints"],function(){pe.ReviewRowModule.intialize_row_modules(pe.event_cities,pe.event_types
,pe.content_tags,pe.event_endpoints,pe.venue_endpoints)})});