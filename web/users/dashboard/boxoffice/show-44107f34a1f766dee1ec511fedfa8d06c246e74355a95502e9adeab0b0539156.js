(function(){var o=function(t,n){return function(){return t.apply(n,arguments)}};pe.ManualInput=function(){function t(t){var n,i,e;this.container=t,this.on_submit_button_clicked=o(this.on_submit_button_clicked,this),this.on_close_dialog=o(this.on_close_dialog,this),n={title:"Enter [12 Digit] Barcode Number",modal:!0,autoOpen:!1,close:this.on_close_dialog},this.dialog=$(".Dialog").dialog(n),this.error=this.container.find(".Error"),this.submit_button=this.container.find(".SubmitButton"),this.submit_button.click(this.on_submit_button_clicked),this.input=this.container.find(".Input"),this.input.keydown((i=this,function(t){if(13===t.which)return i.on_submit_button_clicked(),t.stopPropagation(),t.preventDefault()})),this.input.keyup((e=this,function(t){var n;return 189===t.which?(t.stopPropagation(),void t.preventDefault()):2<(n=e.ticket_number()).length&&n.length<=6?e.input.val(""+(n[0]||"")+(n[1]||"")+"-"+(n[2]||"")+(n[3]||"")+(n[4]||"")+(n[5]||"")):2<n.length?e.input.val(""+n[0]+n[1]+"-"+n[2]+n[3]+n[4]+n[5]+"-"+(n[6]||"")+(n[7]||"")+(n[8]||"")+(n[9]||"")+(n[10]||"")+(n[11]||"")):void 0}))}return t.prototype.open=function(){if(this.dialog.dialog("open"),this.on_show)return this.on_show()},t.prototype.show=function(t){return this.on_show=t},t.prototype.close=function(t){return this.on_close=t},t.prototype.submit=function(t){return this.on_submit=t},t.prototype.valid=function(){return 12===this.ticket_number().length},t.prototype.ticket_number=function(){return $.trim(this.input.val().replace(/(-|_| )/g,""))},t.prototype.show_error=function(t){return this.error.removeClass("hidden"),this.error.html(t)},t.prototype.hide_error=function(){return this.error.html(""),this.error.addClass("hidden")},t.prototype.on_close_dialog=function(){return this.on_close&&this.on_close(),this.hide_error(),this.input.val("")},t.prototype.on_submit_button_clicked=function(){return this.valid()?(this.hide_error(),this.on_submit&&this.on_submit(),this.dialog.dialog("close"),this.on_close_dialog()):(this.input.focus(),this.show_error("Invalid format <br> Entry must be 12 numbers"))},t}(),pe.DataContainer=function(){function t(t){this.container=t,this.data_fields=this.container.find(".Data"),this.status=this.container.find(".Status"),this.fields=_.uniq(_.map(this.data_fields,function(t){return $(t).data("field")}))}return t.prototype.apply_data=function(e){var t,n,o;for(e.initialized=!0,_.each(this.fields,(o=this,function(t){var n,i;return n=o.container.find("[data-field="+t+"]"),i=e[t],_.each(n,function(t){switch((t=$(t)).data("attribute")){case"visible":return t.toggleClass("hidden",!i);case"hidden":return t.toggleClass("hidden",!!i);default:return t.html(i)}})})),n=[],t=0;t<3;++t)n.push(this.status.fadeTo("fast",.3).fadeTo("fast",1));return n},t}(),pe.KeyboardHook=function(){function t(t){this.container=t,this.keypress=o(this.keypress,this),this.disable(),this.enable()}return t.prototype.disable=function(){if(this.stack=[],this.enabled)return this.enabled=!1,$(document).unbind("keypress")},t.prototype.enable=function(){if(this.stack=[],!this.enabled)return this.enabled=!0,$(document).bind("keypress",this.keypress)},t.prototype.keypress=function(t){return 20<this.stack.length?this.submit():13===t.which?(this.submit(),this.container.html("")):(this.stack.push(t.keyCode-48),this.container.html(this.stack.join(" ")))},t.prototype.send=function(t){return this.on_return=t},t.prototype.submit=function(t){var n;return n=t||this.stack.join(""),this.on_return&&this.on_return(n),this.stack=[]},t}(),$(function(){var t;return t=$(".DataContainer"),window.page=new pe.DataContainer(t),window.logger=new pe.KeyboardHook($(".Debugger")),window.manual_input=new pe.ManualInput($(".Dialog")),window.manual_input.show(function(){return window.logger.disable()}),window.manual_input.close(function(){return window.logger.enable()}),window.manual_input.submit(function(){return window.logger.submit(window.manual_input.ticket_number())}),$(".DialogTrigger").click(function(){return window.manual_input.open()}),window.logger.send(function(t){return pe.routes.Request.from_current_location("boxoffice_check_ticket_number",{ticket_number:t}).post(function(t){return window.page.apply_data(t)})})})}).call(this);