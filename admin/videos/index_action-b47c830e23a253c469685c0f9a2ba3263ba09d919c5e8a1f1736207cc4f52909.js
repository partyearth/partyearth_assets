pe.CommentsSection=function(e,t){pe.init_widget(this,e),this.comments_input=e.find(".Comments"),this.comments_save_btn=e.find(".SaveComments"),this.comments_save_btn.click(this.callback(this.save_video_comments)),this.videoable_path=t},pe.CommentsSection.prototype.save_video_comments=function(){this.comments_save_btn.hide(),$.ajax({url:this.videoable_path+"/videos/update_comments",type:"POST",data:{comments:this.comments_input.val()},dataType:"text",success:this.callback(this.save_video_comments_success)})},pe.CommentsSection.prototype.save_video_comments_success=function(){this.comments_save_btn.show()},function($){$.fn.editable=function(e,t){if("disable"!=e)if("enable"!=e){if("destroy"!=e){var c=$.extend({},$.fn.editable.defaults,{target:e},t),d=$.editable.types[c.type].plugin||function(){},u=$.editable.types[c.type].submit||function(){},p=$.editable.types[c.type].buttons||$.editable.types.defaults.buttons,h=$.editable.types[c.type].content||$.editable.types.defaults.content,_=$.editable.types[c.type].element||$.editable.types.defaults.element,f=$.editable.types[c.type].reset||$.editable.types.defaults.reset,v=c.callback||function(){},m=c.onedit||function(){},b=c.onsubmit||function(){},n=c.onreset||function(){},y=c.onerror||f;return c.tooltip&&$(this).attr("title",c.tooltip),c.autowidth="auto"==c.width,c.autoheight="auto"==c.height,this.each(function(){var s=this,i=$(s).width(),l=$(s).height();$(this).data("event.editable",c.event),$.trim($(this).html())||$(this).html(c.placeholder),$(this).bind(c.event,function(e){if(!0!==$(this).data("disabled.editable")&&!s.editing&&!1!==m.apply(this,[c,s])){e.preventDefault(),e.stopPropagation(),c.tooltip&&$(s).removeAttr("title"),0==$(s).width()?(c.width=i,c.height=l):("none"!=c.width&&(c.width=c.autowidth?$(s).width():c.width),"none"!=c.height&&(c.height=c.autoheight?$(s).height():c.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==c.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),s.editing=!0,s.revert=$(s).html(),$(s).html("");var o=$("<form />");c.cssclass&&("inherit"==c.cssclass?o.attr("class",$(s).attr("class")):o.attr("class",c.cssclass)),c.style&&("inherit"==c.style?(o.attr("style",$(s).attr("style")),o.css("display",$(s).css("display"))):o.attr("style",c.style));var t,a=_.apply(o,[c,s]);if(c.loadurl){var r=setTimeout(function(){a.disabled=!0,h.apply(o,[c.loadtext,c,s])},100),n={};n[c.id]=s.id,$.isFunction(c.loaddata)?$.extend(n,c.loaddata.apply(s,[s.revert,c])):$.extend(n,c.loaddata),$.ajax({type:c.loadtype,url:c.loadurl,data:n,async:!1,success:function(e){window.clearTimeout(r),t=e,a.disabled=!1}})}else c.data?(t=c.data,$.isFunction(c.data)&&(t=c.data.apply(s,[s.revert,c]))):t=s.revert;h.apply(o,[t,c,s]),a.attr("name",c.name),p.apply(o,[c,s]),$(s).append(o),d.apply(o,[c,s]),$(":input:visible:enabled:first",o).focus(),c.select&&a.select(),a.keydown(function(e){27==e.keyCode&&(e.preventDefault(),f.apply(o,[c,s]))}),"cancel"==c.onblur?a.blur(function(){r=setTimeout(function(){f.apply(o,[c,s])},500)}):"submit"==c.onblur?a.blur(function(){r=setTimeout(function(){o.submit()},200)}):$.isFunction(c.onblur)?a.blur(function(){c.onblur.apply(s,[a.val(),c])}):a.blur(function(){}),o.submit(function(e){if(r&&clearTimeout(r),e.preventDefault(),!1!==b.apply(o,[c,s])&&!1!==u.apply(o,[c,s]))if($.isFunction(c.target)){var t=c.target.apply(s,[a.val(),c]);$(s).html(t),s.editing=!1,v.apply(s,[s.innerHTML,c]),$.trim($(s).html())||$(s).html(c.placeholder)}else{var n={};n[c.name]=a.val(),n[c.id]=s.id,$.isFunction(c.submitdata)?$.extend(n,c.submitdata.apply(s,[s.revert,c])):$.extend(n,c.submitdata),"PUT"==c.method&&(n._method="put"),$(s).html(c.indicator);var i={type:"POST",data:n,dataType:"html",url:c.target,success:function(e){"html"==i.dataType&&$(s).html(e),s.editing=!1,v.apply(s,[e,c]),$.trim($(s).html())||$(s).html(c.placeholder)},error:function(e){y.apply(o,[c,s,e])}};$.extend(i,c.ajaxoptions),$.ajax(i)}return $(s).attr("title",c.tooltip),!1})}}),this.reset=function(e){this.editing&&!1!==n.apply(e,[c,s])&&($(s).html(s.revert),s.editing=!1,$.trim($(s).html())||$(s).html(c.placeholder),c.tooltip&&$(s).attr("title",c.tooltip))}})}$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable")}else $(this).data("disabled.editable",!1);else $(this).data("disabled.editable",!0)},$.editable={types:{defaults:{element:function(){var e=$('<input type="hidden"></input>');return $(this).append(e),e},content:function(e){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(t,n){var i=this;if(t.submit){if(t.submit.match(/>$/))var e=$(t.submit).click(function(){"submit"!=e.attr("type")&&i.submit()});else(e=$('<button type="submit" />')).html(t.submit);$(this).append(e)}if(t.cancel){if(t.cancel.match(/>$/))var o=$(t.cancel);else(o=$('<button type="cancel" />')).html(t.cancel);$(this).append(o),$(o).click(function(){if($.isFunction($.editable.types[t.type].reset))var e=$.editable.types[t.type].reset;else e=$.editable.types.defaults.reset;return e.apply(i,[t,n]),!1})}}},text:{element:function(e){var t=$("<input />");return"none"!=e.width&&t.width(e.width),"none"!=e.height&&t.height(e.height),t.attr("autocomplete","off"),$(this).append(t),t}},textarea:{element:function(e){var t=$("<textarea />");return e.rows?t.attr("rows",e.rows):"none"!=e.height&&t.height(e.height),e.cols?t.attr("cols",e.cols):"none"!=e.width&&t.width(e.width),$(this).append(t),t}},select:{element:function(){var e=$("<select />");return $(this).append(e),e},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){$(this).val()!=json.selected&&$(this).text()!=$.trim(original.revert)||$(this).attr("selected","selected")})}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery),pe.ExistingVideo=function(e){pe.init_widget(this,e);var t=e.find(".YoutubeId").val();this.youtube_id="string"==typeof t?t:"";var n=e.find(".UrlParam").val();this.url_param="string"==typeof n?n:"",e.find(".DeleteButton").click(this.callback(this.delete_button_clicked)),e.find("img").click(pe.video_image_clicked),e.find(".Title").editable("/admin/videos/"+this.url_param+"/update_in_place",{type:"textarea",select:!0,submit:"Save",cancel:"cancel",indicator:"<img src='/assets/content_bg/loading.gif'>",submitdata:{_method:"put",attr_name:"title"},cssclass:"editable"}),new pe.VideoStatusSelect(e.find(".Status"))},pe.ExistingVideo.prototype.delete_button_clicked=function(){confirm("Seriously?")&&$.ajax({url:"/admin/videos/"+this.url_param,type:"DELETE",dataType:"text",success:this.callback(this.video_deleted)})},pe.ExistingVideo.prototype.video_deleted=function(){this.container.remove()},pe.accentMap={"&":"and","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xe7":"c","\xc0":"a","\xc1":"a","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xc8":"e","\xc9":"e","\xec":"i","\xf1":"n","\xed":"i","\xee":"i","\xef":"i","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","!":"i",$:"s","-":""," ":"","'":"","\u2019":"",".":""},pe.ajax_error=function(){alert("The request failed. Please try again later.")},pe.ajax_send=function(e,t){var n=$("meta[name='csrf-token']").attr("content");t.setRequestHeader("X-CSRF-Token",n)},pe.alert=function(e){alert(e)},pe.animated_scrolling=function(e,t){if(0!==e.length){var n=e.offset().top-(t||25);$("html,body").stop().animate({scrollTop:n+"px"},800,"cubicEaseInOut",function(){return!1})}},pe.scrolling=function(e,t){if(0!==e.length){var n=e.offset().top-(t||25);$("html,body").scrollTop(n)}},pe.days_of_week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],pe.array_contains=function(e,t){return _.isArray(t)?0===_.difference(t,e).length:-1<_.indexOf(e,t)},pe.arrays_equal=function(e,t){if(!e&&!t)return!0;if(!e&&0===t.length||0===e.length&&!t)return!0;if(e.length!=t.length)return!1;for(var n=e.sort(),i=t.sort(),o=0,a=e.length;o<a;o++)if(n[o]!==i[o])return!1;return!0},pe.array_match=function(e,n){var i=!1;return $.each(e,function(e,t){if(-1<n.indexOf(t))return!(i=!0)}),i},pe.array_merge=function(e,t){var n=e.concat(t);return n.sort(),n},pe.array_remove=function(e,t){return e?pe.is_array(t)?$.grep(e,function(e){return-1===t.indexOf(e)}):$.grep(e,function(e){return e!==t}):e},pe.assign_photo_size=function(e,t,n){return e?"original"===t?e.replace("xxx.jpg",t+".jpg"):e.replace("xxx.jpg","s"+t+".jpg"):"/assets/no_image_"+n+".png"},pe.remove_timestamp_from_asset_url=function(e){return e.split("?")[0]},pe.browser_is_ie8=function(){return $.browser.msie&&"8.0"===$.browser.version},pe.build_dob_field_name=function(e,t,n){return t?t+="_":t="",[e=e||"user","[",t,"dob(",n,"i)]"].join("")},pe.capitalise_first_letter=function(e){return null===e?"":e.charAt(0).toUpperCase()+e.slice(1)},pe.classes_starting_with=function(e,t){return $.map(e.attr("class").split(/\s+/),function(e){if(pe.string_starts_with(e,t))return e})},pe.compare=function(e,t){return pe.is_array(e)&&pe.is_array(t)?pe.arrays_equal(e,t):e===t},pe.convert_to_rounded_corners=function(e){var t=e||$(".ConvertToRoundedCorners");return t.each(function(e,t){var n=$(t);n.removeClass("ConvertToRoundedCorners"),n.addClass("rounded_corner_wrapper"),$('<div class="rounded_corner top_left"></div>').appendTo(n),$('<div class="rounded_corner top_right"></div>').appendTo(n),$('<div class="rounded_corner bottom_left"></div>').appendTo(n),$('<div class="rounded_corner bottom_right"></div>').appendTo(n)}),t},pe.convert_to_tabbed_pod=function(e,c){return $.map(e,function(e){var t=$(e);if(!t.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+t[0].className);var n=t.children("ul");n.addClass("tab"),n.children("li").each(function(e,t){var n=(t=$(t)).html();t.html(pe.templatize('<div class="left_end pod_sprite float_left"></div>{{content}}<div class="right_end pod_sprite float_left"></div>',{content:n}))});var i=n.html();n.remove();var o=t.html(),a=pe.classes_starting_with(t,"width");if(0===a.length)return alert("no width class found");if(1<a.length)return alert("more than 1 width class found");var r=a[0].substr(5);t.addClass("tabs"),t.removeClass("ConvertToTabs"),t.removeClass(a[0]),t.html(pe.templatize('<div><table class="width{{width}}" cellpadding="0" cellspacing="0"><tbody><tr><td class="header" colspan="4"><div class="header_row"><ul class="tab">{{headers}}</ul><div class="mid_section"></div><div class="right_corner pod_sprite"></div></div></td></tr><tr class="content_container"><td class="left_side pod_sides"></td><td class="content">{{content}}</td><td class="right_side pod_sides"></td></tr><tr class="footer_row"><td class="left_corner pod_sprite"></td><td class="mid_section"></td><td class="right_corner pod_sprite"></td></tr></tbody></table></div>',{width:r,headers:i,content:o}));var s=t.children().tabs(c),l=["first","second","third","fourth"];return t.find("ul.tab li").each(function(e,t){$(t).addClass(l[e])}),s})},pe.new_convert_to_tabbed_pod=function(e,c){return $.map(e,function(e){var t=$(e);if(!t.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+t[0].className);var n=t.children("ul"),i=n.html();n.remove();var o=t.html(),a=pe.classes_starting_with(t,"width");if(0===a.length)return alert("no width class found");if(1<a.length)return alert("more than 1 width class found");var r=a[0].substr(5);t.addClass("tabs"),t.removeClass("ConvertToTabs"),t.removeClass(a[0]),t.html(pe.templatize('<div class="width{{width}}"><ul class="tab">{{headers}}</ul>{{content}}</div>',{width:r,headers:i,content:o}));var s=t.children().tabs(c),l=["first","second","third","fourth"];return t.find("ul.tab li").each(function(e,t){$(t).addClass(l[e])}),s})},pe.date_string=function(e){return"string"==typeof e?e:e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()},pe.days_between_dates=function(e,t){var n="string"==typeof e?Date.parse(e):e,i="string"==typeof t?Date.parse(t):t;return Math.abs(Math.floor((n-i)/864e5))},pe.empty=function(){},pe.event_search_text=function(e){var n=[e.name,e.description,e.location_name,e.category,e.neighborhood_name,e.neighborhood_id];return e.tags&&$.each(e.tags,function(e,t){n.push(t)}),e.performer_names&&$.each(e.performer_names,function(e,t){n.push(t)}),n.join(" ")},pe.fetch_photo_id_from_url=function(e){return e.split("/photos/")[1]},pe.fix_ie7_rendering_bug=function(){$(".ConvertToTabbedPod").addClass("IeSucks")},pe.format_date=function(e){return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()},pe.format_price=function(e){var t=Math.floor(e/100).toString(),n=(e%100).toString();return n.length<2&&(n="0"+n),"$"+t+"."+n},pe.format_duration=function(e,t){if(!e)return"0:00";var n=Math.floor(e/60),i=Math.floor(e%60);return pe.string_padding_left(n.toString(),t||1,"0")+":"+pe.string_padding_left(i.toString(),2,"0")},pe.get_city_id=function(){return window.city_id},pe.get_url_parameter=function(e,t){var n=new RegExp("[\\?&]"+t+"=([^&]+)","i").exec(e);return n?n[1]:null},pe.hash_length=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},pe.hashes_equal=function(e,t){if(e===t)return!0;if(pe.hash_length(e)!=pe.hash_length(t))return!1;for(var n in e){var i=e[n],o=t[n];if(pe.is_array(i)){if(!pe.arrays_equal(i,o))return!1}else if(i!==o)return!1}return!0},pe.hashes_match=function(e,t){for(var n in e){var i=e[n],o=t[n];if(pe.is_array(i)){if(!pe.array_contains(o,i))return!1}else if(i!==o)return!1}return!0},pe.https=function(e){return-1===window.location.href.indexOf("https://")?e:e.replace("http://","https://")},pe.inject=function(e,t,n){var i=t;return $.each(e,function(e,t){i=n(i,t)}),i},pe.init_widget=function(e,t){"string"!=typeof t&&(null===t||t.length?(e.container=t,e.callback=function(e){for(var t=[e,this],n=1;n<arguments.length;n++)t.push(arguments[n]);return pe.bind_this.apply(this,t)},e.check_bind=function(e){if("undefined"==typeof this.container)throw" in: "+e},e.bind_event=function(e,t){pe.assert(e,"bind_event: parameter 'event_type' is empty"),this.container.bind(e,t)},e.fire_event=function(e,t){void 0===e&&alert("Must provide the event type to fire."),void 0===t&&(t={}),this.container.trigger(e,t)},e.show=function(){this.container.show()},e.hide=function(){this.container.hide()},e.toggle=function(e){this.container.toggle(e)},e.is_visible=function(){return this.container.is(":visible")}):alert("No container given."))},pe.install_easing=function(){jQuery.easing.cubicEaseInOut||(jQuery.easing.cubicEaseInOut=function(e,t,n,i){var o=n+i;return(e/=.5)<1?o/2*e*e*e+n:o/2*((e-=2)*e*e+2)+n})},pe.is_array=function(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.splice||e.propertyIsEnumerable("length"))},pe.is_valid_credit_card_number=function(e){return!!e.match(/^\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}$/)},pe.is_valid_date=function(e){var t=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/;return!!e.match(t)&&(e===$.datepicker.formatDate("m/d/yy",new Date(e))||e===$.datepicker.formatDate("mm/dd/yy",new Date(e)))},pe.is_valid_zip_code=function(e){return!!e.match(/^\d{5}(\s*\-\s*\d{4})?$/)},pe.load=function(e){return pe.assert(e,"error loading data"),e},pe.link_title_for_city=function(e){return"See the latest hotspots and events happening in "+e+"."},pe.link_title_for_city_party_climate=function(e){return"Check out the overview and photos of "+e+"."},pe.link_title_for_event=function(e,t){return t?"Check out event details, photos and videos of "+e+" at "+t+".":"Check out event details, photos and videos of "+e+"."},pe.link_title_for_neighborhood=function(e,t){return"Check out "+e+" description, photos, and venues in "+t+"."},pe.link_title_for_performer=function(e){return"See the latest "+e+" schedule, photos, videos and news."},pe.link_title_for_reviewer=function(e){switch(e){case"Lucas":return"Meet Lucas, the quintessential fun- loving, pub-crawling \u201cguy\u2019s guy\u201d. Learn about his personality and ratings.";case"Adriana":return"Meet Adriana, the epitome of a cosmopolitan girl. Learn about her personality and ratings.";case"Jonah":return"Meet Jonah, an affable, non-mainstream guy with natural curiosity about people and cultures. Learn about his personality and ratings.";case"Emma":return"Meet Emma, a lively, witty, and sociable \u201cgirl next door\u201d. Learn about her personality and ratings.";case"All":return"Meet Lucas, Adriana, Jonah and Emma. Learn how their personalities can help you maximize your social experiences in your city and your travels."}},pe.link_title_for_venue=function(e,t,n){return n?"Check out the review, photos, videos, map and events schedule of "+e+" - "+n+" in "+t+".":"Check out the review, photos, videos, map and events schedule of "+e+" in "+t+"."},pe.normalize=function(e){for(var t="",n=0,i=e.length;n<i;n++){var o=e.charAt(n),a=pe.accentMap[o];t+=void 0===a?o:a}return t},pe.object_hash_from_array=function(e){var n={};return $.each(e,function(e,t){n[t.id]=t}),n},pe.object_length=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},pe.parse_price=function(e){return Math.ceil(100*parseFloat(e.substring(1)))},pe.prepare_autocomplete_data=function(e){var i=[];return $.each(e,function(n,e){$.each(e,function(e,t){t.category=n,i.push(t)})}),i},pe.remove_anchor_from_url=function(e){return e?e.split("#")[0]:""},pe.remove_query_string_from_url=function(e){return e?e.split("?")[0]:""},pe.set_autocomplete_source=function(e,t,n){var i=pe.normalize(t.term).toLowerCase(),o=new RegExp($.ui.autocomplete.escapeRegex(i),"i"),a=$.grep(pe.prepare_autocomplete_data(e),function(e){return e=e.label||e.value||e,o.test(e)||o.test(pe.normalize(e))});n(a=_.sortBy(a,function(e){var t=e.label||e.value||e;return t=pe.normalize(t).toLowerCase(),[e.category,t!=i,e.label]}))},pe.shuffle_array=function(e){if(!e)return[];for(var t,n,i=e.length;i;)t=parseInt(Math.random()*i,10),n=e[--i],e[i]=e[t],e[t]=n;return e},pe.string_padding_left=function(e,t,n){for(var i=e;i.length<t;)i=n+i;return i},pe.string_starts_with=function(e,t){return e.substr(0,t.length)===t},pe.string_ends_with=function(e,t){return e.substr(e.length-t.length)===t},pe.structured_tags_as_flat_array=function(e){var n=[];return $.each(e,function(e,t){$.merge(n,t)}),n},pe.text_contains_query=function(n,e){var t=e.split(" "),i=!0;return $.each(t,function(e,t){if(-1===n.indexOf(t))return!(i=!1)}),i},pe.today_date_string=function(){var e=new Date;return pe.date_string(e)},pe.truncate_by_words=function(e,t,n){if(!e||!t)return alert("Sorry, but an error happened. We are already warned about that.");if(n=n||"...",e.length<t)return e;var i=e.slice(0,t-1);if(" "!==_.last(i)){var o=i.lastIndexOf(" ");i=i.slice(0,o)}return $.trim(i)+n},pe.value_from_cookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^ ;]+)"));return t?t[2]:null},pe.venue_search_text=function(e){var n=[e.name,e.description,e.address,e.hotspot_text,e.neighborhood_name];return e.types&&$.each(e.types,function(e,t){n.push(t)}),e.tags&&$.each(e.tags,function(e,t){n.push(t)}),n.join(" ")},pe.xor=function(e,t){return!!(e?!t:t)},$(document).ready(function(){$(document).ajaxSend(pe.ajax_send)}),pe.DropdownModule=function(e,t,n,i,o,a){if(pe.init_widget(this,e),this.container.html(this.html(i,o)),this.container.attr("tabindex",0),this.container.addClass("Dropdown"),this.container.focusout(this.callback(this.container_focusout)),this.container.click(this.callback(this.title_clicked)),this.title_string_function=n,this.title_container_div=this.container.find(".TitleContainer"),this.title_div=pe.load(this.container.find(".Title")),this.title_div.html(this.title_string_function(null)),this.dropdown_input_field=this.container.find(".DropdownInput"),this.dropdown_div=pe.load(this.container.find(".Dropdown")),this.dropdown_div.hide(),this.choices_div=pe.load(this.container.find(".Choices")),"function"==typeof t?this.dropdown_html_function=t:"string"==typeof t?this.set_choices_content(t):alert("Unknown dropdown_html type given."),a){var r='div[data_result="'+a+'"]';this.set_default_selection(r),this.set_input_field_value(a)}else this.current_selection=null;(this.prevent_next_collapse_flag=!1,i)&&new pe.CloseButton(this.container,pe.CloseButton.close_methods.REMOVE).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));this.auto_collapse=0,this.scroll_timeout=null},pe.DropdownModule.events={OPENED:"DropdownModule_OPENED",CHANGED:"DropdownModule_CHANGED",CLOSED:"DropdownModule_CLOSED",MINIMIZED:"DropdownModule_MINIMIZED"},pe.DropdownModule.prototype.choice_clicked=function(e){return this.current_selection=$(e.target).closest(".Choice"),this.collapse_dropdown(),this.dropdown_div.hide(),this.fire_event(pe.DropdownModule.events.CHANGED,this.current_selection),!1},pe.DropdownModule.prototype.close_button_clicked=function(){this.fire_event(pe.DropdownModule.events.CLOSED)},pe.DropdownModule.prototype.collapse_dropdown=function(){this.dropdown_div.hide(),this.title_div.html(this.title_string_function(this.current_selection)),this.title_div.addClass(this.current_selection&&0<this.current_selection.length?"ClosedWithSelection":"Closed"),this.title_container_div.addClass(this.current_selection&&0<this.current_selection.length?"ClosedWithSelection":"Closed"),this.title_div.removeClass("Opened"),this.title_container_div.removeClass("Opened"),this.fire_event(pe.DropdownModule.events.MINIMIZED)},pe.DropdownModule.prototype.container_focusout=function(){this.auto_collapse<0||setTimeout(this.callback(function(){0<=this.auto_collapse&&!this.prevent_next_collapse_flag&&this.collapse_dropdown(),this.prevent_next_collapse_flag=!1}),200)},pe.DropdownModule.prototype.content_scrolling=function(){this.disable_auto_collapse(0),this.scroll_timeout&&clearTimeout(this.scroll_timeout),this.scroll_timeout=setTimeout(this.callback(function(){this.enable_auto_collapse(),this.container.focus()}),300)},pe.DropdownModule.prototype.disable_auto_collapse=function(e){this.auto_collapse-=1,e&&setTimeout(this.callback(function(){this.enable_auto_collapse()}),e)},pe.DropdownModule.prototype.enable_auto_collapse=function(){this.auto_collapse+=1,0<this.auto_collapse&&(this.auto_collapse=0)},pe.DropdownModule.prototype.expand_dropdown=function(){this.dropdown_html_function&&this.set_choices_content(this.dropdown_html_function()),this.dropdown_div.show(),this.title_div.html(this.title_string_function("selecting")),this.title_div.removeClass("Closed ClosedWithSelection"),this.title_container_div.removeClass("Closed ClosedWithSelection"),this.title_div.addClass("Opened"),this.title_container_div.addClass("Opened"),this.fire_event(pe.DropdownModule.events.OPENED)},pe.DropdownModule.prototype.html=function(e,t){return'<div class="TitleContainer Closed"><div class="Title select Closed"></div>'+(e?'<div class="CloseButton close_btn fake_link"></div>':"")+'<input type="hidden" class="DropdownInput" name="'+t+'" ></div><div class="Dropdown dropdown"><div class="choices_wrapper"><div class="Choices choices"></div></div><div class="footer_bottom"><div class="footer_right"></div></div></div>'},pe.DropdownModule.prototype.is_expanded=function(){return this.dropdown_div.is(":visible")},pe.DropdownModule.prototype.prevent_next_collapse=function(){this.prevent_next_collapse_flag=!0},pe.DropdownModule.prototype.reset_dropdown=function(e){this.title_div.html(this.title_string_function(e)),this.dropdown_input_field.val("")},pe.DropdownModule.prototype.set_choices_content=function(e){this.choices_div.html(e),this.choices_div.find(".Choice").click(this.callback(this.choice_clicked)),this.choices_div.scroll(this.callback(this.content_scrolling))},pe.DropdownModule.prototype.set_default_selection=function(e){this.current_selection=pe.load(this.dropdown_div.find(e)),this.title_div.html(this.title_string_function(this.current_selection))},pe.DropdownModule.prototype.set_error_as_title=function(){this.title_div.html(this.title_string_function("error"))},pe.DropdownModule.prototype.set_input_field_value=function(e){this.dropdown_input_field.val(e)},pe.DropdownModule.prototype.title_clicked=function(){this.is_expanded()?this.collapse_dropdown():(this.disable_auto_collapse(500),this.expand_dropdown())},pe.DropdownModule.prototype.val=function(e){if(!e)return this.current_selection;this.current_selection="string"==typeof e?this.dropdown_div.find(e):e,this.title_div.html(this.title_string_function(this.current_selection))},pe.VideoStatusSelect=function(e){pe.init_widget(this,e),this.video_id=pe.load(this.container.attr("data_video_id")),this.dropdown_module=new pe.DropdownModule(e,this.dropdown_html(),this.callback(this.title_html),!1),this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.dropdown_changed));var t=this.container.attr("data_default_value");t&&this.dropdown_module.set_default_selection(".Choice[data='"+t+"']")},pe.VideoStatusSelect.events={CHANGED:"VideoStatusSelect_CHANGED"},pe.VideoStatusSelect.prototype.dropdown_html=function(){return'<div class="Choice choice" data="live">live</div><div class="Choice choice" data="disabled">disabled</div>'},pe.VideoStatusSelect.prototype.dropdown_changed=function(e,t){$.ajax({url:"/admin/videos/"+this.video_id+".json",type:"PUT",data:{status:this.result_value(t)}})},pe.VideoStatusSelect.prototype.title_html=function(e){return e?"selecting"===e?"Click your choice!":e.html():"video status"},pe.VideoStatusSelect.prototype.result_value=function(e){if(!e)return"";var t=$(e).attr("data");return"string"==typeof t?t:""},pe.VideoStatusSelect.prototype.val=function(e){if(!e)return this.result_value(this.dropdown_module.val());var t=pe.load(this.container.find('.Choice[data="'+e+'"]'));this.dropdown_module.val(t)},$(document).ready(function(){new pe.CommentsSection($(".CommentsContainer"),window.videoable_path),$(".CurrentVideos li").each(function(e,t){new pe.ExistingVideo($(t))}),pe.search_query_input=$(".SearchQuery"),pe.search_query_input.keyup(pe.search_query_keyup),pe.search_results_div=$(".SearchResults"),pe.search_button=$(".SearchButton"),pe.search_button.click(pe.search),pe.found_channels_div=$(".FoundChannels"),pe.current_channels_div=$(".CurrentChannels"),pe.current_channels_div.click(pe.unsubscribe_clicked),pe.current_videos_div=$(".CurrentVideos"),pe.make_sortable(),pe.init_page_framework()}),pe.make_sortable=function(){$(".CurrentVideos, .SearchResults").sortable({connectWith:".ConnectedSortable",placeholder:"placeholder",forcePlaceholderSize:!0})},pe.search=function(){pe.search_button.hide();var e=pe.search_query_input.val();e?$.ajax({data:{query:e,sort:$("input[name=search_sort]:checked").val()},dataType:"json",url:window.videoable_path+"/videos/search_youtube",type:"GET",success:pe.search_success}):alert("Please enter a search query")},pe.search_query_keyup=function(e){13===e.keyCode&&pe.search()},pe.search_success=function(e){pe.search_button.show(),pe.search_results_div.html(e.videos),pe.make_sortable(),pe.search_results_div.find("img").click(pe.video_image_clicked),pe.found_channels_div.html(e.channels),pe.found_channels_div.find(".Subscribe").click(pe.subscribe_button_clicked)},pe.subscribe_button_clicked=function(e){var t=$(e.target).closest(".YoutubeChannel").attr("data_youtube_id");$.ajax({data:{channel_id:t},dataType:"json",url:window.videoable_path+"/youtube_channels/subscribe.json",type:"POST",success:pe.subscribe_success})},pe.subscribe_success=function(e){pe.current_channels_div.html(e.current_channels),pe.current_videos_div.html(e.current_videos),pe.found_channels_div.html(""),pe.search_results_div.html("")},pe.unsubscribe_clicked=function(e){var t=$(e.target).closest(".Channel").attr("data_youtube_id");$.ajax({data:{id:t},dataType:"json",url:window.videoable_path+"/youtube_channels/unsubscribe",type:"POST",success:pe.unsubscribe_success})},pe.unsubscribe_success=function(e){pe.current_channels_div.html(e.current_channels)},pe.video_image_clicked=function(e){var t=$(e.target).closest("li"),n=t.find(".YoutubeId").val();t.find(".Image").html('<iframe title="YouTube video player" width="560" height="349" src="http://www.youtube.com/embed/'+n+'?autoplay=1" frameborder="0" allowfullscreen></iframe>')};