!function($){$.fn.editable=function(e,t){if("disable"!=e)if("enable"!=e){if("destroy"!=e){var l=$.extend({},$.fn.editable.defaults,{target:e},t),d=$.editable.types[l.type].plugin||function(){},u=$.editable.types[l.type].submit||function(){},c=$.editable.types[l.type].buttons||$.editable.types.defaults.buttons,_=$.editable.types[l.type].content||$.editable.types.defaults.content,h=$.editable.types[l.type].element||$.editable.types.defaults.element,m=$.editable.types[l.type].reset||$.editable.types.defaults.reset,f=l.callback||function(){},v=l.onedit||function(){},b=l.onsubmit||function(){},i=l.onreset||function(){},y=l.onerror||m;return l.tooltip&&$(this).attr("title",l.tooltip),l.autowidth="auto"==l.width,l.autoheight="auto"==l.height,this.each(function(){var o=this,s=$(o).width(),p=$(o).height();$(this).data("event.editable",l.event),$.trim($(this).html())||$(this).html(l.placeholder),$(this).bind(l.event,function(e){if(!0!==$(this).data("disabled.editable")&&!o.editing&&!1!==v.apply(this,[l,o])){e.preventDefault(),e.stopPropagation(),l.tooltip&&$(o).removeAttr("title"),0==$(o).width()?(l.width=s,l.height=p):("none"!=l.width&&(l.width=l.autowidth?$(o).width():l.width),"none"!=l.height&&(l.height=l.autoheight?$(o).height():l.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==l.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),o.editing=!0,o.revert=$(o).html(),$(o).html("");var a=$("<form />");l.cssclass&&("inherit"==l.cssclass?a.attr("class",$(o).attr("class")):a.attr("class",l.cssclass)),l.style&&("inherit"==l.style?(a.attr("style",$(o).attr("style")),a.css("display",$(o).css("display"))):a.attr("style",l.style));var t,r=h.apply(a,[l,o]);if(l.loadurl){var n=setTimeout(function(){r.disabled=!0,_.apply(a,[l.loadtext,l,o])},100),i={};i[l.id]=o.id,$.isFunction(l.loaddata)?$.extend(i,l.loaddata.apply(o,[o.revert,l])):$.extend(i,l.loaddata),$.ajax({type:l.loadtype,url:l.loadurl,data:i,async:!1,success:function(e){window.clearTimeout(n),t=e,r.disabled=!1}})}else l.data?(t=l.data,$.isFunction(l.data)&&(t=l.data.apply(o,[o.revert,l]))):t=o.revert;_.apply(a,[t,l,o]),r.attr("name",l.name),c.apply(a,[l,o]),$(o).append(a),d.apply(a,[l,o]),$(":input:visible:enabled:first",a).focus(),l.select&&r.select(),r.keydown(function(e){27==e.keyCode&&(e.preventDefault(),m.apply(a,[l,o]))}),"cancel"==l.onblur?r.blur(function(){n=setTimeout(function(){m.apply(a,[l,o])},500)}):"submit"==l.onblur?r.blur(function(){n=setTimeout(function(){a.submit()},200)}):$.isFunction(l.onblur)?r.blur(function(){l.onblur.apply(o,[r.val(),l])}):r.blur(function(){}),a.submit(function(e){if(n&&clearTimeout(n),e.preventDefault(),!1!==b.apply(a,[l,o])&&!1!==u.apply(a,[l,o]))if($.isFunction(l.target)){var t=l.target.apply(o,[r.val(),l]);$(o).html(t),o.editing=!1,f.apply(o,[o.innerHTML,l]),$.trim($(o).html())||$(o).html(l.placeholder)}else{var i={};i[l.name]=r.val(),i[l.id]=o.id,$.isFunction(l.submitdata)?$.extend(i,l.submitdata.apply(o,[o.revert,l])):$.extend(i,l.submitdata),"PUT"==l.method&&(i._method="put"),$(o).html(l.indicator);var s={type:"POST",data:i,dataType:"html",url:l.target,success:function(e){"html"==s.dataType&&$(o).html(e),o.editing=!1,f.apply(o,[e,l]),$.trim($(o).html())||$(o).html(l.placeholder)},error:function(e){y.apply(a,[l,o,e])}};$.extend(s,l.ajaxoptions),$.ajax(s)}return $(o).attr("title",l.tooltip),!1})}}),this.reset=function(e){this.editing&&!1!==i.apply(e,[l,o])&&($(o).html(o.revert),o.editing=!1,$.trim($(o).html())||$(o).html(l.placeholder),l.tooltip&&$(o).attr("title",l.tooltip))}})}$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable")}else $(this).data("disabled.editable",!1);else $(this).data("disabled.editable",!0)},$.editable={types:{defaults:{element:function(){var e=$('<input type="hidden"></input>');return $(this).append(e),e},content:function(e){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(t,i){var s=this;if(t.submit){if(t.submit.match(/>$/))var e=$(t.submit).click(function(){"submit"!=e.attr("type")&&s.submit()});else(e=$('<button type="submit" />')).html(t.submit);$(this).append(e)}if(t.cancel){if(t.cancel.match(/>$/))var a=$(t.cancel);else(a=$('<button type="cancel" />')).html(t.cancel);$(this).append(a),$(a).click(function(){if($.isFunction($.editable.types[t.type].reset))var e=$.editable.types[t.type].reset;else e=$.editable.types.defaults.reset;return e.apply(s,[t,i]),!1})}}},text:{element:function(e){var t=$("<input />");return"none"!=e.width&&t.width(e.width),"none"!=e.height&&t.height(e.height),t.attr("autocomplete","off"),$(this).append(t),t}},textarea:{element:function(e){var t=$("<textarea />");return e.rows?t.attr("rows",e.rows):"none"!=e.height&&t.height(e.height),e.cols?t.attr("cols",e.cols):"none"!=e.width&&t.width(e.width),$(this).append(t),t}},select:{element:function(){var e=$("<select />");return $(this).append(e),e},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){$(this).val()!=json.selected&&$(this).text()!=$.trim(original.revert)||$(this).attr("selected","selected")})}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery),function(){pe.EditableField=function(){function e(e,t){this.container=e,this.options=t,this.field=this.options.field,this.allow_empty_value=!!this.options.allow_empty_value,this.current_url_params=pe.routes.current_url_params(),this.container.click(this.on_container_clicked),this.options.jeditable.data=function(e){return e.replace(/<br[\s\/]?>/gi,"\n").replace(/&amp;/,"&")},this.options.jeditable.select=!1,this.container.editable(this.on_value_changed,this.options.jeditable),this.on_submit=this.options.submit||function(){}}return e.prototype.on_container_clicked=function(e){var t,i;if(0<(i=$(e.currentTarget).find("textarea")).length)return t=(t=(t=(t=i.val()).replace(/\n\s+/g,"\n")).replace(/<br>/g,"\n")).replace(/&amp;/,"&"),i.val(t)},e.prototype.is_valid_value=function(e){return this.allow_empty_value||!(_.isEmpty(e.replace(/\s+/g,""))||this.options.jeditable.placeholder===e)},e.prototype.is_valid=function(){return this.is_valid_value(this.container.html())},e}()}.call(this),pe.routes.map={search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",boxoffice:"/users/{{user_id}}/dashboard/{{id}}/boxoffice",boxoffice_check_ticket_number:"/users/{{user_id}}/dashboard/{{id}}/boxoffice/{{ticket_number}}/check",user_dashboard_detail:"/users/{{user_id}}/dashboard/{{id}}",user_dashboard_details:"/users/{{user_id}}/dashboard",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_purchase_form:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase_form",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",api_ticket_order_status:"/api/ticket_orders/{{id}}/status",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"},pe.routes.build_path=function(e,t){var i=pe.routes.map[e],s=i.match(/\{\{\*(.+)\}\}/);return _.each(s,function(e){t[e]&&(t[e]=t[e].join("/"))}),i=i.replace(/\*/,""),t=t||{},pe.routes.clean_url(pe.templatize(i,t))},pe.routes.clean_url=function(e){return("/"+e).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")},pe.routes.current_url_params=function(){var e=pe.routes.recognize_path(window.location.pathname);return e?e.params:{}},pe.routes.recognize_path=function(t){var i,s;t=pe.routes.clean_url(t);var e=_.find(_.keys(pe.routes.map),function(e){return i=pe.routes.map[e],(s=new RegExp(i.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"))).test(t)});if(e){for(var a=_.map(i.match(/\{\{[^\}]+\}\}/g),function(e){return e.replace(/\{|\}/g,"")}),r=t.match(s).slice(1,99),n={params:{}},o=function(e){return!_.isEmpty(e)},p=0;p<a.length;p++)"*"==a[p][0]&&(a[p]=a[p].replace(/\*/g,""),r[p]=_.select(r[p].replace(/\*/g,"").split("/"),o)),n.params[a[p]]=r[p];return n.path_info={name:e,template:i},n}return!1},pe.routes.Request=function(e,t,i){pe.routes.map[e]?(this.path=e,"object"!=typeof t&&(t={id:t}),this.params=t,this.callback=i):alert("This path is not registered in the routes map.")},pe.routes.Request.factory=function(e,t,i){return new pe.routes.Request(e,t,i)},pe.routes.Request.from_current_location=function(e,t,i){t=t||{};var s=pe.routes.current_url_params();return new pe.routes.Request(e,_.extend(s,t),i)},pe.routes.Request.prototype.ajax=function(e,t){var i="function"==typeof t?t:this.callback;$.ajax({url:this.build_path(),data:this.params,type:e,success:i})},pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)},pe.routes.Request.prototype.get=function(e){this.ajax("GET",e)},pe.routes.Request.prototype.post=function(e){this.ajax("POST",e)},function(){var i=function(e,t){return function(){return e.apply(t,arguments)}},s=function(e,t){function i(){this.constructor=e}for(var s in t)a.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},a={}.hasOwnProperty;pe.EditableListField=function(e){function t(){return this.on_value_submitted=i(this.on_value_submitted,this),this.on_value_changed=i(this.on_value_changed,this),t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.on_value_changed=function(e){var t;return e=(e=e.replace(/\n\s+/,"\n")).replace(/&amp;/,"&"),this.is_valid_value(e)&&((t={user_list:{},_method:"put"}).user_list[this.field]=e,pe.routes.Request.from_current_location("api_user_list",t).post(this.on_value_submitted)),this.on_submit(),e.replace(/\n/g,"<br>").replace(/&amp;/,"&")},t.prototype.on_value_submitted=function(e){var t;if(t=e.instance.url_param,this.current_url_params.id!==t)return window.location=pe.routes.build_path("user_list",{user_id:this.current_url_params.user_id,id:t})},t}(pe.EditableField)}.call(this);