pe.GeocodeErrorDialog=function(a){pe.init_widget(this,null);this.container=$(this.html(a));this.container.appendTo("body");this.container.dialog({title:"Geo system error",modal:!0,resizable:!1,width:300,buttons:{Ok:function(){$(this).remove()}}})};pe.GeocodeErrorDialog.prototype.html=function(a){return"<div>The geocoder returned the error '"+a+"'. Please try again later.</div>"};
pe.GeocodeNoResultsDialog=function(){pe.init_widget(this,null);this.container=$(this.html());this.container.appendTo("body");this.container.dialog({title:"We were unable to find the address you entered.",modal:!0,resizable:!1,width:300,buttons:{Ok:function(){$(this).remove()}}})};pe.GeocodeNoResultsDialog.prototype.html=function(){return"<div>Please try again.</div>"};
pe.MultipleLocationResultsDialog=function(a,b){pe.init_widget(this,null);this.success_callback=b;this.results=a;this.dialog_div=$(this.html(a));this.dialog_div.appendTo("body");this.dialog_div.click(this.callback(this.result_clicked));this.dialog_div.dialog({width:350,modal:!0,title:'The search returned <span class="blue_text">'+this.results.length+" results</span>. Please click on your choice.",resizable:!1,buttons:{Cancel:function(){$(this).remove()}}})};
pe.MultipleLocationResultsDialog.prototype.html=function(a){var b='<div class="ContentContainer">';$.each(a,function(a,e){b+='<div class="Choice" data_position="'+a+'">'+e.formatted_address+"</div>"});return b+="</div>"};pe.MultipleLocationResultsDialog.prototype.result_clicked=function(a){a=$(a.target).closest(".Choice").attr("data_position");this.dialog_div.remove();this.success_callback(this.results[a])};
pe.LocationInput=function(a,b){pe.init_widget(this,a);this.container.html(this.dom());this.show_location_input_link=this.container.find(".LocationInputLink");this.show_location_input_link.click(this.callback(this.show_location_input_link_clicked));this.location_input_field_div=this.container.find(".InfieldLabel");this.location_input_field_div.hide();this.input_text=this.container.find(".Input");this.input_text.keyup(this.callback(this.input_text_keyup));this.go_button=this.container.find(".Go");this.go_button.click(this.callback(this.go_button_clicked));
this.map=pe.load(b)};pe.LocationInput.prototype.dom=function(){return'<div class="LocationInputLink arrow_link"><span class="blue_link fake_link">or Enter an address</span></div><div class="InfieldLabel"><div class="input float_left"><input type="text" class="Input" id="LocationInputField"></div><label for="LocationInputField">or Enter an address</label><input type="button" class="Go btn go_btn float_left" value="Go"><div class="clear"></div></div>'};
pe.LocationInput.prototype.go_button_clicked=function(){var a=this.input_text.val();if(a&&""!==a){var b=new google.maps.Geocoder,c=this.map.map.getBounds();b.geocode({address:a,bounds:c},this.callback(this.geocode_success))}};pe.LocationInput.prototype.geocode_success=function(a,b){b===google.maps.GeocoderStatus.ZERO_RESULTS?new pe.GeocodeNoResultsDialog:b!==google.maps.GeocoderStatus.OK?new pe.GeocodeErrorDialog(b):1===a.length?this.set_map_location(a[0]):new pe.MultipleLocationResultsDialog(a,this.callback(this.set_map_location))};
pe.LocationInput.prototype.input_text_keyup=function(a){13===a.keyCode&&this.go_button_clicked()};pe.LocationInput.prototype.read_search_configuration=function(a){if(a=a.get_filter("user_locations")){var b=new google.maps.Geocoder,c=this.map.map.getBounds();$.each(a,this.callback(function(a,d){b.geocode({address:d,bounds:c},this.callback(this.geocode_success))}));this.show_location_input_link_clicked();this.input_text.val(a[a.length-1])}};
pe.LocationInput.prototype.show_location_input_link_clicked=function(){this.show_location_input_link.hide(1);this.location_input_field_div.show(1);this.container.find(".InfieldLabel label").inFieldLabels();this.input_text.focus()};
pe.LocationInput.prototype.set_map_location=function(a){var b=pe.map_tools.get_city_name_from_google_address_lookup_result(a),c=null;$.each(pe.ajax_loader.cities.find(pe.cities_timestamp()),function(a,d){if(d.name===b)return c=d.id,!1});c&&c!==pe.filter_city_neighborhood.current_city_id&&(pe.filter_city_neighborhood.set_city(c),pe.map.set_cities([]));this.map.map.fitBounds(a.geometry.viewport);this.map.switch_to_local_view(null);this.map.add_marker({type:pe.Map.marker_types.USER_LOCATION,latitude:a.geometry.location.lat(),
longitude:a.geometry.location.lng(),icon:pe.map_tools.marker_icon(pe.Map.marker_types.USER_LOCATION,null),bubble_html:'<div class="bubble_text"><span class="bubble_headline">Your location: </span><br><span class="bubble_type">'+a.formatted_address+"</span></div>",popup_html:'<div class="user_location_popup"><div class="location_title headline float_left">Your location:</div><div class="clear"></div><div class="address">'+this.map.popup_template_user_location(a.formatted_address)+"</div></div>"});
pe.search()};
