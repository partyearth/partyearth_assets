pe.CloseButton=function(b,c){pe.init_widget(this,b);this.close_button=b.find(".CloseButton");if("function"===typeof c)this.close_button.click(c);else switch(c){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}};pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"};
pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"};pe.CloseButton.prototype.remove_container=function(){this.container.detach();this.fire_event(pe.CloseButton.events.CLOSED);this.container.remove();return!1};pe.CloseButton.prototype.hide_container=function(){this.fire_event(pe.CloseButton.events.CLOSED);this.container.hide();return!1};
pe.GeneralAutocompleteInputModule=function(b,c,a,d){pe.init_widget(this,b);this.autocomplete_data_or_url=c;this.input_field_name=a;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.autocomplete_input_field=this.container.find(".AutocompleteField");this.autocomplete_handler();this.selected_data_list_div=this.container.find(".SelectedDataList");this.selected_data_list_div.sortable();d&&this.add_data_to_list(d)};
pe.GeneralAutocompleteInputModule.events={SELECTED:"GeneralAutocompleteInputModule_SELECTED",REMOVED:"GeneralAutocompleteInputModule_REMOVED",EMPTIED:"GeneralAutocompleteInputMOdule_EMPTIED"};pe.GeneralAutocompleteInputModule.prototype.add_data_to_list=function(b){this.remove_dummy_row();$.each(b,this.callback(function(b,a){-1===$.inArray(a.id.toString(),this.all_values())&&this.autocomplete_data_selected(a.label,a.id,a.category)}))};
pe.GeneralAutocompleteInputModule.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))};pe.GeneralAutocompleteInputModule.prototype.all_values=function(){return this.selected_data_list_div.find('[name="'+this.input_field_name+'"]').map(function(){return this.value}).toArray()};
pe.GeneralAutocompleteInputModule.prototype.autocomplete_data_selected=function(b,c,a){this.remove_dummy_row();this.selected_data_list_div.append(this.selected_data_html(b,c,a));(new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked))};
pe.GeneralAutocompleteInputModule.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:"string"==typeof this.autocomplete_data_or_url?this.callback(function(b,c){$.getJSON(this.autocomplete_data_or_url,{term:this.autocomplete_input_field.val(),val:this.all_values().join(",")},c)}):this.autocomplete_data_or_url,minLength:1,close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(b,c){var a=c.item;this.autocomplete_data_selected(a.label,
a.id,a.category);this.fire_event(pe.GeneralAutocompleteInputModule.events.SELECTED,a.id)})}).data("autocomplete")._renderItem=function(b,c){c.display_label=c.category?pe.templatize("{{label}} ({{category}})",c):c.label;return $("<li></li>").data("item.autocomplete",c).append(pe.templatize("<a>{{display_label}}</a>",c)).appendTo(b)}};pe.GeneralAutocompleteInputModule.prototype.clear_selected_data=function(){this.selected_data_list_div.html("");this.add_dummy_row()};
pe.GeneralAutocompleteInputModule.prototype.close_button_clicked=function(){this.is_empty()&&this.add_dummy_row();this.fire_event(pe.GeneralAutocompleteInputModule.events.REMOVED);this.is_empty()&&this.fire_event(pe.GeneralAutocompleteInputModule.events.EMPTIED)};pe.GeneralAutocompleteInputModule.prototype.display_close_button=function(){this.selected_data_list_div.find(".CloseButton").show()};pe.GeneralAutocompleteInputModule.prototype.hide_close_button=function(){this.selected_data_list_div.find(".CloseButton").hide()};
pe.GeneralAutocompleteInputModule.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><ul class="SelectedDataList" id="sortable"></ul>'};pe.GeneralAutocompleteInputModule.prototype.is_empty=function(){return 0===this.selected_data_list_div.find(".SelectedInputData").length};
pe.GeneralAutocompleteInputModule.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};pe.GeneralAutocompleteInputModule.prototype.replace_data_in_list=function(b){b&&(this.clear_selected_data(),this.add_data_to_list(b))};
pe.GeneralAutocompleteInputModule.prototype.selected_data_html=function(b,c,a){return'<li class="SelectedInputData">  <img style="padding-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"\t\tclass="CloseButton float_left">  <p class="float_left">'+(a?b+"("+a+")":b)+'</p>  <input type="hidden" value="'+c+'" name="'+this.input_field_name+'">  <div class="clear"></div></li>'};
pe.Floater=function(b,c,a){pe.init_widget(this,b);this.bottom_margin=a||0;this.start_point_div=b.find(".FloatingAreaStart");this.end_point_div=c||null;this.stop_at=this.start_from=0;this.sticked=this.is_floating=!1;this.floater=this.container.find(".Floater");this.offset=0;this.disabled=!1;this.top=parseInt(this.floater.css("margin-top"),10)||0;$(window).scroll(this.callback(this.scrolling));this.set_floating_area();pe.Floater.register_floater(this)};
pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"};pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top;this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)};
pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var b=$(window).scrollTop(),c=b+this.offset+this.bottom_margin<=this.start_from,a=b+this.offset+this.bottom_margin>this.start_from,d=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;!this.is_floating&&a&&!d&&!this.sticked?(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this)):this.is_floating&&c?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,
this)):this.end_point_div&&(!this.sticked&&d?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&b+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick())}};pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed");this.floater.removeClass("bottom");this.is_floating=!0;this.sticked=!1;this.set_offset()};
pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.sticked=!0};pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.disabled=this.sticked=!0};
pe.Floater.prototype.enable=function(){this.disabled=!1};pe.Floater.prototype.unstick=function(){this.floater.css("margin-top","");this.floater.css("top","");this.floater.css("position","");this.start_floating();this.fire_event(pe.Floater.events.FLOATING,this)};pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top","");this.floater.removeClass("fixed");this.floater.removeClass("bottom");this.sticked=this.is_floating=!1;this.set_offset()};
pe.Floater.prototype.set_offset=function(b){b&&(this.offset=b);0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")};pe.Floater.registered_floaters=[];pe.Floater.register_floater=function(b){pe.Floater.registered_floaters.push(b);pe.Floater.update_positions()};
pe.Floater.update_positions=function(){pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(a){return a.container.offset().top},null);if(pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var b=1;b<pe.Floater.registered_floaters.length;b++){var c=pe.Floater.registered_floaters[b-1].offset+pe.Floater.registered_floaters[b-1].floater.outerHeight();pe.Floater.registered_floaters[b].offset=c;pe.Floater.registered_floaters[b].is_floating&&
pe.Floater.registered_floaters[b].start_floating();pe.Floater.registered_floaters[b].set_floating_area()}};
pe.SingleSelectionAutocompleteField=function(b,c,a,d){pe.init_widget(this,b);this.close_button_callback=this.on_item_selected=null;this.autocomplete_data_or_url=c;this.input_field_name=a;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.autocomplete_input_field=this.container.find(".AutocompleteField");this.autocomplete_handler();this.selected_data_container=this.container.find(".SelectedValue");d&&this.set_field_value(d)};
pe.SingleSelectionAutocompleteField.events={SELECTED:"SingleSelectionAutocompleteField_SELECTED"};pe.SingleSelectionAutocompleteField.prototype.set_autocomplete_url=function(b){b&&(this.autocomplete_data_or_url=b,this.autocomplete_handler())};pe.SingleSelectionAutocompleteField.prototype.set_field_value=function(b){b&&0!==b.length&&(this.remove_dummy_row(),this.autocomplete_data_selected(b))};
pe.SingleSelectionAutocompleteField.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))};
pe.SingleSelectionAutocompleteField.prototype.autocomplete_data_selected=function(b){this.selected_data=b;this.remove_dummy_row();this.selected_data_container.append(this.selected_data_html(b.label,b.id,b.category));(new pe.CloseButton(this.selected_data_container.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));if(this.on_item_selected)this.on_item_selected(b)};
pe.SingleSelectionAutocompleteField.prototype.item_selected=function(b){this.on_item_selected=b};
pe.SingleSelectionAutocompleteField.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:this.autocomplete_data_or_url,minLength:1,focus:function(){return!1},close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(b,c){var a=c.item;this.autocomplete_data_selected(a);this.fire_event(pe.SingleSelectionAutocompleteField.events.SELECTED,a.id)})}).data("autocomplete")._renderItem=function(b,c){c.display_label=c.category?
pe.templatize("{{label}} ({{category}})",c):c.label;return $("<li></li>").data("item.autocomplete",c).append(pe.templatize("<a>{{display_label}}</a>",c)).appendTo(b)}};pe.SingleSelectionAutocompleteField.prototype.clear_selected_data=function(){this.selected_data_container.html("");this.add_dummy_row()};
pe.SingleSelectionAutocompleteField.prototype.close_button_clicked=function(){0===this.selected_data_container.find(".SelectedInputData").length&&this.add_dummy_row();this.close_button_callback&&this.close_button_callback();this.autocomplete_input_field.show();this.autocomplete_input_field.focus()};pe.SingleSelectionAutocompleteField.prototype.display_close_button=function(){this.selected_data_container.find(".CloseButton").show()};pe.SingleSelectionAutocompleteField.prototype.hide_close_button=function(){this.selected_data_container.find(".CloseButton").hide()};
pe.SingleSelectionAutocompleteField.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><div class="SelectedValue"></div>'};pe.SingleSelectionAutocompleteField.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};
pe.SingleSelectionAutocompleteField.prototype.replace_data_in_list=function(b){this.clear_selected_data();this.set_field_value(b)};pe.SingleSelectionAutocompleteField.prototype.selected_data_html=function(b,c,a){return'<div class="SelectedInputData selected_data">  <div class="CloseButton close_button">'+(a?b+"("+a+")":b)+'</div>  <input type="hidden" value="'+c+'" name="'+this.input_field_name+'"></div>'};
(function(b){var c;b.rails=c={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",
fileInputSelector:"input:file",CSRFProtection:function(a){var c=b('meta[name="csrf-token"]').attr("content");c&&a.setRequestHeader("X-CSRF-Token",c)},fire:function(a,c,e){c=b.Event(c);a.trigger(c,e);return!1!==c.result},confirm:function(a){return confirm(a)},ajax:function(a){return b.ajax(a)},handleRemote:function(a){var d,e,f,g=a.data("type")||b.ajaxSettings&&b.ajaxSettings.dataType;if(c.fire(a,"ajax:before")){if(a.is("form")){d=a.attr("method");e=a.attr("action");f=a.serializeArray();var h=a.data("ujs:submit-button");
h&&(f.push(h),a.data("ujs:submit-button",null))}else d=a.data("method"),e=a.attr("href"),f=null;c.ajax({url:e,type:d||"GET",data:f,dataType:g,beforeSend:function(b,d){void 0===d.dataType&&b.setRequestHeader("accept","*/*;q=0.5, "+d.accepts.script);return c.fire(a,"ajax:beforeSend",[b,d])},success:function(b,c,d){a.trigger("ajax:success",[b,c,d])},complete:function(b,c){a.trigger("ajax:complete",[b,c])},error:function(b,c,d){a.trigger("ajax:error",[b,c,d])}})}},handleMethod:function(a){var c=a.attr("href"),
e=a.data("method"),a=b("meta[name=csrf-token]").attr("content"),f=b("meta[name=csrf-param]").attr("content"),c=b('<form method="post" action="'+c+'"></form>'),e='<input name="_method" value="'+e+'" type="hidden" />';void 0!==f&&void 0!==a&&(e+='<input name="'+f+'" value="'+a+'" type="hidden" />');c.hide().append(e).appendTo("body");c.submit()},disableFormElements:function(a){a.find(c.disableSelector).each(function(){var a=b(this),c=a.is("button")?"html":"val";a.data("ujs:enable-with",a[c]());a[c](a.data("disable-with"));
a.attr("disabled","disabled")})},enableFormElements:function(a){a.find(c.enableSelector).each(function(){var a=b(this),c=a.is("button")?"html":"val";if(a.data("ujs:enable-with"))a[c](a.data("ujs:enable-with"));a.removeAttr("disabled")})},allowAction:function(a){var b=a.data("confirm"),e=!1,f;if(!b)return!0;c.fire(a,"confirm")&&(e=c.confirm(b),f=c.fire(a,"confirm:complete",[e]));return e&&f},blankInputs:function(a,c,e){var f=b(),g;a.find(c||"input,textarea").each(function(){g=b(this);if(e?g.val():
!g.val())f=f.add(g)});return f.length?f:!1},nonBlankInputs:function(a,b){return c.blankInputs(a,b,!0)},stopEverything:function(a){a.stopImmediatePropagation();return!1},callFormSubmitBindings:function(a){var a=a.data("events"),c=!0;void 0!==a&&void 0!==a.submit&&b.each(a.submit,function(a,b){if("function"===typeof b.handler)return c=b.handler(b.data)});return c}};"ajaxPrefilter"in b?b.ajaxPrefilter(function(a,b,e){c.CSRFProtection(e)}):b(document).ajaxSend(function(a,b){c.CSRFProtection(b)});b(c.linkClickSelector).live("click.rails",
function(a){var d=b(this);if(!c.allowAction(d))return c.stopEverything(a);if(void 0!==d.data("remote"))return c.handleRemote(d),!1;if(d.data("method"))return c.handleMethod(d),!1});b(c.formSubmitSelector).live("submit.rails",function(a){var d=b(this),e=void 0!==d.data("remote"),f=c.blankInputs(d,c.requiredInputSelector),g=c.nonBlankInputs(d,c.fileInputSelector);if(!c.allowAction(d))return c.stopEverything(a);if(f&&c.fire(d,"ajax:aborted:required",[f]))return!e;if(e){if(g)return c.fire(d,"ajax:aborted:file",
[g]);if(!b.support.submitBubbles&&!1===c.callFormSubmitBindings(d))return c.stopEverything(a);c.handleRemote(d);return!1}setTimeout(function(){c.disableFormElements(d)},13)});b(c.formInputClickSelector).live("click.rails",function(a){var d=b(this);if(!c.allowAction(d))return c.stopEverything(a);a=(a=d.attr("name"))?{name:a,value:d.val()}:null;d.closest("form").data("ujs:submit-button",a)});b(c.formSubmitSelector).live("ajax:beforeSend.rails",function(a){this==a.target&&c.disableFormElements(b(this))});
b(c.formSubmitSelector).live("ajax:complete.rails",function(a){this==a.target&&c.enableFormElements(b(this))})})(jQuery);
$(document).ready(function(){pe.event_description_field=$("#event_description");pe.event_url_field=$("#event_url");pe.cities_autocomplete=new pe.GeneralAutocompleteInputModule($(".CitiesSelector"),"/api/cities/autocomplete.json","event[city_ids][]",window.existing_cities);pe.ajax_loader.content_tags_autocomplete.load({timestamp:pe.tags_timestamp()},function(b){pe.content_tag_autocomplete=new pe.GeneralAutocompleteInputModule($(".TagSelector"),b,"event[tag_ids][]",window.existing_tags)});pe.ajax_loader.event_type_tags.load({timestamp:pe.tags_timestamp()},
function(b){pe.event_type_autocomplete=new pe.GeneralAutocompleteInputModule($(".TypeSelector"),b,"event[tag_ids][]",window.existing_type_tags)});pe.parent_event_autocomplete=new pe.GeneralAutocompleteInputModule($(".ParentSelector"),"/api/events/parents_autocomplete.json","event[parent_id]",window.existing_parent);pe.parent_event_autocomplete.bind_event(pe.GeneralAutocompleteInputModule.events.SELECTED,pe.parent_event_selected);pe.headliners_autocomplete=new pe.GeneralAutocompleteInputModule($(".HeadlinerSelector"),
"/api/performers.json","event[ordered_headliner_ids][]",window.existing_headliners);pe.headliners_autocomplete.bind_event(pe.GeneralAutocompleteInputModule.events.SELECTED,pe.performer_selected);pe.opening_act_autocomplete=new pe.GeneralAutocompleteInputModule($(".OpeningActSelector"),"/api/performers.json","event[ordered_opening_act_ids][]",window.existing_opening_acts);pe.opening_act_autocomplete.bind_event(pe.GeneralAutocompleteInputModule.events.SELECTED,pe.performer_selected);pe.recurring_event_autocomplete=
new pe.GeneralAutocompleteInputModule($(".RecurringParentSelector"),"/api/events/recurring_parents_autocomplete.json","event[recurring_parent_id]",window.existing_recurring_parent);pe.recurring_event_autocomplete.bind_event(pe.GeneralAutocompleteInputModule.events.SELECTED,pe.recurring_event_selected);pe.recurring_event_autocomplete.bind_event(pe.GeneralAutocompleteInputModule.events.REMOVED,pe.recurring_event_removed);window.tags_editable&&(pe.endpoints_autocomplete=new pe.GeneralAutocompleteInputModule($(".EndpointsSelector"),
"/api/endpoints/events/autocomplete.json","event[ordered_endpoint_ids][]",window.endpoints),pe.recurring_event_autocomplete.is_empty()||pe.endpoints_autocomplete.hide_close_button());pe.venue_autocomplete=new pe.GeneralAutocompleteInputModule($(".VenueSelector"),"/api/venues/autocomplete.json","event[venue_ids][]",window.existing_venues);new pe.Floater($(".FloaterContainer"));pe.init_page_framework()});pe.recurring_event_emptied=function(){$("#EndpointLi").show()};
pe.endpoint_selection_removed=function(){pe.recurring_event_autocomplete.is_empty()&&pe.endpoints_autocomplete.close_button_clicked()};
pe.parent_event_selected=function(b,c){if(!c)return!0;$.ajax({url:"/api/events/parent_event_data",data:{parent_id:c},type:"GET",success:function(a){if(""===a)return!0;a.error?alert(a.error):(pe.content_tag_autocomplete.replace_data_in_list(a.content_tags),pe.cities_autocomplete.replace_data_in_list(a.cities),pe.endpoints_autocomplete.replace_data_in_list(a.endpoint),pe.event_type_autocomplete.replace_data_in_list(a.event_types),pe.venue_autocomplete.replace_data_in_list(a.venues),pe.event_url_field.val()||
pe.event_url_field.val(a.url),pe.recurring_event_autocomplete.clear_selected_data())}})};pe.performer_selected=function(b,c){if(!c)return!0;$.ajax({url:"/api/events/performer_data",data:{performer_id:c},type:"GET",success:function(a){a.error?alert(a.error):(pe.content_tag_autocomplete.add_data_to_list(a.content_tags),pe.event_type_autocomplete.add_data_to_list(a.event_types),pe.venue_autocomplete.add_data_to_list(a.venues))}})};
pe.recurring_event_selected=function(b,c){if(!c)return!0;$.ajax({url:"/api/events/recurring_parent_data",data:{id:c},type:"GET",success:function(a){if(""===a)return!0;a.error?alert(a.error):(pe.content_tag_autocomplete.replace_data_in_list(a.content_tags),pe.cities_autocomplete.replace_data_in_list(a.cities),pe.endpoints_autocomplete.replace_data_in_list(a.endpoint),pe.endpoints_autocomplete.hide_close_button(),pe.event_type_autocomplete.replace_data_in_list(a.event_types),pe.headliners_autocomplete.replace_data_in_list(a.headliners),
pe.opening_act_autocomplete.replace_data_in_list(a.opening_acts),pe.venue_autocomplete.replace_data_in_list(a.venues),pe.event_description_field.val()||pe.event_description_field.val(a.description),pe.event_url_field.val()||pe.event_url_field.val(a.url),pe.parent_event_autocomplete.clear_selected_data())}})};pe.recurring_event_removed=function(){pe.endpoints_autocomplete.display_close_button()};
