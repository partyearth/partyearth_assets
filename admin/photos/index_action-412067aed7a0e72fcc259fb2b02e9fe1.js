pe.CloseButton=function(a,b){pe.init_widget(this,a);this.close_button=a.find(".CloseButton");if("function"===typeof b)this.close_button.click(b);else switch(b){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}};pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"};
pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"};pe.CloseButton.prototype.remove_container=function(){this.container.detach();this.fire_event(pe.CloseButton.events.CLOSED);this.container.remove();return!1};pe.CloseButton.prototype.hide_container=function(){this.fire_event(pe.CloseButton.events.CLOSED);this.container.hide();return!1};
pe.SingleSelectionAutocompleteField=function(a,b,c,d){pe.init_widget(this,a);this.close_button_callback=this.on_item_selected=null;this.autocomplete_data_or_url=b;this.input_field_name=c;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.autocomplete_input_field=this.container.find(".AutocompleteField");this.autocomplete_handler();this.selected_data_container=this.container.find(".SelectedValue");d&&this.set_field_value(d)};
pe.SingleSelectionAutocompleteField.events={SELECTED:"SingleSelectionAutocompleteField_SELECTED"};pe.SingleSelectionAutocompleteField.prototype.set_autocomplete_url=function(a){a&&(this.autocomplete_data_or_url=a,this.autocomplete_handler())};pe.SingleSelectionAutocompleteField.prototype.set_field_value=function(a){a&&0!==a.length&&(this.remove_dummy_row(),this.autocomplete_data_selected(a))};
pe.SingleSelectionAutocompleteField.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))};
pe.SingleSelectionAutocompleteField.prototype.autocomplete_data_selected=function(a){this.selected_data=a;this.remove_dummy_row();this.selected_data_container.append(this.selected_data_html(a.label,a.id,a.category));(new pe.CloseButton(this.selected_data_container.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));if(this.on_item_selected)this.on_item_selected(a)};
pe.SingleSelectionAutocompleteField.prototype.item_selected=function(a){this.on_item_selected=a};
pe.SingleSelectionAutocompleteField.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:this.autocomplete_data_or_url,minLength:1,focus:function(){return!1},close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(a,b){var c=b.item;this.autocomplete_data_selected(c);this.fire_event(pe.SingleSelectionAutocompleteField.events.SELECTED,c.id)})}).data("autocomplete")._renderItem=function(a,b){b.display_label=b.category?
pe.templatize("{{label}} ({{category}})",b):b.label;return $("<li></li>").data("item.autocomplete",b).append(pe.templatize("<a>{{display_label}}</a>",b)).appendTo(a)}};pe.SingleSelectionAutocompleteField.prototype.clear_selected_data=function(){this.selected_data_container.html("");this.add_dummy_row()};
pe.SingleSelectionAutocompleteField.prototype.close_button_clicked=function(){0===this.selected_data_container.find(".SelectedInputData").length&&this.add_dummy_row();this.close_button_callback&&this.close_button_callback();this.autocomplete_input_field.show();this.autocomplete_input_field.focus()};pe.SingleSelectionAutocompleteField.prototype.display_close_button=function(){this.selected_data_container.find(".CloseButton").show()};pe.SingleSelectionAutocompleteField.prototype.hide_close_button=function(){this.selected_data_container.find(".CloseButton").hide()};
pe.SingleSelectionAutocompleteField.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_name+'" value="x_mock_single_value_x"><div class="SelectedValue"></div>'};pe.SingleSelectionAutocompleteField.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};
pe.SingleSelectionAutocompleteField.prototype.replace_data_in_list=function(a){this.clear_selected_data();this.set_field_value(a)};pe.SingleSelectionAutocompleteField.prototype.selected_data_html=function(a,b,c){return'<div class="SelectedInputData selected_data">  <div class="CloseButton close_button">'+(c?a+"("+c+")":a)+'</div>  <input type="hidden" value="'+b+'" name="'+this.input_field_name+'"></div>'};
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=pe,c=function(b){this.container=b;this.window_unloaded=a(this.window_unloaded,this);this.uncheck_all_clicked=a(this.uncheck_all_clicked,this);this.refresh_hidden_input=a(this.refresh_hidden_input,this);this.delete_link_clicked=a(this.delete_link_clicked,this);this.check_all_clicked=a(this.check_all_clicked,this);this.checkbox_clicked=a(this.checkbox_clicked,this);this.autocomplete_type_changed=a(this.autocomplete_type_changed,
this);this.copy_button_clicked=a(this.copy_button_clicked,this);this.move_button_clicked=a(this.move_button_clicked,this);this.sortable_updated=a(this.sortable_updated,this);this.counter_container=$(".CheckedCount");this.check_all_link=$(".CheckAll");this.check_all_link.click(this.check_all_clicked);this.delete_link=$(".DeleteAll");this.delete_link.click(this.delete_link_clicked);this.uncheck_all_link=$(".UncheckAll");this.uncheck_all_link.click(this.uncheck_all_clicked);b=this.load_checked();this.check_ids(b);
this.status_changer=$(".StatusChanger");this.status_changer.submit(this.status_submitted);this.autocomplete_type_selector=$("#destination_type");this.autocomplete_type_selector.change(this.autocomplete_type_changed);this.move_button=$(".Move");this.move_button.click(this.move_button_clicked);this.copy_button=$(".Copy");this.copy_button.click(this.copy_button_clicked);this.refresh_counter(this.get_checked().length);this.refresh_hidden_input();$("#sortable").sortable({update:this.sortable_updated});
this.checkboxes().click(this.checkbox_clicked);$(window).unload(this.window_unloaded);this.urls={Article:"/api/articles/autocomplete",Character:"/api/characters/autocomplete",City:"/api/events/cities",Event:"/api/events/autocomplete",Holiday:"/api/holidays/autocomplete",Neighborhood:"/api/neighborhoods/autocomplete",Performer:"/api/performers",Tag:"/api/tags",Venue:"/api/venues/autocomplete",Writer:"/api/users/writers_autocomplete"}};c.prototype.sortable_updated=function(a,b){var c,g,h;h=$(b.item);
c=this.get_checked();g=h.find("input:checked");if(0<g.length)return g.removeAttr("checked"),c=this.get_checked(),c=_.map(c,function(a){return $(a).closest("li")}),_.each(c.reverse(),function(a){return h.after($(a))}),g.attr("checked","checked")};c.prototype.bulk_move_copy=function(a){var b,c,g;g=this.extract_ids(this.get_checked());b=$("input[name=imageable_id]").val();c=this.autocomplete_type_selector.val();this.save_checked(this.extract_ids(this.get_checked()));if(confirm("Are you sure?"))return this.notify_users(),
$.post(a,{ids:g,dst_id:b,dst_type:c},function(){return window.location.reload()})};c.prototype.move_button_clicked=function(){return this.bulk_move_copy(window.location.pathname+"/bulk_move")};c.prototype.copy_button_clicked=function(){return this.bulk_move_copy(window.location.pathname+"/bulk_copy")};c.prototype.autocomplete_type_changed=function(){var a;a=this.urls[this.autocomplete_type_selector.val()];return this.autocomplete=new pe.SingleSelectionAutocompleteField($(".DestinationAutocomplete"),
a,"imageable_id",[])};c.prototype.checkbox_clicked=function(a){var b,c,g;b=this.checkboxes().index(a.target);if(a.shiftKey&&this.last_checked)for(a=c=g=this.last_checked;g<=b?c<=b:c>=b;a=g<=b?++c:--c)this.check(this.checkboxes()[a]);this.last_checked=b;this.refresh_counter();return this.refresh_hidden_input()};c.prototype.check_all_clicked=function(){var a,b,c,g;g=this.checkboxes();b=0;for(c=g.length;b<c;b++)a=g[b],this.check(a);this.refresh_counter();return this.refresh_hidden_input()};c.prototype.check_ids=
function(a){var b,c,g,h;h=[];c=0;for(g=a.length;c<g;c++)b=a[c],h.push(this.check("#"+b+"_bulk_photo_checkbox"));return h};c.prototype.check=function(a){return $(a).attr("checked","checked")};c.prototype.delete_link_clicked=function(){var a;a=this.extract_ids(this.get_checked());if(confirm("Are you sure?"))return this.notify_users(),$.post("photos/bulk_delete",{ids:a},function(){return window.location.reload()})};c.prototype.extract_ids=function(a){return _.map(a,function(a){return $(a).data("id")})};
c.prototype.checkboxes=function(){return this.container.find(".BulkCheckbox")};c.prototype.get_checked=function(){return this.checkboxes().filter(":checked")};c.prototype.load_checked=function(){return JSON.parse(localStorage.getItem("pe_bulk_photos_ids"))||[]};c.prototype.notify_users=function(){return $("body").html("<h1>Please wait...</h1>")};c.prototype.refresh_counter=function(){return this.counter_container.html("Photos selected("+this.get_checked().length+")")};c.prototype.refresh_hidden_input=
function(){return $("#checked_photo_ids").val(this.extract_ids(this.get_checked()))};c.prototype.save_checked=function(a){return localStorage.setItem("pe_bulk_photos_ids",JSON.stringify(a))};c.prototype.status_submitted=function(){var a;a=$('input[name="imageable[ordered_photo_ids][]"]').map(function(){return $(this).val()}).get().join(",");return $("#ordered_photo_ids").val(a)};c.prototype.uncheck_all_clicked=function(){this.checkboxes().removeAttr("checked");this.refresh_counter();return this.refresh_hidden_input()};
c.prototype.window_unloaded=function(){return localStorage.clear()};b.BulkPhotoTool=c}).call(this);
pe.accentMap={"&":"and","\u00e0":"a","\u00e1":"a","\u00e2":"a","\u00e3":"a","\u00e4":"a","\u00e5":"a","\u00e7":"c","\u00c0":"a","\u00c1":"a","\u00e8":"e","\u00e9":"e","\u00ea":"e","\u00eb":"e","\u00c8":"e","\u00c9":"e","\u00ec":"i","\u00f1":"n","\u00ed":"i","\u00ee":"i","\u00ef":"i","\u00f2":"o","\u00f3":"o","\u00f4":"o","\u00f5":"o","\u00f6":"o","\u00f9":"u","\u00fa":"u","\u00fb":"u","\u00fc":"u","!":"i",$:"s","-":""," ":"","'":"","\u2019":"",".":""};pe.ajax_error=function(){alert("The request failed. Please try again later.")};
pe.ajax_send=function(a,b){var c=$("meta[name='csrf-token']").attr("content");b.setRequestHeader("X-CSRF-Token",c)};pe.alert=function(a){alert(a)};pe.animated_scrolling=function(a,b){if(0!==a.length){var c=a.offset().top-(b||25);$("html,body").stop().animate({scrollTop:c+"px"},800,"cubicEaseInOut",function(){return!1})}};pe.scrolling=function(a,b){if(0!==a.length){var c=a.offset().top-(b||25);$("html,body").scrollTop(c)}};pe.days_of_week="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");
pe.array_contains=function(a,b){return _.isArray(b)?0===_.difference(b,a).length:-1<_.indexOf(a,b)};pe.arrays_equal=function(a,b){if(!a&&!b||!a&&0===b.length||0===a.length&&!b)return!0;if(a.length!=b.length)return!1;for(var c=a.sort(),d=b.sort(),f=0,e=a.length;f<e;f++)if(c[f]!==d[f])return!1;return!0};pe.array_match=function(a,b){var c=!1;$.each(a,function(a,f){if(-1<b.indexOf(f))return c=!0,!1});return c};pe.array_merge=function(a,b){var c=a.concat(b);c.sort();return c};
pe.array_remove=function(a,b){return!a?a:pe.is_array(b)?$.grep(a,function(a){return-1===b.indexOf(a)}):$.grep(a,function(a){return a!==b})};pe.assign_photo_size=function(a,b,c){return!a?"/assets/no_image_"+c+".png":"original"===b?a.replace("xxx.jpg",b+".jpg"):a.replace("xxx.jpg","s"+b+".jpg")};pe.remove_timestamp_from_asset_url=function(a){return a.split("?")[0]};pe.browser_is_ie8=function(){return $.browser.msie&&"8.0"===$.browser.version};
pe.build_dob_field_name=function(a,b,c){return[a||"user","[",b?b+"_":"","dob(",c,"i)]"].join("")};pe.capitalise_first_letter=function(a){return null===a?"":a.charAt(0).toUpperCase()+a.slice(1)};pe.classes_starting_with=function(a,b){return $.map(a.attr("class").split(/\s+/),function(a){if(pe.string_starts_with(a,b))return a})};pe.compare=function(a,b){return pe.is_array(a)&&pe.is_array(b)?pe.arrays_equal(a,b):a===b};
pe.convert_to_rounded_corners=function(a){a=a||$(".ConvertToRoundedCorners");a.each(function(a,c){var d=$(c);d.removeClass("ConvertToRoundedCorners");d.addClass("rounded_corner_wrapper");$('<div class="rounded_corner top_left"></div>').appendTo(d);$('<div class="rounded_corner top_right"></div>').appendTo(d);$('<div class="rounded_corner bottom_left"></div>').appendTo(d);$('<div class="rounded_corner bottom_right"></div>').appendTo(d)});return a};
pe.convert_to_tabbed_pod=function(a,b){return $.map(a,function(a){a=$(a);if(!a.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+a[0].className);var d=a.children("ul");d.addClass("tab");d.children("li").each(function(a,b){b=$(b);var c=b.html();b.html(pe.templatize('<div class="left_end pod_sprite float_left"></div>{{content}}<div class="right_end pod_sprite float_left"></div>',{content:c}))});var f=d.html();d.remove();
var d=a.html(),e=pe.classes_starting_with(a,"width");if(0===e.length)return alert("no width class found");if(1<e.length)return alert("more than 1 width class found");var g=e[0].substr(5);a.addClass("tabs");a.removeClass("ConvertToTabs");a.removeClass(e[0]);a.html(pe.templatize('<div><table class="width{{width}}" cellpadding="0" cellspacing="0"><tbody><tr><td class="header" colspan="4"><div class="header_row"><ul class="tab">{{headers}}</ul><div class="mid_section"></div><div class="right_corner pod_sprite"></div></div></td></tr><tr class="content_container"><td class="left_side pod_sides"></td><td class="content">{{content}}</td><td class="right_side pod_sides"></td></tr><tr class="footer_row"><td class="left_corner pod_sprite"></td><td class="mid_section"></td><td class="right_corner pod_sprite"></td></tr></tbody></table></div>',
{width:g,headers:f,content:d}));var f=a.children().tabs(b),h=["first","second","third","fourth"];a.find("ul.tab li").each(function(a,b){$(b).addClass(h[a])});return f})};
pe.new_convert_to_tabbed_pod=function(a,b){return $.map(a,function(a){a=$(a);if(!a.hasClass("ConvertToTabbedPod"))return alert("format_tabbed_pod: element to convert must have class ConvertToTabbedPod. It only has "+a[0].className);var d=a.children("ul"),f=d.html();d.remove();var d=a.html(),e=pe.classes_starting_with(a,"width");if(0===e.length)return alert("no width class found");if(1<e.length)return alert("more than 1 width class found");var g=e[0].substr(5);a.addClass("tabs");a.removeClass("ConvertToTabs");
a.removeClass(e[0]);a.html(pe.templatize('<div class="width{{width}}"><ul class="tab">{{headers}}</ul>{{content}}</div>',{width:g,headers:f,content:d}));var f=a.children().tabs(b),h=["first","second","third","fourth"];a.find("ul.tab li").each(function(a,b){$(b).addClass(h[a])});return f})};pe.date_string=function(a){return"string"===typeof a?a:a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()};
pe.days_between_dates=function(a,b){var c="string"===typeof a?Date.parse(a):a,d="string"===typeof b?Date.parse(b):b;return Math.abs(Math.floor((c-d)/864E5))};pe.empty=function(){};pe.event_search_text=function(a){var b=[a.name,a.description,a.location_name,a.category,a.neighborhood_name,a.neighborhood_id];a.tags&&$.each(a.tags,function(a,d){b.push(d)});a.performer_names&&$.each(a.performer_names,function(a,d){b.push(d)});return b.join(" ")};pe.fetch_photo_id_from_url=function(a){return a.split("/photos/")[1]};
pe.fix_ie7_rendering_bug=function(){$(".ConvertToTabbedPod").addClass("IeSucks")};pe.format_date=function(a){return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()};pe.format_price=function(a){var b=Math.floor(a/100).toString();a=(a%100).toString();2>a.length&&(a="0"+a);return"$"+b+"."+a};pe.format_duration=function(a,b){if(!a)return"0:00";var c=Math.floor(a%60);return pe.string_padding_left(Math.floor(a/60).toString(),b||1,"0")+":"+pe.string_padding_left(c.toString(),2,"0")};pe.get_city_id=function(){return window.city_id};
pe.get_url_parameter=function(a,b){var c=RegExp("[\\?&]"+b+"=([^&]+)","i").exec(a);return c?c[1]:null};pe.hash_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};pe.hashes_equal=function(a,b){if(a===b)return!0;if(pe.hash_length(a)!=pe.hash_length(b))return!1;for(var c in a){var d=a[c],f=b[c];if(pe.is_array(d)){if(!pe.arrays_equal(d,f))return!1}else if(d!==f)return!1}return!0};
pe.hashes_match=function(a,b){for(var c in a){var d=a[c],f=b[c];if(pe.is_array(d)){if(!pe.array_contains(f,d))return!1}else if(d!==f)return!1}return!0};pe.https=function(a){return-1===window.location.href.indexOf("https://")?a:a.replace("http://","https://")};pe.inject=function(a,b,c){var d=b;$.each(a,function(a,b){d=c(d,b)});return d};
pe.init_widget=function(a,b){"string"!==typeof b&&(null!==b&&!b.length?alert("No container given."):(a.container=b,a.callback=function(a){for(var b=[a,this],f=1;f<arguments.length;f++)b.push(arguments[f]);return pe.bind_this.apply(this,b)},a.check_bind=function(a){if("undefined"===typeof this.container)throw"Incorrect scope binding"+a?" in: "+a:".";},a.bind_event=function(a,b){pe.assert(a,"bind_event: parameter 'event_type' is empty");this.container.bind(a,b)},a.fire_event=function(a,b){"undefined"===
typeof a&&alert("Must provide the event type to fire.");"undefined"===typeof b&&(b={});this.container.trigger(a,b)},a.show=function(){this.container.show()},a.hide=function(){this.container.hide()},a.toggle=function(a){this.container.toggle(a)},a.is_visible=function(){return this.container.is(":visible")}))};pe.install_easing=function(){jQuery.easing.cubicEaseInOut||(jQuery.easing.cubicEaseInOut=function(a,b,c,d){b=c+d;return 1>(a/=0.5)?b/2*a*a*a+c:b/2*((a-=2)*a*a+2)+c})};
pe.is_array=function(a){return!(!a||!("object"===typeof a&&"number"===typeof a.length&&"function"===typeof a.splice&&!a.propertyIsEnumerable("length")))};pe.is_valid_credit_card_number=function(a){return!!a.match(/^\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}(\s*|\s*\-\s*)?\d{4}$/)};pe.is_valid_date=function(a){return!a.match(/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/)?!1:a!==$.datepicker.formatDate("m/d/yy",new Date(a))?a===$.datepicker.formatDate("mm/dd/yy",new Date(a)):!0};
pe.is_valid_zip_code=function(a){return!!a.match(/^\d{5}(\s*\-\s*\d{4})?$/)};pe.load=function(a){pe.assert(a,"error loading data");return a};pe.link_title_for_city=function(a){return"See the latest hotspots and events happening in "+a+"."};pe.link_title_for_city_party_climate=function(a){return"Check out the overview and photos of "+a+"."};
pe.link_title_for_event=function(a,b){return b?"Check out event details, photos and videos of "+a+" at "+b+".":"Check out event details, photos and videos of "+a+"."};pe.link_title_for_neighborhood=function(a,b){return"Check out "+a+" description, photos, and venues in "+b+"."};pe.link_title_for_performer=function(a){return"See the latest "+a+" schedule, photos, videos and news."};
pe.link_title_for_reviewer=function(a){switch(a){case "Lucas":return"Meet Lucas, the quintessential fun- loving, pub-crawling \u201cguy\u2019s guy\u201d. Learn about his personality and ratings.";case "Adriana":return"Meet Adriana, the epitome of a cosmopolitan girl. Learn about her personality and ratings.";case "Jonah":return"Meet Jonah, an affable, non-mainstream guy with natural curiosity about people and cultures. Learn about his personality and ratings.";case "Emma":return"Meet Emma, a lively, witty, and sociable \u201cgirl next door\u201d. Learn about her personality and ratings.";
case "All":return"Meet Lucas, Adriana, Jonah and Emma. Learn how their personalities can help you maximize your social experiences in your city and your travels."}};pe.link_title_for_venue=function(a,b,c){return c?"Check out the review, photos, videos, map and events schedule of "+a+" - "+c+" in "+b+".":"Check out the review, photos, videos, map and events schedule of "+a+" in "+b+"."};
pe.normalize=function(a){for(var b="",c=0,d=a.length;c<d;c++)var f=a.charAt(c),e=pe.accentMap[f],b=b+("undefined"===typeof e?f:e);return b};pe.object_hash_from_array=function(a){var b={};$.each(a,function(a,d){b[d.id]=d});return b};pe.object_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};pe.parse_price=function(a){return Math.ceil(100*parseFloat(a.substring(1)))};
pe.prepare_autocomplete_data=function(a){var b=[];$.each(a,function(a,d){$.each(d,function(d,e){e.category=a;b.push(e)})});return b};pe.remove_anchor_from_url=function(a){return a?a.split("#")[0]:""};pe.remove_query_string_from_url=function(a){return a?a.split("?")[0]:""};
pe.set_autocomplete_source=function(a,b,c){var d=pe.normalize(b.term).toLowerCase(),f=RegExp($.ui.autocomplete.escapeRegex(d),"i");a=$.grep(pe.prepare_autocomplete_data(a),function(a){a=a.label||a.value||a;return f.test(a)||f.test(pe.normalize(a))});a=_.sortBy(a,function(a){var b=a.label||a.value||a,b=pe.normalize(b).toLowerCase();return[a.category,b!=d,a.label]});c(a)};pe.shuffle_array=function(a){if(!a)return[];for(var b,c,d=a.length;d;)b=parseInt(Math.random()*d,10),c=a[--d],a[d]=a[b],a[b]=c;return a};
pe.string_padding_left=function(a,b,c){for(;a.length<b;)a=c+a;return a};pe.string_starts_with=function(a,b){return a.substr(0,b.length)===b};pe.string_ends_with=function(a,b){return a.substr(a.length-b.length)===b};pe.structured_tags_as_flat_array=function(a){var b=[];$.each(a,function(a,d){$.merge(b,d)});return b};pe.text_contains_query=function(a,b){var c=b.split(" "),d=!0;$.each(c,function(b,c){if(-1===a.indexOf(c))return d=!1,!0});return d};pe.today_date_string=function(){return pe.date_string(new Date)};
pe.truncate_by_words=function(a,b,c){if(!a||!b)return alert("Sorry, but an error happened. We are already warned about that.");c=c||"...";if(a.length<b)return a;a=a.slice(0,b-1);" "!==_.last(a)&&(b=a.lastIndexOf(" "),a=a.slice(0,b));return $.trim(a)+c};pe.value_from_cookie=function(a){return(a=document.cookie.match(RegExp("(^| )"+a+"=([^ ;]+)")))?a[2]:null};
pe.venue_search_text=function(a){var b=[a.name,a.description,a.address,a.hotspot_text,a.neighborhood_name];a.types&&$.each(a.types,function(a,d){b.push(d)});a.tags&&$.each(a.tags,function(a,d){b.push(d)});return b.join(" ")};pe.xor=function(a,b){return!!(a?!b:b)};$(document).ready(function(){$(document).ajaxSend(pe.ajax_send)});
pe.DropdownModule=function(a,b,c,d,f,e){pe.init_widget(this,a);this.container.html(this.html(d,f));this.container.attr("tabindex",0);this.container.addClass("Dropdown");this.container.focusout(this.callback(this.container_focusout));this.container.click(this.callback(this.title_clicked));this.title_string_function=c;this.title_container_div=this.container.find(".TitleContainer");this.title_div=pe.load(this.container.find(".Title"));this.title_div.html(this.title_string_function(null));this.dropdown_input_field=
this.container.find(".DropdownInput");this.dropdown_div=pe.load(this.container.find(".Dropdown"));this.dropdown_div.hide();this.choices_div=pe.load(this.container.find(".Choices"));"function"===typeof b?this.dropdown_html_function=b:"string"===typeof b?this.set_choices_content(b):alert("Unknown dropdown_html type given.");e?(this.set_default_selection('div[data_result="'+e+'"]'),this.set_input_field_value(e)):this.current_selection=null;this.prevent_next_collapse_flag=!1;d&&(new pe.CloseButton(this.container,
pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));this.auto_collapse=0;this.scroll_timeout=null};pe.DropdownModule.events={OPENED:"DropdownModule_OPENED",CHANGED:"DropdownModule_CHANGED",CLOSED:"DropdownModule_CLOSED",MINIMIZED:"DropdownModule_MINIMIZED"};
pe.DropdownModule.prototype.choice_clicked=function(a){this.current_selection=$(a.target).closest(".Choice");this.collapse_dropdown();this.dropdown_div.hide();this.fire_event(pe.DropdownModule.events.CHANGED,this.current_selection);return!1};pe.DropdownModule.prototype.close_button_clicked=function(){this.fire_event(pe.DropdownModule.events.CLOSED)};
pe.DropdownModule.prototype.collapse_dropdown=function(){this.dropdown_div.hide();this.title_div.html(this.title_string_function(this.current_selection));this.title_div.addClass(this.current_selection&&0<this.current_selection.length?"ClosedWithSelection":"Closed");this.title_container_div.addClass(this.current_selection&&0<this.current_selection.length?"ClosedWithSelection":"Closed");this.title_div.removeClass("Opened");this.title_container_div.removeClass("Opened");this.fire_event(pe.DropdownModule.events.MINIMIZED)};
pe.DropdownModule.prototype.container_focusout=function(){0>this.auto_collapse||setTimeout(this.callback(function(){0<=this.auto_collapse&&!this.prevent_next_collapse_flag&&this.collapse_dropdown();this.prevent_next_collapse_flag=!1}),200)};pe.DropdownModule.prototype.content_scrolling=function(){this.disable_auto_collapse(0);this.scroll_timeout&&clearTimeout(this.scroll_timeout);this.scroll_timeout=setTimeout(this.callback(function(){this.enable_auto_collapse();this.container.focus()}),300)};
pe.DropdownModule.prototype.disable_auto_collapse=function(a){this.auto_collapse-=1;a&&setTimeout(this.callback(function(){this.enable_auto_collapse()}),a)};pe.DropdownModule.prototype.enable_auto_collapse=function(){this.auto_collapse+=1;0<this.auto_collapse&&(this.auto_collapse=0)};
pe.DropdownModule.prototype.expand_dropdown=function(){this.dropdown_html_function&&this.set_choices_content(this.dropdown_html_function());this.dropdown_div.show();this.title_div.html(this.title_string_function("selecting"));this.title_div.removeClass("Closed ClosedWithSelection");this.title_container_div.removeClass("Closed ClosedWithSelection");this.title_div.addClass("Opened");this.title_container_div.addClass("Opened");this.fire_event(pe.DropdownModule.events.OPENED)};
pe.DropdownModule.prototype.html=function(a,b){return'<div class="TitleContainer Closed"><div class="Title select Closed"></div>'+(a?'<div class="CloseButton close_btn fake_link"></div>':"")+'<input type="hidden" class="DropdownInput" name="'+b+'" ></div><div class="Dropdown dropdown"><div class="choices_wrapper"><div class="Choices choices"></div></div><div class="footer_bottom"><div class="footer_right"></div></div></div>'};pe.DropdownModule.prototype.is_expanded=function(){return this.dropdown_div.is(":visible")};
pe.DropdownModule.prototype.prevent_next_collapse=function(){this.prevent_next_collapse_flag=!0};pe.DropdownModule.prototype.reset_dropdown=function(a){this.title_div.html(this.title_string_function(a));this.dropdown_input_field.val("")};pe.DropdownModule.prototype.set_choices_content=function(a){this.choices_div.html(a);this.choices_div.find(".Choice").click(this.callback(this.choice_clicked));this.choices_div.scroll(this.callback(this.content_scrolling))};
pe.DropdownModule.prototype.set_default_selection=function(a){this.current_selection=pe.load(this.dropdown_div.find(a));this.title_div.html(this.title_string_function(this.current_selection))};pe.DropdownModule.prototype.set_error_as_title=function(){this.title_div.html(this.title_string_function("error"))};pe.DropdownModule.prototype.set_input_field_value=function(a){this.dropdown_input_field.val(a)};
pe.DropdownModule.prototype.title_clicked=function(){this.is_expanded()?this.collapse_dropdown():(this.disable_auto_collapse(500),this.expand_dropdown())};pe.DropdownModule.prototype.val=function(a){if(a)this.current_selection="string"===typeof a?this.dropdown_div.find(a):a,this.title_div.html(this.title_string_function(this.current_selection));else return this.current_selection};
pe.ImageablePhotoStatusSelect=function(a){pe.init_widget(this,a);this.update_url=this.container.attr("data_update_url");this.dropdown_module=new pe.DropdownModule(a,this.dropdown_html(),this.callback(this.title_html),!1);this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.value_changed));(a=this.container.attr("data_default"))&&this.dropdown_module.set_default_selection(".Choice[data='"+a+"']")};pe.ImageablePhotoStatusSelect.events={CHANGED:"ImageablePhotoStatusSelect_CHANGED"};
pe.ImageablePhotoStatusSelect.prototype.dropdown_html=function(){return'<div class="Choice" data="no_photos">no photos</div><div class="Choice" data="no_good_photos">no good photos</div><div class="Choice" data="need_more_quantity">need more quantity</div><div class="Choice" data="complete">complete</div>'};
pe.ImageablePhotoStatusSelect.prototype.value_changed=function(a,b){var c={};c[window.class_name+"[photo_status]"]=this.result_value(b);$.ajax({url:this.update_url,type:"PUT",data:c});this.fire_event(pe.ImageablePhotoStatusSelect.events.CHANGED,this.result_value(b))};pe.ImageablePhotoStatusSelect.prototype.title_html=function(a){return a?"selecting"===a?"click on a choice":a.html():"photo status"};
pe.ImageablePhotoStatusSelect.prototype.result_value=function(a){if(!a)return"";a=$(a).attr("data");return"string"===typeof a?a:""};pe.ImageablePhotoStatusSelect.prototype.val=function(){return this.result_value(this.dropdown_module.val())};pe.ImageablePhotoStatusSelect.create_all=function(){$(".ImageablePhotoStatus").each(function(a,b){new pe.ImageablePhotoStatusSelect($(b))})};
pe.PhotoQualityStatusSelect=function(a){pe.init_widget(this,a);this.photo_id=this.container.attr("data_photo_id");this.dropdown_module=new pe.DropdownModule(a,this.dropdown_html(),this.callback(this.title_html),!1);this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.value_changed));(a=this.container.attr("data_default"))&&this.dropdown_module.set_default_selection(".Choice[data='"+a+"']")};pe.PhotoQualityStatusSelect.events={CHANGED:"PhotoQualityStatusSelect_CHANGED"};
pe.PhotoQualityStatusSelect.prototype.dropdown_html=function(){return'<div class="Choice" data="good">good</div><div class="Choice" data="bad">bad</div><div class="Choice" data="on_the_fence">on fence</div>'};pe.PhotoQualityStatusSelect.prototype.value_changed=function(a,b){$.ajax({url:"/admin/photos/"+this.photo_id+".json",type:"PUT",data:{"photo[quality_status]":this.result_value(b)}});this.fire_event(pe.PhotoQualityStatusSelect.events.CHANGED,this.result_value(b))};
pe.PhotoQualityStatusSelect.prototype.title_html=function(a){return a?"selecting"===a?"click on a choice":a.html():"quality status"};pe.PhotoQualityStatusSelect.prototype.result_value=function(a){if(!a)return"";a=$(a).attr("data");return"string"===typeof a?a:""};pe.PhotoQualityStatusSelect.prototype.val=function(){return this.result_value(this.dropdown_module.val())};pe.PhotoQualityStatusSelect.create_all=function(){$(".PhotoQualityStatusSelect").each(function(a,b){new pe.PhotoQualityStatusSelect($(b))})};
pe.PhotoStatusSelect=function(a){pe.init_widget(this,a);this.container.data("widget",this);this.photo_id=pe.load(this.container.attr("data_photo_id"));this.dropdown_module=new pe.DropdownModule(a,this.dropdown_html(),this.callback(this.title_html),!1);this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.value_changed));(a=this.container.attr("data_default"))&&this.dropdown_module.set_default_selection(".Choice[data='"+a+"']")};pe.PhotoStatusSelect.events={CHANGED:"PhotoStatusSelect_CHANGED"};
pe.PhotoStatusSelect.prototype.dropdown_html=function(){return'<div class="Choice" data="not_reviewed">not reviewed</div><div class="Choice" data="disabled">disabled</div><div class="Choice" data="live">live</div>'};pe.PhotoStatusSelect.prototype.value_changed=function(a,b){$.ajax({url:"/admin/photos/"+this.photo_id+".json",type:"PUT",data:{"photo[status]":this.result_value(b)}});this.fire_event(pe.PhotoStatusSelect.events.CHANGED,this.result_value($(b)))};
pe.PhotoStatusSelect.prototype.title_html=function(a){return a?"selecting"===a?"click on a choice":a.html():"photo status"};pe.PhotoStatusSelect.prototype.result_value=function(a){if(!a)return"";a=$(a).attr("data");return"string"===typeof a?a:""};pe.PhotoStatusSelect.prototype.val=function(a){if(a)a=pe.load(this.container.find('.Choice[data="'+a+'"]')),this.dropdown_module.val(a);else return this.result_value(this.dropdown_module.val())};
pe.PhotoStatusSelect.create_all=function(){$(".PhotoStatusSelect").each(function(a,b){new pe.PhotoStatusSelect($(b))})};
pe.PhotoTypeSelect=function(a,b){pe.init_widget(this,a);this.photo_id=this.container.attr("data_photo_id");this.dropdown_module=new pe.DropdownModule(a,this.dropdown_html(b),this.callback(this.title_html),!1);this.dropdown_module.bind_event(pe.DropdownModule.events.CHANGED,this.callback(this.value_changed));var c=this.container.attr("data_default");c&&this.dropdown_module.set_default_selection(".Choice[data='"+c+"']")};pe.PhotoTypeSelect.events={CHANGED:"PhotoTypeSelect_CHANGED"};
pe.PhotoTypeSelect.prototype.dropdown_html=function(a){return $.map(a,function(a){return'<div class="Choice" data="'+a+'">'+a+"</div>"}).join("\n")};pe.PhotoTypeSelect.prototype.value_changed=function(a,b){$.ajax({url:"/admin/photos/"+this.photo_id+".json",type:"PUT",data:{"photo[photo_type]":this.result_value(b)}});this.fire_event(pe.PhotoTypeSelect.events.CHANGED,this.result_value(b))};pe.PhotoTypeSelect.prototype.title_html=function(a){return a?"selecting"===a?"click on a choice":a.html():"type"};
pe.PhotoTypeSelect.prototype.result_value=function(a){if(!a)return"";a=$(a).attr("data");return"string"===typeof a?a:""};pe.PhotoTypeSelect.prototype.val=function(){return this.result_value(this.dropdown_module.val())};pe.PhotoTypeSelect.create_all=function(a){$(".PhotoTypeSelect").each(function(b,c){new pe.PhotoTypeSelect($(c),a)})};
pe.AjaxInput=function(a){pe.init_widget(this,a);this.update_url=this.container.attr("data_update_url");this.update_key=this.container.attr("data_update_key");this.input=pe.load(this.container.find(".Input"));this.input.change(this.callback(this.input_changed))};
pe.AjaxInput.prototype.input_changed=function(){var a=null;if("textarea"===this.input[0].type)a=this.input.val();else if(this.input.is(":checkbox"))a=this.input.is(":checked");else if(this.input.is(":text"))a=this.input.val();else{alert("unknown input field");return}var b={};b[this.update_key]=a;$.ajax({url:this.update_url,data:b,type:"PUT"})};pe.AjaxInput.instantiate=function(){$(".AjaxFlag").each(function(a,b){new pe.AjaxInput($(b))})};
var swfobject=function(){function a(){if(!x){try{var a=l.getElementsByTagName("body")[0].appendChild(l.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}x=!0;for(var a=G.length,c=0;c<a;c++)G[c]()}}function b(a){x?a():G[G.length]=a}function c(a){if(typeof s.addEventListener!=n)s.addEventListener("load",a,!1);else if(typeof l.addEventListener!=n)l.addEventListener("load",a,!1);else if(typeof s.attachEvent!=n){var b=s;b.attachEvent("onload",a);A[A.length]=[b,"onload",a]}else if("function"==
typeof s.onload){var c=s.onload;s.onload=function(){c();a()}}else s.onload=a}function d(){var a=u.length;if(0<a)for(var b=0;b<a;b++){var c=u[b].id,d=u[b].callbackFn,j={success:!1,id:c};if(0<k.pv[0]){var m=q(c);if(m)if(y(u[b].swfVersion)&&!(k.wk&&312>k.wk))z(c,!0),d&&(j.success=!0,j.ref=f(c),d(j));else if(u[b].expressInstall&&e()){j={};j.data=u[b].expressInstall;j.width=m.getAttribute("width")||"0";j.height=m.getAttribute("height")||"0";m.getAttribute("class")&&(j.styleclass=m.getAttribute("class"));
m.getAttribute("align")&&(j.align=m.getAttribute("align"));for(var l={},m=m.getElementsByTagName("param"),p=m.length,D=0;D<p;D++)"movie"!=m[D].getAttribute("name").toLowerCase()&&(l[m[D].getAttribute("name")]=m[D].getAttribute("value"));g(j,l,c,d)}else h(m),d&&d(j)}else if(z(c,!0),d){if((c=f(c))&&typeof c.SetVariable!=n)j.success=!0,j.ref=c;d(j)}}}function f(a){var b=null;if((a=q(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=n?b=a:(a=a.getElementsByTagName(v)[0])&&(b=a);return b}function e(){return!H&&
y("6.0.65")&&(k.win||k.mac)&&!(k.wk&&312>k.wk)}function g(a,b,c,d){H=!0;L=d||null;O={success:!1,id:c};var f=q(c);if(f){"OBJECT"==f.nodeName?(E=j(f),I=null):(E=f,I=c);a.id=P;if(typeof a.width==n||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==n||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";l.title=l.title.slice(0,47)+" - Flash Player Installation";d=k.ie&&k.win?"ActiveX":"PlugIn";d="MMredirectURL="+s.location.toString().replace(/&/g,"%26")+"&MMplayerType="+
d+"&MMdoctitle="+l.title;b.flashvars=typeof b.flashvars!=n?b.flashvars+("&"+d):d;k.ie&&(k.win&&4!=f.readyState)&&(d=l.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),f.parentNode.insertBefore(d,f),f.style.display="none",function(){4==f.readyState?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}());m(a,b,c)}}function h(a){if(k.ie&&k.win&&4!=a.readyState){var b=l.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(j(a),b);a.style.display="none";(function(){4==
a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(j(a),a)}function j(a){var b=l.createElement("div");if(k.win&&k.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(v)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function m(a,b,c){var d,f=q(c);if(k.wk&&312>k.wk)return d;if(f)if(typeof a.id==n&&(a.id=c),k.ie&&k.win){var e=
"",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?e+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(e+=" "+g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');f.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+e+">"+g+"</object>";J[J.length]=a.id;d=q(a.id)}else{h=l.createElement(v);h.setAttribute("type",K);for(var j in a)a[j]!=Object.prototype[j]&&("styleclass"==
j.toLowerCase()?h.setAttribute("class",a[j]):"classid"!=j.toLowerCase()&&h.setAttribute(j,a[j]));for(e in b)b[e]!=Object.prototype[e]&&"movie"!=e.toLowerCase()&&(a=h,g=e,j=b[e],c=l.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",j),a.appendChild(c));f.parentNode.replaceChild(h,f);d=h}return d}function p(a){var b=q(a);b&&"OBJECT"==b.nodeName&&(k.ie&&k.win?(b.style.display="none",function(){if(4==b.readyState){var c=q(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);
c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function q(a){var b=null;try{b=l.getElementById(a)}catch(c){}return b}function y(a){var b=k.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function Q(a,b,c,d){if(!k.ie||!k.mac){var f=l.getElementsByTagName("head")[0];if(f){c=c&&"string"==typeof c?c:"screen";d&&(M=t=null);if(!t||
M!=c)d=l.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),t=f.appendChild(d),k.ie&&(k.win&&typeof l.styleSheets!=n&&0<l.styleSheets.length)&&(t=l.styleSheets[l.styleSheets.length-1]),M=c;k.ie&&k.win?t&&typeof t.addRule==v&&t.addRule(a,b):t&&typeof l.createTextNode!=n&&t.appendChild(l.createTextNode(a+" {"+b+"}"))}}}function z(a,b){if(R){var c=b?"visible":"hidden";x&&q(a)?q(a).style.visibility=c:Q("#"+a,"visibility:"+c)}}function S(a){return null!=/[\\\"<>\.;]/.exec(a)&&
typeof encodeURIComponent!=n?encodeURIComponent(a):a}var n="undefined",v="object",K="application/x-shockwave-flash",P="SWFObjectExprInst",s=window,l=document,w=navigator,T=!1,G=[function(){if(T){var a=l.getElementsByTagName("body")[0],b=l.createElement(v);b.setAttribute("type",K);var c=a.appendChild(b);if(c){var f=0;(function(){if(typeof c.GetVariable!=n){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),k.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>f){f++;
setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;d()})()}else d()}else d()}],u=[],J=[],A=[],E,I,L,O,x=!1,H=!1,t,M,R=!0,k,V=typeof l.getElementById!=n&&typeof l.getElementsByTagName!=n&&typeof l.createElement!=n,B=w.userAgent.toLowerCase(),C=w.platform.toLowerCase(),W=C?/win/.test(C):/win/.test(B),C=C?/mac/.test(C):/mac/.test(B),B=/webkit/.test(B)?parseFloat(B.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,N=!+"\v1",F=[0,0,0],r=null;if(typeof w.plugins!=n&&typeof w.plugins["Shockwave Flash"]==
v){if((r=w.plugins["Shockwave Flash"].description)&&!(typeof w.mimeTypes!=n&&w.mimeTypes[K]&&!w.mimeTypes[K].enabledPlugin))T=!0,N=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),F[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),F[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),F[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof s.ActiveXObject!=n)try{var U=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(U&&(r=U.GetVariable("$version")))N=!0,r=r.split(" ")[1].split(","),
F=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}catch(X){}k={w3:V,pv:F,wk:B,ie:N,win:W,mac:C};k.w3&&((typeof l.readyState!=n&&"complete"==l.readyState||typeof l.readyState==n&&(l.getElementsByTagName("body")[0]||l.body))&&a(),x||(typeof l.addEventListener!=n&&l.addEventListener("DOMContentLoaded",a,!1),k.ie&&k.win&&(l.attachEvent("onreadystatechange",function(){"complete"==l.readyState&&(l.detachEvent("onreadystatechange",arguments.callee),a())}),s==top&&function(){if(!x){try{l.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),k.wk&&function(){x||(/loaded|complete/.test(l.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)));k.ie&&k.win&&window.attachEvent("onunload",function(){for(var a=A.length,b=0;b<a;b++)A[b][0].detachEvent(A[b][1],A[b][2]);a=J.length;for(b=0;b<a;b++)p(J[b]);for(var c in k)k[c]=null;k=null;for(var d in swfobject)swfobject[d]=null;swfobject=null});return{registerObject:function(a,b,c,d){if(k.w3&&a&&b){var f={};f.id=a;f.swfVersion=b;f.expressInstall=c;f.callbackFn=d;u[u.length]=
f;z(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(k.w3)return f(a)},embedSWF:function(a,c,d,f,h,j,l,p,q,r){var s={success:!1,id:c};k.w3&&!(k.wk&&312>k.wk)&&a&&c&&d&&f&&h?(z(c,!1),b(function(){d+="";f+="";var b={};if(q&&typeof q===v)for(var k in q)b[k]=q[k];b.data=a;b.width=d;b.height=f;k={};if(p&&typeof p===v)for(var t in p)k[t]=p[t];if(l&&typeof l===v)for(var u in l)k.flashvars=typeof k.flashvars!=n?k.flashvars+("&"+u+"="+l[u]):u+"="+l[u];if(y(h))t=m(b,k,c),b.id==c&&z(c,!0),s.success=
!0,s.ref=t;else{if(j&&e()){b.data=j;g(b,k,c,r);return}z(c,!0)}r&&r(s)})):r&&r(s)},switchOffAutoHideShow:function(){R=!1},ua:k,getFlashPlayerVersion:function(){return{major:k.pv[0],minor:k.pv[1],release:k.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(a,b,c){if(k.w3)return m(a,b,c)},showExpressInstall:function(a,b,c,d){k.w3&&e()&&g(a,b,c,d)},removeSWF:function(a){k.w3&&p(a)},createCSS:function(a,b,c,d){k.w3&&Q(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=l.location.search||
l.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return S(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return S(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(H){var a=q(P);a&&E&&(a.parentNode.replaceChild(E,a),I&&(z(I,!0),k.ie&&k.win&&(E.style.display="block")),L&&L(O));H=!1}}}}(),SWFUpload;void 0==SWFUpload&&(SWFUpload=function(a){this.initSWFUpload(a)});
SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={},this.settings=a,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(b){throw delete SWFUpload.instances[this.movieName],b;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";
SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};
SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(a){if(!a)return"";if("string"!==typeof a||a.match(/^https?:\/\//i)||a.match(/^\//))return a;var b=window.location.pathname.lastIndexOf("/");path=0>=b?"/":window.location.pathname.substr(0,b)+"/";return path+a};
SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=void 0==this.settings[a]?b:this.settings[a]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",!1);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",!1);this.ensureDefault("requeue_on_error",!1);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types",
"*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",!0);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");
this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",!1);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",!1);this.settings.debug_enabled=this.settings.debug;
this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",
null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(0>this.settings.flash_url.indexOf("?")?"?":"&")+"preventswfcaching="+(new Date).getTime());this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=
SWFUpload.completeURL(this.settings.button_image_url));delete this.ensureDefault};
SWFUpload.prototype.loadFlash=function(){var a,b;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(void 0==a)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;b=document.createElement("div");b.innerHTML=this.getFlashHTML();a.parentNode.replaceChild(b.firstChild,a);void 0==window[this.movieName]&&
(window[this.movieName]=this.getMovieElement())};
SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload"><param name="wmode" value="',this.settings.button_window_mode,'" /><param name="movie" value="',this.settings.flash_url,'" /><param name="quality" value="high" /><param name="menu" value="false" /><param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+
this.getFlashVars()+'" />',"</object>"].join("")};
SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",
encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),
"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),
"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName));if(null===this.movieElement)throw"Could not find Flash element";return this.movieElement};
SWFUpload.prototype.buildParamString=function(){var a=this.settings.post_params,b=[];if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")};
SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var a=null;if((a=this.getMovieElement())&&"unknown"===typeof a.CallFunction){for(var b in a)try{"function"===typeof a[b]&&(a[b]=null)}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieName=this.eventQueue=this.customSettings=this.settings=this.movieElement=null;return!0}catch(f){return!1}};
SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\nVersion: ",SWFUpload.version,"\nMovie Name: ",this.movieName,"\nSettings:\n\tupload_url:               ",this.settings.upload_url,"\n\tflash_url:                ",this.settings.flash_url,"\n\tuse_query_string:         ",this.settings.use_query_string.toString(),"\n\trequeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n\thttp_success:             ",this.settings.http_success.join(", "),"\n\tassume_success_timeout:   ",
this.settings.assume_success_timeout,"\n\tfile_post_name:           ",this.settings.file_post_name,"\n\tpost_params:              ",this.settings.post_params.toString(),"\n\tfile_types:               ",this.settings.file_types,"\n\tfile_types_description:   ",this.settings.file_types_description,"\n\tfile_size_limit:          ",this.settings.file_size_limit,"\n\tfile_upload_limit:        ",this.settings.file_upload_limit,"\n\tfile_queue_limit:         ",this.settings.file_queue_limit,"\n\tdebug:                    ",
this.settings.debug.toString(),"\n\tprevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n\tbutton_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n\tbutton_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n\tbutton_image_url:         ",this.settings.button_image_url.toString(),"\n\tbutton_width:             ",this.settings.button_width.toString(),"\n\tbutton_height:            ",this.settings.button_height.toString(),"\n\tbutton_text:              ",
this.settings.button_text.toString(),"\n\tbutton_text_style:        ",this.settings.button_text_style.toString(),"\n\tbutton_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n\tbutton_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n\tbutton_action:            ",this.settings.button_action.toString(),"\n\tbutton_disabled:          ",this.settings.button_disabled.toString(),"\n\tcustom_settings:          ",this.settings.custom_settings.toString(),"\nEvent Handlers:\n\tswfupload_loaded_handler assigned:  ",
("function"===typeof this.settings.swfupload_loaded_handler).toString(),"\n\tfile_dialog_start_handler assigned: ",("function"===typeof this.settings.file_dialog_start_handler).toString(),"\n\tfile_queued_handler assigned:       ",("function"===typeof this.settings.file_queued_handler).toString(),"\n\tfile_queue_error_handler assigned:  ",("function"===typeof this.settings.file_queue_error_handler).toString(),"\n\tupload_start_handler assigned:      ",("function"===typeof this.settings.upload_start_handler).toString(),
"\n\tupload_progress_handler assigned:   ",("function"===typeof this.settings.upload_progress_handler).toString(),"\n\tupload_error_handler assigned:      ",("function"===typeof this.settings.upload_error_handler).toString(),"\n\tupload_success_handler assigned:    ",("function"===typeof this.settings.upload_success_handler).toString(),"\n\tupload_complete_handler assigned:   ",("function"===typeof this.settings.upload_complete_handler).toString(),"\n\tdebug_handler assigned:             ",("function"===
typeof this.settings.debug_handler).toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(a,b,c){return void 0==b?this.settings[a]=c:this.settings[a]=b};SWFUpload.prototype.getSetting=function(a){return void 0!=this.settings[a]?this.settings[a]:""};
SWFUpload.prototype.callFlash=function(a,b){b=b||[];var c=this.getMovieElement(),d,f;try{f=c.CallFunction('<invoke name="'+a+'" returntype="javascript">'+__flash__argumentsToXML(b,0)+"</invoke>"),d=eval(f)}catch(e){throw"Call to "+a+" failed";}void 0!=d&&"object"===typeof d.post&&(d=this.unescapeFilePostParams(d));return d};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};
SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelUpload=function(a,b){!1!==b&&(b=!0);this.callFlash("CancelUpload",[a,b])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])};
SWFUpload.prototype.getFile=function(a){return"number"===typeof a?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])};SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])};SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])};SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString();this.callFlash("SetUploadURL",[a])};
SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;this.callFlash("SetPostParams",[a])};SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];this.callFlash("SetPostParams",[this.settings.post_params])};
SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;this.settings.file_types_description=b;this.callFlash("SetFileTypes",[a,b])};SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;this.callFlash("SetFileSizeLimit",[a])};SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;this.callFlash("SetFileUploadLimit",[a])};
SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;this.callFlash("SetFileQueueLimit",[a])};SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;this.callFlash("SetFilePostName",[a])};SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;this.callFlash("SetUseQueryString",[a])};SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;this.callFlash("SetRequeueOnError",[a])};
SWFUpload.prototype.setHTTPSuccess=function(a){"string"===typeof a&&(a=a.replace(" ","").split(","));this.settings.http_success=a;this.callFlash("SetHTTPSuccess",[a])};SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a;this.callFlash("SetAssumeSuccessTimeout",[a])};SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;this.callFlash("SetDebugEnabled",[a])};
SWFUpload.prototype.setButtonImageURL=function(a){void 0==a&&(a="");this.settings.button_image_url=a;this.callFlash("SetButtonImageURL",[a])};SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a;this.settings.button_height=b;var c=this.getMovieElement();void 0!=c&&(c.style.width=a+"px",c.style.height=b+"px");this.callFlash("SetButtonDimensions",[a,b])};SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;this.callFlash("SetButtonText",[a])};
SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b;this.settings.button_text_left_padding=a;this.callFlash("SetButtonTextPadding",[a,b])};SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;this.callFlash("SetButtonTextStyle",[a])};SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;this.callFlash("SetButtonDisabled",[a])};
SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;this.callFlash("SetButtonAction",[a])};SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a;this.callFlash("SetButtonCursor",[a])};
SWFUpload.prototype.queueEvent=function(a,b){void 0==b?b=[]:b instanceof Array||(b=[b]);var c=this;if("function"===typeof this.settings[a])this.eventQueue.push(function(){this.settings[a].apply(this,b)}),setTimeout(function(){c.executeNextEvent()},0);else if(null!==this.settings[a])throw"Event handler "+a+" is unknown or is not a function";};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;"function"===typeof a&&a.apply(this)};
SWFUpload.prototype.unescapeFilePostParams=function(a){var b=/[$]([0-9a-f]{4})/i,c={},d;if(void 0!=a){for(var f in a.post)if(a.post.hasOwnProperty(f)){d=f;for(var e;null!==(e=b.exec(d));)d=d.replace(e[0],String.fromCharCode(parseInt("0x"+e[1],16)));c[d]=a.post[f]}a.post=c}return a};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return!1}};
SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();a?(this.cleanUp(a),this.queueEvent("swfupload_loaded_handler")):this.debug("Flash called back ready but the flash movie can't be found.")};
SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&"unknown"===typeof a.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{"function"===typeof a[b]&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};
SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("file_queued_handler",a)};SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("file_queue_error_handler",[a,b,c])};SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])};SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("return_upload_start_handler",a)};
SWFUpload.prototype.returnUploadStart=function(a){var b;if("function"===typeof this.settings.upload_start_handler)a=this.unescapeFilePostParams(a),b=this.settings.upload_start_handler.call(this,a);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===b&&(b=!0);this.callFlash("ReturnUploadStart",[!!b])};SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_progress_handler",[a,b,c])};
SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_error_handler",[a,b,c])};SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_success_handler",[a,b,c])};SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("upload_complete_handler",a)};SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)};
SWFUpload.prototype.debugMessage=function(a){if(this.settings.debug){var b=[];if("object"===typeof a&&"string"===typeof a.name&&"string"===typeof a.message){for(var c in a)a.hasOwnProperty(c)&&b.push(c+": "+a[c]);a=b.join("\n")||"";b=a.split("\n");a="EXCEPTION: "+b.join("\nEXCEPTION: ")}SWFUpload.Console.writeLine(a)}};SWFUpload.Console={};
SWFUpload.Console.writeLine=function(a){var b,c;try{b=document.getElementById("SWFUpload_Console"),b||(c=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(c),b=document.createElement("textarea"),b.id="SWFUpload_Console",b.style.fontFamily="monospace",b.setAttribute("wrap","off"),b.wrap="off",b.style.overflow="auto",b.style.width="700px",b.style.height="350px",b.style.margin="5px",c.appendChild(b)),b.value+=a+"\n",b.scrollTop=b.scrollHeight-b.clientHeight}catch(d){alert("Exception: "+
d.name+" Message: "+d.message)}};
(function(a){var b={init:function(b,f){return this.each(function(){var e=a(this),g=e.clone(),h=a.extend({id:e.attr("id"),swf:"uploadify.swf",uploader:"uploadify.php",auto:!0,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:!1,debug:!1,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",height:30,method:"post",multi:!0,formData:{},preventCaching:!0,progressData:"percentage",queueID:!1,queueSizeLimit:999,removeCompleted:!0,removeTimeout:3,
requeueErrors:!1,successTimeout:30,uploadLimit:0,width:120,overrideEvents:[]},b),j={assume_success_timeout:h.successTimeout,button_placeholder_id:h.id,button_width:h.width,button_height:h.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:h.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:"arrow"==h.buttonCursor?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,
debug:h.debug,requeue_on_error:h.requeueErrors,file_post_name:h.fileObjName,file_size_limit:h.fileSizeLimit,file_types:h.fileTypeExts,file_types_description:h.fileTypeDesc,file_queue_limit:h.queueSizeLimit,file_upload_limit:h.uploadLimit,flash_url:h.swf,prevent_swf_caching:h.preventCaching,post_params:h.formData,upload_url:h.uploader,use_query_string:"get"==h.method,file_dialog_complete_handler:c.onDialogClose,file_dialog_start_handler:c.onDialogOpen,file_queued_handler:c.onSelect,file_queue_error_handler:c.onSelectError,
swfupload_loaded_handler:h.onSWFReady,upload_complete_handler:c.onUploadComplete,upload_error_handler:c.onUploadError,upload_progress_handler:c.onUploadProgress,upload_start_handler:c.onUploadStart,upload_success_handler:c.onUploadSuccess};f&&(j=a.extend(j,f));j=a.extend(j,h);if(9<=swfobject.getFlashPlayerVersion().major){window["uploadify_"+h.id]=new SWFUpload(j);j=window["uploadify_"+h.id];e.data("uploadify",j);var m=a("<div />",{id:h.id,"class":"uploadify",css:{height:h.height+"px",width:h.width+
"px"}});a("#"+j.movieName).wrap(m);m=a("#"+h.id);m.data("uploadify",j);var p=a("<div />",{id:h.id+"-button","class":"uploadify-button "+h.buttonClass});h.buttonImage&&p.css({"background-image":"url('"+h.buttonImage+"')","text-indent":"-9999px"});p.html('<span class="uploadify-button-text">'+h.buttonText+"</span>").css({height:h.height+"px","line-height":h.height+"px",width:h.width+"px"});m.append(p);a("#"+j.movieName).css({position:"absolute","z-index":1});if(!h.queueID){var q=a("<div />",{id:h.id+
"-queue","class":"uploadify-queue"});m.after(q);j.settings.queueID=h.id+"-queue";j.settings.defaultQueue=!0}j.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"};j.original=g;j.wrapper=m;j.button=p;j.queue=q;h.onInit&&h.onInit.call(e,j)}else h.onFallback&&h.onFallback.call(e)})},
cancel:function(b,c){var e=arguments;this.each(function(){var b=a(this),c=b.data("uploadify"),d=c.settings,f=-1;if(e[0])if("*"==e[0]){var p=c.queueData.queueLength;a("#"+d.queueID).find(".uploadify-queue-item").each(function(){f++;!0===e[1]?c.cancelUpload(a(this).attr("id"),!1):c.cancelUpload(a(this).attr("id"));a(this).find(".data").removeClass("data").html(" - Cancelled");a(this).find(".uploadify-progress-bar").remove();a(this).delay(1E3+100*f).fadeOut(500,function(){a(this).remove()})});c.queueData.queueSize=
0;c.queueData.queueLength=0;d.onClearQueue&&d.onClearQueue.call(b,p)}else for(b=0;b<e.length;b++)c.cancelUpload(e[b]),a("#"+e[b]).find(".data").removeClass("data").html(" - Cancelled"),a("#"+e[b]).find(".uploadify-progress-bar").remove(),a("#"+e[b]).delay(1E3+100*b).fadeOut(500,function(){a(this).remove()});else b=a("#"+d.queueID).find(".uploadify-queue-item").get(0),$item=a(b),c.cancelUpload($item.attr("id")),$item.find(".data").removeClass("data").html(" - Cancelled"),$item.find(".uploadify-progress-bar").remove(),
$item.delay(1E3).fadeOut(500,function(){a(this).remove()})})},destroy:function(){this.each(function(){var b=a(this).data("uploadify"),c=b.settings;b.destroy();c.defaultQueue&&a("#"+c.queueID).remove();a("#"+c.id).replaceWith(b.original);c.onDestroy&&c.onDestroy.call(this);delete b})},disable:function(b){this.each(function(){var c=a(this).data("uploadify"),e=c.settings;b?(c.button.addClass("disabled"),e.onDisable&&e.onDisable.call(this)):(c.button.removeClass("disabled"),e.onEnable&&e.onEnable.call(this));
c.setButtonDisabled(b)})},settings:function(b,c,e){var g=arguments,h=c;this.each(function(){var j=a(this).data("uploadify"),m=j.settings;if("object"==typeof g[0])for(var p in c)setData(p,c[p]);if(1===g.length)h=m[b];else{switch(b){case "uploader":j.setUploadURL(c);break;case "formData":e||(c=a.extend(m.formData,c));j.setPostParams(m.formData);break;case "method":"get"==c?j.setUseQueryString(!0):j.setUseQueryString(!1);break;case "fileObjName":j.setFilePostName(c);break;case "fileTypeExts":j.setFileTypes(c,
m.fileTypeDesc);break;case "fileTypeDesc":j.setFileTypes(m.fileTypeExts,c);break;case "fileSizeLimit":j.setFileSizeLimit(c);break;case "uploadLimit":j.setFileUploadLimit(c);break;case "queueSizeLimit":j.setFileQueueLimit(c);break;case "buttonImage":j.button.css("background-image",settingValue);break;case "buttonCursor":"arrow"==c?j.setButtonCursor(SWFUpload.CURSOR.ARROW):j.setButtonCursor(SWFUpload.CURSOR.HAND);break;case "buttonText":a("#"+m.id+"-button").find(".uploadify-button-text").html(c);break;
case "width":j.setButtonDimensions(c,m.height);break;case "height":j.setButtonDimensions(m.width,c);break;case "multi":c?j.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILES):j.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILE)}m[b]=c}});if(1===g.length)return h},stop:function(){this.each(function(){var b=a(this).data("uploadify");b.queueData.averageSpeed=0;b.queueData.uploadSize=0;b.queueData.bytesUploaded=0;b.queueData.uploadQueue=[];b.stopUpload()})},upload:function(){var b=arguments;this.each(function(){var c=
a(this).data("uploadify");c.queueData.averageSpeed=0;c.queueData.uploadSize=0;c.queueData.bytesUploaded=0;c.queueData.uploadQueue=[];if(b[0])if("*"==b[0])c.queueData.uploadSize=c.queueData.queueSize,c.queueData.uploadQueue.push("*"),c.startUpload();else{for(var e=0;e<b.length;e++)c.queueData.uploadSize+=c.queueData.files[b[e]].size,c.queueData.uploadQueue.push(b[e]);c.startUpload(c.queueData.uploadQueue.shift())}else c.startUpload()})}},c={onDialogOpen:function(){var a=this.settings;this.queueData.errorMsg=
"Some files were not added to the queue:";this.queueData.filesReplaced=0;this.queueData.filesCancelled=0;a.onDialogOpen&&a.onDialogOpen.call(this)},onDialogClose:function(b,c,e){var g=this.settings;this.queueData.filesErrored=b-c;this.queueData.filesSelected=b;this.queueData.filesQueued=c-this.queueData.filesCancelled;this.queueData.queueLength=e;0>a.inArray("onDialogClose",g.overrideEvents)&&0<this.queueData.filesErrored&&alert(this.queueData.errorMsg);g.onDialogClose&&g.onDialogClose.call(this,
this.queueData);g.auto&&a("#"+g.id).uploadify("upload","*")},onSelect:function(b){var c=this.settings,e={},g;for(g in this.queueData.files)if(e=this.queueData.files[g],!0!=e.uploaded&&e.name==b.name)if(confirm('The file named "'+b.name+'" is already in the queue.\nDo you want to replace the existing item in the queue?'))a("#"+e.id).remove(),this.cancelUpload(e.id),this.queueData.filesReplaced++;else return this.cancelUpload(b.id),this.queueData.filesCancelled++,!1;e=Math.round(b.size/1024);g="KB";
1E3<e&&(e=Math.round(e/1E3),g="MB");var h=e.toString().split("."),e=h[0];1<h.length&&(e+="."+h[1].substr(0,2));e+=g;g=b.name;25<g.length&&(g=g.substr(0,25)+"...");0>a.inArray("onSelect",c.overrideEvents)&&a("#"+c.queueID).append('<div id="'+b.id+'" class="uploadify-queue-item">\t\t\t\t\t<div class="cancel">\t\t\t\t\t\t<a href="javascript:$(\'#'+c.id+"').uploadify('cancel', '"+b.id+'\')">X</a>\t\t\t\t\t</div>\t\t\t\t\t<span class="fileName">'+g+" ("+e+')</span><span class="data"></span>\t\t\t\t\t<div class="uploadify-progress">\t\t\t\t\t\t<div class="uploadify-progress-bar">\x3c!--Progress Bar--\x3e</div>\t\t\t\t\t</div>\t\t\t\t</div>');
this.queueData.queueSize+=b.size;this.queueData.files[b.id]=b;c.onSelect&&c.onSelect.apply(this,arguments)},onSelectError:function(b,c,e){var g=this.settings;if(0>a.inArray("onSelectError",g.overrideEvents))switch(c){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:this.queueData.errorMsg=g.queueSizeLimit>e?this.queueData.errorMsg+("\nThe number of files selected exceeds the remaining upload limit ("+e+")."):this.queueData.errorMsg+("\nThe number of files selected exceeds the queue size limit ("+g.queueSizeLimit+
").");break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+b.name+'" exceeds the size limit ('+g.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\nThe file "'+b.name+'" is empty.';break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+b.name+'" is not an accepted file type ('+g.fileTypeDesc+")."}c!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete this.queueData.files[b.id];
g.onSelectError&&g.onSelectError.apply(this,arguments)},onQueueComplete:function(){this.settings.onQueueComplete&&this.settings.onQueueComplete.call(this,this.settings.queueData)},onUploadComplete:function(b){var c=this.settings,e=this,g=this.getStats();this.queueData.queueLength=g.files_queued;"*"==this.queueData.uploadQueue[0]?0<this.queueData.queueLength?this.startUpload():(this.queueData.uploadQueue=[],c.onQueueComplete&&c.onQueueComplete.call(this,this.queueData)):0<this.queueData.uploadQueue.length?
this.startUpload(this.queueData.uploadQueue.shift()):(this.queueData.uploadQueue=[],c.onQueueComplete&&c.onQueueComplete.call(this,this.queueData));if(0>a.inArray("onUploadComplete",c.overrideEvents))if(c.removeCompleted)switch(b.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){a("#"+b.id)&&(e.queueData.queueSize-=b.size,e.queueData.queueLength-=1,delete e.queueData.files[b.id],a("#"+b.id).fadeOut(500,function(){a(this).remove()}))},1E3*c.removeTimeout);break;case SWFUpload.FILE_STATUS.ERROR:c.requeueErrors||
setTimeout(function(){a("#"+b.id)&&(e.queueData.queueSize-=b.size,e.queueData.queueLength-=1,delete e.queueData.files[b.id],a("#"+b.id).fadeOut(500,function(){a(this).remove()}))},1E3*c.removeTimeout)}else b.uploaded=!0;c.onUploadComplete&&c.onUploadComplete.call(this,b)},onUploadError:function(b,c,e){var g=this.settings,h="Error";switch(c){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:h="HTTP Error ("+e+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:h="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:h=
"IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:h="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+e+").");h="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:h="Failed";break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:h="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:h="Cancelled";this.queueData.queueSize-=b.size;this.queueData.queueLength-=1;if(b.status==SWFUpload.FILE_STATUS.IN_PROGRESS||
0<=a.inArray(b.id,this.queueData.uploadQueue))this.queueData.uploadSize-=b.size;g.onCancel&&g.onCancel.call(this,b);delete this.queueData.files[b.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:h="Stopped"}0>a.inArray("onUploadError",g.overrideEvents)&&(c!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&c!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED&&a("#"+b.id).addClass("uploadify-error"),a("#"+b.id).find(".uploadify-progress-bar").css("width","1px"),c!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&
b.status!=SWFUpload.FILE_STATUS.COMPLETE&&a("#"+b.id).find(".data").html(" - "+h));var j=this.getStats();this.queueData.uploadsErrored=j.upload_errors;g.onUploadError&&g.onUploadError.call(this,b,c,e,h)},onUploadProgress:function(b,c,e){var g=this.settings,h=(new Date).getTime(),j=h-this.timer;500<j&&(this.timer=h);var m=c-this.bytesLoaded;this.bytesLoaded=c;var h=this.queueData.queueBytesUploaded+c,p=Math.round(100*(c/e)),q="KB/s",y=0,m=Math.floor(10*(m/1024/(j/1E3)))/10;this.queueData.averageSpeed=
0<this.queueData.averageSpeed?Math.floor((this.queueData.averageSpeed+m)/2):Math.floor(m);1E3<m&&(y=0.001*m,this.queueData.averageSpeed=Math.floor(y),q="MB/s");0>a.inArray("onUploadProgress",g.overrideEvents)&&("percentage"==g.progressData?a("#"+b.id).find(".data").html(" - "+p+"%"):"speed"==g.progressData&&500<j&&a("#"+b.id).find(".data").html(" - "+this.queueData.averageSpeed+q),a("#"+b.id).find(".uploadify-progress-bar").css("width",p+"%"));g.onUploadProgress&&g.onUploadProgress.call(this,b,c,
e,h,this.queueData.uploadSize)},onUploadStart:function(b){var c=this.settings;this.timer=(new Date).getTime();this.bytesLoaded=0;0==this.queueData.uploadQueue.length&&(this.queueData.uploadSize=b.size);c.checkExisting&&a.ajax({type:"POST",async:!1,url:c.checkExisting,data:{filename:b.name},success:function(c){1==c&&!confirm('A file with the name "'+b.name+'" already exists on the server.\nWould you like to replace the existing file?')&&(this.cancelUpload(b.id),a("#"+b.id).remove(),0<this.queueData.uploadQueue.length&&
0<this.queueData.queueLength&&("*"==this.queueData.uploadQueue[0]?this.startUpload():this.startUpload(this.queueData.uploadQueue.shift())))}});c.onUploadStart&&c.onUploadStart.call(this,b)},onUploadSuccess:function(b,c,e){var g=this.settings,h=this.getStats();this.queueData.uploadsSuccessful=h.successful_uploads;this.queueData.queueBytesUploaded+=b.size;0>a.inArray("onUploadSuccess",g.overrideEvents)&&a("#"+b.id).find(".data").html(" - Complete");g.onUploadSuccess&&g.onUploadSuccess.call(this,b,c,
e)}};a.fn.uploadify=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof c||!c)return b.init.apply(this,arguments);a.error("The method "+c+" does not exist in $.uploadify")}})($);
(function(a){var b;a.rails=b={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",
fileInputSelector:"input:file",CSRFProtection:function(b){var d=a('meta[name="csrf-token"]').attr("content");d&&b.setRequestHeader("X-CSRF-Token",d)},fire:function(b,d,f){d=a.Event(d);b.trigger(d,f);return!1!==d.result},confirm:function(a){return confirm(a)},ajax:function(b){return a.ajax(b)},handleRemote:function(c){var d,f,e,g=c.data("type")||a.ajaxSettings&&a.ajaxSettings.dataType;if(b.fire(c,"ajax:before")){if(c.is("form")){d=c.attr("method");f=c.attr("action");e=c.serializeArray();var h=c.data("ujs:submit-button");
h&&(e.push(h),c.data("ujs:submit-button",null))}else d=c.data("method"),f=c.attr("href"),e=null;b.ajax({url:f,type:d||"GET",data:e,dataType:g,beforeSend:function(a,d){void 0===d.dataType&&a.setRequestHeader("accept","*/*;q=0.5, "+d.accepts.script);return b.fire(c,"ajax:beforeSend",[a,d])},success:function(a,b,d){c.trigger("ajax:success",[a,b,d])},complete:function(a,b){c.trigger("ajax:complete",[a,b])},error:function(a,b,d){c.trigger("ajax:error",[a,b,d])}})}},handleMethod:function(b){var d=b.attr("href"),
f=b.data("method");b=a("meta[name=csrf-token]").attr("content");var e=a("meta[name=csrf-param]").attr("content"),d=a('<form method="post" action="'+d+'"></form>'),f='<input name="_method" value="'+f+'" type="hidden" />';void 0!==e&&void 0!==b&&(f+='<input name="'+e+'" value="'+b+'" type="hidden" />');d.hide().append(f).appendTo("body");d.submit()},disableFormElements:function(c){c.find(b.disableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";b.data("ujs:enable-with",b[c]());
b[c](b.data("disable-with"));b.attr("disabled","disabled")})},enableFormElements:function(c){c.find(b.enableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";if(b.data("ujs:enable-with"))b[c](b.data("ujs:enable-with"));b.removeAttr("disabled")})},allowAction:function(a){var d=a.data("confirm"),f=!1,e;if(!d)return!0;b.fire(a,"confirm")&&(f=b.confirm(d),e=b.fire(a,"confirm:complete",[f]));return f&&e},blankInputs:function(b,d,f){var e=a(),g;b.find(d||"input,textarea").each(function(){g=
a(this);if(f?g.val():!g.val())e=e.add(g)});return e.length?e:!1},nonBlankInputs:function(a,d){return b.blankInputs(a,d,!0)},stopEverything:function(a){a.stopImmediatePropagation();return!1},callFormSubmitBindings:function(b){b=b.data("events");var d=!0;void 0!==b&&void 0!==b.submit&&a.each(b.submit,function(a,b){if("function"===typeof b.handler)return d=b.handler(b.data)});return d}};"ajaxPrefilter"in a?a.ajaxPrefilter(function(a,d,f){b.CSRFProtection(f)}):a(document).ajaxSend(function(a,d){b.CSRFProtection(d)});
a(b.linkClickSelector).live("click.rails",function(c){var d=a(this);if(!b.allowAction(d))return b.stopEverything(c);if(void 0!==d.data("remote"))return b.handleRemote(d),!1;if(d.data("method"))return b.handleMethod(d),!1});a(b.formSubmitSelector).live("submit.rails",function(c){var d=a(this),f=void 0!==d.data("remote"),e=b.blankInputs(d,b.requiredInputSelector),g=b.nonBlankInputs(d,b.fileInputSelector);if(!b.allowAction(d))return b.stopEverything(c);if(e&&b.fire(d,"ajax:aborted:required",[e]))return!f;
if(f){if(g)return b.fire(d,"ajax:aborted:file",[g]);if(!a.support.submitBubbles&&!1===b.callFormSubmitBindings(d))return b.stopEverything(c);b.handleRemote(d);return!1}setTimeout(function(){b.disableFormElements(d)},13)});a(b.formInputClickSelector).live("click.rails",function(c){var d=a(this);if(!b.allowAction(d))return b.stopEverything(c);c=(c=d.attr("name"))?{name:c,value:d.val()}:null;d.closest("form").data("ujs:submit-button",c)});a(b.formSubmitSelector).live("ajax:beforeSend.rails",function(c){this==
c.target&&b.disableFormElements(a(this))});a(b.formSubmitSelector).live("ajax:complete.rails",function(c){this==c.target&&b.enableFormElements(a(this))})})(jQuery);
$(document).ready(function(){pe.ImageablePhotoStatusSelect.create_all();pe.PhotoQualityStatusSelect.create_all();pe.PhotoStatusSelect.create_all();0<window.photo_types.length&&pe.PhotoTypeSelect.create_all(window.photo_types);$(".MakeLive").click(pe.make_live_clicked);pe.AjaxInput.instantiate();pe.bulk=new pe.BulkPhotoTool($(".BulkPhotoTool"));pe.init_page_framework()});
pe.make_live_clicked=function(a){var b=$(a.target).closest(".MakeLive"),c=b.attr("data_url_param");$.ajax({url:"/admin/photos/"+c+".json",data:{"photo[status]":"live"},type:"PUT",success:pe.bind(pe.make_live_success,b)});a.stopPropagation();return!1};pe.make_live_success=function(a){var b=pe.load(a.closest(".ui-state-default")),b=pe.load(b.find(".PhotoStatusSelect"));pe.load(b.data("widget")).val("live");a.remove()};
