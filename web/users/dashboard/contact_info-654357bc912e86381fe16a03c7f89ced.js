(function(a){var b=(a.browser.msie?"paste":"input")+".mask",f=void 0!=window.orientation;a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};a.fn.extend({caret:function(a,b){if(0!=this.length){if("number"==typeof a)return b="number"==typeof b?b:a,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(a,b);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0);c.moveEnd("character",b);c.moveStart("character",a);c.select()}});if(this[0].setSelectionRange)a=
this[0].selectionStart,b=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var d=document.selection.createRange();a=0-d.duplicate().moveStart("character",-1E5);b=a+d.text.length}return{begin:a,end:b}}},unmask:function(){return this.trigger("unmask")},mask:function(h,l){if(!h&&0<this.length){var d=a(this[0]),c=d.data("tests");return a.map(d.data("buffer"),function(a,b){return c[b]?a:null}).join("")}l=a.extend({placeholder:"_",completed:null},l);var t=a.mask.definitions,
c=[],n=h.length,q=null,m=h.length;a.each(h.split(""),function(a,b){"?"==b?(m--,n=a):t[b]?(c.push(RegExp(t[b])),null==q&&(q=c.length-1)):c.push(null)});return this.each(function(){function d(a){for(;++a<=m&&!c[a];);return a}function w(b){var j=a(this).caret();b=b.keyCode;r=16>b||16<b&&32>b||32<b&&41>b;0!=j.begin-j.end&&(!r||8==b||46==b)&&v(j.begin,j.end);if(8==b||46==b||f&&127==b){for(j=j.begin+(46==b?0:-1);!c[j]&&0<=--j;);for(b=j;b<m;b++)if(c[b]){k[b]=l.placeholder;var e=d(b);if(e<m&&c[b].test(k[e]))k[b]=
k[e];else break}s();g.caret(Math.max(q,j));return!1}if(27==b)return g.val(u),g.caret(0,p()),!1}function x(b){if(r)return r=!1,8==b.keyCode?!1:null;b=b||window.event;var j=b.charCode||b.keyCode||b.which,e=a(this).caret();if(b.ctrlKey||b.altKey||b.metaKey)return!0;if(32<=j&&125>=j||186<j)if(b=d(e.begin-1),b<m&&(j=String.fromCharCode(j),c[b].test(j))){for(var e=b,f=l.placeholder;e<m;e++)if(c[e]){var h=d(e),n=k[e];k[e]=f;if(h<m&&c[h].test(n))f=n;else break}k[b]=j;s();b=d(b);a(this).caret(b);l.completed&&
b==m&&l.completed.call(g)}return!1}function v(a,b){for(var e=a;e<b&&e<m;e++)c[e]&&(k[e]=l.placeholder)}function s(){return g.val(k.join("")).val()}function p(a){for(var b=g.val(),e=-1,d=0,f=0;d<m;d++)if(c[d]){for(k[d]=l.placeholder;f++<b.length;){var h=b.charAt(f-1);if(c[d].test(h)){k[d]=h;e=d;break}}if(f>b.length)break}else k[d]==b[f]&&d!=n&&(f++,e=d);if(!a&&e+1<n)g.val(""),v(0,m);else if(a||e+1>=n)s(),a||g.val(g.val().substring(0,e+1));return n?d:q}var g=a(this),k=a.map(h.split(""),function(a){if("?"!=
a)return t[a]?l.placeholder:a}),r=!1,u=g.val();g.data("buffer",k).data("tests",c);g.attr("readonly")||g.one("unmask",function(){g.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){u=g.val();var a=p();s();setTimeout(function(){a==h.length?g.caret(0,a):g.caret(a)},0)}).bind("blur.mask",function(){p();g.val()!=u&&g.change()}).bind("keydown.mask",w).bind("keypress.mask",x).bind(b,function(){setTimeout(function(){g.caret(p(!0))},0)});p()})}})})(jQuery);
pe.Validator=function(a){this.message=a.message||"Invalid value.";this.callback=a.callback;this.unless_callback=a.unless||function(){return!1};this.options=a;this.value=a.value?a.value:function(b){return a.callback(b)}};pe.Validator.prototype.passed=function(a){return!!this.callback($(a))};pe.Validator.prototype.failed=function(a){return!this.passed(a)};pe.Validator.prototype.unless=function(){return this.unless_callback()};
pe.validation.email_format_validator=new pe.Validator({callback:function(a){return pe.validation.check_email_format(a.val())},message:"Please enter a valid email address."});pe.validation.check_email_format=function(a){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(a))};
pe.validation.name_validator=new pe.Validator({callback:function(a){return _.isEmpty($.trim(a.val()))?(this.message="Required.",!1):50<a.val().length?(this.message="Please shorten your name.",!1):!0},message:"Invalid name."});pe.validation.not_blank_validator=new pe.Validator({callback:function(a){return"checkbox"==a.attr("type")?$(a).is(":checked"):!_.isEmpty($.trim(a.val()))},message:"Required."});
(function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(a){var b,f,h,l,d;b=_.map($(a).find("select"),function(a){return $(a).val()});d=b[2];a=b[0];h=b[1];if(!d||!a||!h)return!1;f=new Date(""+a+"/"+h+"/"+d);l=f.getMonth()+1+"";b=f.getDate()+"";f=f.getFullYear()+"";return l===a&&b===h&&f===d}})}).call(this);(function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(a){return 0<a.find("input:checked").length}})}).call(this);
pe.ValidatableForm=function(a,b,f,h){pe.init_widget(this,a);this.bindings=f||{};this.chained_fields=[];this.errors={};this.rules=b||{};_.each(a.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(a){a=$(a);var b="#"+a.attr("id"),c=a.data("validator");this.rules[b]=c?eval(c):pe.validation.not_blank_validator;(c=a.data("binding"))?this.bindings[b]=c:"text"==a.attr("type")||"textarea"==a.attr("tagName")?this.bindings[b]=
"blur":this.rules[b]==pe.validation.dob_validator?a.find("select").each(this.callback(function(a,c){$(c).change(this.callback(function(){this.validate_field(b)}))})):this.bindings[b]="change"}));this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.after_submit=h;this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(a,b){"string"===typeof a?$(b).bind(a,this.callback(function(){this.validate_field(b)})):"function"===typeof a&&this.callback(a)();this.rules[b].value($(b))&&this.validate_field(b)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var a=this.validate();this.highlight_first_failed();a&&this.after_submit&&this.after_submit();return a};pe.ValidatableForm.prototype.delete_error=function(a){delete this.errors[a];_.each(this.chained_fields,function(b){_.include(b,a)&&_.each(b,function(a){this.errors[a]&&this.delete_error(a)},this)},this)};
pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var a=_.keys(this.errors)[0];this.render_field_error(a)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(a,b){this.render_field_error(b)},this)};
pe.ValidatableForm.prototype.render_field_error=function(a){var b=$(a).parents("li.input:first");0===b.length&&(b=$(a));b.find(".inline-errors").remove();b.append('<span class="inline-errors">'+this.errors[a]+"</span>");b.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(a){var b=$(a).parents("li.input:first");0===b.length&&(b=$(a));b.find(".inline-success").remove();b.append('<img class="inline-success" src="/assets/users/check.png" />');b.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(a){this.render_field_success(a)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(a){var b=this.rules[a],f=b.passed(a);b.unless()?this.delete_error(a):f?(this.delete_error(a),this.render_field_success(a)):(this.errors[a]=$(a).data("message")||b.message,this.render_field_error(a));this.toggle_submit();return f};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};
pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(a,b){a.failed(b)?this.errors[b]=$(b).data("message")||a.message:delete this.errors[b]},this);return this.valid()};pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
(function(){$(function(){var a;$("#Phone").mask("(999) 999-9999");$("#WorkPhone").mask("(999) 999-9999");a={"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Email":pe.validation.email_format_validator,"#Phone":pe.validation.not_blank_validator,"#CompanyName":pe.validation.not_blank_validator,"#BusinessAddress":pe.validation.not_blank_validator,"#BusinessCity":pe.validation.not_blank_validator,"#BusinessState":pe.validation.not_blank_validator,"#BusinessZipCode":pe.validation.not_blank_validator,
"#BusinessCountry":pe.validation.not_blank_validator,"#WorkPhone":pe.validation.not_blank_validator};window.x=new pe.ValidatableForm($("form.ContactInfo"),a,{"#FirstName":"blur","#LastName":"blur","#Email":"blur","#Phone":"blur","#CompanyName":"blur","#BusinessAddress":"blur","#BusinessCity":"blur","#BusinessState":"blur","#BusinessZipCode":"blur","#BusinessCountry":"change","#WorkPhone":"blur"});return pe.init_page_framework()})}).call(this);
