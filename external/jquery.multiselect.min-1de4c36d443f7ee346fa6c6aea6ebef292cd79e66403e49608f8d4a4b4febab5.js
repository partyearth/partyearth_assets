!function(g){var l=0;g.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{}},_create:function(){var e=this.element.hide(),t=this.options;this.speed=g.fx.speeds._default,this._isOpen=!1,e=(this.button=g('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(t.classes).attr({title:e.attr("title"),"aria-haspopup":!0,tabIndex:e.attr("tabIndex")}).insertAfter(e),(this.buttonlabel=g("<span />")).html(t.noneSelectedText).appendTo(e);e=(this.menu=g("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(t.classes).appendTo(document.body);var i=(this.header=g("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(e);(this.headerLinkContainer=g("<ul />")).addClass("ui-helper-reset").html(function(){return!0===t.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+t.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+t.uncheckAllText+"</span></a></li>":"string"==typeof t.header?"<li>"+t.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(i),(this.checkboxContainer=g("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(e),this._bindEvents(),this.refresh(!0),t.multiple||e.addClass("ui-multiselect-single")},_init:function(){!1===this.options.header&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(e){var t=this.element,o=this.options,i=this.menu,s=this.checkboxContainer,r=[],d="",p=t.attr("id")||l++;t.find("option").each(function(e){g(this);var t,i=this.parentNode,s=this.innerHTML,l=this.title,a=this.value,n=(e="ui-multiselect-"+(this.id||p+"-option-"+e),this.disabled),c=this.selected,h=["ui-corner-all"],u=(n?"ui-multiselect-disabled ":" ")+this.className;"OPTGROUP"===i.tagName&&(t=i.getAttribute("label"),-1===g.inArray(t,r)&&(d+='<li class="ui-multiselect-optgroup-label '+i.className+'"><a href="#">'+t+"</a></li>",r.push(t))),n&&h.push("ui-state-disabled"),c&&!o.multiple&&h.push("ui-state-active"),d+='<li class="'+u+'">',d+='<label for="'+e+'" title="'+l+'" class="'+h.join(" ")+'">',d+='<input id="'+e+'" name="multiselect_'+p+'" type="'+(o.multiple?"checkbox":"radio")+'" value="'+a+'" title="'+s+'"',c&&(d+=' checked="checked"',d+=' aria-selected="true"'),n&&(d+=' disabled="disabled"',d+=' aria-disabled="true"'),d+=" /><span>"+s+"</span></label></li>"}),s.html(d),this.labels=i.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this._setMenuWidth(),this.button[0].defaultValue=this.update(),e||this._trigger("refresh")},update:function(){var e=this.options,t=this.inputs,i=t.filter(":checked"),s=i.length;e=0===s?e.noneSelectedText:g.isFunction(e.selectedText)?e.selectedText.call(this,s,t.length,i.get()):/\d/.test(e.selectedList)&&0<e.selectedList&&s<=e.selectedList?i.map(function(){return g(this).next().html()}).get().join(", "):e.selectedText.replace("#",s).replace("#",t.length);return this.buttonlabel.html(e),e},_bindEvents:function(){function e(){return a[a._isOpen?"close":"open"](),!1}var a=this,t=this.button;t.find("span").bind("click.multiselect",e),t.bind({click:e,keypress:function(e){switch(e.which){case 27:case 38:case 37:a.close();break;case 39:case 40:a.open()}},mouseenter:function(){t.hasClass("ui-state-disabled")||g(this).addClass("ui-state-hover")},mouseleave:function(){g(this).removeClass("ui-state-hover")},focus:function(){t.hasClass("ui-state-disabled")||g(this).addClass("ui-state-focus")},blur:function(){g(this).removeClass("ui-state-focus")}}),this.header.delegate("a","click.multiselect",function(e){g(this).hasClass("ui-multiselect-close")?a.close():a[g(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),e.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(e){e.preventDefault();var t=(s=g(this)).parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),i=t.get(),s=s.parent().text();!1!==a._trigger("beforeoptgrouptoggle",e,{inputs:i,label:s})&&(a._toggleChecked(t.filter(":checked").length!==t.length,t),a._trigger("optgrouptoggle",e,{inputs:i,label:s,checked:i[0].checked}))}).delegate("label","mouseenter.multiselect",function(){g(this).hasClass("ui-state-disabled")||(a.labels.removeClass("ui-state-hover"),g(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(e){switch(e.preventDefault(),e.which){case 9:case 27:a.close();break;case 38:case 40:case 37:case 39:a._traverse(e.which,this);break;case 13:g(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(e){var t=g(this),i=this.value,s=this.checked,l=a.element.find("option");this.disabled||!1===a._trigger("click",e,{value:i,text:this.title,checked:s})?e.preventDefault():(t.focus(),t.attr("aria-selected",s),l.each(function(){this.value===i?this.selected=s:a.options.multiple||(this.selected=!1)}),a.options.multiple||(a.labels.removeClass("ui-state-active"),t.closest("label").toggleClass("ui-state-active",s),a.close()),a.element.trigger("change"),setTimeout(g.proxy(a.update,a),10))}),g(document).bind("mousedown.multiselect",function(e){a._isOpen&&!g.contains(a.menu[0],e.target)&&!g.contains(a.button[0],e.target)&&e.target!==a.button[0]&&a.close()}),g(this.element[0].form).bind("reset.multiselect",function(){setTimeout(g.proxy(a.refresh,a),10)})},_setButtonWidth:function(){var e=this.element.outerWidth(),t=this.options;/\d/.test(t.minWidth)&&e<t.minWidth&&(e=t.minWidth),this.button.width(e)},_setMenuWidth:function(){var e=this.menu,t=this.button.outerWidth()-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10)-parseInt(e.css("border-right-width"),10)-parseInt(e.css("border-left-width"),10);e.width(t||this.button.outerWidth())},_traverse:function(e,t){var i,s=38===e||37===e;(i=(i=g(t)).parent()[s?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[s?"last":"first"]()).length?i.find("label").trigger("mouseover"):(i=this.menu.find("ul").last(),this.menu.find("label")[s?"last":"first"]().trigger("mouseover"),i.scrollTop(s?i.height():0))},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(e,t){var i=t&&t.length?t:this.inputs,s=this;i.each(this._toggleState("checked",e)),i.eq(0).focus(),this.update();var l=i.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&-1<g.inArray(this.value,l)&&s._toggleState("selected",e).call(this)}),i.length&&this.element.trigger("change")},_toggleDisabled:function(e){this.button.attr({disabled:e,"aria-disabled":e})[e?"addClass":"removeClass"]("ui-state-disabled");var t=this.menu.find("input");(t=e?t.filter(":enabled").data("ech-multiselect-disabled",!0):t.filter(function(){return!0===g.data(this,"ech-multiselect-disabled")}).removeData("ech-multiselect-disabled")).attr({disabled:e,"arial-disabled":e}).parent()[e?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:e,"aria-disabled":e})},open:function(){var e=this.button,t=this.menu,i=this.speed,s=this.options,l=[];if(!1!==this._trigger("beforeopen")&&!e.hasClass("ui-state-disabled")&&!this._isOpen){var a=t.find("ul").last(),n=s.show,c=e.offset();g.isArray(s.show)&&(n=s.show[0],i=s.show[1]||this.speed),n&&(l=[n,i]),a.scrollTop(0).height(s.height),g.ui.position&&!g.isEmptyObject(s.position)?(s.position.of=s.position.of||e,t.show().position(s.position).hide()):t.css({top:c.top+e.outerHeight(),left:c.left}),g.fn.show.apply(t,l),this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),e.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var e=this.options,t=e.hide,i=this.speed,s=[];g.isArray(e.hide)&&(t=e.hide[0],i=e.hide[1]||this.speed),t&&(s=[t,i]),g.fn.hide.apply(this.menu,s),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return g.Widget.prototype.destroy.call(this),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(e,t){var i=this.menu;switch(e){case"header":i.find("div.ui-multiselect-header")[t?"show":"hide"]();break;case"checkAllText":i.find("a.ui-multiselect-all span").eq(-1).text(t);break;case"uncheckAllText":i.find("a.ui-multiselect-none span").eq(-1).text(t);break;case"height":i.find("ul").last().height(parseInt(t,10));break;case"minWidth":this.options[e]=parseInt(t,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[e]=t,this.update();break;case"classes":i.add(this.button).removeClass(this.options.classes).addClass(t);break;case"multiple":i.toggleClass("ui-multiselect-single",!t),this.options.multiple=t,this.element[0].multiple=t,this.refresh()}g.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);