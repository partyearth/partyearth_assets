(function(){var b,c,d,g,a,e={}.hasOwnProperty;c=function(a,b){function c(){this.constructor=a}for(var f in b)e.call(b,f)&&(a[f]=b[f]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};var l=this,f=function(){};d=b=this.Stripe=(f.version=2,f.endpoint="https://api.stripe.com/v1",f.setPublishableKey=function(a){f.key=a},f.complete=function(a){return function(e){var b;if("success"!==e)return b=Math.round((new Date).getTime()/1E3),(new Image).src="http://q.stripe.com?event=stripejs-error&type="+
e+"&key="+f.key+"&timestamp="+b,"function"==typeof a?a(500,{error:{code:e,type:e,message:"An unexpected error has occurred with Stripe.js. This may\nbe due to network connectivity issues, so you should try\nagain (you won't be charged twice). If you're still having\nproblems, please let us know!"}}):void 0}},f);g=function(){};g=(g.validate=function(a,e){if(!a)throw e+" required";if("object"!=typeof a)throw e+" invalid";},g.formatData=function(a,e){return b.utils.isElement(a)&&(a=b.utils.paramsFromForm(a,
e)),b.utils.underscoreKeys(a),a},g.create=function(a,e){return a.key||(a.key=b.key||b.publishableKey),b.utils.validateKey(a.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens",data:a,method:"POST",success:function(a,b){return"function"==typeof e?e(b,a):void 0},complete:b.complete(e),timeout:4E4})},g.get=function(a,e){if(!a)throw"token required";return b.utils.validateKey(b.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens/"+a,data:{key:b.key},success:function(a,b){return"function"==typeof e?e(b,a):void 0},complete:b.complete(e),
timeout:4E4})},g);d.token=g;d=this.Stripe;var j=function(){return j.__super__.constructor.apply(this,arguments)};c(j,this.Stripe.token);j.tokenName="card";j.whitelistedAttrs="number cvc exp_month exp_year name address_line1 address_line2 address_city address_state address_zip address_country".split(" ");j.createToken=function(a,e,c){var f;return null==e&&(e={}),b.token.validate(a,"card"),"function"==typeof e?(c=e,e={}):"object"!=typeof e&&(f=parseInt(e,10),e={},0<f&&(e.amount=f)),e[j.tokenName]=b.token.formatData(a,
j.whitelistedAttrs),b.token.create(e,c)};j.getToken=function(a,e){return b.token.get(a,e)};j.validateCardNumber=function(a){return a=(a+"").replace(/\s+|-/g,""),10<=a.length&&16>=a.length&&j.luhnCheck(a)};j.validateCVC=function(a){return a=b.utils.trim(a),/^\d+$/.test(a)&&3<=a.length&&4>=a.length};j.validateExpiry=function(a,e){var c,f;return a=b.utils.trim(a),e=b.utils.trim(e),/^\d+$/.test(a)?/^\d+$/.test(e)?12>=parseInt(a,10)?(f=new Date(e,a),c=new Date,f.setMonth(f.getMonth()-1),f.setMonth(f.getMonth()+
1,1),f>c):!1:!1:!1};j.luhnCheck=function(a){var e,b,f,c,l;b=!0;f=0;e=(a+"").split("").reverse();c=0;for(l=e.length;c<l;c++){a=e[c];a=parseInt(a,10);if(b=!b)a*=2;9<a&&(a-=9);f+=a}return 0===f%10};j.cardType=function(a){return j.cardTypes[a.slice(0,2)]||"Unknown"};var k;a={};for(g=k=40;49>=k;g=++k)a[g]="Visa";for(g=k=50;59>=k;g=++k)a[g]="MasterCard";g=(a[34]=a[37]="American Express",a[60]=a[62]=a[64]=a[65]="Discover",a[35]="JCB",a[30]=a[36]=a[38]=a[39]="Diners Club",a);g=(j.cardTypes=g,j);d.card=g;
d=this.Stripe;var h=function(){return h.__super__.constructor.apply(this,arguments)};c=(c(h,this.Stripe.token),h.tokenName="bank_account",h.whitelistedAttrs=["country","routing_number","account_number"],h.createToken=function(a,e,f){return null==e&&(e={}),b.token.validate(a,"bank account"),"function"==typeof e&&(f=e,e={}),e[h.tokenName]=b.token.formatData(a,h.whitelistedAttrs),b.token.create(e,f)},h.getToken=function(a,e){return b.token.get(a,e)},h.validateRoutingNumber=function(a,e){a=b.utils.trim(a);
switch(e){case "US":return/^\d+$/.test(a)&&9===a.length&&h.routingChecksum(a);case "CA":return/\d{5}\-\d{3}/.test(a)&&9===a.length;default:return!0}},h.validateAccountNumber=function(a,e){a=b.utils.trim(a);switch(e){case "US":return/^\d+$/.test(a)&&1<=a.length&&17>=a.length;default:return!0}},h.routingChecksum=function(a){var e,b,f,c,l;b=0;a=(a+"").split("");l=[0,3,6];f=0;for(c=l.length;f<c;f++)e=l[f],b+=3*parseInt(a[e]),b+=7*parseInt(a[e+1]),b+=parseInt(a[e+2]);return 0!==b&&0===b%10},h);d.bankAccount=
c;c="createToken getToken cardType validateExpiry validateCVC validateCardNumber".split(" ");g=0;for(a=c.length;g<a;g++)d=c[g],this.Stripe[d]=this.Stripe.card[d];"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe);"function"==typeof define&&define("stripe",[],function(){return l.Stripe})}).call(this);
(function(){var b,c,d,g=[].slice;b=encodeURIComponent;c=(new Date).getTime();d=function(a,e,c){var f,g;null==e&&(e=[]);for(f in a)g=a[f],c&&(f=""+c+"["+f+"]"),"object"==typeof g?d(g,e,f):e.push(""+f+"="+b(g));return e.join("&").replace(/%20/g,"+")};this.Stripe.ajaxJSONP=function(a){var e,b,f,j,k,h;return null==a&&(a={}),f="sjsonp"+ ++c,k=document.createElement("script"),b=null,e=function(e){var c;return null==e&&(e="abort"),clearTimeout(b),null!=(c=k.parentNode)&&c.removeChild(k),f in window&&(window[f]=
function(){}),"function"==typeof a.complete?a.complete(e,h,a):void 0},h={abort:e},k.onerror=function(){return h.abort(),"function"==typeof a.error?a.error(h,a):void 0},window[f]=function(){var e;e=1<=arguments.length?g.call(arguments,0):[];clearTimeout(b);k.parentNode.removeChild(k);try{delete window[f]}catch(c){window[f]=void 0}return"function"==typeof a.success&&a.success.apply(a,e),"function"==typeof a.complete?a.complete("success",h,a):void 0},a.data||(a.data={}),a.data.callback=f,a.method&&(a.data._method=
a.method),k.src=a.url+"?"+d(a.data),j=document.getElementsByTagName("head")[0],j.appendChild(k),0<a.timeout&&(b=setTimeout(function(){return h.abort("timeout")},a.timeout)),h}}).call(this);
(function(){var b=[].indexOf||function(b){for(var a=0,e=this.length;a<e;a++)if(a in this&&this[a]===b)return a;return-1},c=this.Stripe,d;d=function(){};d=(d.trim=function(b){return(b+"").replace(/^\s+|\s+$/g,"")},d.underscore=function(b){return(b+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},d.underscoreKeys=function(b){var a,e,c;c=[];for(a in b)e=b[a],delete b[a],c.push(b[this.underscore(a)]=e);return c},d.isElement=function(b){return"object"!=typeof b?!1:"undefined"!=
typeof jQuery&&null!==jQuery&&b instanceof jQuery?!0:1===b.nodeType},d.paramsFromForm=function(c,a){var e,d,f,j,k,h,p;null==a&&(a=[]);"undefined"!=typeof jQuery&&null!==jQuery&&c instanceof jQuery&&(c=c[0]);f=c.getElementsByTagName("input");j=c.getElementsByTagName("select");k={};h=0;for(p=f.length;h<p;h++)d=f[h],e=this.underscore(d.getAttribute("data-stripe")),0>b.call(a,e)||(k[e]=d.value);f=0;for(h=j.length;f<h;f++)d=j[f],e=this.underscore(d.getAttribute("data-stripe")),0>b.call(a,e)||null!=d.selectedIndex&&
(k[e]=d.options[d.selectedIndex].value);return k},d.validateKey=function(b){if(!b||"string"!=typeof b)throw Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(b))throw Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(b))throw Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js");
},d);c.utils=d}).call(this);
(function(){var b=[].indexOf||function(b){for(var d=0,g=this.length;d<g;d++)if(d in this&&this[d]===b)return d;return-1};this.Stripe.validator={"boolean":function(b,d){if("true"!==d&&"false"!==d)return"Enter a boolean string (true or false)"},integer:function(b,d){if(!/^\d+$/.test(d))return"Enter an integer"},positive:function(b,d){if(this.integer(b,d)||!(0<parseInt(d,10)))return"Enter a positive value"},range:function(c,d){var g;if(g=parseInt(d,10),0>b.call(c,g))return"Needs to be between "+c[0]+
" and "+c[c.length-1]},required:function(b,d){if(b&&(null==d||""===d))return"Required"},year:function(b,d){if(!/^\d{4}$/.test(d))return"Enter a 4-digit year"},birthYear:function(b,d){var g;if(g=this.year(b,d))return g;if(2E3<parseInt(d,10))return"You must be over 18";if(1900>parseInt(d,10))return"Enter your birth year"},month:function(b,d){if(this.integer(b,d))return"Please enter a month";if(this.range([1,2,3,4,5,6,7,8,9,10,11,12],d))return"Needs to be between 1 and 12"},choices:function(c,d){if(0>
b.call(c,d))return"Not an acceptable value for this field"},email:function(b,d){if(!/^[^@<\s>]+@[^@<\s>]+$/.test(d))return"That doesn't look like an email address"},url:function(b,d){if(!/^https?:\/\/.+\..+/.test(d))return"Not a valid url"},usTaxID:function(b,d){if(!/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(d))return"Not a valid tax ID"},ein:function(b,d){if(!/^\d{2}-?\d{7}$/.test(d))return"Not a valid EIN"},ssnLast4:function(b,d){if(!/^\d{4}$/.test(d))return"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(b,
d){var g;a:{switch(b){case "CA":g=/^\d{3}-?\d{3}-?\d{3}$/.test(d);break a;case "US":g=!0;break a}g=void 0}if(!g)return"Not a valid ID"},bizTaxID:function(b,d){var g,a,e,l,f,j;a={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]}[b];if(null!=a){g=a[0];l=a[1];a=!1;f=0;for(j=l.length;f<j;f++)if(e=l[f],e.test(d)){a=!0;break}if(!a)return"Not a valid "+g}},zip:function(b,d){var g;a:{switch(b.toUpperCase()){case "CA":g=/^[\d\w]{6}$/.test(null!=d?d.replace(/\s+/g,""):void 0);break a;case "US":g=/^\d{5}$/.test(d)||
/^\d{9}$/.test(d);break a}g=void 0}if(!g)return"Not a valid zip"},bankAccountNumber:function(b,d){if(!/^\d{1,17}$/.test(d))return"Invalid bank account number"},usRoutingNumber:function(b){var d,g,a,e,l,f;if(!/^\d{9}$/.test(b))return"Routing number must have 9 digits";d=l=e=0;for(f=b.length-1;l<=f;d=l+=3)g=3*parseInt(b.charAt(d),10),a=7*parseInt(b.charAt(d+1),10),d=parseInt(b.charAt(d+2),10),e+=g+a+d;if(0===e||0!==e%10)return"Invalid routing number"},caRoutingNumber:function(b){if(!/^\d{5}\-\d{3}$/.test(b))return"Invalid transit number"},
routingNumber:function(b,d){switch(b.toUpperCase()){case "CA":return this.caRoutingNumber(d);case "US":return this.usRoutingNumber(d)}},phoneNumber:function(b,d){if(10!==d.replace(/[^0-9]/g,"").length)return"Invalid phone number"},bizDBA:function(b,d){if(!/^.{1,23}$/.test(d))return"Statement descriptors can only have up to 23 characters"},nameLength:function(b,d){if(1===d.length)return"Names need to be longer than one character"}}}).call(this);
pe.routes={map:{search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",
new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",
map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",
user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",
tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",send_message:"/services/contact_messages/",
subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile"}};
pe.routes.build_path=function(b,c){var d=pe.routes.map[b],g=d.match(/\{\{\*(.+)\}\}/);_.each(g,function(a){c[a]&&(c[a]=c[a].join("/"))});d=d.replace(/\*/,"");c=c||{};return pe.routes.clean_url(pe.templatize(d,c))};pe.routes.clean_url=function(b){return("/"+b).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var b=pe.routes.recognize_path(window.location.pathname);return b?b.params:{}};
pe.routes.recognize_path=function(b){b=pe.routes.clean_url(b);var c,d,g=_.find(_.keys(pe.routes.map),function(a){c=pe.routes.map[a];d=RegExp(c.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return d.test(b)});if(g){for(var a=_.map(c.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),e=b.match(d).slice(1,99),l={params:{}},f=function(a){return!_.isEmpty(a)},j=0;j<a.length;j++)"*"==a[j][0]&&(a[j]=a[j].replace(/\*/g,""),e[j]=_.select(e[j].replace(/\*/g,"").split("/"),f)),
l.params[a[j]]=e[j];l.path_info={name:g,template:c};return l}return!1};pe.routes.Request=function(b,c,d){pe.routes.map[b]?(this.path=b,"object"!==typeof c&&(c={id:c}),this.params=c,this.callback=d):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(b,c,d){return new pe.routes.Request(b,c,d)};pe.routes.Request.from_current_location=function(b,c,d){c=c||{};var g=pe.routes.current_url_params();return new pe.routes.Request(b,_.extend(g,c),d)};
pe.routes.Request.prototype.ajax=function(b,c){var d="function"===typeof c?c:this.callback;$.ajax({url:this.build_path(),data:this.params,type:b,success:d})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(b){this.ajax("GET",b)};pe.routes.Request.prototype.post=function(b){this.ajax("POST",b)};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},c=pe,d=function(d,a,e){this.form=d;this.path_name=a;this.on_success=e;this.on_submit_button_clicked=b(this.on_submit_button_clicked,this);this.on_submit=b(this.on_submit,this);this.on_charge=b(this.on_charge,this);if(!this.init_stripe())return this.form.submit(function(a){return a.preventDefault()}),!1;this.errors_container=this.form.find(".Errors");this.messages_container=this.form.find(".Messages");this.card_inputs=
this.form.find(".CardInput");this.billing_inputs=this.form.find(".BillingInput");this.submit_button=this.form.find(".SubmitButton");this.submit_button.click(this.on_submit_button_clicked);this.form.submit(this.on_submit)};d.prototype.collect_card_data=function(b){var a;a={};_.each(b,function(b){var d;b=$(b);"radio"===b.attr("type")&&(b=b.filter(":checked"));if(0<b.length&&(d=b.data("key")))return a[d]=b.val()});return a};d.prototype.init_stripe=function(){if(window.publishable_stripe_key)return Stripe.setPublishableKey(window.publishable_stripe_key),
!0;alert("No window.publishable_stripe_key set to use stripe");return!1};d.prototype.on_charge=function(b,a){var e,d=this;if(a&&a.error)return $("body").css("cursor","inherit"),this.show_error(a.error.message);this.show_message("Please wait...");e=this.collect_card_data(this.billing_inputs);e={id:e.id,ticket_order:e};e.card_token=a?a.id:"failed";return pe.routes.Request.factory(this.path_name,e).post(function(a){$("body").css("cursor","inherit");if(1===a.status)return d.show_error(a.message);if(d.on_success)return d.on_success()})};
d.prototype.on_submit=function(b){b&&b.preventDefault();return!1};d.prototype.charge=function(){$("body").css("cursor","wait");return Stripe.card.createToken(this.collect_card_data(this.card_inputs),this.on_charge)};d.prototype.on_submit_button_clicked=function(){return this.charge()};d.prototype.show_error=function(b){this.errors_container.show().html(b);this.messages_container.hide();pe.install_easing();pe.animated_scrolling(this.errors_container,10);return _.each(this.card_inputs,function(a){return $(a).val("")})};
d.prototype.show_message=function(){return this.errors_container.hide()};c.StripeForm=d}).call(this);
pe.Floater=function(b,c,d){pe.init_widget(this,b);this.bottom_margin=d||0;this.start_point_div=b.find(".FloatingAreaStart");this.end_point_div=c||null;this.stop_at=this.start_from=0;this.sticked=this.is_floating=!1;this.floater=this.container.find(".Floater");this.offset=0;this.disabled=!1;this.top=parseInt(this.floater.css("margin-top"),10)||0;$(window).scroll(this.callback(this.scrolling));this.set_floating_area();pe.Floater.register_floater(this)};
pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"};pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top;this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)};
pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var b=$(window).scrollTop(),c=b+this.offset+this.bottom_margin<=this.start_from,d=b+this.offset+this.bottom_margin>this.start_from,g=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;!this.is_floating&&d&&!g&&!this.sticked?(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this)):this.is_floating&&c?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,
this)):this.end_point_div&&(!this.sticked&&g?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&b+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick())}};pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed");this.floater.removeClass("bottom");this.is_floating=!0;this.sticked=!1;this.set_offset()};
pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.sticked=!0};pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.disabled=this.sticked=!0};
pe.Floater.prototype.enable=function(){this.disabled=!1};pe.Floater.prototype.unstick=function(){this.floater.css("margin-top","");this.floater.css("top","");this.floater.css("position","");this.start_floating();this.fire_event(pe.Floater.events.FLOATING,this)};pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top","");this.floater.removeClass("fixed");this.floater.removeClass("bottom");this.sticked=this.is_floating=!1;this.set_offset()};
pe.Floater.prototype.set_offset=function(b){b&&(this.offset=b);0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")};pe.Floater.registered_floaters=[];pe.Floater.register_floater=function(b){pe.Floater.registered_floaters.push(b);pe.Floater.update_positions()};
pe.Floater.update_positions=function(){pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(b){return b.container.offset().top},null);if(pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var b=1;b<pe.Floater.registered_floaters.length;b++){var c=pe.Floater.registered_floaters[b-1].offset+pe.Floater.registered_floaters[b-1].floater.outerHeight();pe.Floater.registered_floaters[b].offset=c;pe.Floater.registered_floaters[b].is_floating&&
pe.Floater.registered_floaters[b].start_floating();pe.Floater.registered_floaters[b].set_floating_area()}};pe.Validator=function(b){this.message=b.message||"Invalid value.";this.callback=b.callback;this.value=b.value?b.value:function(c){return b.callback(c)}};pe.Validator.prototype.passed=function(b){return!!this.callback($(b))};pe.Validator.prototype.failed=function(b){return!this.passed(b)};
pe.validation.name_validator=new pe.Validator({callback:function(b){return _.isEmpty($.trim(b.val()))?(this.message="Field cannot be blank.",!1):50<b.val().length?(this.message="Please shorten your name.",!1):!0},message:"Invalid name."});pe.validation.not_blank_validator=new pe.Validator({callback:function(b){return!_.isEmpty($.trim(b.val()))},message:"Field cannot be blank."});
pe.validation.cc_number_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCardNumber(b.val())},message:"Invalid card number."});pe.validation.cvc_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCVC(b.val())},message:"Invalid CVC."});pe.validation.zip_code_validator=new pe.Validator({callback:function(b){return!!b.val().match(/^\d{5}(\s*\-\s*\d{4})?$/)},message:"Please enter a valid zip code."});
pe.validation.email_format_validator=new pe.Validator({callback:function(b){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(b.val()))},message:"Please enter a valid email address. Your confirmation and tickets will be sent to this address"});
pe.ValidatableForm=function(b,c,d){pe.init_widget(this,b);this.bindings=d||{};this.chained_fields=[];this.errors={};this.rules=c||{};this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(b,c){"string"===typeof b?$(c).bind(b,this.callback(function(){this.validate_field(c)})):"function"===typeof b&&this.callback(b)();this.rules[c].value($(c))&&this.validate_field(c)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var b=this.validate();this.highlight_first_failed();return b};pe.ValidatableForm.prototype.delete_error=function(b){delete this.errors[b];_.each(this.chained_fields,function(c){_.include(c,b)&&_.each(c,function(b){this.errors[b]&&this.delete_error(b)},this)},this)};pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};
pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var b=_.keys(this.errors)[0];this.render_field_error(b)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(b,c){this.render_field_error(c)},this)};
pe.ValidatableForm.prototype.render_field_error=function(b){var c=$(b).parents("li.input");0===c.length&&(c=$(b));c.find(".inline-errors").remove();c.append('<span class="inline-errors">'+this.errors[b]+"</span>");c.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(b){var c=$(b).parents("li.input");0===c.length&&(c=$(b));c.find(".inline-success").remove();c.append('<img class="inline-success" src="/assets/users/check.png" />');c.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(b){this.render_field_success(b)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(b){var c=this.rules[b],d=c.passed(b);d?(this.delete_error(b),this.render_field_success(b)):(this.errors[b]=c.message,this.render_field_error(b));this.toggle_submit();return d};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(b,c){b.failed(c)&&(this.errors[c]=b.message)},this);return this.valid()};
pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},c=pe,d=function(d){this.container=d;this.show_message=b(this.show_message,this);this.on_submit=b(this.on_submit,this);this.show_form=b(this.show_form,this);this.link=this.container.find(".Link");this.link.click(this.show_form);this.form_container=this.container.find(".FormContainer");this.form=this.form_container.find("form");this.form.submit(this.on_submit);this.message=this.container.find(".Message")};d.prototype.show_form=
function(){var b;b=new pe.Validator({callback:function(a){a=$.trim(a.val());if(_.isEmpty(a))return this.message="Email cannot be blank.",!1;this.message="Invalid email.";return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test(a)}});new pe.ValidatableForm(this.form,{"#question_name":pe.validation.name_validator,"#question_email":b,"#question_text":pe.validation.not_blank_validator},{"#question_name":"keyup","#question_email":"keyup","#question_text":"keyup"});this.link.hide();return this.form_container.show()};
d.prototype.on_submit=function(b){b.preventDefault();$.post(pe.routes.build_path("ask_party_earth"),this.form.serialize(),"json");return this.show_message()};d.prototype.show_message=function(){this.form_container.hide();return this.message.show()};c.AskPartyEarth=d}).call(this);
(function(b){function c(){function a(b){b=1E12>b?d?performance.now()+performance.timing.navigationStart:e():b||e();1E3<=b-c&&(g._updateTargets(),c=b);f(a)}this.regional=[];this.regional[""]={labels:"Years Months Weeks Days Hours Minutes Seconds".split(" "),labels1:"Year Month Week Day Hour Minute Second".split(" "),compactLabels:["y","m","w","d"],whichLabels:null,digits:"0123456789".split(""),timeSeparator:":",isRTL:!1};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",
layout:"",compact:!1,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:!1,onExpiry:null,onTick:null,tickInterval:1};b.extend(this._defaults,this.regional[""]);this._serverSyncs=[];var e="function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},d=window.performance&&"function"==typeof window.performance.now,f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
null,c=0;!f||b.noRequestAnimationFrame?(b.noRequestAnimationFrame=null,setInterval(function(){g._updateTargets()},980)):(c=window.animationStartTime||window.webkitAnimationStartTime||window.mozAnimationStartTime||window.oAnimationStartTime||window.msAnimationStartTime||e(),f(a))}b.extend(c.prototype,{markerClassName:"hasCountdown",propertyName:"countdown",_rtlClass:"countdown_rtl",_sectionClass:"countdown_section",_amountClass:"countdown_amount",_rowClass:"countdown_row",_holdingClass:"countdown_holding",
_showClass:"countdown_show",_descrClass:"countdown_descr",_timerTargets:[],setDefaults:function(a){this._resetExtraLabels(this._defaults,a);b.extend(this._defaults,a||{})},UTCDate:function(a,b,d,f,c,g,h,p){"object"==typeof b&&b.constructor==Date&&(p=b.getMilliseconds(),h=b.getSeconds(),g=b.getMinutes(),c=b.getHours(),f=b.getDate(),d=b.getMonth(),b=b.getFullYear());var n=new Date;n.setUTCFullYear(b);n.setUTCDate(1);n.setUTCMonth(d||0);n.setUTCDate(f||1);n.setUTCHours(c||0);n.setUTCMinutes((g||0)-(30>
Math.abs(a)?60*a:a));n.setUTCSeconds(h||0);n.setUTCMilliseconds(p||0);return n},periodsToSeconds:function(a){return 31557600*a[0]+2629800*a[1]+604800*a[2]+86400*a[3]+3600*a[4]+60*a[5]+a[6]},_attachPlugin:function(a,e){a=b(a);if(!a.hasClass(this.markerClassName)){var d={options:b.extend({},this._defaults),_periods:[0,0,0,0,0,0,0]};a.addClass(this.markerClassName).data(this.propertyName,d);this._optionPlugin(a,e)}},_addTarget:function(a){this._hasTarget(a)||this._timerTargets.push(a)},_hasTarget:function(a){return-1<
b.inArray(a,this._timerTargets)},_removeTarget:function(a){this._timerTargets=b.map(this._timerTargets,function(b){return b==a?null:b})},_updateTargets:function(){for(var a=this._timerTargets.length-1;0<=a;a--)this._updateCountdown(this._timerTargets[a])},_optionPlugin:function(a,e,d){a=b(a);var f=a.data(this.propertyName);if(!e||"string"==typeof e&&null==d){var c=e;return(e=(f||{}).options)&&c?e[c]:e}a.hasClass(this.markerClassName)&&(e=e||{},"string"==typeof e&&(c=e,e={},e[c]=d),e.layout&&(e.layout=
e.layout.replace(/&lt;/g,"<").replace(/&gt;/g,">")),this._resetExtraLabels(f.options,e),d=f.options.timezone!=e.timezone,b.extend(f.options,e),this._adjustSettings(a,f,null!=e.until||null!=e.since||d),e=new Date,(f._since&&f._since<e||f._until&&f._until>e)&&this._addTarget(a[0]),this._updateCountdown(a,f))},_updateCountdown:function(a,e){var d=b(a);if(e=e||d.data(this.propertyName)){d.html(this._generateHTML(e)).toggleClass(this._rtlClass,e.options.isRTL);if(b.isFunction(e.options.onTick)){var f=
"lap"!=e._hold?e._periods:this._calculatePeriods(e,e._show,e.options.significant,new Date);(1==e.options.tickInterval||0==this.periodsToSeconds(f)%e.options.tickInterval)&&e.options.onTick.apply(a,[f])}if("pause"!=e._hold&&(e._since?e._now.getTime()<e._since.getTime():e._now.getTime()>=e._until.getTime())&&!e._expiring){e._expiring=!0;if(this._hasTarget(a)||e.options.alwaysExpire)this._removeTarget(a),b.isFunction(e.options.onExpiry)&&e.options.onExpiry.apply(a,[]),e.options.expiryText&&(f=e.options.layout,
e.options.layout=e.options.expiryText,this._updateCountdown(a,e),e.options.layout=f),e.options.expiryUrl&&(window.location=e.options.expiryUrl);e._expiring=!1}else"pause"==e._hold&&this._removeTarget(a);d.data(this.propertyName,e)}},_resetExtraLabels:function(a,b){var d=!1,f;for(f in b)if("whichLabels"!=f&&f.match(/[Ll]abels/)){d=!0;break}if(d)for(f in a)f.match(/[Ll]abels[02-9]|compactLabels1/)&&(a[f]=null)},_adjustSettings:function(a,e,d){for(var f=0,f=null,c=0;c<this._serverSyncs.length;c++)if(this._serverSyncs[c][0]==
e.options.serverSync){f=this._serverSyncs[c][1];break}null!=f?(f=e.options.serverSync?f:0,a=new Date):(f=b.isFunction(e.options.serverSync)?e.options.serverSync.apply(a,[]):null,a=new Date,f=f?a.getTime()-f.getTime():0,this._serverSyncs.push([e.options.serverSync,f]));c=e.options.timezone;c=null==c?-a.getTimezoneOffset():c;if(d||!d&&null==e._until&&null==e._since)e._since=e.options.since,null!=e._since&&(e._since=this.UTCDate(c,this._determineTime(e._since,null)),e._since&&f&&e._since.setMilliseconds(e._since.getMilliseconds()+
f)),e._until=this.UTCDate(c,this._determineTime(e.options.until,a)),f&&e._until.setMilliseconds(e._until.getMilliseconds()+f);e._show=this._determineShow(e)},_destroyPlugin:function(a){a=b(a);a.hasClass(this.markerClassName)&&(this._removeTarget(a[0]),a.removeClass(this.markerClassName).empty().removeData(this.propertyName))},_pausePlugin:function(a){this._hold(a,"pause")},_lapPlugin:function(a){this._hold(a,"lap")},_resumePlugin:function(a){this._hold(a,null)},_hold:function(a,e){var d=b.data(a,
this.propertyName);if(d){if("pause"==d._hold&&!e){d._periods=d._savePeriods;var f=d._since?"-":"+";d[d._since?"_since":"_until"]=this._determineTime(f+d._periods[0]+"y"+f+d._periods[1]+"o"+f+d._periods[2]+"w"+f+d._periods[3]+"d"+f+d._periods[4]+"h"+f+d._periods[5]+"m"+f+d._periods[6]+"s");this._addTarget(a)}d._hold=e;d._savePeriods="pause"==e?d._periods:null;b.data(a,this.propertyName,d);this._updateCountdown(a,d)}},_getTimesPlugin:function(a){a=b.data(a,this.propertyName);return!a?null:"pause"==
a._hold?a._savePeriods:!a._hold?a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date)},_determineTime:function(a,b){var d;if(null==a)d=b;else if("string"==typeof a){d=a.toLowerCase();for(var f=new Date,c=f.getFullYear(),k=f.getMonth(),h=f.getDate(),p=f.getHours(),n=f.getMinutes(),f=f.getSeconds(),m=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,r=m.exec(d);r;){switch(r[2]||"s"){case "s":f+=parseInt(r[1],10);break;case "m":n+=parseInt(r[1],10);break;case "h":p+=parseInt(r[1],10);break;case "d":h+=
parseInt(r[1],10);break;case "w":h+=7*parseInt(r[1],10);break;case "o":k+=parseInt(r[1],10);h=Math.min(h,g._getDaysInMonth(c,k));break;case "y":c+=parseInt(r[1],10),h=Math.min(h,g._getDaysInMonth(c,k))}r=m.exec(d)}d=new Date(c,k,h,p,n,f,0)}else"number"==typeof a?(d=new Date,d.setTime(d.getTime()+1E3*a)):d=a;d&&d.setMilliseconds(0);return d},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_normalLabels:function(a){return a},_generateHTML:function(a){var e=this;a._periods=a._hold?
a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date);for(var d=!1,c=0,j=a.options.significant,k=b.extend({},a._show),h=0;6>=h;h++)d|="?"==a._show[h]&&0<a._periods[h],k[h]="?"==a._show[h]&&!d?null:a._show[h],c+=k[h]?1:0,j-=0<a._periods[h]?1:0;for(var p=[!1,!1,!1,!1,!1,!1,!1],h=6;0<=h;h--)a._show[h]&&(a._periods[h]?p[h]=!0:(p[h]=0<j,j--));var n=a.options.compact?a.options.compactLabels:a.options.labels,m=a.options.whichLabels||this._normalLabels,d=function(b){var d=a.options["compactLabels"+
m(a._periods[b])];return k[b]?e._translateDigits(a,a._periods[b])+(d?d[b]:n[b])+" ":""},j=function(b){var d=a.options["labels"+m(a._periods[b])];return!a.options.significant&&k[b]||a.options.significant&&p[b]?'<span class="'+g._sectionClass+'"><span class="'+g._amountClass+'">'+e._translateDigits(a,a._periods[b])+"</span><br/>"+(d?d[b]:n[b])+"</span>":""};return a.options.layout?this._buildLayout(a,k,a.options.layout,a.options.compact,a.options.significant,p):(a.options.compact?'<span class="'+this._rowClass+
" "+this._amountClass+(a._hold?" "+this._holdingClass:"")+'">'+d(0)+d(1)+d(2)+d(3)+(k[4]?this._minDigits(a,a._periods[4],2):"")+(k[5]?(k[4]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[5],2):"")+(k[6]?(k[4]||k[5]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[6],2):""):'<span class="'+this._rowClass+" "+this._showClass+(a.options.significant||c)+(a._hold?" "+this._holdingClass:"")+'">'+j(0)+j(1)+j(2)+j(3)+j(4)+j(5)+j(6))+"</span>"+(a.options.description?'<span class="'+this._rowClass+
" "+this._descrClass+'">'+a.options.description+"</span>":"")},_buildLayout:function(a,e,d,c,g,k){var h=a.options[c?"compactLabels":"labels"],p=a.options.whichLabels||this._normalLabels,n=function(b){return(a.options[(c?"compactLabels":"labels")+p(a._periods[b])]||h)[b]},m=function(b,e){return a.options.digits[Math.floor(b/e)%10]},n={desc:a.options.description,sep:a.options.timeSeparator,yl:n(0),yn:this._minDigits(a,a._periods[0],1),ynn:this._minDigits(a,a._periods[0],2),ynnn:this._minDigits(a,a._periods[0],
3),y1:m(a._periods[0],1),y10:m(a._periods[0],10),y100:m(a._periods[0],100),y1000:m(a._periods[0],1E3),ol:n(1),on:this._minDigits(a,a._periods[1],1),onn:this._minDigits(a,a._periods[1],2),onnn:this._minDigits(a,a._periods[1],3),o1:m(a._periods[1],1),o10:m(a._periods[1],10),o100:m(a._periods[1],100),o1000:m(a._periods[1],1E3),wl:n(2),wn:this._minDigits(a,a._periods[2],1),wnn:this._minDigits(a,a._periods[2],2),wnnn:this._minDigits(a,a._periods[2],3),w1:m(a._periods[2],1),w10:m(a._periods[2],10),w100:m(a._periods[2],
100),w1000:m(a._periods[2],1E3),dl:n(3),dn:this._minDigits(a,a._periods[3],1),dnn:this._minDigits(a,a._periods[3],2),dnnn:this._minDigits(a,a._periods[3],3),d1:m(a._periods[3],1),d10:m(a._periods[3],10),d100:m(a._periods[3],100),d1000:m(a._periods[3],1E3),hl:n(4),hn:this._minDigits(a,a._periods[4],1),hnn:this._minDigits(a,a._periods[4],2),hnnn:this._minDigits(a,a._periods[4],3),h1:m(a._periods[4],1),h10:m(a._periods[4],10),h100:m(a._periods[4],100),h1000:m(a._periods[4],1E3),ml:n(5),mn:this._minDigits(a,
a._periods[5],1),mnn:this._minDigits(a,a._periods[5],2),mnnn:this._minDigits(a,a._periods[5],3),m1:m(a._periods[5],1),m10:m(a._periods[5],10),m100:m(a._periods[5],100),m1000:m(a._periods[5],1E3),sl:n(6),sn:this._minDigits(a,a._periods[6],1),snn:this._minDigits(a,a._periods[6],2),snnn:this._minDigits(a,a._periods[6],3),s1:m(a._periods[6],1),s10:m(a._periods[6],10),s100:m(a._periods[6],100),s1000:m(a._periods[6],1E3)},r=d;for(d=0;6>=d;d++)m="yowdhms".charAt(d),r=r.replace(RegExp("\\{"+m+"<\\}([\\s\\S]*)\\{"+
m+">\\}","g"),!g&&e[d]||g&&k[d]?"$1":"");b.each(n,function(a,b){r=r.replace(RegExp("\\{"+a+"\\}","g"),b)});return r},_minDigits:function(a,b,d){b=""+b;if(b.length>=d)return this._translateDigits(a,b);b="0000000000"+b;return this._translateDigits(a,b.substr(b.length-d))},_translateDigits:function(a,b){return(""+b).replace(/[0-9]/g,function(b){return a.options.digits[b]})},_determineShow:function(a){a=a.options.format;var b=[];b[0]=a.match("y")?"?":a.match("Y")?"!":null;b[1]=a.match("o")?"?":a.match("O")?
"!":null;b[2]=a.match("w")?"?":a.match("W")?"!":null;b[3]=a.match("d")?"?":a.match("D")?"!":null;b[4]=a.match("h")?"?":a.match("H")?"!":null;b[5]=a.match("m")?"?":a.match("M")?"!":null;b[6]=a.match("s")?"?":a.match("S")?"!":null;return b},_calculatePeriods:function(a,b,d,c){a._now=c;a._now.setMilliseconds(0);var j=new Date(a._now.getTime());a._since?c.getTime()<a._since.getTime()?a._now=c=j:c=a._since:(j.setTime(a._until.getTime()),c.getTime()>a._until.getTime()&&(a._now=c=j));var k=[0,0,0,0,0,0,
0];if(b[0]||b[1]){var h=g._getDaysInMonth(c.getFullYear(),c.getMonth()),p=g._getDaysInMonth(j.getFullYear(),j.getMonth()),p=j.getDate()==c.getDate()||j.getDate()>=Math.min(h,p)&&c.getDate()>=Math.min(h,p),p=Math.max(0,12*(j.getFullYear()-c.getFullYear())+j.getMonth()-c.getMonth()+(j.getDate()<c.getDate()&&!p||p&&60*(60*j.getHours()+j.getMinutes())+j.getSeconds()<60*(60*c.getHours()+c.getMinutes())+c.getSeconds()?-1:0));k[0]=b[0]?Math.floor(p/12):0;k[1]=b[1]?p-12*k[0]:0;c=new Date(c.getTime());h=c.getDate()==
h;p=g._getDaysInMonth(c.getFullYear()+k[0],c.getMonth()+k[1]);c.getDate()>p&&c.setDate(p);c.setFullYear(c.getFullYear()+k[0]);c.setMonth(c.getMonth()+k[1]);h&&c.setDate(p)}var n=Math.floor((j.getTime()-c.getTime())/1E3);c=function(a,d){k[a]=b[a]?Math.floor(n/d):0;n-=k[a]*d};c(2,604800);c(3,86400);c(4,3600);c(5,60);c(6,1);if(0<n&&!a._since){a=[1,12,4.3482,7,24,60,60];c=6;j=1;for(h=6;0<=h;h--)b[h]&&(k[c]>=j&&(k[c]=0,n=1),0<n&&(k[h]++,n=0,c=h,j=1)),j*=a[h]}if(d)for(h=0;6>=h;h++)d&&k[h]?d--:d||(k[h]=
0);return k}});var d=["getTimes"];b.fn.countdown=function(a){var c=Array.prototype.slice.call(arguments,1),l;l="option"==a&&(0==c.length||1==c.length&&"string"==typeof c[0])?!0:-1<b.inArray(a,d);return l?g["_"+a+"Plugin"].apply(g,[this[0]].concat(c)):this.each(function(){if("string"==typeof a){if(!g["_"+a+"Plugin"])throw"Unknown command: "+a;g["_"+a+"Plugin"].apply(g,[this].concat(c))}else g._attachPlugin(this,a||{})})};var g=b.countdown=new c})(jQuery);
(function(b){var c=(b.browser.msie?"paste":"input")+".mask",d=void 0!=window.orientation;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};b.fn.extend({caret:function(b,a){if(0!=this.length){if("number"==typeof b)return a="number"==typeof a?a:b,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(b,a);else if(this.createTextRange){var d=this.createTextRange();d.collapse(!0);d.moveEnd("character",a);d.moveStart("character",b);d.select()}});if(this[0].setSelectionRange)b=
this[0].selectionStart,a=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var d=document.selection.createRange();b=0-d.duplicate().moveStart("character",-1E5);a=b+d.text.length}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(g,a){if(!g&&0<this.length){var e=b(this[0]),l=e.data("tests");return b.map(e.data("buffer"),function(a,b){return l[b]?a:null}).join("")}a=b.extend({placeholder:"_",completed:null},a);var f=b.mask.definitions,
l=[],j=g.length,k=null,h=g.length;b.each(g.split(""),function(a,b){"?"==b?(h--,j=a):f[b]?(l.push(RegExp(f[b])),null==k&&(k=l.length-1)):l.push(null)});return this.each(function(){function e(a){for(;++a<=h&&!l[a];);return a}function n(c){var f=b(this).caret();c=c.keyCode;v=16>c||16<c&&32>c||32<c&&41>c;0!=f.begin-f.end&&(!v||8==c||46==c)&&r(f.begin,f.end);if(8==c||46==c||d&&127==c){for(f=f.begin+(46==c?0:-1);!l[f]&&0<=--f;);for(c=f;c<h;c++)if(l[c]){s[c]=a.placeholder;var g=e(c);if(g<h&&l[c].test(s[g]))s[c]=
s[g];else break}u();q.caret(Math.max(k,f));return!1}if(27==c)return q.val(w),q.caret(0,t()),!1}function m(c){if(v)return v=!1,8==c.keyCode?!1:null;c=c||window.event;var d=c.charCode||c.keyCode||c.which,f=b(this).caret();if(c.ctrlKey||c.altKey||c.metaKey)return!0;if(32<=d&&125>=d||186<d)if(c=e(f.begin-1),c<h&&(d=String.fromCharCode(d),l[c].test(d))){for(var f=c,g=a.placeholder;f<h;f++)if(l[f]){var j=e(f),k=s[f];s[f]=g;if(j<h&&l[j].test(k))g=k;else break}s[c]=d;u();c=e(c);b(this).caret(c);a.completed&&
c==h&&a.completed.call(q)}return!1}function r(b,c){for(var d=b;d<c&&d<h;d++)l[d]&&(s[d]=a.placeholder)}function u(){return q.val(s.join("")).val()}function t(b){for(var c=q.val(),d=-1,e=0,f=0;e<h;e++)if(l[e]){for(s[e]=a.placeholder;f++<c.length;){var g=c.charAt(f-1);if(l[e].test(g)){s[e]=g;d=e;break}}if(f>c.length)break}else s[e]==c[f]&&e!=j&&(f++,d=e);if(!b&&d+1<j)q.val(""),r(0,h);else if(b||d+1>=j)u(),b||q.val(q.val().substring(0,d+1));return j?e:k}var q=b(this),s=b.map(g.split(""),function(b){if("?"!=
b)return f[b]?a.placeholder:b}),v=!1,w=q.val();q.data("buffer",s).data("tests",l);q.attr("readonly")||q.one("unmask",function(){q.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){w=q.val();var a=t();u();setTimeout(function(){a==g.length?q.caret(0,a):q.caret(a)},0)}).bind("blur.mask",function(){t();q.val()!=w&&q.change()}).bind("keydown.mask",n).bind("keypress.mask",m).bind(c,function(){setTimeout(function(){q.caret(t(!0))},0)});t()})}})})(jQuery);
pe.HelpModule=function(b,c,d){pe.init_widget(this,b);this.help_module_open=!1;this.help_id=c;this.container.append(this.html(d));this.container.click(this.callback(this.help_button_clicked));this.help_button_div=this.container.find(".HelpButton");(this.admin_link=this.container.find(".AdminLink"))&&this.admin_link.click(this.callback(this.admin_link_clicked))};
pe.HelpModule.prototype.html=function(b){var c="";0===this.container.contents().length&&(c+='<div class="help_btn HelpButton"></div>');b&&(c+='<div><a class="AdminLink admin_edit" target="_blank" href="/admin/pages/'+this.help_id+'/edit">Edit Tip</a></div>');return c};pe.HelpModule.prototype.admin_link_clicked=function(b){b.stopPropagation()};
pe.HelpModule.prototype.help_button_clicked=function(b){this.help_module_open?b.stopPropagation():pe.ajax_loader.help_page.load({page_id:this.help_id},this.callback(function(b){b=$(this.dialog_box_html(b));this.help_button_div.append(b);this.help_module_open=!0;new pe.CloseButton(b,this.callback(this.close_dialog,b))}))};
pe.HelpModule.prototype.dialog_box_html=function(b){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <h1>{{title}}</h1>{{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',b)};pe.HelpModule.prototype.close_dialog=function(b,c){this.help_module_open=!1;b.remove();c.stopPropagation()};
(function(){pe.on_expire=function(){window.onbeforeunload=null;$(".Timer").html("0:00");alert("The time limit has been exceeded and your tickets have been released. \n\nThe purpose of the time limit is to give all fans a fair shot at tickets and ensure tickets are available to as many people as possible. We are sorry for the inconvenience.");return window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())};pe.on_tick=function(){return $(".Timer").html($(".Timer").html().replace(/0(\d+):/,
"$1:"))};window.onbeforeunload=function(){return"You have not completed the purchase process."};$(function(){return pe.init_page_framework(function(){var b,c,d,g;pe.routes.Request.factory("api_ticket_orders_countdown_seconds").get(function(a){var b;b=new Date;b=new Date(b.getTime()+1E3*a.data.seconds);return $(".Timer").countdown({until:b,compact:!0,format:"MS",description:"",onExpiry:pe.on_expire,onTick:pe.on_tick})});$(".EditOrderLink").click(function(a){window.onbeforeunload=null;if(confirm("Your tickets will be released for others to purchase if you leave this page.\n\nDo you wish to forfeit your tickets?"))return $(this).html("Please wait..."),
$("body").css("cursor","wait"),pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){return window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())});a.preventDefault();return a.stopPropagation()});c=$("#OrderTicketsForm");0<c.length&&(pe.order_tickets_form=new pe.StripeForm(c,"api_close_ticket_order",function(){return window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),d=new pe.Validator({message:"Invalid date",
callback:function(){pe.form&&(pe.form.errors["#ExpYear"]||pe.form.validate_field("#ExpYear"));return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())}}),g=new pe.Validator({message:"Invalid date",callback:function(){pe.form&&pe.form.errors["#ExpMonth"]&&pe.form.validate_field("#ExpMonth");return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())}}),b=new pe.Validator({message:"Card number does not match this type",callback:function(){return pe.validation.cc_number_validator.passed($("#CardNumber"))?
Stripe.card.cardType($("#CardNumber").val())===$("#payment_type").val():null}}),d={"#payment_type":b,"#CardNumber":pe.validation.cc_number_validator,"#ExpMonth":d,"#ExpYear":g,"#Cvc":pe.validation.cvc_validator,"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Address1":pe.validation.not_blank_validator,"#City":pe.validation.not_blank_validator,"#state":pe.validation.not_blank_validator,"#Zip":pe.validation.zip_code_validator,"#Phone":pe.validation.not_blank_validator,
"#Email":pe.validation.email_format_validator},b={"#payment_type":"change","#CardNumber":"blur","#ExpMonth":"change","#ExpYear":"change","#Cvc":"blur","#FirstName":"blur","#LastName":"blur","#Address1":"blur","#City":"blur","#state":"change","#Zip":"blur","#Phone":"blur","#Email":"blur"},$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")}),$("#Phone").mask("(999) 999-9999"),pe.form=new pe.ValidatableForm(c,d,b),c=c.find(".SubmitButton"),c.unbind("click"),c.click(function(a){a.preventDefault();
a.stopPropagation();pe.form.on_submit()&&pe.order_tickets_form.charge();return!1}));pe.ask_party_earth=new pe.AskPartyEarth($(".AskPartyEarth"));pe.right_rail_floater=new pe.Floater($(".FloaterContainer"),$(".FloaterLimiter"));c=$(".SecurityCodeHelp");if(0<c.length)return new pe.HelpModule(c,"credit-card-security-code",!1)})})}).call(this);
