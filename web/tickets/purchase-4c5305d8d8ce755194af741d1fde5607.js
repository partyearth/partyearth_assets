(function(){var b,e,c,f,a,d={}.hasOwnProperty;e=function(a,b){function f(){this.constructor=a}for(var g in b)d.call(b,g)&&(a[g]=b[g]);return f.prototype=b.prototype,a.prototype=new f,a.__super__=b.prototype,a};var n=this,g=function(){};c=b=this.Stripe=(g.version=2,g.endpoint="https://api.stripe.com/v1",g.setPublishableKey=function(a){g.key=a},g.complete=function(a){return function(d){var b;if("success"!==d)return b=Math.round((new Date).getTime()/1E3),(new Image).src="http://q.stripe.com?event=stripejs-error&type="+
d+"&key="+g.key+"&timestamp="+b,"function"==typeof a?a(500,{error:{code:d,type:d,message:"An unexpected error has occurred with Stripe.js. This may\nbe due to network connectivity issues, so you should try\nagain (you won't be charged twice). If you're still having\nproblems, please let us know!"}}):void 0}},g);f=function(){};f=(f.validate=function(a,d){if(!a)throw d+" required";if("object"!=typeof a)throw d+" invalid";},f.formatData=function(a,d){return b.utils.isElement(a)&&(a=b.utils.paramsFromForm(a,
d)),b.utils.underscoreKeys(a),a},f.create=function(a,d){return a.key||(a.key=b.key||b.publishableKey),b.utils.validateKey(a.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens",data:a,method:"POST",success:function(a,b){return"function"==typeof d?d(b,a):void 0},complete:b.complete(d),timeout:4E4})},f.get=function(a,d){if(!a)throw"token required";return b.utils.validateKey(b.key),b.ajaxJSONP({url:""+b.endpoint+"/tokens/"+a,data:{key:b.key},success:function(a,b){return"function"==typeof d?d(b,a):void 0},complete:b.complete(d),
timeout:4E4})},f);c.token=f;c=this.Stripe;var k=function(){return k.__super__.constructor.apply(this,arguments)};e(k,this.Stripe.token);k.tokenName="card";k.whitelistedAttrs="number cvc exp_month exp_year name address_line1 address_line2 address_city address_state address_zip address_country".split(" ");k.createToken=function(a,d,f){var g;return null==d&&(d={}),b.token.validate(a,"card"),"function"==typeof d?(f=d,d={}):"object"!=typeof d&&(g=parseInt(d,10),d={},0<g&&(d.amount=g)),d[k.tokenName]=b.token.formatData(a,
k.whitelistedAttrs),b.token.create(d,f)};k.getToken=function(a,d){return b.token.get(a,d)};k.validateCardNumber=function(a){return a=(a+"").replace(/\s+|-/g,""),10<=a.length&&16>=a.length&&k.luhnCheck(a)};k.validateCVC=function(a){return a=b.utils.trim(a),/^\d+$/.test(a)&&3<=a.length&&4>=a.length};k.validateExpiry=function(a,d){var f,g;return a=b.utils.trim(a),d=b.utils.trim(d),/^\d+$/.test(a)?/^\d+$/.test(d)?12>=parseInt(a,10)?(g=new Date(d,a),f=new Date,g.setMonth(g.getMonth()-1),g.setMonth(g.getMonth()+
1,1),g>f):!1:!1:!1};k.luhnCheck=function(a){var d,b,f,g,c;b=!0;f=0;d=(a+"").split("").reverse();g=0;for(c=d.length;g<c;g++){a=d[g];a=parseInt(a,10);if(b=!b)a*=2;9<a&&(a-=9);f+=a}return 0===f%10};k.cardType=function(a){return k.cardTypes[a.slice(0,2)]||"Unknown"};var j;a={};for(f=j=40;49>=j;f=++j)a[f]="Visa";for(f=j=50;59>=j;f=++j)a[f]="MasterCard";f=(a[34]=a[37]="American Express",a[60]=a[62]=a[64]=a[65]="Discover",a[35]="JCB",a[30]=a[36]=a[38]=a[39]="Diners Club",a);f=(k.cardTypes=f,k);c.card=f;
c=this.Stripe;var h=function(){return h.__super__.constructor.apply(this,arguments)};e=(e(h,this.Stripe.token),h.tokenName="bank_account",h.whitelistedAttrs=["country","routing_number","account_number"],h.createToken=function(a,d,f){return null==d&&(d={}),b.token.validate(a,"bank account"),"function"==typeof d&&(f=d,d={}),d[h.tokenName]=b.token.formatData(a,h.whitelistedAttrs),b.token.create(d,f)},h.getToken=function(a,d){return b.token.get(a,d)},h.validateRoutingNumber=function(a,d){a=b.utils.trim(a);
switch(d){case "US":return/^\d+$/.test(a)&&9===a.length&&h.routingChecksum(a);case "CA":return/\d{5}\-\d{3}/.test(a)&&9===a.length;default:return!0}},h.validateAccountNumber=function(a,d){a=b.utils.trim(a);switch(d){case "US":return/^\d+$/.test(a)&&1<=a.length&&17>=a.length;default:return!0}},h.routingChecksum=function(a){var d,b,f,g,c;b=0;a=(a+"").split("");c=[0,3,6];f=0;for(g=c.length;f<g;f++)d=c[f],b+=3*parseInt(a[d]),b+=7*parseInt(a[d+1]),b+=parseInt(a[d+2]);return 0!==b&&0===b%10},h);c.bankAccount=
e;e="createToken getToken cardType validateExpiry validateCVC validateCardNumber".split(" ");f=0;for(a=e.length;f<a;f++)c=e[f],this.Stripe[c]=this.Stripe.card[c];"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe);"function"==typeof define&&define("stripe",[],function(){return n.Stripe})}).call(this);
(function(){var b,e,c,f=[].slice;b=encodeURIComponent;e=(new Date).getTime();c=function(a,d,f){var g,e;null==d&&(d=[]);for(g in a)e=a[g],f&&(g=""+f+"["+g+"]"),"object"==typeof e?c(e,d,g):d.push(""+g+"="+b(e));return d.join("&").replace(/%20/g,"+")};this.Stripe.ajaxJSONP=function(a){var d,b,g,k,j,h;return null==a&&(a={}),g="sjsonp"+ ++e,j=document.createElement("script"),b=null,d=function(d){var f;return null==d&&(d="abort"),clearTimeout(b),null!=(f=j.parentNode)&&f.removeChild(j),g in window&&(window[g]=
function(){}),"function"==typeof a.complete?a.complete(d,h,a):void 0},h={abort:d},j.onerror=function(){return h.abort(),"function"==typeof a.error?a.error(h,a):void 0},window[g]=function(){var d;d=1<=arguments.length?f.call(arguments,0):[];clearTimeout(b);j.parentNode.removeChild(j);try{delete window[g]}catch(c){window[g]=void 0}return"function"==typeof a.success&&a.success.apply(a,d),"function"==typeof a.complete?a.complete("success",h,a):void 0},a.data||(a.data={}),a.data.callback=g,a.method&&(a.data._method=
a.method),j.src=a.url+"?"+c(a.data),k=document.getElementsByTagName("head")[0],k.appendChild(j),0<a.timeout&&(b=setTimeout(function(){return h.abort("timeout")},a.timeout)),h}}).call(this);
(function(){var b=[].indexOf||function(b){for(var a=0,d=this.length;a<d;a++)if(a in this&&this[a]===b)return a;return-1},e=this.Stripe,c;c=function(){};c=(c.trim=function(b){return(b+"").replace(/^\s+|\s+$/g,"")},c.underscore=function(b){return(b+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},c.underscoreKeys=function(b){var a,d,c;c=[];for(a in b)d=b[a],delete b[a],c.push(b[this.underscore(a)]=d);return c},c.isElement=function(b){return"object"!=typeof b?!1:"undefined"!=
typeof jQuery&&null!==jQuery&&b instanceof jQuery?!0:1===b.nodeType},c.paramsFromForm=function(f,a){var d,c,g,e,j,h,p;null==a&&(a=[]);"undefined"!=typeof jQuery&&null!==jQuery&&f instanceof jQuery&&(f=f[0]);g=f.getElementsByTagName("input");e=f.getElementsByTagName("select");j={};h=0;for(p=g.length;h<p;h++)c=g[h],d=this.underscore(c.getAttribute("data-stripe")),0>b.call(a,d)||(j[d]=c.value);g=0;for(h=e.length;g<h;g++)c=e[g],d=this.underscore(c.getAttribute("data-stripe")),0>b.call(a,d)||null!=c.selectedIndex&&
(j[d]=c.options[c.selectedIndex].value);return j},c.validateKey=function(b){if(!b||"string"!=typeof b)throw Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(b))throw Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(b))throw Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js");
},c);e.utils=c}).call(this);
(function(){var b=[].indexOf||function(b){for(var c=0,f=this.length;c<f;c++)if(c in this&&this[c]===b)return c;return-1};this.Stripe.validator={"boolean":function(b,c){if("true"!==c&&"false"!==c)return"Enter a boolean string (true or false)"},integer:function(b,c){if(!/^\d+$/.test(c))return"Enter an integer"},positive:function(b,c){if(this.integer(b,c)||!(0<parseInt(c,10)))return"Enter a positive value"},range:function(e,c){var f;if(f=parseInt(c,10),0>b.call(e,f))return"Needs to be between "+e[0]+
" and "+e[e.length-1]},required:function(b,c){if(b&&(null==c||""===c))return"Required"},year:function(b,c){if(!/^\d{4}$/.test(c))return"Enter a 4-digit year"},birthYear:function(b,c){var f;if(f=this.year(b,c))return f;if(2E3<parseInt(c,10))return"You must be over 18";if(1900>parseInt(c,10))return"Enter your birth year"},month:function(b,c){if(this.integer(b,c))return"Please enter a month";if(this.range([1,2,3,4,5,6,7,8,9,10,11,12],c))return"Needs to be between 1 and 12"},choices:function(e,c){if(0>
b.call(e,c))return"Not an acceptable value for this field"},email:function(b,c){if(!/^[^@<\s>]+@[^@<\s>]+$/.test(c))return"That doesn't look like an email address"},url:function(b,c){if(!/^https?:\/\/.+\..+/.test(c))return"Not a valid url"},usTaxID:function(b,c){if(!/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(c))return"Not a valid tax ID"},ein:function(b,c){if(!/^\d{2}-?\d{7}$/.test(c))return"Not a valid EIN"},ssnLast4:function(b,c){if(!/^\d{4}$/.test(c))return"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(b,
c){var f;a:{switch(b){case "CA":f=/^\d{3}-?\d{3}-?\d{3}$/.test(c);break a;case "US":f=!0;break a}f=void 0}if(!f)return"Not a valid ID"},bizTaxID:function(b,c){var f,a,d,n,g,k;a={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]}[b];if(null!=a){f=a[0];n=a[1];a=!1;g=0;for(k=n.length;g<k;g++)if(d=n[g],d.test(c)){a=!0;break}if(!a)return"Not a valid "+f}},zip:function(b,c){var f;a:{switch(b.toUpperCase()){case "CA":f=/^[\d\w]{6}$/.test(null!=c?c.replace(/\s+/g,""):void 0);break a;case "US":f=/^\d{5}$/.test(c)||
/^\d{9}$/.test(c);break a}f=void 0}if(!f)return"Not a valid zip"},bankAccountNumber:function(b,c){if(!/^\d{1,17}$/.test(c))return"Invalid bank account number"},usRoutingNumber:function(b){var c,f,a,d,n,g;if(!/^\d{9}$/.test(b))return"Routing number must have 9 digits";c=n=d=0;for(g=b.length-1;n<=g;c=n+=3)f=3*parseInt(b.charAt(c),10),a=7*parseInt(b.charAt(c+1),10),c=parseInt(b.charAt(c+2),10),d+=f+a+c;if(0===d||0!==d%10)return"Invalid routing number"},caRoutingNumber:function(b){if(!/^\d{5}\-\d{3}$/.test(b))return"Invalid transit number"},
routingNumber:function(b,c){switch(b.toUpperCase()){case "CA":return this.caRoutingNumber(c);case "US":return this.usRoutingNumber(c)}},phoneNumber:function(b,c){if(10!==c.replace(/[^0-9]/g,"").length)return"Invalid phone number"},bizDBA:function(b,c){if(!/^.{1,23}$/.test(c))return"Statement descriptors can only have up to 23 characters"},nameLength:function(b,c){if(1===c.length)return"Names need to be longer than one character"}}}).call(this);
pe.routes={map:{search_autocomplete:"{{city_id}}/search/autocomplete.ehtml/",api_user_list:"/api/user_lists/{{id}}",api_reorder_user_list:"/api/user_lists/{{id}}/reorder",api_user_list_favorites:"/api/user_lists/{{id}}/favorites",api_favorite:"/api/favorites/{{id}}",api_favorite_vote_yes:"/api/favorites/{{id}}/vote_yes",api_favorite_vote_huh:"/api/favorites/{{id}}/vote_huh",holiday:"/{{city_id}}/holidays/{{id}}-7",holiday_comments:"/services/holidays/{{id}}/comments",holiday_reactions:"/holidays/{{id}}/reactions/all",
new_holiday_reactions:"/holidays/{{id}}/reactions",holiday_calendar:"/{{city_id}}/holidays/{{id}}-7/calendar",holiday_photos:"/api/{{city_id}}/holidays/{{id}}/photos",holiday_map_venues:"/api/maps/holidays/{{slug}}/venues",holiday_map_events:"/api/maps/holidays/{{slug}}/events",venue_map_popup:"/venues/{{venue_id}}/map_popup",map_venues:"/api/cities/{{city_id}}/maps/venues",map_events:"/api/cities/{{city_id}}/maps/events",map_neighborhood_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/venues",
map_neighborhood_events:"/api/maps/neighborhoods/{{neighborhood_id}}/events",map_neighborhood_endpoint_venues:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/venues",map_neighborhood_endpoint_events:"/api/maps/neighborhoods/{{neighborhood_id}}/endpoints/{{endpoint_id}}/events",user_list_map_venues:"/api/maps/users/{{user_id}}/lists/{{id}}/venues",user_list_map_events:"/api/maps/users/{{user_id}}/lists/{{id}}/events",create_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}",
generate_button_user_dashboard_event:"/users/{{user_id}}/dashboard/buttons/{{id}}/generate",user_list:"/users/{{user_id}}/lists/{{id}}",user_lists:"/users/{{user_id}}/lists",user_comments:"/users/{{user_id}}/comments",user_reviews:"/users/{{user_id}}/reviews",list_items:"/lists/{{id}}/list_items",list_comments:"/services/lists/{{id}}/comments",list_reactions:"/lists/{{id}}/reactions/all",new_list_reactions:"/lists/{{id}}/reactions",user_personalities:"/users/{{id}}/personalities",user:"/users/{{id}}",
api_user:"/api/users/{{id}}",event:"/{{city_id}}/{{*endpoints}}/{{id}}-1",tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets",purchase_tickets:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/purchase",tickets_confirmation:"/{{city_id}}/{{*endpoints}}/{{id}}-1/tickets/confirmation",api_ticket_orders:"/api/ticket_orders",api_close_ticket_order:"/api/ticket_orders/{{id}}/close",api_apply_ticket_order_promo_code:"/api/ticket_orders/apply_promo",api_remove_ticket_order_promo_code:"/api/ticket_orders/remove_promo",
api_ticket_orders_disable_pending:"/api/ticket_orders/disable_pending",api_ticket_orders_countdown_seconds:"/api/ticket_orders/countdown_seconds",admin_event_ticket_types:"/admin/events/{{event_id}}/ticket_types",admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes",update_status_admin_event_ticket_promo_codes:"/admin/events/{{event_id}}/ticket_promo_codes/{{id}}/update_status",event_type_tags:"/api/tags/event_types",find_your_scene:"/services/find_your_scene.ehtml",missing_info:"/services/contact_messages/missing_info.ehtml",
send_message:"/services/contact_messages/",subscription_select:"/services/subscriptions/web.ehtml",subscriptions_create:"/services/subscriptions/web",creeper_dialog:"/services/creeper.ehtml",creeper_subscribe:"/services/creeper/subscribe",creeper_close:"/services/creeper/close",character:"/pe-reviewers/{{id}}.ehtml",ask_party_earth:"/api/questions",mobile_subscribe:"/services/subscriptions/mobile",client_signup_form:"/clients/forms.ehtml"}};
pe.routes.build_path=function(b,e){var c=pe.routes.map[b],f=c.match(/\{\{\*(.+)\}\}/);_.each(f,function(a){e[a]&&(e[a]=e[a].join("/"))});c=c.replace(/\*/,"");e=e||{};return pe.routes.clean_url(pe.templatize(c,e))};pe.routes.clean_url=function(b){return("/"+b).replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/").replace(/\/\//g,"/")};pe.routes.current_url_params=function(){var b=pe.routes.recognize_path(window.location.pathname);return b?b.params:{}};
pe.routes.recognize_path=function(b){b=pe.routes.clean_url(b);var e,c,f=_.find(_.keys(pe.routes.map),function(a){e=pe.routes.map[a];c=RegExp(e.replace(/\//g,"\\/").replace(/\{\{[^\{\}]+\}\}/g,"(.+)"));return c.test(b)});if(f){for(var a=_.map(e.match(/\{\{[^\}]+\}\}/g),function(a){return a.replace(/\{|\}/g,"")}),d=b.match(c).slice(1,99),n={params:{}},g=function(a){return!_.isEmpty(a)},k=0;k<a.length;k++)"*"==a[k][0]&&(a[k]=a[k].replace(/\*/g,""),d[k]=_.select(d[k].replace(/\*/g,"").split("/"),g)),
n.params[a[k]]=d[k];n.path_info={name:f,template:e};return n}return!1};pe.routes.Request=function(b,e,c){pe.routes.map[b]?(this.path=b,"object"!==typeof e&&(e={id:e}),this.params=e,this.callback=c):alert("This path is not registered in the routes map.")};pe.routes.Request.factory=function(b,e,c){return new pe.routes.Request(b,e,c)};pe.routes.Request.from_current_location=function(b,e,c){e=e||{};var f=pe.routes.current_url_params();return new pe.routes.Request(b,_.extend(f,e),c)};
pe.routes.Request.prototype.ajax=function(b,e){var c="function"===typeof e?e:this.callback;$.ajax({url:this.build_path(),data:this.params,type:b,success:c})};pe.routes.Request.prototype.build_path=function(){return pe.routes.build_path(this.path,this.params)};pe.routes.Request.prototype.get=function(b){this.ajax("GET",b)};pe.routes.Request.prototype.post=function(b){this.ajax("POST",b)};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},e=pe,c=function(f,a,d){this.form=f;this.path_name=a;this.on_success=d;this.on_submit_button_clicked=b(this.on_submit_button_clicked,this);this.on_submit=b(this.on_submit,this);this.on_charge=b(this.on_charge,this);this.form.find("select, input[type=text]").each(function(){return $(this).val("")});if(!this.init_stripe())return this.form.submit(function(a){return a.preventDefault()}),!1;this.errors_container=this.form.find(".Errors");
this.messages_container=this.form.find(".Messages");this.card_inputs=this.form.find(".CardInput");this.billing_inputs=this.form.find(".BillingInput");this.submit_button=this.form.find(".SubmitButton");this.submit_button.click(this.on_submit_button_clicked);this.form.submit(this.on_submit)};c.prototype.collect_card_data=function(b){var a;a={};_.each(b,function(b){var c;b=$(b);"radio"===b.attr("type")&&(b=b.filter(":checked"));if(0<b.length&&(c=b.data("key")))return a[c]=b.val()});return a};c.prototype.init_stripe=
function(){if(window.publishable_stripe_key)return Stripe.setPublishableKey(window.publishable_stripe_key),!0;alert("No window.publishable_stripe_key set to use stripe");return!1};c.prototype.on_charge=function(b,a){var d,c=this;if(a&&a.error)return $("body").css("cursor","inherit"),this.show_error(a.error.message);this.show_message("Please wait...");d=this.collect_card_data(this.billing_inputs);d={id:d.id,ticket_order:d};d.card_token=a?a.id:"failed";return pe.routes.Request.factory(this.path_name,
d).post(function(a){$("body").css("cursor","inherit");if(1===a.status)return c.show_error(a.message);if(c.on_success)return c.on_success()})};c.prototype.on_submit=function(b){b&&b.preventDefault();return!1};c.prototype.charge=function(){$("body").css("cursor","wait");return Stripe.card.createToken(this.collect_card_data(this.card_inputs),this.on_charge)};c.prototype.on_submit_button_clicked=function(){return this.charge()};c.prototype.show_error=function(b){this.errors_container.show().html(b);this.messages_container.hide();
pe.install_easing();pe.animated_scrolling(this.errors_container,10);return _.each(this.card_inputs,function(a){$(a).val("");return $(a).parent().find(".inline-success").remove()})};c.prototype.show_message=function(){return this.errors_container.hide()};e.StripeForm=c}).call(this);
pe.Floater=function(b,e,c){pe.init_widget(this,b);this.bottom_margin=c||0;this.start_point_div=b.find(".FloatingAreaStart");this.end_point_div=e||null;this.stop_at=this.start_from=0;this.sticked=this.is_floating=!1;this.floater=this.container.find(".Floater");this.offset=0;this.disabled=!1;this.top=parseInt(this.floater.css("margin-top"),10)||0;$(window).scroll(this.callback(this.scrolling));this.set_floating_area();pe.Floater.register_floater(this)};
pe.Floater.events={TOP_REACHED:"Floater_TOP_REACHED",FLOATING:"Floater_FLOATING",BOTTOM_REACHED:"Floater_BOTTOM_REACHED"};pe.Floater.prototype.set_floating_area=function(){this.start_from=this.start_point_div.offset().top;this.end_point_div&&(this.stop_at=this.end_point_div.offset().top)};
pe.Floater.prototype.scrolling=function(){if(!this.disabled){this.set_floating_area();var b=$(window).scrollTop(),e=b+this.offset+this.bottom_margin<=this.start_from,c=b+this.offset+this.bottom_margin>this.start_from,f=this.floater.position().top+this.floater.outerHeight(!0)>this.stop_at;!this.is_floating&&c&&!f&&!this.sticked?(this.start_floating(),this.fire_event(pe.Floater.events.FLOATING,this),pe.fire_global_event(pe.Floater.events.FLOATING,this)):this.is_floating&&e?(this.stop_scrolling(),this.fire_event(pe.Floater.events.TOP_REACHED,
this)):this.end_point_div&&(!this.sticked&&f?(this.stick(),this.fire_event(pe.Floater.events.BOTTOM_REACHED,this)):this.sticked&&b+this.floater.outerHeight(!0)<=this.stop_at&&this.unstick())}};pe.Floater.prototype.start_floating=function(){this.floater.addClass("fixed");this.floater.removeClass("bottom");this.is_floating=!0;this.sticked=!1;this.set_offset()};
pe.Floater.prototype.stick=function(){this.floater.css("top",this.end_point_div.position().top-this.floater.outerHeight(!0)+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.sticked=!0};pe.Floater.prototype.disable=function(){this.floater.css("top",this.floater.position().top-140+"px");this.floater.removeClass("fixed");this.floater.css("position","absolute");this.is_floating=!1;this.disabled=this.sticked=!0};
pe.Floater.prototype.enable=function(){this.disabled=!1};pe.Floater.prototype.unstick=function(){this.floater.css("margin-top","");this.floater.css("top","");this.floater.css("position","");this.start_floating();this.fire_event(pe.Floater.events.FLOATING,this)};pe.Floater.prototype.stop_scrolling=function(){this.floater.css("margin-top","");this.floater.removeClass("fixed");this.floater.removeClass("bottom");this.sticked=this.is_floating=!1;this.set_offset()};
pe.Floater.prototype.set_offset=function(b){b&&(this.offset=b);0!==this.offset&&this.is_floating?this.floater.css("margin-top",this.top+this.offset+"px"):this.floater.css("margin-top","")};pe.Floater.registered_floaters=[];pe.Floater.register_floater=function(b){pe.Floater.registered_floaters.push(b);pe.Floater.update_positions()};
pe.Floater.update_positions=function(){pe.Floater.registered_floaters=_.sortBy(pe.Floater.registered_floaters,function(b){return b.container.offset().top},null);if(pe.Floater.registered_floaters[0]&&(pe.Floater.registered_floaters[0].offset=0,1<pe.Floater.registered_floaters.length))for(var b=1;b<pe.Floater.registered_floaters.length;b++){var e=pe.Floater.registered_floaters[b-1].offset+pe.Floater.registered_floaters[b-1].floater.outerHeight();pe.Floater.registered_floaters[b].offset=e;pe.Floater.registered_floaters[b].is_floating&&
pe.Floater.registered_floaters[b].start_floating();pe.Floater.registered_floaters[b].set_floating_area()}};pe.Validator=function(b){this.message=b.message||"Invalid value.";this.callback=b.callback;this.unless_callback=b.unless||function(){return!1};this.options=b;this.value=b.value?b.value:function(e){return b.callback(e)}};pe.Validator.prototype.passed=function(b){return!!this.callback($(b))};pe.Validator.prototype.failed=function(b){return!this.passed(b)};pe.Validator.prototype.unless=function(){return this.unless_callback()};
pe.validation.name_validator=new pe.Validator({callback:function(b){return _.isEmpty($.trim(b.val()))?(this.message="Field cannot be blank.",!1):50<b.val().length?(this.message="Please shorten your name.",!1):!0},message:"Invalid name."});pe.validation.not_blank_validator=new pe.Validator({callback:function(b){return!_.isEmpty($.trim(b.val()))},message:"Field cannot be blank."});
pe.validation.cc_number_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCardNumber(b.val())},message:"Invalid card number."});pe.validation.cvc_validator=new pe.Validator({callback:function(b){return Stripe.card.validateCVC(b.val())},message:"Invalid CVC."});pe.validation.zip_code_validator=new pe.Validator({callback:function(b){return!!b.val().match(/^\d{5}(\s*\-\s*\d{4})?$/)},message:"Please enter a valid zip code."});
pe.validation.email_format_validator=new pe.Validator({callback:function(b){return pe.validation.check_email_format(b.val())},message:"Please enter a valid email address."});pe.validation.check_email_format=function(b){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(b))};
pe.ValidatableForm=function(b,e,c){pe.init_widget(this,b);this.bindings=c||{};this.chained_fields=[];this.errors={};this.rules=e||{};this.save_button=this.container.find(".SaveButton");this.submit_button=this.container.find(".SubmitButton");this.init_bindings();this.validate();this.toggle_submit();this.submit_button.click(this.callback(this.on_submit))};
pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")}));_.each(this.bindings,function(b,e){"string"===typeof b?$(e).bind(b,this.callback(function(){this.validate_field(e)})):"function"===typeof b&&this.callback(b)();this.rules[e].value($(e))&&this.validate_field(e)},this)};
pe.ValidatableForm.prototype.on_submit=function(){var b=this.validate();this.highlight_first_failed();return b};pe.ValidatableForm.prototype.delete_error=function(b){delete this.errors[b];_.each(this.chained_fields,function(e){_.include(e,b)&&_.each(e,function(b){this.errors[b]&&this.delete_error(b)},this)},this)};pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1};
pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var b=_.keys(this.errors)[0];this.render_field_error(b)}this.focus_on_failed()}};pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(b,e){this.render_field_error(e)},this)};
pe.ValidatableForm.prototype.render_field_error=function(b){var e=$(b).parents("li.input");0===e.length&&(e=$(b));e.find(".inline-errors").remove();e.append('<span class="inline-errors">'+this.errors[b]+"</span>");e.find(".inline-success").remove()};pe.ValidatableForm.prototype.render_field_success=function(b){var e=$(b).parents("li.input");0===e.length&&(e=$(b));e.find(".inline-success").remove();e.append('<img class="inline-success" src="/assets/users/check.png" />');e.find(".inline-errors").remove()};
pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(b){this.render_field_success(b)},this)};pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")};pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))};
pe.ValidatableForm.prototype.validate_field=function(b){var e=this.rules[b],c=e.passed(b);e.unless()?this.delete_error(b):c?(this.delete_error(b),this.render_field_success(b)):(this.errors[b]=e.message,this.render_field_error(b));this.toggle_submit();return c};pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)};pe.ValidatableForm.prototype.validate=function(){_.each(this.rules,function(b,e){b.failed(e)&&(this.errors[e]=b.message)},this);return this.valid()};
pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)};pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length};
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},e=pe,c=function(c){this.container=c;this.show_message=b(this.show_message,this);this.on_submit=b(this.on_submit,this);this.show_form=b(this.show_form,this);this.click=b(this.click,this);this.link=this.container.find(".Link");this.link.click(this.show_form);this.form_container=this.container.find(".FormContainer");this.form=this.form_container.find("form");this.form.submit(this.on_submit);this.message=this.container.find(".Message")};
c.prototype.click=function(b){return this.on_click_callback=b};c.prototype.show_form=function(){var b;b=new pe.Validator({callback:function(a){a=$.trim(a.val());if(_.isEmpty(a))return this.message="Email cannot be blank.",!1;this.message="Invalid email.";return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test(a)}});new pe.ValidatableForm(this.form,{"#question_name":pe.validation.name_validator,"#question_email":b,"#question_text":pe.validation.not_blank_validator},{"#question_name":"keyup",
"#question_email":"keyup","#question_text":"keyup"});this.link.hide();this.form_container.show();return this.on_click_callback()};c.prototype.on_submit=function(b){b.preventDefault();$.post(pe.routes.build_path("ask_party_earth"),this.form.serialize(),"json");return this.show_message()};c.prototype.show_message=function(){this.form_container.hide();return this.message.show()};e.AskPartyEarth=c}).call(this);
(function(b){function e(){function a(b){b=1E12>b?c?performance.now()+performance.timing.navigationStart:d():b||d();1E3<=b-e&&(f._updateTargets(),e=b);g(a)}this.regional=[];this.regional[""]={labels:"Years Months Weeks Days Hours Minutes Seconds".split(" "),labels1:"Year Month Week Day Hour Minute Second".split(" "),compactLabels:["y","m","w","d"],whichLabels:null,digits:"0123456789".split(""),timeSeparator:":",isRTL:!1};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",
layout:"",compact:!1,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:!1,onExpiry:null,onTick:null,tickInterval:1};b.extend(this._defaults,this.regional[""]);this._serverSyncs=[];var d="function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},c=window.performance&&"function"==typeof window.performance.now,g=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
null,e=0;!g||b.noRequestAnimationFrame?(b.noRequestAnimationFrame=null,setInterval(function(){f._updateTargets()},980)):(e=window.animationStartTime||window.webkitAnimationStartTime||window.mozAnimationStartTime||window.oAnimationStartTime||window.msAnimationStartTime||d(),g(a))}b.extend(e.prototype,{markerClassName:"hasCountdown",propertyName:"countdown",_rtlClass:"countdown_rtl",_sectionClass:"countdown_section",_amountClass:"countdown_amount",_rowClass:"countdown_row",_holdingClass:"countdown_holding",
_showClass:"countdown_show",_descrClass:"countdown_descr",_timerTargets:[],setDefaults:function(a){this._resetExtraLabels(this._defaults,a);b.extend(this._defaults,a||{})},UTCDate:function(a,b,c,g,f,e,h,p){"object"==typeof b&&b.constructor==Date&&(p=b.getMilliseconds(),h=b.getSeconds(),e=b.getMinutes(),f=b.getHours(),g=b.getDate(),c=b.getMonth(),b=b.getFullYear());var m=new Date;m.setUTCFullYear(b);m.setUTCDate(1);m.setUTCMonth(c||0);m.setUTCDate(g||1);m.setUTCHours(f||0);m.setUTCMinutes((e||0)-(30>
Math.abs(a)?60*a:a));m.setUTCSeconds(h||0);m.setUTCMilliseconds(p||0);return m},periodsToSeconds:function(a){return 31557600*a[0]+2629800*a[1]+604800*a[2]+86400*a[3]+3600*a[4]+60*a[5]+a[6]},_attachPlugin:function(a,d){a=b(a);if(!a.hasClass(this.markerClassName)){var c={options:b.extend({},this._defaults),_periods:[0,0,0,0,0,0,0]};a.addClass(this.markerClassName).data(this.propertyName,c);this._optionPlugin(a,d)}},_addTarget:function(a){this._hasTarget(a)||this._timerTargets.push(a)},_hasTarget:function(a){return-1<
b.inArray(a,this._timerTargets)},_removeTarget:function(a){this._timerTargets=b.map(this._timerTargets,function(b){return b==a?null:b})},_updateTargets:function(){for(var a=this._timerTargets.length-1;0<=a;a--)this._updateCountdown(this._timerTargets[a])},_optionPlugin:function(a,d,c){a=b(a);var g=a.data(this.propertyName);if(!d||"string"==typeof d&&null==c){var f=d;return(d=(g||{}).options)&&f?d[f]:d}a.hasClass(this.markerClassName)&&(d=d||{},"string"==typeof d&&(f=d,d={},d[f]=c),d.layout&&(d.layout=
d.layout.replace(/&lt;/g,"<").replace(/&gt;/g,">")),this._resetExtraLabels(g.options,d),c=g.options.timezone!=d.timezone,b.extend(g.options,d),this._adjustSettings(a,g,null!=d.until||null!=d.since||c),d=new Date,(g._since&&g._since<d||g._until&&g._until>d)&&this._addTarget(a[0]),this._updateCountdown(a,g))},_updateCountdown:function(a,d){var c=b(a);if(d=d||c.data(this.propertyName)){c.html(this._generateHTML(d)).toggleClass(this._rtlClass,d.options.isRTL);if(b.isFunction(d.options.onTick)){var g=
"lap"!=d._hold?d._periods:this._calculatePeriods(d,d._show,d.options.significant,new Date);(1==d.options.tickInterval||0==this.periodsToSeconds(g)%d.options.tickInterval)&&d.options.onTick.apply(a,[g])}if("pause"!=d._hold&&(d._since?d._now.getTime()<d._since.getTime():d._now.getTime()>=d._until.getTime())&&!d._expiring){d._expiring=!0;if(this._hasTarget(a)||d.options.alwaysExpire)this._removeTarget(a),b.isFunction(d.options.onExpiry)&&d.options.onExpiry.apply(a,[]),d.options.expiryText&&(g=d.options.layout,
d.options.layout=d.options.expiryText,this._updateCountdown(a,d),d.options.layout=g),d.options.expiryUrl&&(window.location=d.options.expiryUrl);d._expiring=!1}else"pause"==d._hold&&this._removeTarget(a);c.data(this.propertyName,d)}},_resetExtraLabels:function(a,b){var c=!1,g;for(g in b)if("whichLabels"!=g&&g.match(/[Ll]abels/)){c=!0;break}if(c)for(g in a)g.match(/[Ll]abels[02-9]|compactLabels1/)&&(a[g]=null)},_adjustSettings:function(a,d,c){for(var g=0,g=null,f=0;f<this._serverSyncs.length;f++)if(this._serverSyncs[f][0]==
d.options.serverSync){g=this._serverSyncs[f][1];break}null!=g?(g=d.options.serverSync?g:0,a=new Date):(g=b.isFunction(d.options.serverSync)?d.options.serverSync.apply(a,[]):null,a=new Date,g=g?a.getTime()-g.getTime():0,this._serverSyncs.push([d.options.serverSync,g]));f=d.options.timezone;f=null==f?-a.getTimezoneOffset():f;if(c||!c&&null==d._until&&null==d._since)d._since=d.options.since,null!=d._since&&(d._since=this.UTCDate(f,this._determineTime(d._since,null)),d._since&&g&&d._since.setMilliseconds(d._since.getMilliseconds()+
g)),d._until=this.UTCDate(f,this._determineTime(d.options.until,a)),g&&d._until.setMilliseconds(d._until.getMilliseconds()+g);d._show=this._determineShow(d)},_destroyPlugin:function(a){a=b(a);a.hasClass(this.markerClassName)&&(this._removeTarget(a[0]),a.removeClass(this.markerClassName).empty().removeData(this.propertyName))},_pausePlugin:function(a){this._hold(a,"pause")},_lapPlugin:function(a){this._hold(a,"lap")},_resumePlugin:function(a){this._hold(a,null)},_hold:function(a,d){var c=b.data(a,
this.propertyName);if(c){if("pause"==c._hold&&!d){c._periods=c._savePeriods;var f=c._since?"-":"+";c[c._since?"_since":"_until"]=this._determineTime(f+c._periods[0]+"y"+f+c._periods[1]+"o"+f+c._periods[2]+"w"+f+c._periods[3]+"d"+f+c._periods[4]+"h"+f+c._periods[5]+"m"+f+c._periods[6]+"s");this._addTarget(a)}c._hold=d;c._savePeriods="pause"==d?c._periods:null;b.data(a,this.propertyName,c);this._updateCountdown(a,c)}},_getTimesPlugin:function(a){a=b.data(a,this.propertyName);return!a?null:"pause"==
a._hold?a._savePeriods:!a._hold?a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date)},_determineTime:function(a,b){var c;if(null==a)c=b;else if("string"==typeof a){c=a.toLowerCase();for(var g=new Date,e=g.getFullYear(),j=g.getMonth(),h=g.getDate(),p=g.getHours(),m=g.getMinutes(),g=g.getSeconds(),l=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,r=l.exec(c);r;){switch(r[2]||"s"){case "s":g+=parseInt(r[1],10);break;case "m":m+=parseInt(r[1],10);break;case "h":p+=parseInt(r[1],10);break;case "d":h+=
parseInt(r[1],10);break;case "w":h+=7*parseInt(r[1],10);break;case "o":j+=parseInt(r[1],10);h=Math.min(h,f._getDaysInMonth(e,j));break;case "y":e+=parseInt(r[1],10),h=Math.min(h,f._getDaysInMonth(e,j))}r=l.exec(c)}c=new Date(e,j,h,p,m,g,0)}else"number"==typeof a?(c=new Date,c.setTime(c.getTime()+1E3*a)):c=a;c&&c.setMilliseconds(0);return c},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_normalLabels:function(a){return a},_generateHTML:function(a){var d=this;a._periods=a._hold?
a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date);for(var c=!1,g=0,e=a.options.significant,j=b.extend({},a._show),h=0;6>=h;h++)c|="?"==a._show[h]&&0<a._periods[h],j[h]="?"==a._show[h]&&!c?null:a._show[h],g+=j[h]?1:0,e-=0<a._periods[h]?1:0;for(var p=[!1,!1,!1,!1,!1,!1,!1],h=6;0<=h;h--)a._show[h]&&(a._periods[h]?p[h]=!0:(p[h]=0<e,e--));var m=a.options.compact?a.options.compactLabels:a.options.labels,l=a.options.whichLabels||this._normalLabels,c=function(b){var c=a.options["compactLabels"+
l(a._periods[b])];return j[b]?d._translateDigits(a,a._periods[b])+(c?c[b]:m[b])+" ":""},e=function(b){var c=a.options["labels"+l(a._periods[b])];return!a.options.significant&&j[b]||a.options.significant&&p[b]?'<span class="'+f._sectionClass+'"><span class="'+f._amountClass+'">'+d._translateDigits(a,a._periods[b])+"</span><br/>"+(c?c[b]:m[b])+"</span>":""};return a.options.layout?this._buildLayout(a,j,a.options.layout,a.options.compact,a.options.significant,p):(a.options.compact?'<span class="'+this._rowClass+
" "+this._amountClass+(a._hold?" "+this._holdingClass:"")+'">'+c(0)+c(1)+c(2)+c(3)+(j[4]?this._minDigits(a,a._periods[4],2):"")+(j[5]?(j[4]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[5],2):"")+(j[6]?(j[4]||j[5]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[6],2):""):'<span class="'+this._rowClass+" "+this._showClass+(a.options.significant||g)+(a._hold?" "+this._holdingClass:"")+'">'+e(0)+e(1)+e(2)+e(3)+e(4)+e(5)+e(6))+"</span>"+(a.options.description?'<span class="'+this._rowClass+
" "+this._descrClass+'">'+a.options.description+"</span>":"")},_buildLayout:function(a,d,c,f,e,j){var h=a.options[f?"compactLabels":"labels"],p=a.options.whichLabels||this._normalLabels,m=function(b){return(a.options[(f?"compactLabels":"labels")+p(a._periods[b])]||h)[b]},l=function(b,d){return a.options.digits[Math.floor(b/d)%10]},m={desc:a.options.description,sep:a.options.timeSeparator,yl:m(0),yn:this._minDigits(a,a._periods[0],1),ynn:this._minDigits(a,a._periods[0],2),ynnn:this._minDigits(a,a._periods[0],
3),y1:l(a._periods[0],1),y10:l(a._periods[0],10),y100:l(a._periods[0],100),y1000:l(a._periods[0],1E3),ol:m(1),on:this._minDigits(a,a._periods[1],1),onn:this._minDigits(a,a._periods[1],2),onnn:this._minDigits(a,a._periods[1],3),o1:l(a._periods[1],1),o10:l(a._periods[1],10),o100:l(a._periods[1],100),o1000:l(a._periods[1],1E3),wl:m(2),wn:this._minDigits(a,a._periods[2],1),wnn:this._minDigits(a,a._periods[2],2),wnnn:this._minDigits(a,a._periods[2],3),w1:l(a._periods[2],1),w10:l(a._periods[2],10),w100:l(a._periods[2],
100),w1000:l(a._periods[2],1E3),dl:m(3),dn:this._minDigits(a,a._periods[3],1),dnn:this._minDigits(a,a._periods[3],2),dnnn:this._minDigits(a,a._periods[3],3),d1:l(a._periods[3],1),d10:l(a._periods[3],10),d100:l(a._periods[3],100),d1000:l(a._periods[3],1E3),hl:m(4),hn:this._minDigits(a,a._periods[4],1),hnn:this._minDigits(a,a._periods[4],2),hnnn:this._minDigits(a,a._periods[4],3),h1:l(a._periods[4],1),h10:l(a._periods[4],10),h100:l(a._periods[4],100),h1000:l(a._periods[4],1E3),ml:m(5),mn:this._minDigits(a,
a._periods[5],1),mnn:this._minDigits(a,a._periods[5],2),mnnn:this._minDigits(a,a._periods[5],3),m1:l(a._periods[5],1),m10:l(a._periods[5],10),m100:l(a._periods[5],100),m1000:l(a._periods[5],1E3),sl:m(6),sn:this._minDigits(a,a._periods[6],1),snn:this._minDigits(a,a._periods[6],2),snnn:this._minDigits(a,a._periods[6],3),s1:l(a._periods[6],1),s10:l(a._periods[6],10),s100:l(a._periods[6],100),s1000:l(a._periods[6],1E3)},r=c;for(c=0;6>=c;c++)l="yowdhms".charAt(c),r=r.replace(RegExp("\\{"+l+"<\\}([\\s\\S]*)\\{"+
l+">\\}","g"),!e&&d[c]||e&&j[c]?"$1":"");b.each(m,function(a,b){r=r.replace(RegExp("\\{"+a+"\\}","g"),b)});return r},_minDigits:function(a,b,c){b=""+b;if(b.length>=c)return this._translateDigits(a,b);b="0000000000"+b;return this._translateDigits(a,b.substr(b.length-c))},_translateDigits:function(a,b){return(""+b).replace(/[0-9]/g,function(b){return a.options.digits[b]})},_determineShow:function(a){a=a.options.format;var b=[];b[0]=a.match("y")?"?":a.match("Y")?"!":null;b[1]=a.match("o")?"?":a.match("O")?
"!":null;b[2]=a.match("w")?"?":a.match("W")?"!":null;b[3]=a.match("d")?"?":a.match("D")?"!":null;b[4]=a.match("h")?"?":a.match("H")?"!":null;b[5]=a.match("m")?"?":a.match("M")?"!":null;b[6]=a.match("s")?"?":a.match("S")?"!":null;return b},_calculatePeriods:function(a,b,c,g){a._now=g;a._now.setMilliseconds(0);var e=new Date(a._now.getTime());a._since?g.getTime()<a._since.getTime()?a._now=g=e:g=a._since:(e.setTime(a._until.getTime()),g.getTime()>a._until.getTime()&&(a._now=g=e));var j=[0,0,0,0,0,0,
0];if(b[0]||b[1]){var h=f._getDaysInMonth(g.getFullYear(),g.getMonth()),p=f._getDaysInMonth(e.getFullYear(),e.getMonth()),p=e.getDate()==g.getDate()||e.getDate()>=Math.min(h,p)&&g.getDate()>=Math.min(h,p),p=Math.max(0,12*(e.getFullYear()-g.getFullYear())+e.getMonth()-g.getMonth()+(e.getDate()<g.getDate()&&!p||p&&60*(60*e.getHours()+e.getMinutes())+e.getSeconds()<60*(60*g.getHours()+g.getMinutes())+g.getSeconds()?-1:0));j[0]=b[0]?Math.floor(p/12):0;j[1]=b[1]?p-12*j[0]:0;g=new Date(g.getTime());h=g.getDate()==
h;p=f._getDaysInMonth(g.getFullYear()+j[0],g.getMonth()+j[1]);g.getDate()>p&&g.setDate(p);g.setFullYear(g.getFullYear()+j[0]);g.setMonth(g.getMonth()+j[1]);h&&g.setDate(p)}var m=Math.floor((e.getTime()-g.getTime())/1E3);g=function(a,c){j[a]=b[a]?Math.floor(m/c):0;m-=j[a]*c};g(2,604800);g(3,86400);g(4,3600);g(5,60);g(6,1);if(0<m&&!a._since){a=[1,12,4.3482,7,24,60,60];g=6;e=1;for(h=6;0<=h;h--)b[h]&&(j[g]>=e&&(j[g]=0,m=1),0<m&&(j[h]++,m=0,g=h,e=1)),e*=a[h]}if(c)for(h=0;6>=h;h++)c&&j[h]?c--:c||(j[h]=
0);return j}});var c=["getTimes"];b.fn.countdown=function(a){var d=Array.prototype.slice.call(arguments,1),e;e="option"==a&&(0==d.length||1==d.length&&"string"==typeof d[0])?!0:-1<b.inArray(a,c);return e?f["_"+a+"Plugin"].apply(f,[this[0]].concat(d)):this.each(function(){if("string"==typeof a){if(!f["_"+a+"Plugin"])throw"Unknown command: "+a;f["_"+a+"Plugin"].apply(f,[this].concat(d))}else f._attachPlugin(this,a||{})})};var f=b.countdown=new e})(jQuery);
(function(b){var e=(b.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;b.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};b.fn.extend({caret:function(b,a){if(0!=this.length){if("number"==typeof b)return a="number"==typeof a?a:b,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(b,a);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0);c.moveEnd("character",a);c.moveStart("character",b);c.select()}});if(this[0].setSelectionRange)b=
this[0].selectionStart,a=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var c=document.selection.createRange();b=0-c.duplicate().moveStart("character",-1E5);a=b+c.text.length}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(f,a){if(!f&&0<this.length){var d=b(this[0]),n=d.data("tests");return b.map(d.data("buffer"),function(a,b){return n[b]?a:null}).join("")}a=b.extend({placeholder:"_",completed:null},a);var g=b.mask.definitions,
n=[],k=f.length,j=null,h=f.length;b.each(f.split(""),function(a,b){"?"==b?(h--,k=a):g[b]?(n.push(RegExp(g[b])),null==j&&(j=n.length-1)):n.push(null)});return this.each(function(){function d(a){for(;++a<=h&&!n[a];);return a}function m(f){var e=b(this).caret();f=f.keyCode;v=16>f||16<f&&32>f||32<f&&41>f;0!=e.begin-e.end&&(!v||8==f||46==f)&&r(e.begin,e.end);if(8==f||46==f||c&&127==f){for(e=e.begin+(46==f?0:-1);!n[e]&&0<=--e;);for(f=e;f<h;f++)if(n[f]){s[f]=a.placeholder;var g=d(f);if(g<h&&n[f].test(s[g]))s[f]=
s[g];else break}u();q.caret(Math.max(j,e));return!1}if(27==f)return q.val(w),q.caret(0,t()),!1}function l(c){if(v)return v=!1,8==c.keyCode?!1:null;c=c||window.event;var f=c.charCode||c.keyCode||c.which,e=b(this).caret();if(c.ctrlKey||c.altKey||c.metaKey)return!0;if(32<=f&&125>=f||186<f)if(c=d(e.begin-1),c<h&&(f=String.fromCharCode(f),n[c].test(f))){for(var e=c,g=a.placeholder;e<h;e++)if(n[e]){var j=d(e),k=s[e];s[e]=g;if(j<h&&n[j].test(k))g=k;else break}s[c]=f;u();c=d(c);b(this).caret(c);a.completed&&
c==h&&a.completed.call(q)}return!1}function r(b,c){for(var d=b;d<c&&d<h;d++)n[d]&&(s[d]=a.placeholder)}function u(){return q.val(s.join("")).val()}function t(b){for(var c=q.val(),d=-1,f=0,e=0;f<h;f++)if(n[f]){for(s[f]=a.placeholder;e++<c.length;){var g=c.charAt(e-1);if(n[f].test(g)){s[f]=g;d=f;break}}if(e>c.length)break}else s[f]==c[e]&&f!=k&&(e++,d=f);if(!b&&d+1<k)q.val(""),r(0,h);else if(b||d+1>=k)u(),b||q.val(q.val().substring(0,d+1));return k?f:j}var q=b(this),s=b.map(f.split(""),function(b){if("?"!=
b)return g[b]?a.placeholder:b}),v=!1,w=q.val();q.data("buffer",s).data("tests",n);q.attr("readonly")||q.one("unmask",function(){q.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){w=q.val();var a=t();u();setTimeout(function(){a==f.length?q.caret(0,a):q.caret(a)},0)}).bind("blur.mask",function(){t();q.val()!=w&&q.change()}).bind("keydown.mask",m).bind("keypress.mask",l).bind(e,function(){setTimeout(function(){q.caret(t(!0))},0)});t()})}})})(jQuery);
pe.HelpModule=function(b,e,c){pe.init_widget(this,b);this.help_module_open=!1;this.help_id=e;this.container.append(this.html(c));this.container.click(this.callback(this.help_button_clicked));this.help_button_div=this.container.find(".HelpButton");(this.admin_link=this.container.find(".AdminLink"))&&this.admin_link.click(this.callback(this.admin_link_clicked))};
pe.HelpModule.prototype.html=function(b){var e="";0===this.container.contents().length&&(e+='<div class="help_btn HelpButton"></div>');b&&(e+='<div><a class="AdminLink admin_edit" target="_blank" href="/admin/pages/'+this.help_id+'/edit">Edit Tip</a></div>');return e};pe.HelpModule.prototype.admin_link_clicked=function(b){b.stopPropagation()};
pe.HelpModule.prototype.help_button_clicked=function(b){this.help_module_open?b.stopPropagation():pe.ajax_loader.help_page.load({page_id:this.help_id},this.callback(function(b){b=$(this.dialog_box_html(b));this.help_button_div.append(b);this.help_module_open=!0;new pe.CloseButton(b,this.callback(this.close_dialog,b))}))};
pe.HelpModule.prototype.dialog_box_html=function(b){return pe.templatize('<div class="DialogBox dialog_box"><div class="dialog_content_wrapper clearfix"><div class="CloseButton close_btn" title="Close"></div><div class="dialog_img"></div><div class="dialog_content"> <h1>{{title}}</h1>{{content}}</div></div></div><div class="dialog_point"><div class="dialog_inner_point"></div></div>',b)};pe.HelpModule.prototype.close_dialog=function(b,e){this.help_module_open=!1;b.remove();e.stopPropagation()};
(function(){pe.validation.promo_code_validator=new pe.Validator({message:"Invalid code",callback:function(b){b=$.trim(b.val());this.message="Invalid code";return _.isEmpty(b)?(this.message="Please enter a promo code",!1):25<b.length?(this.message="Length is limited by 25 characters",!1):/^[\w-_@.]+$/.test(b)}})}).call(this);
(function(){var b=function(b,a){return function(){return b.apply(a,arguments)}},e=pe,c=function(c){var a=this;this.container=c;this.remove_promo=b(this.remove_promo,this);this.assign_promo=b(this.assign_promo,this);this.apply_promo=b(this.apply_promo,this);this.input=this.container.find(".Input");this.input.val(this.container.data("value"));this.apply_button=this.container.find(".ApplyCodeButton");this.apply_button.data("label",this.apply_button.html());this.remove_button=this.container.find(".RemoveCodeButton");
this.remove_button.data("label",this.remove_button.html());this.apply_button.click(this.apply_promo);this.remove_button.click(this.remove_promo);this.container.find(".Toggler").click(function(){a.container.find(".Fields").show();return a.container.find(".Toggler").hide()});this.error=this.container.find(".Error");this.message=this.container.find(".Message");this.container.data("valid")?this.assign_promo():this.initialize()};c.prototype.promo_code_entered=function(){return!_.isEmpty(this.promo_code())};
c.prototype.promo_code=function(){return this.input.val()};c.prototype.hide_error=function(){this.error.html("");return this.error.hide()};c.prototype.show_error=function(b){this.error.html("<span>"+b+"</span>");return this.error.show()};c.prototype.show_message=function(b){this.message.html(b);return this.message.show()};c.prototype.hide_message=function(){return this.message.hide()};c.prototype.initialize=function(){this.promo_code_entered()?(this.container.find(".Toggler").hide(),this.container.find(".Fields").show()):
(this.container.find(".Fields").hide(),this.container.find(".Toggler").show());this.input.show();return this.apply_button.show()};c.prototype.reload_table=function(){var b,a;b=$(this.container.data("target"));b.css("opacity",0.5);a=b.data("url");return $.get(a,function(a){b.replaceWith(a);return $(".TotalAmount").html($(".Supermoney").html())})};c.prototype.apply_promo=function(){var b,a=this;return pe.validation.promo_code_validator.passed(this.input)?(this.error.hide(),this.apply_button.html("Please wait...").addClass("disabled"),
b={},b.ticket_order={promo:this.promo_code()},pe.routes.Request.from_current_location("api_apply_ticket_order_promo_code",b).post(function(b){a.apply_button.html(a.apply_button.data("label"));a.apply_button.removeClass("disabled");if(1===b.status)return a.show_error(b.message);a.hide_message();a.assign_promo();return a.reload_table()})):this.show_error(pe.validation.promo_code_validator.message)};c.prototype.assign_promo=function(){this.container.find(".Fields").show();this.container.find(".Toggler").hide();
this.input.hide();this.apply_button.hide();this.hide_error();this.show_message("Promo Applied: "+this.promo_code());return this.remove_button.show()};c.prototype.remove_promo=function(){var b=this;this.remove_button.addClass("disabled").html("Please wait...");return pe.routes.Request.from_current_location("api_remove_ticket_order_promo_code").post(function(a){b.remove_button.html(b.remove_button.data("label"));b.remove_button.removeClass("disabled");if(1===a.status)return b.show_error(a.message);
b.hide_error();b.reload_table();b.container.find(".Fields").show();b.hide_error();b.hide_message();b.remove_button.hide();b.input.val("");b.input.show();return b.apply_button.show()})};e.TicketPromoApplier=c;pe.on_expire=function(){window.onbeforeunload=null;$(".Timer").html("0:00");alert("The time limit has been exceeded and your tickets have been released. \n\nThe purpose of the time limit is to give all fans a fair shot at tickets and ensure tickets are available to as many people as possible. We are sorry for the inconvenience.");
$("body").css("cursor","wait");return pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){return window.location=pe.routes.build_path("tickets",pe.routes.current_url_params())})};pe.on_tick=function(){return $(".Timer").html($(".Timer").html().replace(/0(\d+):/,"$1:"))};window.onbeforeunload=function(){return"You have not completed the purchase process."};$(function(){return pe.init_page_framework(function(){var b,a,c,e,g;pe.routes.Request.factory("api_ticket_orders_countdown_seconds").get(function(a){var b;
b=new Date;b=new Date(b.getTime()+1E3*a.data.seconds);return $(".Timer").countdown({until:b,compact:!0,format:"MS",description:"",onExpiry:pe.on_expire,onTick:pe.on_tick})});$(".EditOrderLink").click(function(a){window.onbeforeunload=null;if(confirm("Your tickets will be released for others to purchase if you leave this page.\n\nDo you wish to forfeit your tickets?"))return $(this).html("Please wait..."),$("body").css("cursor","wait"),pe.routes.Request.factory("api_ticket_orders_disable_pending").post(function(){return window.location=
pe.routes.build_path("tickets",pe.routes.current_url_params())});a.preventDefault();return a.stopPropagation()});c=$("#OrderTicketsForm");0<c.length&&(pe.order_tickets_form=new pe.StripeForm(c,"api_close_ticket_order",function(){window.onbeforeunload=null;return window.location=pe.routes.build_path("tickets_confirmation",pe.routes.current_url_params())}),e=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||
_.isEmpty($("#ExpYear").val())}}),g=new pe.Validator({message:"Invalid date",callback:function(){return Stripe.card.validateExpiry($("#ExpMonth").val(),$("#ExpYear").val())},unless:function(){return _.isEmpty($("#ExpMonth").val())||_.isEmpty($("#ExpYear").val())}}),b=new pe.Validator({message:"Card number does not match this type",callback:function(){return Stripe.card.cardType($("#CardNumber").val())===$("#payment_type").val()},unless:function(){return!pe.validation.cc_number_validator.passed($("#CardNumber"))}}),
e={"#payment_type":b,"#CardNumber":pe.validation.cc_number_validator,"#ExpMonth":e,"#ExpYear":g,"#Cvc":pe.validation.cvc_validator,"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Address1":pe.validation.not_blank_validator,"#City":pe.validation.not_blank_validator,"#state":pe.validation.not_blank_validator,"#Zip":pe.validation.zip_code_validator,"#Phone":pe.validation.not_blank_validator,"#Email":pe.validation.email_format_validator},b={"#payment_type":"change",
"#CardNumber":"blur","#ExpMonth":"change","#ExpYear":"change","#Cvc":"blur","#FirstName":"blur","#LastName":"blur","#Address1":"blur","#City":"blur","#state":"change","#Zip":"blur","#Phone":"blur","#Email":"blur"},$("#CardNumber").change(function(){return pe.form.validate_field("#payment_type")}),$("#Phone").mask("(999) 999-9999"),pe.form=new pe.ValidatableForm(c,e,b),c=c.find(".SubmitButton"),c.unbind("click"),c.click(function(a){a.preventDefault();a.stopPropagation();pe.form.on_submit()&&pe.order_tickets_form.charge();
return!1}),$(".CCTypeButton").click(function(){$(".CCTypeButton").removeClass("selected").addClass("disabled");$(this).addClass("selected");$(".CCType").val($(this).data("value"));return pe.form.validate_field("#payment_type")}),$(".BillingInput[name=has_email_delivery]").change(function(){return"true"===$(this).val()?$(".DeliveryMessage").html("Your tickets and confirmation email will be sent to the above email address."):$(".DeliveryMessage").html("Your confirmation email will be sent to the above email address.")}));
setTimeout(function(){return pe.promo=new pe.TicketPromoApplier($(".PromoCode"))},5);pe.right_rail_floater=new pe.Floater($(".FloaterContainer"),$(".FloaterLimiter"));pe.ask_party_earth=new pe.AskPartyEarth($(".AskPartyEarth"));pe.ask_party_earth.click(function(){pe.right_rail_floater.start_floating();return pe.right_rail_floater.scrolling()});a=$(".CodeTipContent");if(0<a.length)return $(".CodeTipLink").click(function(){return a.toggle()}),$(".CodeTipClose").click(function(){return a.hide()})})})}).call(this);
