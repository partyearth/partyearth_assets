pe.ajax_loader={};pe.ajax_loader.Loader=function(a,b,c){pe.init_widget(this,null);a=a.replace(/#[^$\/]+/,"").replace(/(^[^?]+)([^:])\/\//,"$1$2/");this.url=-1<a.indexOf("?")?a.replace("?","."+b+"?"):a+"."+b;this.callbacks=[];this.cache=null;this.data_type=b;c&&(this.expander_function=c);this.status=pe.ajax_loader.Loader.statuses.EMPTY};pe.ajax_loader.Loader.data_types={JSON:"json",EHTML:"ehtml"};pe.ajax_loader.Loader.statuses={EMPTY:"EMPTY",LOADING:"LOADING",LOADED:"LOADED"};
pe.ajax_loader.Loader.prototype.find=function(){return this.cache};
pe.ajax_loader.Loader.prototype.load=function(a){if(this.status===pe.ajax_loader.Loader.statuses.LOADED)a&&a(this.cache);else if(a&&this.callbacks.push(a),this.status===pe.ajax_loader.Loader.statuses.EMPTY)switch(this.status=pe.ajax_loader.Loader.statuses.LOADING,speed_tracker.start_timer("load "+this.url),this.data_type){case pe.ajax_loader.Loader.data_types.JSON:$.getJSON(this.url,null,this.callback(this.request_success));break;case pe.ajax_loader.Loader.data_types.EHTML:$.get(this.url,null,this.callback(this.request_success))}};
pe.ajax_loader.Loader.prototype.preload=function(a,b){this.cache=this.expander_function&&b?this.expander_function(a):a;this.status=pe.ajax_loader.Loader.statuses.LOADED};pe.ajax_loader.Loader.prototype.request_success=function(a){this.cache=this.expander_function?this.expander_function(a):a;this.status=pe.ajax_loader.Loader.statuses.LOADED;$.each(this.callbacks,this.callback(function(a,c){try{c(this.cache)}catch(d){alert("error: "+d.message+"\nfile: "+d.fileName+"\nline: "+d.lineNumber)}}))};
pe.ajax_loader.MultiLoader=function(a,b,c){this.url_template=a;this.data_type=b;this.loaders={};this.expander_function=c};pe.ajax_loader.MultiLoader.prototype.find=function(a){return this.get_loader(a).find()};pe.ajax_loader.MultiLoader.prototype.get_loader=function(a){var b=this.object_url(a),c=null;$.each(this.loaders,function(a,e){if(a===b)return c=e,!1});c||(c=new pe.ajax_loader.Loader(b,this.data_type,this.expander_function),this.loaders[b]=c);return c};
pe.ajax_loader.MultiLoader.prototype.load=function(a,b){this.get_loader(a).load(b)};pe.ajax_loader.MultiLoader.prototype.object_url=function(a){return"string"===typeof a?pe.templatize(this.url_template,{id:a}):pe.templatize(this.url_template,a)};pe.ajax_loader.MultiLoader.prototype.preload=function(a,b){this.get_loader(a).preload(b)};
