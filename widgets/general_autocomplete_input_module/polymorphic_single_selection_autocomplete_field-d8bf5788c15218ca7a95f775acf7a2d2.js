pe.CloseButton=function(a,b){pe.init_widget(this,a);this.close_button=a.find(".CloseButton");if("function"===typeof b)this.close_button.click(b);else switch(b){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}};pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"};
pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"};pe.CloseButton.prototype.remove_container=function(){this.container.detach();this.fire_event(pe.CloseButton.events.CLOSED);this.container.remove();return!1};pe.CloseButton.prototype.hide_container=function(){this.fire_event(pe.CloseButton.events.CLOSED);this.container.hide();return!1};
pe.PolymorphicSingleSelectionAutocompleteField=function(a,b,c,e,d){pe.init_widget(this,a);this.autocomplete_data_or_url=b;this.input_field_id_name=c;this.input_field_type_name=e;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.autocomplete_input_field=this.container.find(".AutocompleteField");this.autocomplete_handler();this.selected_data_container=this.container.find(".SelectedValue");d&&this.set_field_value(d)};
pe.PolymorphicSingleSelectionAutocompleteField.events={SELECTED:"PolymorphicSingleSelectionAutocompleteField_SELECTED"};pe.PolymorphicSingleSelectionAutocompleteField.prototype.set_field_value=function(a){a&&(this.remove_dummy_row(),this.autocomplete_data_selected(a.label,a.id,a.category))};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField"        type="hidden" name="'+this.input_field_id_name+'"       value="x_mock_single_value_x">'),this.autocomplete_input_field.after(this.dummy_input_field))};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.autocomplete_data_selected=function(a,b,c){this.remove_dummy_row();this.selected_data_container.append(this.selected_data_html(a,b,c));(new pe.CloseButton(this.selected_data_container.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));this.autocomplete_input_field.hide()};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.autocomplete_handler=function(){this.autocomplete_input_field.autocomplete({source:this.autocomplete_data_or_url,minLength:1,close:this.callback(function(){this.autocomplete_input_field.val("")}),select:this.callback(function(a,b){var c=b.item;this.autocomplete_data_selected(c.label,c.id,c.category);this.fire_event(pe.PolymorphicSingleSelectionAutocompleteField.events.SELECTED,c.id)})}).data("autocomplete")._renderItem=function(a,b){b.display_label=
b.category?pe.templatize("{{label}} ({{category}})",b):b.label;return $("<li></li>").data("item.autocomplete",b).append(pe.templatize("<a>{{display_label}}</a>",b)).appendTo(a)}};pe.PolymorphicSingleSelectionAutocompleteField.prototype.clear_selected_data=function(){this.selected_data_container.html("");this.add_dummy_row()};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.close_button_clicked=function(){0===this.selected_data_container.find(".SelectedInputData").length&&this.add_dummy_row();this.autocomplete_input_field.show();this.autocomplete_input_field.focus()};pe.PolymorphicSingleSelectionAutocompleteField.prototype.display_close_button=function(){this.selected_data_container.find(".CloseButton").show()};pe.PolymorphicSingleSelectionAutocompleteField.prototype.hide_close_button=function(){this.selected_data_container.find(".CloseButton").hide()};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.html=function(){return'<input class="AutocompleteField" type="text"><input class="DummyInputField" type="hidden" name="'+this.input_field_id_name+'" value="x_mock_single_value_x"><div class="SelectedValue"></div>'};pe.PolymorphicSingleSelectionAutocompleteField.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.replace_data_in_list=function(a){this.clear_selected_data();this.set_field_value(a)};
pe.PolymorphicSingleSelectionAutocompleteField.prototype.selected_data_html=function(a,b,c){return'<div class="SelectedInputData"><span class="CloseButton float_right" style="color:red; font-weight:bold; font-style: italic; cursor: pointer;">&nbsp;&rarr;&nbsp;change&nbsp;value</span>  <p class="float_left" style="font-size: 14pt; background: #add8e6; padding:5px;">'+(a+"("+c+")")+'</p>  <input type="hidden" value="'+b+'" name="'+this.input_field_id_name+'">  <input type="hidden" value="'+c+'" name="'+
this.input_field_type_name+'">  <div class="clear"></div></div>'};
