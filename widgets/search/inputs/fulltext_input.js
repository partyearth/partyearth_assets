pe.FulltextInput=function(a){pe.init_widget(this,a);this.container.html(this.dom());this.container.find(".InfieldLabel label").inFieldLabels();this.text_field=pe.load(this.container.find(".TextField"));this.text_field.keypress(this.callback(this.text_field_key_up));this.go_button=pe.load(this.container.find(".Go"));this.go_button.click(this.callback(this.go_button_clicked));this.autocomplete=this.tags_widget_list=this.search_configuration_to_apply=null};pe.FulltextInput.events={CHANGED:"FulltextInput_CHANGED"};
pe.FulltextInput.prototype.add_search_configuration=function(a){if(this.search_configuration_to_apply)$.each(this.search_configuration_to_apply,function(b,c){a.add_filter(c.type,c.value)}),this.search_configuration_to_apply=null;else{var c=this.text_field.val();""!==c&&a.add_filter("fulltext",c)}};pe.FulltextInput.prototype.autocomplete_entry_focussed=function(){return!1};pe.FulltextInput.prototype.destroy=function(){this.autocomplete&&this.text_field.autocomplete("destroy")};
pe.FulltextInput.prototype.dom=function(){return'<div class="InfieldLabel"><div class="input float_left"><input type="text" class="TextField" id="FulltextInputField"></div><label for="FulltextInputField" class="desc">e.g. Bar, Beach, Lady Gaga</label><input type="button" class="Go btn go_btn float_left" value="Go"></div><div class="clear"></div> '};pe.FulltextInput.prototype.go_button_clicked=function(){this.fire_event(pe.FulltextInput.events.CHANGED)};
pe.FulltextInput.prototype.read_search_configuration=function(a){var c=a.get_filter("fulltext");c&&(this.text_field.val(c),this.text_field.focus());this.search_configuration_to_apply=[];(c=a.get_filter("venue_name"))&&this.search_configuration_to_apply.push({type:"venue_name",value:c});(c=a.get_filter("performer_name"))&&this.search_configuration_to_apply.push({type:"performer_name",value:c});(c=a.get_filter("start_date"))&&this.search_configuration_to_apply.push({type:"start_date",value:c});(a=a.get_filter("end_date"))&&
this.search_configuration_to_apply.push({type:"end_date",value:a})};pe.FulltextInput.prototype.render_suggestion=function(a,c){var b=$(pe.templatize("<li><a>{{label}}</a></li>",c));a.append(b);b.data("item.autocomplete",c);return b};pe.FulltextInput.prototype.reset=function(){this.text_field.val("");this.text_field.autocomplete("close");this.search_configuration_to_apply=null};
pe.FulltextInput.prototype.set_autocomplete_data=function(a){this.autocomplete=this.text_field.autocomplete({minLength:3,source:pe.bind(pe.set_autocomplete_source,a),select:this.callback(this.suggestion_selected),focus:this.callback(this.autocomplete_entry_focussed)}).data("autocomplete");this.autocomplete._renderItem=this.callback(this.render_suggestion)};pe.FulltextInput.prototype.set_tags_widget_list=function(a){this.tags_widget_list=a};
pe.FulltextInput.prototype.suggestion_selected=function(a,c){this.text_field.val("");var b=c.item;switch(b.category){case "cities":pe.filter_city_neighborhood.set_city(b.value);pe.map.tooltip_div.hide();pe.city_changed(!0,null,b.value);break;case "crowds":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Crowd").select_tags([b.label],!0);pe.search();break;case "dresses":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Dress").select_tags([b.label],
!0);pe.search();break;case "entertainments":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Entertainment").select_tags([b.label],!0);pe.search();break;case "events":pe.ajax_loader.event.load({event_id:c.item.value,timestamp:pe.events_timestamp()},this.callback(function(a){pe.ajax_loader.city.load(a.city_id,this.callback(function(a){var c=new Date,d=new Date;d.setFullYear(d.getFullYear()+1);pe.calendar_dropdown.set_dates(c,d);pe.map.set_view(a.latitude,a.longitude,a.default_zoom_level);
pe.map.set_cities([]);pe.search_results_widget.select_tab(2);pe.filter_city_neighborhood.set_city(a.id);this.search_configuration_to_apply=[{type:"event_name",value:b.label}];pe.search()}))}));break;case "food_drinks":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Food/Drink").select_tags([b.label],!0);pe.search();break;case "layout_d\u00e9cors":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Layout/D\u00e9cor").select_tags([b.label],!0);pe.search();
break;case "musics":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Music").select_tags([b.label],!0);pe.search();break;case "neighborhoods":pe.ajax_loader.neighborhood.load(b.value,this.callback(function(a){pe.map.set_view(a.latitude,a.longitude,a.default_zoom_level);pe.map.set_cities([]);pe.filter_city_neighborhood.set_city(a.city_id);pe.filter_city_neighborhood.set_neighborhood(a.id);pe.search()}));break;case "performers":pe.search_results_widget.select_tab(2);var f=
new Date,e=new Date;e.setMonth(e.getMonth()+3);this.search_configuration_to_apply=[{type:"performer_name",value:[b.label]},{type:"start_date",value:pe.date_string(f)},{type:"end_date",value:pe.date_string(e)}];pe.search();break;case "prices":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Prices").select_tags([b.label],!0);pe.search();break;case "seasonals":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Seasonal").select_tags([b.label],!0);pe.search();
break;case "venue_types":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Venue Type").select_tags([b.label],!0);pe.search();break;case "venues":pe.ajax_loader.venue.load(c.item.value,this.callback(function(a){pe.ajax_loader.city.load(a.city_id,this.callback(function(a){pe.filter_city_neighborhood.set_city(a.id);pe.map.set_view(a.latitude,a.longitude,a.default_zoom_level);pe.search_results_widget.select_tab(0);pe.map.set_cities([]);this.search_configuration_to_apply=[{type:"venue_name",
value:b.label}];pe.search()}))}));break;case "vibes":pe.search_results_widget.select_tab(0);this.tags_widget_list.add_category("Vibe").select_tags([b.label],!0);pe.search();break;default:alert("unknown autocomplete category: "+b.category)}return!1};pe.FulltextInput.prototype.text_field_key_up=function(a){if(!(13!==a.keyCode||0===this.text_field.val().length))return this.go_button_clicked(),!1};
