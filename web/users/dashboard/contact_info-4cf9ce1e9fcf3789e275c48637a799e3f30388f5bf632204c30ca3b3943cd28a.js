!function(g){var k=(g.browser.msie?"paste":"input")+".mask",y=window.orientation!=undefined;g.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},g.fn.extend({caret:function(t,i){if(0!=this.length){if("number"==typeof t)return i="number"==typeof i?i:t,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(t,i);else if(this.createTextRange){var e=this.createTextRange();e.collapse(!0),e.moveEnd("character",i),e.moveStart("character",t),e.select()}});if(this[0].setSelectionRange)t=this[0].selectionStart,i=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var e=document.selection.createRange();t=0-e.duplicate().moveStart("character",-1e5),i=t+e.text.length}return{begin:t,end:i}}},unmask:function(){return this.trigger("unmask")},mask:function(i,f){if(!i&&0<this.length){var e=g(this[0]),p=e.data("tests");return g.map(e.data("buffer"),function(e,t){return p[t]?e:null}).join("")}f=g.extend({placeholder:"_",completed:null},f);var m=g.mask.definitions,v=(p=[],i.length),b=null,_=i.length;return g.each(i.split(""),function(e,t){"?"==t?(_--,v=e):m[t]?(p.push(new RegExp(m[t])),null==b&&(b=p.length-1)):p.push(null)}),this.each(function(){function s(e){for(;++e<=_&&!p[e];);return e}function a(e){for(;!p[e]&&0<=--e;);for(var t=e;t<_;t++)if(p[t]){u[t]=f.placeholder;var i=s(t);if(!(i<_&&p[t].test(u[i])))break;u[t]=u[i]}d(),c.caret(Math.max(b,e))}function l(e){for(var t=e,i=f.placeholder;t<_;t++)if(p[t]){var a=s(t),n=u[t];if(u[t]=i,!(a<_&&p[a].test(n)))break;i=n}}function e(e){var t=g(this).caret(),i=e.keyCode;return h=i<16||16<i&&i<32||32<i&&i<41,t.begin-t.end==0||h&&8!=i&&46!=i||o(t.begin,t.end),8==i||46==i||y&&127==i?(a(t.begin+(46==i?0:-1)),!1):27==i?(c.val(r),c.caret(0,n()),!1):void 0}function t(e){if(h)return h=!1,8!=e.keyCode&&null;var t=(e=e||window.event).charCode||e.keyCode||e.which,i=g(this).caret();if(e.ctrlKey||e.altKey||e.metaKey)return!0;if(32<=t&&t<=125||186<t){var a=s(i.begin-1);if(a<_){var n=String.fromCharCode(t);if(p[a].test(n)){l(a),u[a]=n,d();var r=s(a);g(this).caret(r),f.completed&&r==_&&f.completed.call(c)}}}return!1}function o(e,t){for(var i=e;i<t&&i<_;i++)p[i]&&(u[i]=f.placeholder)}function d(){return c.val(u.join("")).val()}function n(e){for(var t=c.val(),i=-1,a=0,n=0;a<_;a++)if(p[a]){for(u[a]=f.placeholder;n++<t.length;){var r=t.charAt(n-1);if(p[a].test(r)){u[a]=r,i=a;break}}if(n>t.length)break}else u[a]==t[n]&&a!=v&&(n++,i=a);return!e&&i+1<v?(c.val(""),o(0,_)):(e||v<=i+1)&&(d(),e||c.val(c.val().substring(0,i+1))),v?a:b}var c=g(this),u=g.map(i.split(""),function(e){if("?"!=e)return m[e]?f.placeholder:e}),h=!1,r=c.val();c.data("buffer",u).data("tests",p),c.attr("readonly")||c.one("unmask",function(){c.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){r=c.val();var e=n();d(),setTimeout(function(){e==i.length?c.caret(0,e):c.caret(e)},0)}).bind("blur.mask",function(){n(),c.val()!=r&&c.change()}).bind("keydown.mask",e).bind("keypress.mask",t).bind(k,function(){setTimeout(function(){c.caret(n(!0))},0)}),n()})}})}(jQuery),pe.Validator=function(t){this.message=t.message||"Invalid value.",this.callback=t.callback,this.unless_callback=t.unless||function(){return!1},(this.options=t).value?this.value=t.value:this.value=function(e){return t.callback(e)}},pe.Validator.prototype.passed=function(e){return!!this.callback($(e))},pe.Validator.prototype.failed=function(e){return!this.passed(e)},pe.Validator.prototype.unless=function(){return this.unless_callback()},pe.validation.email_format_validator=new pe.Validator({callback:function(e){return pe.validation.check_email_format(e.val())},message:"Please enter a valid email address."}),pe.validation.check_email_format=function(e){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/.test($.trim(e))},pe.validation.name_validator=new pe.Validator({callback:function(e){return _.isEmpty($.trim(e.val()))?!(this.message="Required."):!(50<e.val().length)||!(this.message="Please shorten your name.")},message:"Invalid name."}),pe.validation.not_blank_validator=new pe.Validator({callback:function(e){return"checkbox"==e.attr("type")?$(e).is(":checked"):!_.isEmpty($.trim(e.val()))},message:"Required."}),function(){pe.validation.dob_validator=new pe.Validator({message:"Please enter valid date.",callback:function(e){var t,i,a,n,r,s,l,o;return o=(s=_.map($(e).find("select"),function(e){return $(e).val()}))[2],r=s[0],a=s[1],!!(o&&r&&a)&&(n=(i=new Date(r+"/"+a+"/"+o)).getMonth()+1+"",t=i.getDate()+"",l=i.getFullYear()+"",n===r&&t===a&&l===o)}})}.call(this),function(){pe.validation.check_group_validator=new pe.Validator({message:"Please select something.",callback:function(e){return 0<e.find("input:checked").length}})}.call(this),pe.ValidatableForm=function(container,rules,bindings,after_submit){pe.init_widget(this,container),this.bindings=bindings||{},this.chained_fields=[],this.errors={},this.rules=rules||{},_.each(container.find(".input[data-required=true], select[data-required=true], input[data-required=true], textarea[data-required=true]"),this.callback(function(element){element=$(element);var selector="#"+element.attr("id"),validator=element.data("validator");this.rules[selector]=validator?eval(validator):pe.validation.not_blank_validator;var binding=element.data("binding");binding?this.bindings[selector]=binding:"text"==element.attr("type")||"textarea"==element.attr("tagName")?this.bindings[selector]="blur":this.rules[selector]==pe.validation.dob_validator?element.find("select").each(this.callback(function(e,t){$(t).change(this.callback(function(){this.validate_field(selector)}))})):this.bindings[selector]="change"})),this.save_button=this.container.find(".SaveButton"),this.submit_button=this.container.find(".SubmitButton"),this.after_submit=after_submit,this.init_bindings(),this.validate(),this.toggle_submit(),this.submit_button.click(this.callback(this.on_submit))},pe.ValidatableForm.prototype.init_bindings=function(){this.container.find("input, textarea, select").change(this.callback(function(){this.save_button.removeClass("disabled").removeAttr("disabled")})),_.each(this.bindings,function(e,t){"string"==typeof e?$(t).bind(e,this.callback(function(){this.validate_field(t)})):"function"==typeof e&&this.callback(e)(),this.rules[t].value($(t))&&this.validate_field(t)},this)},pe.ValidatableForm.prototype.on_submit=function(){var e=this.validate();return this.highlight_first_failed(),e&&this.after_submit&&this.after_submit(),e},pe.ValidatableForm.prototype.delete_error=function(t){delete this.errors[t],_.each(this.chained_fields,function(e){_.include(e,t)&&_.each(e,function(e){this.errors[e]&&this.delete_error(e)},this)},this)},pe.ValidatableForm.prototype.focus_on_failed=function(){if(!this.valid())return pe.install_easing(),pe.animated_scrolling($(".inline-errors:first").parents("li"),2),!1},pe.ValidatableForm.prototype.highlight_first_failed=function(){if(!this.validate()){if(!this.validation_shown()){var e=_.keys(this.errors)[0];this.render_field_error(e)}this.focus_on_failed()}},pe.ValidatableForm.prototype.render_errors=function(){_.each(this.errors,function(e,t){this.render_field_error(t)},this)},pe.ValidatableForm.prototype.render_field_error=function(e){var t=$(e).parents("li.input:first");0===t.length&&(t=$(e)),t.find(".inline-errors").remove(),t.append('<span class="inline-errors">'+this.errors[e]+"</span>"),t.find(".inline-success").remove()},pe.ValidatableForm.prototype.render_field_success=function(e){var t=$(e).parents("li.input:first");0===t.length&&(t=$(e)),t.find(".inline-success").remove(),t.append('<img class="inline-success" src="/assets/users/check.png" />'),t.find(".inline-errors").remove()},pe.ValidatableForm.prototype.render_success=function(){_.each(this.valid_fields(),function(e){this.render_field_success(e)},this)},pe.ValidatableForm.prototype.toggle_submit=function(){this.valid()?this.submit_button.removeClass("disabled").removeAttr("disabled"):this.submit_button.addClass("disabled")},pe.ValidatableForm.prototype.valid_fields=function(){return _.difference(_.keys(this.rules),_.keys(this.errors))},pe.ValidatableForm.prototype.validate_field=function(e){var t=this.rules[e],i=t.passed(e);return t.unless()?this.delete_error(e):i?(this.delete_error(e),this.render_field_success(e)):(this.errors[e]=$(e).data("message")||t.message,this.render_field_error(e)),this.toggle_submit(),i},pe.ValidatableForm.prototype.valid=function(){return _.isEmpty(this.errors)},pe.ValidatableForm.prototype.validate=function(){return _.each(this.rules,function(e,t){e.failed(t)?this.errors[t]=$(t).data("message")||e.message:delete this.errors[t]},this),this.valid()},pe.ValidatableForm.prototype.validate_together=function(){this.chained_fields.push(arguments)},pe.ValidatableForm.prototype.validation_shown=function(){return 0<this.container.find(".inline-errors").length},function(){$(function(){var e,t;return $("#Phone").mask("(999) 999-9999"),$("#WorkPhone").mask("(999) 999-9999"),t={"#FirstName":pe.validation.name_validator,"#LastName":pe.validation.name_validator,"#Email":pe.validation.email_format_validator,"#Phone":pe.validation.not_blank_validator,"#CompanyName":pe.validation.not_blank_validator,"#BusinessAddress":pe.validation.not_blank_validator,"#BusinessCity":pe.validation.not_blank_validator,"#BusinessState":pe.validation.not_blank_validator,"#BusinessZipCode":pe.validation.not_blank_validator,"#BusinessCountry":pe.validation.not_blank_validator,"#WorkPhone":pe.validation.not_blank_validator},e={"#FirstName":"blur","#LastName":"blur","#Email":"blur","#Phone":"blur","#CompanyName":"blur","#BusinessAddress":"blur","#BusinessCity":"blur","#BusinessState":"blur","#BusinessZipCode":"blur","#BusinessCountry":"change","#WorkPhone":"blur"},window.x=new pe.ValidatableForm($("form.ContactInfo"),t,e),pe.init_page_framework()})}.call(this);