pe.validation.autocomplete_open=!1,pe.validate_on_key_up=function(e,i){return e.keyup(function(){i(e)}),e.val()&&i(e),e},pe.validate_on_blur=function(e,i,a){return e.blur(function(){i(e)}),!a&&e.val()&&i(e),e},pe.validate_on_change=function(e,i,a){return e.change(function(){i(e)}),!a&&e.val()&&i(e),e},pe.validate_before_submit=function(s){s.submit(function(){pe.validation.clear_error_messages(s),s.find("input").each(function(e,i){var a=$(i);a.data("text_entered",!0),a.keyup(),a.blur()}),s.find("select").each(function(e,i){var a=$(i);a.data("text_entered",!0),a.change()}),s.find("textarea").each(function(e,i){var a=$(i);a.data("text_entered",!0),a.keyup(),a.blur()});var a=!0;if($.each(pe.validatables,function(e,i){a=i.validate_on_submit()&&a}),0<s.find(".inline-errors").length||!a){var e=s.find(".inline-errors:first").parent(),i=e.find("input:first");if(0<i.length)i.is(":hidden")?(i.show(),i.focus(),i.hide()):i.focus();else{var t=e.find("textarea"),n=e.find('select option:selected[value=""]').parent();t&&t.focus(),n&&n.focus()}return!1}})},pe.validate_user_exists=function(i,a){form=$(i.parents("form")[0]),form.submit(function(){return pe.validation.clear_error_messages(form),$.post("/api/users/check_user_exists",{login:i.val(),password:a.val()},function(e){pe.validation.show_message(i,e.username),pe.validation.show_message(a,e.password),_.isEmpty(e)&&(form.unbind("submit"),form.submit())}),!1})},pe.validation.clear_error_messages=function(e){pe.validation.find_error_messages(e).remove()},pe.validation.find_error_messages=function(e){return e.find(".inline-errors")},pe.validation.show_message=function(e,i){e.parent().find(".inline-errors,img").remove(),i?e.after('<span class="inline-errors">'+i+"</span>"):e.after('<img src="/assets/users/check.png" />')},pe.validation.is_more_than_5_words=function(e){return!!e.match(/(\w+\s+){5}\w+/)},pe.validation.is_single_non_character=function(e){return!!e&&!e.match(/[a-zA-Z]+/)},pe.validation.is_valid_email_address=function(e){return!!e.match(/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/)},pe.validation.is_valid_email_list=function(e){if(!e)return"Please enter at least one email.";var i=e.split(","),a="";return $.each(i,function(e,i){if(i=$.trim(i),!pe.validation.is_valid_email_address(i))return a=i+" is not a valid email address.",!1}),a},pe.validation.contains_illegal_characters=function(e){return!!e.match(/[\!@#\$%\^&\*\(\)\{\}\[\]\/\=\"<>\~\;_\+\?\\]/)},pe.validation.ensure_email_not_blank_and_is_valid=function(e){var i=e.val();if("string"==typeof i&&(i||e.data("text_entered"))){e.data("text_entered",!0);var a=e.attr("data_label")||"Email";if(0!==i.length){var t=!0,n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/;$.each(i.split(","),function(e,i){t=t&&0<i.length&&n.test($.trim(i))}),t?(pe.validation.show_message(e,""),e.data("text_entered",!0)):pe.validation.show_message(e,"Please enter a valid email.")}else pe.validation.show_message(e,a+" cannot be blank.")}},pe.validation.validate_name=function(e){var i=e.val();"string"==typeof i&&(i||e.data("text_entered"))&&(e.data("text_entered",!0),pe.validation.is_single_non_character(i)?pe.validation.show_message(e,"Please enter a valid "+pe.validation.get_name_error_message(e)+"."):pe.validation.contains_illegal_characters(i)?pe.validation.show_message(e,"Please enter a valid name."):50<i.length?pe.validation.show_message(e,"Please shorten your name."):pe.validation.is_more_than_5_words(i)?pe.validation.show_message(e,"Please enter fewer than 5 words."):0<i.length?pe.validation.show_message(e,""):0<e[0].id.indexOf("first_name")?pe.validation.show_message(e,"Please enter your first name."):0<e[0].id.indexOf("last_name")?pe.validation.show_message(e,"Please enter your last name."):pe.validation.show_message(e,"Please enter your name."))},pe.validation.ensure_not_blank=function(e){var i=e.val();if("string"==typeof i&&(i||e.data("text_entered")))if(e.data("text_entered",!0),0===e.val().length){var a=e.attr("data_label")||"Field";pe.validation.show_message(e,a+" cannot be blank.")}else pe.validation.show_message(e,""),e.data("text_entered",!0)},pe.validation.validate_credit_card_number=function(e){var i=e.val();if(!(i.length<16)||e.data("text_entered"))return e.data("text_entered",!0),"string"==typeof i&&pe.is_valid_credit_card_number(i)?void pe.validation.show_message(e,""):void pe.validation.show_message(e,"Please enter a valid card number.")},pe.validation.validate_email=function(i){var e=i.val();(e||i.data("text_entered"))&&(i.data("text_entered",!0),$.getJSON("/api/users/check_email",{email:e},function(e){pe.validation.show_message(i,e.message)}))},pe.validation.validate_edited_email=function(e,i){var a=i.val();(a||i.data("text_entered"))&&(i.data("text_entered",!0),$.getJSON("/api/users/"+e+"/check_edited_email",{email:a},function(e){pe.validation.show_message(i,e.message)}))},pe.validation.validate_email_format=function(e){var i=e.val(),a=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/;0<i.length&&!a.test(i)?pe.validation.show_message(e,"Please enter a valid email."):0<i.length&&a.test(i)&&(pe.validation.show_message(e,""),e.data("text_entered",!0))},pe.validation.validate_email_list=function(e){var i=e.val();if("string"==typeof i){var a=pe.validation.is_valid_email_list(i);a&&pe.validation.show_message(e,a)}},pe.validation.validate_password=function(e){var i=e.val();i?0<i.length&&-1<i.indexOf(" ")?pe.validation.show_message(e,"No spaces allowed for password."):i.length<6?pe.validation.show_message(e,"Please enter a longer password."):(pe.validation.show_message(e,""),e.data("text_entered",!0)):e.data("text_entered")&&pe.validation.show_message(e,"Please enter a password.")},pe.validation.validate_security_code=function(e){var i=e.val();i.length<3&&!e.data("text_entered")||(e.data("text_entered",!0),i.match(/^\d{3}$/)||pe.validation.show_message(e,"Please enter a valid security code."))},pe.validation.validate_user_name=function(i){var e=i.val();i.attr("disabled")||(e||i.data("text_entered"))&&(i.data("text_entered",!0),50<e.length?pe.validation.show_message(i,"Please shorten your name."):0!==e.length?$.getJSON("/api/users/check_username",{username:e},function(e){pe.validation.show_message(i,e.message)}):pe.validation.show_message(i,"Please enter a user name."))},pe.validation.validate_change_of_username=function(e,i){var a=i.val();(a||i.data("text_entered"))&&(i.data("text_entered",!0),50<a.length?pe.validation.show_message(i,"Please shorten your name."):0!==a.length?$.getJSON("/api/users/"+e+"/check_edited_username",{username:a},function(e){pe.validation.show_message(i,e.message)}):pe.validation.show_message(i,"Please enter a user name."))},pe.validation.validate_zip_code=function(e){var i=e.val();i.length<5&&!e.data("text_entered")||(e.data("text_entered",!0),i.length<5?pe.validation.show_message(e,"Please enter a valid zip code."):"string"==typeof i&&pe.is_valid_zip_code(i)?pe.validation.show_message(e,""):pe.validation.show_message(e,"Please enter a valid zip code."))},pe.validation.terms_accepted=function(e){(e.attr("checked")||e.data("text_entered"))&&(e.data("text_entered",!0),e.attr("checked")?pe.validation.show_message(e.parent(),""):pe.validation.show_message(e.parent(),"Please accept the terms of use"))},pe.validation.get_name_error_message=function(e){return 0<e[0].id.indexOf("first_name")?"first name":0<e[0].id.indexOf("last_name")?"last name":"name"},pe.SubscribePage=function(e,i,a,t){pe.init_widget(this,e),this.subscribe_request_sent=!1,this.signup_source=a,this.is_mobile_device=i,this.signup_url="/services/subscriptions/"+(i?"mobile":"web"),this.referral_code=t||"",this.email_input=this.container.find(".YourEmail"),this.email_input.keyup(this.callback(this.email_input_key_handler)),pe.validate_on_blur(this.email_input,pe.validation.ensure_email_not_blank_and_is_valid),this.container.find(".InfieldLabel label").inFieldLabels({fadeDuration:0});var n=this.container.find(".SubscriptionList");this.is_mobile_device?n.removeClass("hidden"):n.multiselect({header:!1,selectedList:1,click:function(){if(0===$(this).multiselect("widget").find("input:checked").length)return!1}}),this.subscription_list_input=this.container.find("select"),this.subscribe_button=this.container.find(".Subscribe"),this.subscribe_button.click(this.callback(this.subscribe_button_clicked)),this.facebook_link_button=this.container.find(".FacebookSubscribeLink"),this.is_mobile_device?this.facebook_link_button.click(this.callback(this.mobile_facebook_link_clicked)):(this.facebook_link_button.click(this.callback(function(){pe.subscription_module=this})),this.setup_facebook_subscribe())},pe.SubscribePage.prototype.as_enum=function(){return{list_ids:this.subscription_list_input.val(),referral_code:this.referral_code,signup_source:this.signup_source}},pe.SubscribePage.prototype.email_input_key_handler=function(e){13===e.keyCode&&this.subscribe_button.click()},pe.SubscribePage.prototype.redirect_url=function(){return window.location.protocol+"//"+window.location.host+this.signup_url+"?signup_method=facebook&signup_source="+this.signup_source+"&list_ids="+this.subscription_list_input.val()+"&referral_code="+this.referral_code},pe.SubscribePage.prototype.add_subscriptions=function(e){if(!1===this.subscribe_request_sent){var i=_.extend(e,this.as_enum());this.request_in_process(),$.ajax({url:this.signup_url,data:$.param(i),type:"POST",success:this.callback(function(e){this.is_mobile_device?window.location=window.location.protocol+"//"+window.location.host+"/subscribe/confirm/":(this.subscribe_request_sent=!1,this.container.addClass("subscription_confirmation"),this.container.html(e),pe.subscription_module=null)})})}},pe.SubscribePage.prototype.setup_facebook_subscribe=function(){this.facebook_link_button.data("logged-in")?gigya.socialize.getUserInfo({callback:this.callback(function(e){this.facebook_link_button.click(this.callback(function(){_.contains(e.user.providers,"facebook")?this.add_subscriptions(_.extend(e.user,{signup_method:"facebook"})):gigya.services.socialize.plugins.login.providerClick("LinkAccounts","facebook")}))})}):this.facebook_link_button.click(this.callback(function(){gigya.services.socialize.plugins.login.providerClick("SocialLogin","facebook")}))},pe.SubscribePage.prototype.mobile_facebook_link_clicked=function(){if(null===this.subscription_list_input.val())return!1;var e={provider:"facebook",authFlow:"redirect",redirectMethod:"post",redirectURL:this.redirect_url(),context:this.as_enum()};this.facebook_link_button.data("logged-in")&&gigya&&gigya.socialize?gigya.socialize.login(e):gigya&&gigya.socialize&&gigya.socialize.addConnection(e)},pe.SubscribePage.prototype.subscribe_button_clicked=function(){return null!==this.subscription_list_input.val()&&(this.validate_on_submit()?void this.add_subscriptions({email:this.email_input.val(),signup_method:"email"}):(this.email_input.focus(),!1))},pe.SubscribePage.prototype.subscription_confirmation=function(e){this.is_mobile_device?window.location=window.location.protocol+"//"+window.location.host+"/subscribe/confirm/":(this.subscribe_request_sent=!1,this.container.addClass("subscription_confirmation"),this.container.html(e),pe.subscription_module=null)},pe.SubscribePage.prototype.request_in_process=function(){this.subscribe_request_sent=!0,this.container.html('<div class="lspinner" style="text-align: center;"><h2>Please Wait</h2><img src="/assets/content_bg/spinner.gif"/></div>')},pe.SubscribePage.prototype.validate_on_submit=function(){return pe.validation.clear_error_messages(this.container),this.email_input.data("text_entered",!0).blur(),0===this.container.find(".inline-errors").length},pe.validation.ensure_email_not_blank_and_is_valid=function(e){var i=e.val();if("string"==typeof i&&(i||e.data("text_entered")))if(e.data("text_entered",!0),0!==i.length){var a=!0,t=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9])([A-Za-z0-9_\-\.])*\.([A-Za-z]{2,4})$/;$.each(i.split(","),function(e,i){a=a&&0<i.length&&t.test($.trim(i))}),a?(pe.validation.show_message(e,""),e.data("text_entered",!0)):pe.validation.show_message(e,"Please enter a valid email address")}else pe.validation.show_message(e,"Please enter your email address")},$(document).ready(function(){var e=window.is_mobile_device;new pe.SubscribePage($(".SubscribeFormContainer"),e,window.source_label,window.referral_code),e||pe.init_page_framework()});