pe.CloseButton=function(a,b){pe.init_widget(this,a);this.close_button=a.find(".CloseButton");if("function"===typeof b)this.close_button.click(b);else switch(b){case pe.CloseButton.close_methods.REMOVE:this.close_button.click(this.callback(this.remove_container));break;case pe.CloseButton.close_methods.HIDE:this.close_button.click(this.callback(this.hide_container));break;default:alert("unknown value for 'close_method' parameter.")}};pe.CloseButton.close_methods={REMOVE:"REMOVE",HIDE:"HIDE"};
pe.CloseButton.events={CLOSED:"CloseButton_CLOSED"};pe.CloseButton.prototype.remove_container=function(){this.container.detach();this.fire_event(pe.CloseButton.events.CLOSED);this.container.remove();return!1};pe.CloseButton.prototype.hide_container=function(){this.fire_event(pe.CloseButton.events.CLOSED);this.container.hide();return!1};
pe.PolymorphicSortableAutocomplete=function(a,b,c,d,g,e,f){pe.init_widget(this,a);this.autocomplete_data_or_url=b;this.limit=e;this.input_field_group=c;this.input_field_id_name=d;this.input_field_type_name=g;this.input_field_count=0;this.container.html(this.html());this.dummy_input_field=this.container.find(".DummyInputField");this.messaging_area=this.container.find(".Messaging");this.autocomplete_input_field=this.container.find(".AutocompleteField");a=this.autocomplete_input_field.autocomplete({source:this.autocomplete_data_or_url,
minLength:1,close:this.callback(this.autocomplete_closed),select:this.callback(this.autocomplete_entry_selected)}).data("autocomplete");a._renderItem=pe.PolymorphicSortableAutocomplete.render_autocomplete_entry;a._renderMenu=pe.PolymorphicSortableAutocomplete.render_autocomplete_list;this.selected_data_list_div=this.container.find(".SelectedDataList");this.selected_data_list_div.sortable();this.selected_data_list_div.disableSelection();f&&this.add_data_to_list(f)};
pe.PolymorphicSortableAutocomplete.events={SELECTED:"PolymorphicSortableAutocomplete_SELECTED"};pe.PolymorphicSortableAutocomplete.prototype.add_data_to_list=function(a){0!==a.length&&(this.remove_dummy_row(),$.each(a,this.callback(function(a,c){this.add_selected_data(c.label,c.id,c.category)})),this.enforce_limit())};
pe.PolymorphicSortableAutocomplete.prototype.add_dummy_row=function(){this.dummy_input_field||(this.dummy_input_field=$('<input class="DummyInputField" type="hidden" name="'+this.input_field_group+'[]" value="">'),this.autocomplete_input_field.after(this.dummy_input_field))};
pe.PolymorphicSortableAutocomplete.prototype.add_selected_data=function(a,b,c){this.remove_dummy_row();this.selected_data_list_div.append(this.selected_data_html(a,b,c));(new pe.CloseButton(this.selected_data_list_div.find(".SelectedInputData").last(),pe.CloseButton.close_methods.REMOVE)).bind_event(pe.CloseButton.events.CLOSED,this.callback(this.close_button_clicked));this.enforce_limit()};pe.PolymorphicSortableAutocomplete.prototype.autocomplete_closed=function(){this.autocomplete_input_field.val("")};
pe.PolymorphicSortableAutocomplete.prototype.autocomplete_entry_selected=function(a,b){var c=b.item;this.add_selected_data(c.label,c.id,c.category);this.fire_event(pe.PolymorphicSortableAutocomplete.events.SELECTED,c.id)};pe.PolymorphicSortableAutocomplete.prototype.close_button_clicked=function(){0===this.selected_data_list_div.find(".SelectedInputData").length&&this.add_dummy_row();this.enforce_limit()};
pe.PolymorphicSortableAutocomplete.prototype.enforce_limit=function(){this.selected_data_list_div.find(".SelectedInputData").length>=this.limit?(this.messaging_area.html("You have reached the selection limit. Please remove before adding."),this.autocomplete_input_field.autocomplete("disable")):(this.messaging_area.html(""),this.autocomplete_input_field.autocomplete("enable"))};
pe.PolymorphicSortableAutocomplete.prototype.html=function(){return'<input class="AutocompleteField" type="text"><div class="Messaging"></div><input class="DummyInputField" type="hidden" name="'+this.input_field_group+'[]" value=""><ul class="SelectedDataList" id="sortable"></ul>'};pe.PolymorphicSortableAutocomplete.prototype.remove_dummy_row=function(){this.dummy_input_field&&(this.dummy_input_field.remove(),this.dummy_input_field=null)};
pe.PolymorphicSortableAutocomplete.render_autocomplete_entry=function(a,b){b.display_label=b.category?pe.templatize("{{label}} ({{category}})",b):b.label;var c=$(pe.templatize("<li><a>{{display_label}}</a></li>",b));c.data("item.autocomplete",b);a.append(c);return c};pe.PolymorphicSortableAutocomplete.render_autocomplete_list=function(a,b){var c=this,d="";$.each(b,function(b,e){e.type!=d&&(a.append("<li class='ui-autocomplete-category  first_category'>"+e.type+"</li>"),d=e.type);c._renderItem(a,e)})};
pe.PolymorphicSortableAutocomplete.prototype.generate_full_input_names=function(){this.input_field_count++;return{id:this.input_field_group+"["+this.input_field_count+"]["+this.input_field_id_name+"]",type:this.input_field_group+"["+this.input_field_count+"]["+this.input_field_type_name+"]"}};
pe.PolymorphicSortableAutocomplete.prototype.selected_data_html=function(a,b,c){var a=a+"("+c+")",d=this.generate_full_input_names();return'<li class="SelectedInputData ui-state-default"><img style="margin-right:20px; width: 15px; height: 15px;" src="/assets/events/close.png"class="CloseButton float_left"><p class="float_left">'+a+'</p><input type="hidden" value="'+b+'" name="'+d.id+'"><input type="hidden" value="'+c+'" name="'+d.type+'"><div class="clear"></div></li>'};
